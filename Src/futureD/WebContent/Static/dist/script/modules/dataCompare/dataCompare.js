var dataCompareSwalMixin=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"}),dataCompareState=new Object;function redirectLogin(t){dataCompareSwalMixin({title:"mock数据异常",text:t.text,type:"error",showConfirmButton:!1,timer:2500}).then(function(a){a.dismiss!=swal.DismissReason.backdrop&&a.dismiss!=swal.DismissReason.esc&&a.dismiss!=swal.DismissReason.timer||window.location.assign(t.url)})}function getdataCompareData(o,a,t){var e=store.get("futureDT2__datalist__pageDataObj");if(_.isEmpty(e)||_.isNil(e))return redirectLogin({text:"意外被删除，请重新进入下数据列表！",url:"dataList.html"}),!1;var n=JSON.parse(e).data;store.set("futureDT2__datalist__selectedItem",[]);var r=store.get("futureDT2__datalist__selectedItem");if(_.isEmpty(r)||_.isNil(r)){var i=[];if(null==o||""==o?i=_.cloneDeep(n):_.forEach(n,function(t){_.forOwn(t,function(a){if(-1<String(a.value).indexOf(o))return-1<_.indexOf(dataCompareState.sellectObj.selectItem,t.wafer_id.value)&&dataCompareState.sellectObj.selectSearchItem.push(t.wafer_id.value),i.push(t),!1})}),t)return i;var l=_.filter(i,function(a){return"0"==a.delete_status.value});if(a)return l;var p=_.chunk(_.reverse(_.sortBy(l,function(a){return a.test_start_date.value})),10);return dataCompareState.searchObj.hasSearch?(dataCompareState.pageSearchObj.pageCount=p.length,dataCompareState.pageSearchObj.itemLength=l.length,dataCompareState.pageSearchObj.data=_.cloneDeep(p)):(dataCompareState.pageObj.pageCount=p.length,dataCompareState.pageObj.itemLength=l.length,dataCompareState.pageObj.data=_.cloneDeep(p)),p}var d=[];if(_.forEach(r,function(e,a){if(null==o||""==o)d.push(_.find(n,function(a){return a.wafer_id.value==e}));else{var r=_.find(n,function(a){return a.wafer_id.value==e});_.forOwn(r,function(a,t){if(-1<String(a.value).indexOf(o))return-1<_.indexOf(dataCompareState.sellectObj.selectItem,e.wafer_id.value)&&dataCompareState.sellectObj.selectSearchItem.push(e.wafer_id.value),d.push(r),!1})}}),t)return d;var s=_.filter(d,function(a){return"0"==a.delete_status.value});if(a)return s;var c=_.chunk(_.reverse(_.sortBy(s,function(a){return a.test_start_date.value})),10);return dataCompareState.searchObj.hasSearch?(dataCompareState.pageSearchObj.pageCount=c.length,dataCompareState.pageSearchObj.itemLength=s.length,dataCompareState.pageSearchObj.data=_.cloneDeep(c)):(dataCompareState.pageObj.pageCount=c.length,dataCompareState.pageObj.itemLength=s.length,dataCompareState.pageObj.data=_.cloneDeep(c)),c}function dataCompareRenderData(o){if(null!=o.chunkArr){var n="";o.chunkArr[o.currentPage-1].map(function(a,t,e){var r=a.wafer_id.value;o.currentPage;n+='<tr><td class="not_search"><input type="checkbox" data-ivalue="'+r+'"></td><td data-itext="第'+r+"条"+a.product_category.value+'">第'+r+"条"+a.product_category.value+'</td><td data-itext="'+a.device_number.value+'">'+a.device_number.value+'</td><td data-itext="'+a.lot_number.value+'">'+a.lot_number.value+'</td><td data-itext="'+a.wafer_number.value+'">'+a.wafer_number.value+'</td><td data-itext="'+a.qualified_rate.value+'">'+a.qualified_rate.value+'</td><td data-itext="'+a.test_start_date.value+'">'+a.test_start_date.value+'</td><td data-itext="'+a.archive_user.value+'">'+a.archive_user.value+'</td><td data-itext="'+a.description.value+'">'+a.description.value+"</td></tr>"}),$(".home_dataCompare_top tbody").empty().append(n),dataCompareState.searchObj.hasSearch?($(".home_dataCompare_top tbody [type='checkbox']").each(function(){-1<_.indexOf(dataCompareState.sellectObj.selectSearchItem,$(this).data("ivalue").toString())&&$(this).prop("checked",!0).parent().parent().addClass("warning").removeClass("info")}),$(".home_dataCompare_top tbody td:not(.not_search)").each(function(){var a=$(this).text(),t="<b style='color:red'>"+dataCompareState.searchObj.searchVal+"</b>",e=a.replace(new RegExp(dataCompareState.searchObj.searchVal,"g"),t);$(this).empty().html(e)}),$("#checkAll").prop("checked",dataCompareState.pageSearchObj.itemLength==dataCompareState.sellectObj.selectSearchItem.length)):($(".home_dataCompare_top tbody [type='checkbox']").each(function(){-1<_.indexOf(dataCompareState.sellectObj.selectItem,$(this).data("ivalue").toString())&&$(this).prop("checked",!0).parent().parent().addClass("warning").removeClass("info")}),$("#checkAll").prop("checked",dataCompareState.pageObj.itemLength==dataCompareState.sellectObj.selectItem.length))}}function eleResize(){var a=$(window).height();a<600&&(a=600),$("body").height(a),$(".g_bodyin_bodyin_bottom").innerHeight(a-165),$(".g_bodyin_bodyin_bottom>.tab-content").innerHeight(a-165),$(".home_dataCompare_top .body_div").innerHeight(a/2-83),$(".home_dataCompare_bottom .left_div, .home_dataCompare_bottom .right_div").innerHeight(a/2-92),$(".home_dataCompare_bottom .right_div .panel-body").innerHeight(a/2-175)}function judgeNav(a){{if("wafer"==a.classify)return 0==dataCompareState.sellectObj.selectItem.length?($(".g_bodyin_bodyin_top_wrap>ul").empty().append('<li role="presentation" class="active"><a href="#home_dataCompare" aria-controls="home_dataCompare" role="tab" data-toggle="tab">主页面</a></li>'),dataCompareState.stateObj.canClickParam=!1,dataCompareState.stateObj.curParam=null,!1):(dataCompareState.stateObj.canClickParam=!0,judgeNav({classify:"param",param:{TotalYield:a.param.TotalYield,other:_.cloneDeep(a.param.other)}}));if("param"==a.classify){var t=[],e=[{href:"map_good_rate_distribution",text:"Map良率分布"},{href:"map_color_order_distribution",text:"Map色阶分布"},{href:"good_rate",text:"良品率图"},{href:"histogram",text:"直方图"},{href:"boxlinediagram",text:"箱线图"},{href:"CPK",text:"CPK图"}],r=[{href:"map_good_rate_distribution",text:"Map良率分布"},{href:"map_color_order_distribution",text:"Map色阶分布"},{href:"good_rate",text:"良品率图"},{href:"histogram",text:"直方图"},{href:"boxlinediagram",text:"箱线图"},{href:"CPK",text:"CPK图"},{href:"correlationgraph",text:"相关性图"}];return dataCompareState.stateObj.curParam=_.cloneDeep(a.param),0==a.param.TotalYield?0==a.param.other.length?t.length=0:2==a.param.other.length?t=_.cloneDeep(r):2!=a.param.other.length&&(t=_.cloneDeep(e)):0==a.param.other.length?t=[{href:"map_good_rate_distribution",text:"Map良率分布"},{href:"good_rate",text:"良品率图"}]:2==a.param.other.length?t=_.cloneDeep(r):2!=a.param.other.length&&(t=_.cloneDeep(e)),t}}}function renderNav(a){if(!1!==a){var r='<li role="presentation" class="active"><a href="#home_dataCompare" aria-controls="home_dataCompare" role="tab" data-toggle="tab">主页面</a></li>';a.map(function(a,t,e){r+='<li role="presentation"><a href="#'+a.href+'" aria-controls="'+a.href+'" role="tab" data-toggle="tab">'+a.text+"</a></li>"}),_.isEmpty(a)||(r+='<li role="presentation"><a href="#all_statistics" aria-controls="all_statistics" role="tab" data-toggle="tab">所有统计</a></li>'),$(".g_bodyin_bodyin_top_wrap>ul").empty().append(r)}}function groupJudgeRenderNav(a){var t=[];$("#home_param_ul>li.list-group-item-info:not([data-iparam='TotalYield'])").each(function(){t.push($(this).data("iparam"))}),renderNav(judgeNav({classify:a,param:{TotalYield:$("#home_param_ul>li.list-group-item-info[data-iparam='TotalYield']").length,other:_.cloneDeep(t)}}))}function renderPanel(a,t,e,r,o){var n="";if("map_good_rate_distribution"==e||"map_color_order_distribution"==e){if(1==a&&"map_good_rate_distribution"==e){n+='<div class="panel panel-info"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>Total Yield</div><div class="panel-body"><div class="container-fluid">';var i=buildMapContainer({divi:3,controls:e,iparam:"TotalYield",iclassify:"map"});n+=i,n+="</div></div></div>"}t.map(function(a,t){n+='<div class="panel panel-info"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>'+a+'</div><div class="panel-body"><div class="container-fluid">',n+=buildMapContainer({divi:3,controls:e,iparam:a,iclassify:"map"}),n+="</div></div></div>"})}else if("good_rate"==e){var l=2;(6<dataCompareState.sellectObj.selectItem.length||1==dataCompareState.stateObj.curParam.other.length)&&(l=1),n=buildMapContainer({divi:l,controls:e,iparam:null,iclassify:"otherSingle"})}else if(-1<["histogram","boxlinediagram","CPK"].indexOf(e)){var p=2;(6<dataCompareState.sellectObj.selectItem.length||1==dataCompareState.stateObj.curParam.other.length)&&(p=1),n=buildMapContainer({divi:p,controls:e,iparam:null,iclassify:"otherSingleNotTY"})}else"correlationgraph"==e&&(n=buildMapContainer({divi:1,controls:e,iparam:dataCompareState.stateObj.curParam.other.join(" VS "),iclassify:"correlationgraph"}));!0===r?o&&o(n):$("div[role='tabpanel']#"+e+">.single_div_in").empty().append(n)}function buildMapContainer(a){var r="",o=a.divi,n=a.controls,i=a.iparam,t=a.iclassify;if("otherSingle"==t||"otherSingleNotTY"==t){var e=[];"otherSingle"==t&&(e[dataCompareState.stateObj.curParam.TotalYield]="TotalYield",_.pullAt(e,0));var l=_.concat(e,dataCompareState.stateObj.curParam.other),p=Math.ceil(l.length/o),d=_.join(_.sortBy(dataCompareState.sellectObj.selectItem));r+='<div class="container-fluid">',_.times(p,function(e){r+='<div class="row">',_.times(o,function(a){var t=e*o+a;t<l.length&&(r+='<div class="col-sm-12 col-md-'+12/o+" col-lg-"+12/o+'">',r+='<div class="panel panel-info"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>'+l[t]+'</div><div class="panel-body"><div class="chart_otherSingle_tit">头</div><div class="chart_otherSingle_body"><div id="'+(n+dataCompareState.stateObj.curChartContainerNum)+'" data-ivalue="'+d+'" data-ichart="'+n+'" data-iparam="'+l[t]+'"></div></div><div class="chart_otherSingle_foot">脚</div></div></div>',r+="</div>",dataCompareState.stateObj.curChartContainerNum++)}),r+="</div>"}),r+="</div>"}else if("map"==t){var s=dataCompareState.sellectObj.selectItem.length,c=Math.ceil(s/o);_.times(c,function(e){r+='<div class="row">',_.times(o,function(a){var t=e*o+a;t<s&&(r+='<div class="col-sm-6 col-md-'+12/o+" col-lg-"+12/o+'">',r+='<div class="chart_map_tit">wafer'+dataCompareState.sellectObj.selectItem[t]+"</div>",r+='<div class="chart_map_body"><div id="'+(n+dataCompareState.stateObj.curChartContainerNum)+'" data-ivalue="'+dataCompareState.sellectObj.selectItem[t]+'" data-ichart="'+n+'" data-iparam="'+i+'"></div></div>',r+='<div class="chart_map_foot"></div>',r+="</div>",dataCompareState.stateObj.curChartContainerNum++)}),r+="</div>"})}else if("correlationgraph"==t){var h=_.join(_.sortBy(dataCompareState.sellectObj.selectItem));r+='<div class="container-fluid"><div class="row"><div class="col-sm-12 col-md-12 col-lg-12"><div class="panel panel-info"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>'+i+'</div><div class="panel-body"><div class="chart_otherSingle_tit">头</div><div class="chart_otherSingle_body"><div id="'+(n+dataCompareState.stateObj.curChartContainerNum)+'" data-ivalue="'+h+'" data-ichart="'+n+'" data-iparam="'+i+'"></div></div><div class="chart_otherSingle_foot">脚</div></div></div></div></div></div>',dataCompareState.stateObj.curChartContainerNum++}return r}function draw_map_good_rate_distribution(a,t){var e=a.innerWidth();a.innerHeight(e);var r="canvas_"+a.attr("id");a.append("<canvas id='"+r+"'></canvas>"),a.after("<div class='criterion_"+r+"'></div>"),buildColorGradation({width:e,height:e,container:r,bgFillColor:"#314067",waferData:futuredGlobal.S_getMockWaferData()[0],spacePercent:{x:.05,y:.05},m_DieDataListNew:futuredGlobal.S_getMockWaferData()[0].waferMapDataList[t%5].m_DieDataListNew,colorGradation:{limitColor:"#FF0000",floorColor:"#00FF00",nums:256}})}function draw_map_color_order_distribution(e,a,t,r,o,n,i,l,p,d,s,c,h){var m=e.innerWidth();e.innerHeight(m);var u="canvas_"+e.attr("id");e.append("<canvas id='"+u+"'></canvas>"),e.after("<div class='criterion_"+u+"'><div class='colorGradient'></div></div>"),buildColorGradation({width:m,height:m,container:u,bgFillColor:"#314067",waferData:t,spacePercent:{x:.05,y:.05},m_DieDataListNew:t.waferMapDataList[a%5].m_DieDataListNew,colorGradation:{theMinColor:"#0000FF",lowwerColor:"#00FFFF",midderColor:"#00FF00",upperColor:"#FFFF00",theMaxColor:"#FF0000",twoDiff:p,threeDiff:d,fourDiff:s,fiveDiff:c},colorOrder:!0,theMin:o,lowwer:n,midder:l,upper:i,theMax:r,otherColor:h});var g=e.next().find("div.colorGradient");g.width(e.next().width()-60).height(e.next().height()-30);var b=p+d+s+c,f=g.height(),C=g.width()/(1.2*b);g.append("<span class='colorGradientSpan oneSpan outSpan'><span style='height: "+f+"px; width: "+C+"px'></span></span>"),g.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+C+"px;'></span>"),_.times(p,function(a){var t=getGradientColor("#00FFFF","#0000FF",p,p-a);g.append("<span class='colorGradientSpan' data-icolor='"+t+"' style='background: "+t+"; height: "+f+"px; width: "+C+"px'></span>")}),g.append("<span class='colorGradientSpan twoSpan outSpan'><span style='height: "+f+"px; width: "+C+"px'></span></span>"),g.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+C+"px;'></span>"),_.times(d,function(a){var t=getGradientColor("#00FF00","#00FFFF",d,d-a);g.append("<span class='colorGradientSpan' data-icolor='"+t+"' style='background: "+t+"; height: "+f+"px; width: "+C+"px'></span>")}),g.append("<span class='colorGradientSpan threeSpan outSpan'><span style='height: "+f+"px; width: "+C+"px'></span></span>"),g.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+C+"px;'></span>"),_.times(s,function(a){var t=getGradientColor("#FFFF00","#00FF00",s,s-a);g.append("<span class='colorGradientSpan' data-icolor='"+t+"' style='background: "+t+"; height: "+f+"px; width: "+C+"px'></span>")}),g.append("<span class='colorGradientSpan fourSpan outSpan'><span style='height: "+f+"px; width: "+C+"px'></span></span>"),g.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+C+"px;'></span>"),_.times(c,function(a){var t=getGradientColor("#FF0000","#FFFF00",c,c-a);g.append("<span class='colorGradientSpan' data-icolor='"+t+"' style='background: "+t+"; height: "+f+"px; width: "+C+"px'></span>")}),g.append("<span class='colorGradientSpan fiveSpan outSpan'><span style='height: "+f+"px; width: "+C+"px'></span></span>"),g.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+C+"px;'></span>"),g.append("<span class='colorGradientSpan sixSpan outSpan'><span style='height: "+f+"px; width: "+C+"px'></span></span>");var v=_.countBy(t.waferMapDataList[a%5].m_DieDataListNew,function(a,t){var e;return _.forOwn(a,function(a,t){e=a.color.split(":")[0]}),e});$('<table class="table table-striped table-bordered table-condensed"><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table>').appendTo(e.parent().next()),console.log(v),_.forOwn(v,function(a,t){if(-1==t||12==t)return!0;e.parent().next().find("th").eq(t-1).text(t+"区间"),e.parent().next().find("td").eq(t-1).text(a+"个")}),e.parent().next().find("th").each(function(a){_.isEmpty($(this).text())&&($(this).text(a+1+"区间"),e.parent().next().find("td").eq(a).text("0个"))})}function draw_other_chart(a,t,e){var r,o,n,i,l=a.attr("id"),p=a.data("iparam");switch(t){case"histogram":r="直方图-"+p;o={categories:[["-∞",423e-8],[423e-8,448e-8],[448e-8,47300000000000005e-22],[47300000000000005e-22,498e-8],[498e-8,523e-8],[523e-8,548e-8],[548e-8,5729999999999999e-21],[5729999999999999e-21,59799999999999995e-22],[59799999999999995e-22,623e-8],[623e-8,"+∞"]],type:"linear",labels:{rotation:-45},plotLines:[{color:"#FF0000",width:2,value:.5},{color:"#FF0000",width:2,value:8.5}]},n={title:{text:"百分数"}};var d=[];_.forEach(dataCompareState.sellectObj.selectItem,function(a,t){var e={};e.name="wafer"+a,e.type="column",e.data=[2,8,10,5,15,20,3,7,10,20],d.push(e)}),i=d;break;case"boxlinediagram":r="箱线图-"+p,o={categories:_.forEach(_.cloneDeep(dataCompareState.sellectObj.selectItem),function(a,t,e){e[t]="wafer"+a}),title:{text:"晶圆"}},n={title:{text:"值"}};var s=dataCompareState.mock.boxlinediagram_data,c=[],h=[];_.forEach(dataCompareState.sellectObj.selectItem,function(a,t,e){var r=[],o=t%3+1;r.push(s["param"+o].lowerOfInner),r.push(s["param"+o].Q1),r.push(s["param"+o].Median),r.push(s["param"+o].Q3),r.push(s["param"+o].UpperOfInner),c.push(r);var n=[];n.push("wafer"+a),t%2==0?n.push(s["param"+o].lowerOfInner-1e-6):n.push(s["param"+o].UpperOfInner+2e-6),h.push(n)}),i=[{name:"观测值",data:c,tooltip:{headerFormat:"<em>晶圆： {point.key}</em><br/>"}},{name:"异常值",color:Highcharts.getOptions().colors[0],type:"scatter",data:h,marker:{fillColor:"white",lineWidth:1,lineColor:Highcharts.getOptions().colors[0]},tooltip:{pointFormat:"Observation: {point.y}"}}];break;case"CPK":r="CPK-"+p;var m=_.range(1,13);_.forEach(m,function(a,t,e){e[t]=eouluGlobal.S_numToChineseSm(a)}),o={categories:m},n={title:{text:"values"}};var u=[];_.forEach(dataCompareState.sellectObj.selectItem,function(a,t){var e={};e.name="wafer"+a;var r=[];_.times(12,function(){r.push(_.round(_.random(1,30,!0),2))}),e.data=r,u.push(e)}),i=u;break;case"correlationgraph":r="相关性图-"+p,o={title:{enabled:!0,text:dataCompareState.stateObj.curParam.other[0]},startOnTick:!0,endOnTick:!0,showLastLabel:!0},n={title:{text:dataCompareState.stateObj.curParam.other[1]}};var g=dataCompareState.mock.dataCompare.correlationgraph,b=[];_.forEach(dataCompareState.sellectObj.selectItem,function(a,t,e){var r={};r.name="wafer"+a,r.data=[],_.forOwn(g.dataMap,function(e,a){a=="wafer"+(t%3+1)&&0<e.X.length&&_.forEach(e.X,function(a,t){r.data.push([a,e.Y[t]])})}),b.push(r)}),i=b;break;default:r="良品率图-"+p;var f={};f.name=p,f.data=[];var C=[];_.forEach(dataCompareState.sellectObj.selectItem,function(a,t,e){f.data.push(_.round(_.random(0,1,!0),4)),C.push("wafer"+a)}),o={categories:C},n={title:{text:"比率"},min:0,max:1,tickInterval:.1,labels:{formatter:function(){return this.value}}},i=[f]}dataCompareRenderChart({container:l,chart:{type:e},title:{text:r},subtitle:{text:null},xAxis:o,yAxis:n,series:_.cloneDeep(i),chartClassify:t})}dataCompareState.paginationObj={normal:null,search:null},dataCompareState.pageObj={selector:null,pageOption:null,currentPage:null,pageCount:null,itemLength:null,data:null},dataCompareState.pageSearchObj={selector:"#pagelist",pageOption:{limit:10,count:0,curr:0,ellipsis:!0,pageShow:2,hash:!1,callback:function(a){(dataCompareState.pageSearchObj.currentPage=a.curr,a.isFirst)||dataCompareRenderData({chunkArr:getdataCompareData(dataCompareState.searchObj.searchVal),currentPage:dataCompareState.pageSearchObj.currentPage})}},currentPage:null,pageCount:null,itemLength:null,data:null},dataCompareState.searchObj={hasSearch:!1,searchVal:null},dataCompareState.sellectObj={selectAll:!1,selectItem:[],selectSearchItem:[]},dataCompareState.stateObj={canClickParam:!1,curParam:null,curChartContainerNum:0,searchShow:!0},dataCompareState.chartTypeMap={good_rate:"spline",histogram:"column",boxlinediagram:"boxplot",CPK:"line",correlationgraph:"scatter"},dataCompareState.mock={dataCompare:futuredGlobal.S_getDataCompare(),boxlinediagram_data:futuredGlobal.S_getDataCompare().boxlinediagram.data[5]},$(".g_info_m_in").hide(),eleResize(),$(window).on("resize",function(){eleResize()}),$(function(){var a=getdataCompareData(null);!1!==a&&(dataCompareRenderData({chunkArr:a,currentPage:1}),dataCompareState.pageObj.selector="#pagelist",dataCompareState.pageObj.pageOption={limit:10,count:dataCompareState.pageObj.itemLength,curr:1,ellipsis:!0,pageShow:2,hash:!1,callback:function(a){(dataCompareState.pageObj.currentPage=a.curr,a.isFirst)||dataCompareRenderData({chunkArr:getdataCompareData(dataCompareState.searchObj.searchVal),currentPage:dataCompareState.pageObj.currentPage})}},dataCompareState.paginationObj.normal=new Pagination(dataCompareState.pageObj.selector,dataCompareState.pageObj.pageOption))}),$(".g_info_r>.glyphicon-user").click(function(){window.location.assign("admin.html")}),$(".g_info_r>.glyphicon-search").click(function(){var a=$(".g_info_m").innerWidth();$(this).css("position","relative").animate({left:-(a/2+20)+"px"},500,"swing",function(){$(this).fadeOut(200,function(){$(".g_info_m_in").fadeIn(200).fadeTo(1,1),dataCompareState.stateObj.searchShow=!1})})}),$(".g_info_m_in span.input-group-addon").click(function(){$(".g_info_m_in").fadeTo(0,200,function(){$(this).fadeOut(200),$(".g_info_r>.glyphicon-search").fadeIn(100).animate({left:"0px"},600,"swing",function(){$(this).css("position","static"),dataCompareState.stateObj.searchShow=!0})})}),$(document).on("mouseover",".home_dataCompare_top td",function(){$(this).addClass("warning").parent().addClass("info")}).on("mouseout",".home_dataCompare_top td",function(){$(this).removeClass("warning").parent().removeClass("info")}).on("click",".home_dataCompare_top td",function(){$(this).parent().toggleClass("warning info").find("[type='checkbox']").prop("checked",!$(this).parent().find("[type='checkbox']").prop("checked")).change()}).on("click",".home_dataCompare_top tbody [type='checkbox']",function(a){a.stopPropagation(),$(this).parent().parent().toggleClass("warning info")}).on("change",".home_dataCompare_top tbody [type='checkbox']",function(){var a=$(this).data("ivalue").toString();$(this).prop("checked")?(dataCompareState.sellectObj.selectItem.push(a),dataCompareState.searchObj.hasSearch&&dataCompareState.sellectObj.selectSearchItem.push(a),$(".home_dataCompare_bottom tbody>tr [type='checkbox'][data-ivalue='"+Number(a)+"']").parent().parent().remove(),$(".home_dataCompare_bottom tbody").append($(this).parent().parent().clone()),$(".home_dataCompare_bottom tbody tr, .home_dataCompare_bottom tbody td").removeClass("info warning")):(_.pull(dataCompareState.sellectObj.selectItem,a),dataCompareState.searchObj.hasSearch&&_.pull(dataCompareState.sellectObj.selectSearchItem,a),$(".home_dataCompare_bottom tbody [type='checkbox'][data-ivalue='"+Number(a)+"']").parent().parent().remove()),dataCompareState.sellectObj.selectItem=_.uniq(dataCompareState.sellectObj.selectItem),dataCompareState.sellectObj.selectSearchItem=_.uniq(dataCompareState.sellectObj.selectSearchItem),dataCompareState.searchObj.hasSearch?$("#checkAll").prop("checked",dataCompareState.pageSearchObj.itemLength==dataCompareState.sellectObj.selectItem.length):$("#checkAll").prop("checked",dataCompareState.pageObj.itemLength==dataCompareState.sellectObj.selectItem.length),dataCompareState.sellectObj.selectAll=$("#checkAll").prop("checked"),groupJudgeRenderNav("wafer")}),$("#checkAll").on({click:function(){var a=$(this);if($(".home_dataCompare_top tbody [type='checkbox']").each(function(){$(this).prop("checked",a.prop("checked")),a.prop("checked")?$(this).parent().parent().removeClass("info").addClass("warning"):$(this).parent().parent().removeClass("warning info")}),dataCompareState.sellectObj.selectAll=a.prop("checked"),a.prop("checked")){dataCompareSwalMixin({title:"加载全部数据",text:"正在加载中......",type:"info",showConfirmButton:!1,showCancelButton:!1});var t=JSON.parse(store.get("futureDT2__datalist__pageDataObj")).data;if(dataCompareState.searchObj.hasSearch)dataCompareState.sellectObj.selectSearchItem=[],t.map(function(r,a){if("0"!=r.delete_status.value)return!0;_.forOwn(r,function(a){if(-1<String(a.value).indexOf(dataCompareState.searchObj.searchVal)){if(dataCompareState.sellectObj.selectSearchItem.push(r.wafer_id.value),-1==_.indexOf(dataCompareState.sellectObj.selectItem,r.wafer_id.value)){dataCompareState.sellectObj.selectItem.push(r.wafer_id.value);var t=r.wafer_id.value,e='<tr><td class="not_search"><input type="checkbox" data-ivalue="'+t+'"></td><td data-itext="第'+t+"条"+r.product_category.value+'">第'+t+"条"+r.product_category.value+'</td><td data-itext="'+r.lot_number.value+'">'+r.lot_number.value+'</td><td data-itext="'+r.wafer_number.value+'">'+r.wafer_number.value+'</td><td data-itext="'+r.qualified_rate.value+'">'+r.qualified_rate.value+'</td><td data-itext="'+r.test_start_date.value+'">'+r.test_start_date.value+'</td><td data-itext="'+r.archive_user.value+'">'+r.archive_user.value+'</td><td data-itext="'+r.description.value+'">'+r.description.value+"</td></tr>";$(".home_dataCompare_bottom tbody>tr").length?$(".home_dataCompare_bottom tbody>tr:first").before(e):$(".home_dataCompare_bottom tbody").append(e)}return!1}})}),dataCompareState.sellectObj.selectItem=_.uniq(dataCompareState.sellectObj.selectItem);else{var r="";dataCompareState.sellectObj.selectItem=[],t.map(function(a,t){if("0"!=a.delete_status.value)return!0;dataCompareState.sellectObj.selectItem.push(a.wafer_id.value);var e=a.wafer_id.value;r='<tr><td class="not_search"><input type="checkbox" data-ivalue="'+e+'"></td><td data-itext="第'+e+"条"+a.product_category.value+'">第'+e+"条"+a.product_category.value+'</td><td data-itext="'+a.lot_number.value+'">'+a.lot_number.value+'</td><td data-itext="'+a.wafer_number.value+'">'+a.wafer_number.value+'</td><td data-itext="'+a.qualified_rate.value+'">'+a.qualified_rate.value+'</td><td data-itext="'+a.test_start_date.value+'">'+a.test_start_date.value+'</td><td data-itext="'+a.archive_user.value+'">'+a.archive_user.value+'</td><td data-itext="'+a.description.value+'">'+a.description.value+"</td></tr>"+r}),$(".home_dataCompare_bottom tbody").empty().append(r)}setTimeout(function(){swal.clickCancel()},2e3)}else dataCompareState.searchObj.hasSearch?(dataCompareState.sellectObj.selectSearchItem.map(function(a){_.pull(dataCompareState.sellectObj.selectItem,a),$(".home_dataCompare_bottom tbody [type='checkbox'][data-ivalue='"+Number(a)+"']").parent().parent().remove()}),dataCompareState.sellectObj.selectSearchItem=[]):(dataCompareState.sellectObj.selectItem=[],$(".home_dataCompare_bottom tbody").empty());groupJudgeRenderNav("wafer")}}),$(".g_info_m_in .form-control-feedback").click(function(){$(this).prev().children("input").val("")}),$("#search_input").on("input propertychange change",function(){""!=$(this).val().trim()?$(this).parent().parent().next().removeClass("btn-default").addClass("btn-primary").prop("disabled",!1):($(this).val(""),$(this).parent().parent().next().removeClass("btn-primary").addClass("btn-default").prop("disabled",!0))}).on("keyup",function(a){13==(a.keyCode||a.which||a.charCode)&&""!=$(this).val().trim()&&$(this).parent().parent().next().trigger("click")}),$("#search_button").on("click",function(){$("#checkAll").prop("checked",!1),dataCompareState.sellectObj.selectSearchItem=[];var a=$("#search_input").val().trim();dataCompareState.searchObj.hasSearch=""!=a,dataCompareState.searchObj.searchVal=1==dataCompareState.searchObj.hasSearch?a:null;var t=getdataCompareData(a);return!1!==t&&dataCompareRenderData({chunkArr:t,currentPage:1}),dataCompareState.searchObj.hasSearch?(dataCompareState.pageSearchObj.currentPage=1,dataCompareState.pageSearchObj.pageOption.curr=1,dataCompareState.pageSearchObj.pageOption.count=dataCompareState.pageSearchObj.itemLength,$("ol#pagelist").remove(),$("span.futureDT2_page_span").before('<ol class="pagination" id="pagelist"></ol>'),dataCompareState.paginationObj.search=new Pagination(dataCompareState.pageSearchObj.selector,dataCompareState.pageSearchObj.pageOption)):(dataCompareState.pageObj.pageOption.curr=1,dataCompareState.pageObj.pageOption.count=dataCompareState.pageObj.itemLength,$("ol#pagelist").remove(),$("span.futureDT2_page_span").before('<ol class="pagination" id="pagelist"></ol>'),dataCompareState.paginationObj.normal=new Pagination(dataCompareState.pageObj.selector,dataCompareState.pageObj.pageOption)),!1}),$("#jumpText").on("input propertychange",function(){$(this).val($(this).val().replace(/[^\d]/g,""))}),$("#jumpPage").on("click",function(){var a=Number($("#jumpText").val()),t=Number(dataCompareState.pageObj.currentPage),e=Number(dataCompareState.pageObj.pageCount);(dataCompareState.searchObj.hasSearch&&(t=Number(dataCompareState.pageSearchObj.currentPage),e=Number(dataCompareState.pageSearchObj.pageCount)),t==a||a<=0||e<a)?$("#jumpText").val(""):!1!==getdataCompareData(dataCompareState.searchObj.searchVal)?dataCompareState.searchObj.hasSearch?(dataCompareState.pageSearchObj.pageOption.curr=a,dataCompareState.paginationObj.search.goPage(a),dataCompareState.paginationObj.search.renderPages(),dataCompareState.paginationObj.search.options.curr=a,console.log(dataCompareState.paginationObj.search),dataCompareState.paginationObj.search.options.callback&&dataCompareState.paginationObj.search.options.callback({curr:dataCompareState.paginationObj.search.pageNumber,isFirst:!1})):(dataCompareState.pageObj.pageOption.curr=a,dataCompareState.paginationObj.normal.goPage(a),dataCompareState.paginationObj.normal.renderPages(),dataCompareState.paginationObj.normal.options.curr=a,console.log(dataCompareState.paginationObj.normal),dataCompareState.paginationObj.normal.options.callback&&dataCompareState.paginationObj.normal.options.callback({curr:dataCompareState.paginationObj.normal.pageNumber,isFirst:!1})):dataCompareSwalMixin({title:"出错！",text:"页面将在2秒后刷新",type:"error",showConfirmButton:!1,timer:2e3}).then(function(a){a.dismiss!=swal.DismissReason.backdrop&&a.dismiss!=swal.DismissReason.esc&&a.dismiss!=swal.DismissReason.timer||window.location.reload()})}),$(document).on("click",".home_dataCompare_bottom .panel-body li",function(){if(!dataCompareState.stateObj.canClickParam)return!1;$(this).toggleClass("list-group-item-info").children("span").text(["选中","取消选中"][Number($(this).hasClass("list-group-item-info"))]),groupJudgeRenderNav("param")}),$(document).on("shown.bs.tab",'div.g_bodyin_bodyin_top_wrap a[data-toggle="tab"]',function(a){var e=dataCompareState.stateObj.curParam,r=$(a.target).attr("aria-controls");if($(".g_info_m, .g_info_r .glyphicon-search, .g_info .glyphicon-question-sign").hide(),"home_dataCompare"==r)$(".g_info_m, .g_info .glyphicon-question-sign").show(),dataCompareState.stateObj.searchShow&&$(".g_info_r .glyphicon-search").show();else if("all_statistics"==r)dataCompareSwalMixin({title:"加载数据",text:"正在绘图中......",type:"info",showConfirmButton:!1,showCancelButton:!1,timer:1e3}).then(function(){dataCompareSwalMixin({title:"加载数据",text:"正在绘图中......",type:"info",showConfirmButton:!1,showCancelButton:!1}),$("#all_statistics>div.panel>.panel-body").empty(),$(".g_bodyin_bodyin_top_wrap ul>li[role='presentation']>a:not([aria-controls='home_dataCompare']):not([aria-controls='all_statistics'])").each(function(a,t){renderPanel(e.TotalYield,e.other,$(t).attr("aria-controls"),!0,function(a){$("#all_statistics>div.panel.panel_"+$(t).attr("aria-controls")+">.panel-body").append(a)})}),$("#all_statistics>div.panel").each(function(a,t){var e=$(t).data("iallstatistics");if("map_good_rate_distribution"==e)$(t).children(".panel-body").find(".chart_map_body>div").each(function(a,t){draw_map_good_rate_distribution($(this),a)});else if("map_color_order_distribution"==e){var r=_.cloneDeep(futuredGlobal.S_getMockWaferData()[_.random(0,1,!1)]),c={},h=200,m=300,o=Math.max(Math.abs(r.maxX),Math.abs(r.minX)),u=Math.sqrt(2)*o,g=_.round(80),b=_.round(480);_.forEach(r.waferMapDataList,function(a,t,e){_.forEach(e[t].m_DieDataListNew,function(a,t,e){_.forOwn(e[t],function(a,t,e){var r=_.random(g,b,!1),o=Number(t.toString().split(":")[0]),n=Number(t.toString().split(":")[1]),i=Math.pow(o,2)+Math.pow(n,2),l=_.round(_.mean([h,250])),p=_.round(_.mean([250,m])),d=_.round(_.mean([100,h])),s=_.round(_.mean([m,400]));Math.pow(3.2,2)*i<Math.pow(u,2)?r=_.random(l,p,!1):4*i<Math.pow(u,2)?r=Math.pow(2.67,2)*i<Math.pow(u,2)?_.random(h,l,!1):_.random(p,m,!1):Math.pow(1.33,2)*i<Math.pow(u,2)?r=Math.pow(1.6,2)*i<Math.pow(u,2)?_.random(d,h,!1):_.random(m,s,!1):i<=Math.pow(u,2)&&(r=(Math.abs(o)+Math.abs(n))%2==0?_.random(g,d,!1):_.random(s,b,!1)),r<100?(r=100,e[t]={bin:a,color:"1:"+r}):100<=r&&r<h?e[t]={bin:a,color:"2:"+r}:h<=r&&r<250?e[t]={bin:a,color:"3:"+r}:250<=r&&r<m?e[t]={bin:a,color:"4:"+r}:m<=r&&r<400?e[t]={bin:a,color:"5:"+r}:400<=r&&(r=400,e[t]={bin:a,color:"6:"+r}),12==a?("12:"in c||(c["12:"]="#fff"),e[t]={bin:12,color:"12:"}):-1==a&&("-1:"in c||(c["-1:"]="#314067"),e[t]={bin:-1,color:"-1:"})})})});$(t).children(".panel-body").find(".chart_map_body>div").each(function(a,t){draw_map_color_order_distribution($(this),a,r,400,100,h,m,250,100,50,50,100,c)})}else{var n=_.find(dataCompareState.chartTypeMap,function(a,t){return t==e});$(t).children(".panel-body").find(".chart_otherSingle_body>div").each(function(){draw_other_chart($(this),e,n)})}}),swal.clickCancel()});else{if(!_.isNil(e)&&!_.isEmpty(e))if(renderPanel(e.TotalYield,e.other,r),"map_good_rate_distribution"==r)$("#map_good_rate_distribution>.single_div_in .chart_map_body>div").each(function(a,t){draw_map_good_rate_distribution($(this),a)});else if("map_color_order_distribution"==r)dataCompareSwalMixin({title:"加载数据",text:"正在绘图中......",type:"info",showConfirmButton:!1,showCancelButton:!1,timer:1e3}).then(function(){dataCompareSwalMixin({title:"加载数据",text:"正在绘图中......",type:"info",showConfirmButton:!1,showCancelButton:!1});var e=_.cloneDeep(futuredGlobal.S_getMockWaferData()[_.random(0,1,!1)]),c={},h=200,m=300,a=Math.max(Math.abs(e.maxX),Math.abs(e.minX)),u=Math.sqrt(2)*a,g=_.round(80),b=_.round(480);_.forEach(e.waferMapDataList,function(a,t,e){_.forEach(e[t].m_DieDataListNew,function(a,t,e){_.forOwn(e[t],function(a,t,e){var r=_.random(g,b,!1),o=Number(t.toString().split(":")[0]),n=Number(t.toString().split(":")[1]),i=Math.pow(o,2)+Math.pow(n,2),l=_.round(_.mean([h,250])),p=_.round(_.mean([250,m])),d=_.round(_.mean([100,h])),s=_.round(_.mean([m,400]));Math.pow(3.2,2)*i<Math.pow(u,2)?r=_.random(l,p,!1):4*i<Math.pow(u,2)?r=Math.pow(2.67,2)*i<Math.pow(u,2)?_.random(h,l,!1):_.random(p,m,!1):Math.pow(1.33,2)*i<Math.pow(u,2)?r=Math.pow(1.6,2)*i<Math.pow(u,2)?_.random(d,h,!1):_.random(m,s,!1):i<=Math.pow(u,2)&&(r=(Math.abs(o)+Math.abs(n))%2==0?_.random(g,d,!1):_.random(s,b,!1)),r<100?(r=100,e[t]={bin:a,color:"1:"+r}):100<=r&&r<h?e[t]={bin:a,color:"2:"+r}:h<=r&&r<250?e[t]={bin:a,color:"3:"+r}:250<=r&&r<m?e[t]={bin:a,color:"4:"+r}:m<=r&&r<400?e[t]={bin:a,color:"5:"+r}:400<=r&&(r=400,e[t]={bin:a,color:"6:"+r}),12==a?("12:"in c||(c["12:"]="#fff"),e[t]={bin:12,color:"12:"}):-1==a&&("-1:"in c||(c["-1:"]="#314067"),e[t]={bin:-1,color:"-1:"})})})});$("#map_color_order_distribution>.single_div_in .chart_map_body>div").each(function(a,t){draw_map_color_order_distribution($(this),a,e,400,100,h,m,250,100,50,50,100,c)}),swal.clickCancel()});else{var t=_.find(dataCompareState.chartTypeMap,function(a,t){return t==r});$("#"+r+" .single_div_in .chart_otherSingle_body>div").each(function(){draw_other_chart($(this),r,t)})}}}),$(document).on("click",".g_bodyin_bodyin_bottom div.panel-heading>span.glyphicon",function(){$(this).toggleClass("glyphicon-menu-down glyphicon-menu-right").parent().parent().toggleClass("panel-info panel-success"),$(this).hasClass("glyphicon-menu-right")?$(this).parent().next().slideUp(200):$(this).parent().next().slideDown(200)});