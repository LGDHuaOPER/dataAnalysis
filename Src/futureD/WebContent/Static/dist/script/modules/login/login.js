var futureDT2Mock,loginSwalMixin=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"}),loginUserPassObj=store.get("futureDT2__userDB");function login_session_login_judge(){store.set("futureDT2__login_mode","visit"),setTimeout(function(){window.location.assign("index.html")},100)}$(function(){if(eouluGlobal.S_getPageAllConfig().futureDT2.canUseAjax){if(window.localStorage){var n=window.localStorage,l=Date.now(),e=n.getItem("futureDT2Mock");if(null==e)s();else JSON.parse(e).expires<l?s():(futureDT2Mock=JSON.parse(e).data,loginUserPassObj=futureDT2Mock.login.login)}else alert("浏览器不支持localstorage");function s(){jQuery.getJSON("../static/futureDT2.json",void 0,function(e,s,t){if("success"==s){var o={};o.expires=l+36e5,o.data=_.cloneDeep(e),futureDT2Mock=_.cloneDeep(e),loginUserPassObj=futureDT2Mock.login.login;var i=JSON.stringify(o);n.setItem("futureDT2Mock",i)}else alert("读取mock数据失败")})}}else(_.isEmpty(loginUserPassObj)||_.isNil(loginUserPassObj))&&(loginUserPassObj=futuredGlobal.S_getAdmin_staff(),store.set("futureDT2__userDB",_.cloneDeep(loginUserPassObj)));0!==window.location.href.indexOf("file:///")&&0!==window.location.href.indexOf("file:///")?$(".button_div2>button").data("env","online").attr("title","线上环境访客登录"):$(".button_div2>button").data("env","offline").attr("title","线下环境访客登录")}),$("span.glyphicon.form-control-feedback").click(function(){var e=$(this).prev().children("input");if(""==e.val())return!1;e.is("#login_user")?e.val(""):e.is("#login_password")&&($(this).is(".glyphicon-eye-open")?e.attr("type","text"):$(this).is(".glyphicon-eye-close")&&e.attr("type","password"),$(this).toggleClass("glyphicon-eye-open glyphicon-eye-close"))}),$("#login_user, #login_password").on("input propertychange change",function(){""!=$("#login_user").val().trim()&&""!=$("#login_password").val().trim()?$(".button_div>button").removeClass("btn-default").addClass("btn-primary").prop("disabled",!1):$(".button_div>button").removeClass("btn-primary").addClass("btn-default").prop("disabled",!0)}),$(".button_div>button").click(function(){var e,t=$("#login_user").val().trim(),s=$("#login_password").val().trim(),o=!1,i=_.find(loginUserPassObj,function(e,s){return s==t});if(null==i?(e="用户名不存在！",o=!0):i.password.value!=s&&(e="密码错误！",o=!0),o){var n='<div class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true" class="close_times">&times;</span></button><strong>'+e+"</strong></div>";$(".login_panin .message_div").empty().append(n)}else{var l={},a=_.cloneDeep(i);null!=a.current_login.value&&(a.last_login.value=a.current_login.value),a.current_login.value=moment().format("YYYY-MM-DD HH:mm:ss"),l.expires=Date.now()+36e5,l.data=a;var r={};if(r[t]=a,store.set("futureDT2__userDB",_.assign(loginUserPassObj,r)),$(".save_login_div [type='checkbox']").prop("checked")){store.set("futureDT2__session_classify","sessionStorage");try{window.sessionStorage.setItem("futureDT2__sessionStorage",JSON.stringify(l)),store.set("futureDT2__session",l),store.set("futureDT2__login_mode","sessionStorage"),window.location.assign("index.html")}catch(e){loginSwalMixin({title:"异常",text:"您的浏览器不支持sessionStorage！",type:"warning",showConfirmButton:!1,timer:2e3})}}else store.set("futureDT2__session_classify","localStorage"),store.set("futureDT2__session",l),store.set("futureDT2__login_mode","localStorage"),window.location.assign("index.html")}}),$("#login_user, #login_password").on("keyup",function(e){""!=$("#login_user").val().trim()&&""!=$("#login_password").val().trim()&&(13==(e.keyCode||e.which||e.charCode)&&$(".button_div>button").trigger("click"))}),$(".button_div2>button").click(function(){var d=$(this);if(eouluGlobal.C_btnDisabled(d,!0,"登陆中..."),"offline"==$(this).data("env")){var e=store.get("futureDT2__offline_visit"),s=Date.now();if(_.isNil(e))eouluGlobal.C_btnAbled(d,!0,"线下访客登录成功"),store.set("futureDT2__offline_visit",{visit:"offline_visit",overdueLength:s+18e5,start:s,oldNum:18e5}),login_session_login_judge();else e.overdueLength<s?loginSwalMixin({title:"温馨提示",text:"您的线下访客模式已超期！请联系管理员",type:"info",animation:!1,customClass:"animated zoomIn",showConfirmButton:!1,timer:2e3}).then(function(e){e.dismiss!=swal.DismissReason.backdrop&&e.dismiss!=swal.DismissReason.esc&&e.dismiss!=swal.DismissReason.timer||eouluGlobal.C_btnAbled(d,!0,"访客登录")}):(eouluGlobal.C_btnAbled(d,!0,"正在跳转"),login_session_login_judge())}else if("online"==$(this).data("env")){var g,c;$.get("https://api.ipify.org/?format=json",function(e,s,t){"success"==s?(g=e.ip,$.get("https://www.easy-mock.com/mock/5be5483eb9983d342035d96d/futureDT2/overdueLength",function(e,s){if("success"==s){c=e.data;var t=Number(c.num),o=c.refresh,i=eouluGlobal.S_getBrowserType()[0]+eouluGlobal.S_getBrowserType()[1]+"##"+g+"##"+eouluGlobal.S_getOSInfo(),n=store.get("futureDT2__visit__"+encodeURI(i)),l=Date.now();if(null!=n)if(!0===o||"true"==o)store.set("futureDT2__visit__"+encodeURI(i),{visit:"visit",overdueLength:l+t,start:l,oldNum:t}),eouluGlobal.C_btnAbled(d,!0,"访客登录成功"),login_session_login_judge();else{var a=n.overdueLength,r=n.oldNum,u=n.start;t!=r?u+t<l?loginSwalMixin({title:"温馨提示",text:"管理员改变了使用时长，访客模式已超期，请联系管理员！",type:"info",animation:!1,customClass:"animated zoomIn",showConfirmButton:!1,timer:2500}).then(function(e){e.dismiss!=swal.DismissReason.backdrop&&e.dismiss!=swal.DismissReason.esc&&e.dismiss!=swal.DismissReason.timer||eouluGlobal.C_btnAbled(d,!0,"访客登录")}):(console.log("管理员改变了使用时长，但没有立即刷新，访客模式未超期"),store.set("futureDT2__visit__"+encodeURI(i),{visit:"visit",overdueLength:u+t,start:u,oldNum:t}),eouluGlobal.C_btnAbled(d,!0,"访客登录成功"),login_session_login_judge()):a<l?loginSwalMixin({title:"温馨提示",text:"您的访客模式已超期，请联系管理员！",type:"info",animation:!1,customClass:"animated zoomIn",showConfirmButton:!1,timer:2500}).then(function(e){e.dismiss!=swal.DismissReason.backdrop&&e.dismiss!=swal.DismissReason.esc&&e.dismiss!=swal.DismissReason.timer||eouluGlobal.C_btnAbled(d,!0,"访客登录")}):(console.log("管理员未改变使用时长，也没有立即刷新，访客模式未超期"),eouluGlobal.C_btnAbled(d,!0,"访客登录成功"),login_session_login_judge())}else eouluGlobal.C_btnAbled(d,!0,"正在跳转"),store.set("futureDT2__visit__"+encodeURI(i),{visit:"visit",overdueLength:l+t,start:l,oldNum:t}),login_session_login_judge()}else alert("请求出错，请检查网络连接！"),eouluGlobal.C_btnAbled(d,!0,"访客登录")})):(alert("请求出错，请检查网络连接！"),eouluGlobal.C_btnAbled(d,!0,"访客登录"))})}});