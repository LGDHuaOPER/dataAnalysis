var dataListSwalMixin=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"}),dataListState=new Object;function additionUpdateIsSubmit(t){$(".futureDT2_"+t).find("span.glyphicon-info-sign").length?$(".futureDT2_"+t+"_r_foot>.btn-primary").prop("disabled",!0):$(".futureDT2_"+t+"_r_foot>.btn-primary").prop("disabled",!1)}function getDataListPageData(t,e){var a,i,n,s;if(store.remove("futuredDatalist"),"search"==t)return e.searchFun&&(a=e.searchFun()),a;if("delete"==t)return e.deleteFun&&(i=e.deleteFun()),i;if("addition"==t)return e.additionFun&&(n=e.additionFun()),n;if("update"==t)return e.updateFun&&(s=e.updateFun()),s;if("onload"==t){var r=store.get("futureDT2__datalist__pageDataObj"),o=[];if(r&&!e.refreshMock)o=JSON.parse(r).data;else{var l=futuredGlobal.S_getDataList(),d=[];_.times(93,function(t){var e=_.cloneDeep(l[0]),i=String(t+1);_.forOwn(e,function(t,e,a){if(null===t.detail&&"qualified_rate"!=e&&"die_type"!=e)a[e].value=_.padEnd(t.value,t.value.length+i.length,i);else if("qualified_rate"==e)a[e].value=_.padStart(t.value,t.value.length+i.length,i);else if("die_type"==e)a[e].value="DefaultType";else switch(t.detail){case"product_category":a[e].value=i,d.push(i);break;case"time":a[e].value=moment().add(Number(i),"days").format("YYYY-MM-DD HH:mm:ss");break;case"delete_status":a[e].value="0";break;default:a[e].value=Number(i)%4}}),o.push(e)}),store.set("futureDT2__dataList__product_category",_.uniq(d));var c={};c.data=_.cloneDeep(o),c.expires=Date.now()+6e4,store.set("futureDT2__datalist__pageDataObj",JSON.stringify(c))}var u=_.filter(o,function(t){return"0"==t.delete_status.value}),p=_.chunk(_.reverse(_.sortBy(u,function(t){return t.test_start_date.value})),10);return dataListState.pageObj.pageCount=p.length,dataListState.pageObj.itemLength=u.length,p}}function renderData(s,t,e,a){var i=getDataListPageData(t,e)[s-1],r="",n=s;null!=i?i.map(function(t,e,a){var i=t.wafer_id.value,n=10*(s-1)+e+1;r+='<tr><td class="not_search"><input type="checkbox" data-ivalue="'+i+'"></td><td class="td_product_category" data-itext="第'+n+"条"+t.product_category.value+'" data-ivalue="'+t.product_category.value+'">第'+n+"条"+t.product_category.value+'</td><td data-itext="'+t.lot_number.value+'">'+t.lot_number.value+'</td><td data-itext="'+t.wafer_number.value+'">'+t.wafer_number.value+'</td><td data-itext="'+t.qualified_rate.value+'">'+t.qualified_rate.value+'</td><td data-itext="'+t.test_start_date.value+'">'+t.test_start_date.value+'</td><td data-itext="'+t.archive_user.value+'">'+t.archive_user.value+'</td><td class="td_description" data-itext="'+t.description.value+'" data-ivalue="'+t.description.value+'">'+t.description.value+'</td><td class="not_search"><span class="glyphicon glyphicon-edit" aria-hidden="true" data-ivalue="'+i+'"></span><span class="glyphicon glyphicon-eye-open" aria-hidden="true" data-ivalue="'+i+'"></span><span class="glyphicon glyphicon-trash" aria-hidden="true" data-ivalue="'+i+'"></span></td><td class="not_search td_data_format" data-itext="'+t.data_format.value+'" data-ivalue="'+t.data_format.value+'">'+t.data_format.value+"</td></tr>"}):n=0,$(".g_bodyin_bodyin_body tbody").empty().append(r),$("#checkAll").prop("checked",dataListState.sellectObj.selectAll),dataListState.pageObj.currentPage=n,1==a&&(_.forEach(dataListState.sellectObj.selectItem,function(t){$(".g_bodyin_bodyin_body tbody [type='checkbox'][data-ivalue='"+Number(t)+"']").prop("checked",!0).parent().parent().addClass("warning").removeClass("info")}),$("#checkAll").prop("checked",dataListState.pageObj.itemLength==dataListState.sellectObj.selectItem.length),dataListState.sellectObj.selectAll=$("#checkAll").prop("checked"))}function searchMark(i){""!=i&&$(".g_bodyin_bodyin_body tbody td:not(.not_search)").each(function(){var t=$(this).text(),e="<b style='color:red'>"+i+"</b>",a=t.replace(new RegExp(i,"g"),e);$(this).empty().html(a)})}function searchRenderData(s,r){renderData(s,"search",{searchFun:function(){var t=store.get("futureDT2__datalist__pageDataObj");if(_.isEmpty(t)||_.isNil(t))return dataListSwalMixin({title:"mock数据异常",text:"意外被删除，请重新登录！",type:"error",showConfirmButton:!1,timer:2500}).then(function(t){t.dismiss!=swal.DismissReason.backdrop&&t.dismiss!=swal.DismissReason.esc&&t.dismiss!=swal.DismissReason.timer||window.location.assign("login.html")}),!1;var e=JSON.parse(t).data,a=[];null==r||""==r?a=e:_.forEach(e,function(e){_.forOwn(e,function(t){if(-1<String(t.value).indexOf(r))return a.push(e),!1})});var i=_.filter(a,function(t){return"0"==t.delete_status.value}),n=_.chunk(_.reverse(_.sortBy(i,function(t){return t.test_start_date.value})),10);return dataListState.searchPageObj.pageCount=n.length,dataListState.searchPageObj.itemLength=i.length,dataListState.searchPageObj.pageOption.count=dataListState.searchPageObj.itemLength,dataListState.searchPageObj.pageOption.curr=s,n}},!1),searchMark(r)}dataListState.pageObj={selector:null,pageOption:null,currentPage:null,pageCount:null,itemLength:0},dataListState.searchPageObj={currentPage:0,pageCount:0,itemLength:0,searchVal:null,selector:"#pagelist",pageOption:{limit:10,count:0,curr:0,ellipsis:!0,pageShow:2,hash:!1,callback:function(t){dataListState.searchPageObj.currentPage=t.curr,t.isFirst||searchRenderData(t.curr,dataListState.searchPageObj.searchVal)}}},dataListState.hasSearch=!1,dataListState.sellectObj={selectAll:!1,selectItem:[]},dataListState.product_categoryArr=store.get("futureDT2__dataList__product_category"),dataListState.cache={futureDT2_update_td_description:null},dataListState.Bar=null,dataListState.BarOption={color:"#32c462",strokeWidth:4,trailColor:"#ddd",trailWidth:5,easing:"easeInOut",text:{autoStyleContainer:!1},from:{color:"#aaa",width:3},to:{color:"#333",width:5},step:function(t,e){e.path.setAttribute("stroke","#32c462"),e.path.setAttribute("stroke-width",t.width);var a=Math.round(100*e.value());0===a?e.setText(""):e.setText(a+"%")}},dataListState.hasBuildBar=!1,$(function(){renderData(1,"onload",{}),dataListState.pageObj.selector="#pagelist",dataListState.pageObj.pageOption={limit:10,count:dataListState.pageObj.itemLength,curr:1,ellipsis:!0,pageShow:2,hash:!1,callback:function(t){dataListState.pageObj.currentPage=t.curr,t.isFirst||(renderData(t.curr,"onload",{}),dataListState.hasSearch&&searchMark($("#search_input").val().trim()),$(".g_bodyin_bodyin_body tbody [type='checkbox']").each(function(){-1<_.indexOf(dataListState.sellectObj.selectItem,$(this).data("ivalue").toString())&&$(this).prop("checked",!0).parent().parent().addClass("warning").removeClass("info")}))}},new Pagination(dataListState.pageObj.selector,dataListState.pageObj.pageOption)}),$(".g_bodyin_bodyin_tit_r .form-control-feedback").click(function(){$(this).prev().children("input").val("")}),$("#search_input").on("input propertychange change",function(){""!=$(this).val().trim()?$(this).parent().parent().next().removeClass("btn-default").addClass("btn-primary").prop("disabled",!1):($(this).val(""),$(this).parent().parent().next().removeClass("btn-primary").addClass("btn-default").prop("disabled",!0))}).on("keyup",function(t){13==(t.keyCode||t.which||t.charCode)&&""!=$(this).val().trim()&&$(this).parent().parent().next().trigger("click")}),$(document).on("mouseover",".g_bodyin_bodyin_body td",function(){$(this).addClass("warning"),$(this).parent().addClass("info")}),$(document).on("mouseout",".g_bodyin_bodyin_body td",function(){$(this).removeClass("warning"),$(this).parent().removeClass("info")}),$(document).on("click",".g_bodyin_bodyin_body td",function(){$(this).parent().toggleClass("warning info").find("[type='checkbox']").prop("checked",!$(this).parent().find("[type='checkbox']").prop("checked")).change()}),$(document).on("click",".g_bodyin_bodyin_body tbody [type='checkbox']",function(t){t.stopPropagation(),$(this).parent().parent().toggleClass("warning info")}),$(document).on("change",".g_bodyin_bodyin_body tbody [type='checkbox']",function(){var t=$(this).data("ivalue").toString();$(this).prop("checked")?dataListState.sellectObj.selectItem.push(t):_.pull(dataListState.sellectObj.selectItem,t),dataListState.sellectObj.selectItem=_.uniq(dataListState.sellectObj.selectItem),$("#checkAll").prop("checked",dataListState.pageObj.itemLength==dataListState.sellectObj.selectItem.length),dataListState.sellectObj.selectAll=$("#checkAll").prop("checked")}),$("#checkAll").on({click:function(){var t=$(this);$(".g_bodyin_bodyin_body tbody [type='checkbox']").each(function(){$(this).prop("checked",t.prop("checked")),t.prop("checked")?$(this).parent().parent().removeClass("info").addClass("warning"):$(this).parent().parent().removeClass("warning info")}),dataListState.sellectObj.selectAll=t.prop("checked"),t.prop("checked")?(dataListState.sellectObj.selectItem=[],JSON.parse(store.get("futureDT2__datalist__pageDataObj")).data.map(function(t,e,a){"0"==t.delete_status.value&&dataListState.sellectObj.selectItem.push(t.wafer_id.value)})):dataListState.sellectObj.selectItem=[]}}),$("#search_button").on("click",function(){var t=$("#search_input").val().trim();return dataListState.searchPageObj.searchVal=t,dataListState.hasSearch=""!=t,searchRenderData(1,t),new Pagination(dataListState.searchPageObj.selector,dataListState.searchPageObj.pageOption),dataListState.sellectObj={selectAll:!1,selectItem:[]},$("#checkAll").prop("checked",!1),!1}),$(".g_info_r>.glyphicon-user").click(function(){window.location.assign("admin.html")}),$(document).on("click",".g_bodyin_bodyin_body tbody .glyphicon-eye-open",function(t){t.stopPropagation(),window.location.assign("dataListDetail.html")}).on("click",".g_bodyin_bodyin_body tbody .glyphicon-edit",function(t){t.stopPropagation();var e=$(this).parent();$(".futureDT2_bg_cover, .futureDT2_update").slideDown(200),$(".futureDT2_update_l, .futureDT2_update_r").height($(".futureDT2_update").height());var a=dataListState.product_categoryArr;_.isNil(a)&&(a=[]),$("#futureDT2_update_data_format").val(e.siblings(".td_data_format").data("ivalue")),$("#futureDT2_update_product_category").val(e.siblings(".td_product_category").data("ivalue")),$("#futureDT2_update_td_description").val(e.siblings(".td_description").data("ivalue")),dataListState.cache.futureDT2_update_td_description=e.siblings(".td_description").data("ivalue").toString(),$("#futureDT2_update_product_category").each(function(t,e){new Awesomplete(e,{list:a,minChars:1,maxItems:13,autoFirst:!0})})}),$(".g_bodyin_bodyin_tit_l>.glyphicon-remove-circle").click(function(){$(".futureDT2_bg_cover, .futureDT2_addition").slideDown(200),$(".futureDT2_addition_l, .futureDT2_addition_r").height($(".futureDT2_addition").height())}),$(".futureDT2_addition_r_foot .btn-warning, .futureDT2_update_r_foot .btn-warning").click(function(){var t=$(this).parents("[data-iparent]");$(".futureDT2_bg_cover").slideUp(200),t.slideUp(200)}),$(".g_bodyin_bodyin_tit_l>.glyphicon-trash").click(function(){dataListSwalMixin({title:"提示",text:"功能正在开发中！",type:"info",showConfirmButton:!1,timer:2e3})}),$(".isRequired").on("input propertychange change",function(){var t,e=$(this).val(),a=$(this).parents("[data-iparent]").data("iparent");t=_.isNil(e)?'<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>':""==e.trim()?'<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>':'<span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span>',$(this).parents("div.row").find("div.info_div").empty().append(t),additionUpdateIsSubmit(a)}),$("#futureDT2_update_td_description").on("input propertychange change",function(){var t=$(this).val();dataListState.cache.futureDT2_update_td_description!=t&&additionUpdateIsSubmit("update")}),$(".row_extra3 .well .glyphicon-plus-sign").click(function(){$("#add_file_Upload").val(""),$(this).next().trigger("click")}),$("#add_file_Upload").on("change",function(){dataListState.hasBuildBar&&dataListState.Bar.destroy();var t=$(this)[0].files[0].size,e=$(this)[0].files[0].name;$(".upload_l_tit").text($(this)[0].files[0].name),$(".upload_l_body").text("大小："+eouluGlobal.S_getFileSize(t)),dataListState.Bar=new ProgressBar.Circle("#upload_container",dataListState.BarOption),dataListState.Bar.text.style.fontFamily='"microsoft yahei", "Arial", sans-serif',dataListState.Bar.text.style.fontSize="2rem",dataListState.Bar.animate(1,{duration:1e4},function(){dataListSwalMixin({title:"上传成功！",text:e+" 已经上传至服务器",type:"success",showConfirmButton:!1,timer:2500})}),dataListState.hasBuildBar=!0}),$("#jumpText").on("input propertychange",function(){$(this).val($(this).val().replace(/[^\d]/g,""))}),$("#jumpPage").on("click",function(){var t=Number($("#jumpText").val()),e=Number(dataListState.pageObj.currentPage),a=Number(dataListState.pageObj.pageCount);e==t||t<=0||a<t?$("#jumpText").val(""):dataListState.hasSearch?(searchRenderData(dataListState.searchPageObj.pageOption.curr=t,dataListState.searchPageObj.searchVal),new Pagination(dataListState.searchPageObj.selector,dataListState.searchPageObj.pageOption)):(renderData(dataListState.pageObj.pageOption.curr=t,"onload",{}),new Pagination(dataListState.pageObj.selector,dataListState.pageObj.pageOption))}),$(".g_bodyin_bodyin_tit_l .glyphicon-refresh").click(function(){renderData(1,"onload",{refreshMock:!0}),dataListState.sellectObj.selectAll=!1,$("#checkAll").prop("checked",!1),dataListState.sellectObj.selectItem=[],dataListState.hasSearch=!1,$("#search_input").val(""),dataListState.pageObj.pageOption.count=dataListState.pageObj.itemLength,dataListState.pageObj.pageOption.curr=1,new Pagination(dataListState.pageObj.selector,dataListState.pageObj.pageOption)}),$(".g_bodyin_bodyin_tit_l .glyphicon-remove").click(function(){if(0==dataListState.sellectObj.selectItem.length)return swal({position:"center",type:"info",title:"未选中数据！",showConfirmButton:!1,timer:1500,animation:!1,customClass:"animated zoomIn"}),!1;var e=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"});e({title:"确定删除吗？",text:"删除后将放入回收站，点击刷新按钮可以重置数据！",type:"warning",showCancelButton:!0,confirmButtonText:"确定，删除！",cancelButtonText:"不，取消！",reverseButtons:!1}).then(function(t){if(t.value){var n=dataListState.sellectObj.selectItem,s=1;dataListState.sellectObj.selectAll&&(s=0),renderData(s,"delete",{deleteFun:function(){var a;dataListState.sellectObj.selectAll?a=[]:(a=JSON.parse(store.get("futureDT2__datalist__pageDataObj")).data,_.forEach(n,function(i,t,e){_.forEach(a,function(t,e,a){if(t.wafer_id.value==i)return!(a[e].delete_status.value="1")})}));var t={};t.data=_.cloneDeep(a),t.expires=Date.now()+6e4,store.set("futureDT2__datalist__pageDataObj",JSON.stringify(t));var e=_.filter(a,function(t){return"0"==t.delete_status.value}),i=_.chunk(_.reverse(_.sortBy(e,function(t){return t.test_start_date.value})),10);return dataListState.pageObj.pageCount=i.length,dataListState.pageObj.itemLength=e.length,dataListState.pageObj.pageOption.count=dataListState.pageObj.itemLength,dataListState.pageObj.pageOption.curr=s,dataListState.sellectObj.selectItem=[],dataListState.sellectObj.selectAll&&($("#checkAll").prop("checked",!1),dataListState.sellectObj.selectAll=!1),i}}),new Pagination(dataListState.pageObj.selector,dataListState.pageObj.pageOption),dataListState.hasSearch&&searchMark($("#search_input").val().trim()),e({title:"删除成功！",text:"被选中的记录已经放入回收站",type:"success",showConfirmButton:!1,timer:1800})}else t.dismiss===swal.DismissReason.cancel&&e({title:"取消了！",text:"不作处理",type:"error",showConfirmButton:!1,timer:1800})})}),$(document).on("click",".g_bodyin_bodyin_body tbody td.not_search .glyphicon.glyphicon-trash",function(t){t.stopPropagation();var e=$(this),a=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"});a({title:"确定删除吗？",text:"删除后将放入回收站，点击刷新按钮可以重置数据！",type:"warning",showCancelButton:!0,confirmButtonText:"确定，删除！",cancelButtonText:"不，取消！",reverseButtons:!1}).then(function(t){if(t.value){var n;n=dataListState.pageObj.currentPage<dataListState.pageObj.pageCount?dataListState.pageObj.currentPage:dataListState.pageObj.itemLength%10!=1?dataListState.pageObj.currentPage:dataListState.pageObj.currentPage-1;var s=e.data("ivalue").toString();renderData(n,"delete",{deleteFun:function(){var t=JSON.parse(store.get("futureDT2__datalist__pageDataObj")).data;_.forEach(t,function(t,e,a){if(t.wafer_id.value==s)return!(a[e].delete_status.value="1")});var e={};e.data=_.cloneDeep(t),e.expires=Date.now()+6e4,store.set("futureDT2__datalist__pageDataObj",JSON.stringify(e));var a=_.filter(t,function(t){return"0"==t.delete_status.value}),i=_.chunk(_.reverse(_.sortBy(a,function(t){return t.test_start_date.value})),10);return dataListState.pageObj.pageCount=i.length,dataListState.pageObj.itemLength=a.length,dataListState.pageObj.pageOption.count=dataListState.pageObj.itemLength,dataListState.pageObj.pageOption.curr=n,_.pull(dataListState.sellectObj.selectItem,s),i}},!0),new Pagination(dataListState.pageObj.selector,dataListState.pageObj.pageOption),dataListState.hasSearch&&searchMark($("#search_input").val().trim()),a({title:"删除成功！",text:"被选中的记录已经放入回收站",type:"success",showConfirmButton:!1,timer:1800})}else t.dismiss===swal.DismissReason.cancel&&a({title:"取消了！",text:"不作处理",type:"error",showConfirmButton:!1,timer:1800})})});