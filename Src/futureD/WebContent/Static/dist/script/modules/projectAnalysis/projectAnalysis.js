var projectAnalysisSwalMixin=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"}),projectAnalysisState=new Object;function redirectLogin(t){projectAnalysisSwalMixin({title:"mock数据异常",text:t.text,type:"error",showConfirmButton:!1,timer:2500}).then(function(e){e.dismiss!=swal.DismissReason.backdrop&&e.dismiss!=swal.DismissReason.esc&&e.dismiss!=swal.DismissReason.timer||window.location.assign(t.url)})}function getProjectAnalysisData(s,e,t){var a=store.get("futureDT2__datalist__pageDataObj");if(_.isEmpty(a)||_.isNil(a))return redirectLogin({text:"意外被删除，请重新进入下数据列表！",url:"dataList.html"}),!1;var i=JSON.parse(a).data;store.set("futureDT2__datalist__selectedItem",[]);var n=store.get("futureDT2__datalist__selectedItem");if(_.isEmpty(n)||_.isNil(n)){var r=[];if(null==s||""==s?r=_.cloneDeep(i):_.forEach(i,function(t){_.forOwn(t,function(e){if(-1<String(e.value).indexOf(s))return-1<_.indexOf(projectAnalysisState.sellectObj.selectItem,t.wafer_id.value)&&projectAnalysisState.sellectObj.selectSearchItem.push(t.wafer_id.value),r.push(t),!1})}),t)return r;var o=_.filter(r,function(e){return"0"==e.delete_status.value});if(e)return o;var l=_.chunk(_.reverse(_.sortBy(o,function(e){return e.test_start_date.value})),10);return projectAnalysisState.searchObj.hasSearch?(projectAnalysisState.pageSearchObj.pageCount=l.length,projectAnalysisState.pageSearchObj.itemLength=o.length,projectAnalysisState.pageSearchObj.data=_.cloneDeep(l)):(projectAnalysisState.pageObj.pageCount=l.length,projectAnalysisState.pageObj.itemLength=o.length,projectAnalysisState.pageObj.data=_.cloneDeep(l)),l}var c=[];if(_.forEach(n,function(a,e){if(null==s||""==s)c.push(_.find(i,function(e){return e.wafer_id.value==a}));else{var n=_.find(i,function(e){return e.wafer_id.value==a});_.forOwn(n,function(e,t){if(-1<String(e.value).indexOf(s))return-1<_.indexOf(projectAnalysisState.sellectObj.selectItem,a.wafer_id.value)&&projectAnalysisState.sellectObj.selectSearchItem.push(a.wafer_id.value),c.push(n),!1})}}),t)return c;var p=_.filter(c,function(e){return"0"==e.delete_status.value});if(e)return p;var d=_.chunk(_.reverse(_.sortBy(p,function(e){return e.test_start_date.value})),10);return projectAnalysisState.searchObj.hasSearch?(projectAnalysisState.pageSearchObj.pageCount=d.length,projectAnalysisState.pageSearchObj.itemLength=p.length,projectAnalysisState.pageSearchObj.data=_.cloneDeep(d)):(projectAnalysisState.pageObj.pageCount=d.length,projectAnalysisState.pageObj.itemLength=p.length,projectAnalysisState.pageObj.data=_.cloneDeep(d)),d}function projectAnalysisRenderData(s){if(null!=s.chunkArr){var i="";s.chunkArr[s.currentPage-1].map(function(e,t,a){var n=e.wafer_id.value;s.currentPage;i+='<tr><td class="not_search"><input type="checkbox" data-ivalue="'+n+'"></td><td data-itext="第'+n+"条"+e.product_category.value+'">第'+n+"条"+e.product_category.value+'</td><td data-itext="'+e.lot_number.value+'">'+e.lot_number.value+'</td><td data-itext="'+e.wafer_number.value+'">'+e.wafer_number.value+'</td><td data-itext="'+e.qualified_rate.value+'">'+e.qualified_rate.value+'</td><td data-itext="'+e.test_start_date.value+'">'+e.test_start_date.value+'</td><td data-itext="'+e.archive_user.value+'">'+e.archive_user.value+'</td><td data-itext="'+e.description.value+'">'+e.description.value+"</td></tr>"}),$(".g_bodyin_bodyin_body tbody").empty().append(i),projectAnalysisState.searchObj.hasSearch?($(".g_bodyin_bodyin_body tbody [type='checkbox']").each(function(){-1<_.indexOf(projectAnalysisState.sellectObj.selectSearchItem,$(this).data("ivalue").toString())&&$(this).prop("checked",!0).parent().parent().addClass("warning").removeClass("info")}),$(".g_bodyin_bodyin_body tbody td:not(.not_search)").each(function(){var e=$(this).text(),t="<b style='color:red'>"+projectAnalysisState.searchObj.searchVal+"</b>",a=e.replace(new RegExp(projectAnalysisState.searchObj.searchVal,"g"),t);$(this).empty().html(a)}),$("#checkAll").prop("checked",projectAnalysisState.pageSearchObj.itemLength==projectAnalysisState.sellectObj.selectSearchItem.length)):($(".g_bodyin_bodyin_body tbody [type='checkbox']").each(function(){-1<_.indexOf(projectAnalysisState.sellectObj.selectItem,$(this).data("ivalue").toString())&&$(this).prop("checked",!0).parent().parent().addClass("warning").removeClass("info")}),$("#checkAll").prop("checked",projectAnalysisState.pageObj.itemLength==projectAnalysisState.sellectObj.selectItem.length))}}function analyzeBtn(){$(".g_body_rr_body_item.active").length?$(".g_body_rr_body_btn>input").prop("disabled",!1):$(".g_body_rr_body_btn>input").prop("disabled",!0)}function bottomTableANDAnalyzeBtn(){0==projectAnalysisState.sellectObj.selectItem.length?($(".g_bodyin_body_bottom tbody").css("border-bottom","0px solid #fff"),$(".g_body_rr_body_btn>input").prop("disabled",!0)):analyzeBtn()}projectAnalysisState.paginationObj={normal:null,search:null},projectAnalysisState.pageObj={selector:null,pageOption:null,currentPage:null,pageCount:null,itemLength:null,data:null},projectAnalysisState.pageSearchObj={selector:"#pagelist",pageOption:{limit:10,count:0,curr:0,ellipsis:!0,pageShow:2,hash:!1,callback:function(e){(projectAnalysisState.pageSearchObj.currentPage=e.curr,e.isFirst)||projectAnalysisRenderData({chunkArr:getProjectAnalysisData(projectAnalysisState.searchObj.searchVal),currentPage:projectAnalysisState.pageSearchObj.currentPage})}},currentPage:null,pageCount:null,itemLength:null,data:null},projectAnalysisState.searchObj={hasSearch:!1,searchVal:null,searchItem:[]},projectAnalysisState.sellectObj={selectAll:!1,selectItem:[],selectSearchItem:[]},$(".g_info_m_in").hide(),$(".g_bodyin_body_top").innerHeight($(".g_bodyin_body").height()/2),$(".g_bodyin_body_bottom").innerHeight($(".g_bodyin_body").height()/2-10),$(function(){var e=store.get("futureDT2__projectAnalysis__selectedObj");_.isNil(e)||(projectAnalysisState.sellectObj.selectItem=e.selectedItem),$(window).on("resize",function(){$(".g_bodyin_body_top").height($(".g_bodyin_body").height()/2),$(".g_bodyin_body_bottom").height($(".g_bodyin_body").height()/2-30)});var t=getProjectAnalysisData(null);if(!1!==t){projectAnalysisRenderData({chunkArr:t,currentPage:1}),projectAnalysisState.pageObj.selector="#pagelist",projectAnalysisState.pageObj.pageOption={limit:10,count:projectAnalysisState.pageObj.itemLength,curr:1,ellipsis:!0,pageShow:2,hash:!1,callback:function(e){(projectAnalysisState.pageObj.currentPage=e.curr,e.isFirst)||projectAnalysisRenderData({chunkArr:getProjectAnalysisData(projectAnalysisState.searchObj.searchVal),currentPage:projectAnalysisState.pageObj.currentPage});var t=getProjectAnalysisData(null,!1,!0);projectAnalysisState.sellectObj.selectItem.length>projectAnalysisState.pageObj.itemLength?($("#checkAll").prop("checked",!0),t.map(function(e,t){if("1"==e.delete_status.value){var a=e.wafer_id.value;-1<_.indexOf(projectAnalysisState.sellectObj.selectItem,a)&&_.pull(projectAnalysisState.sellectObj.selectItem,a.toString())}})):projectAnalysisState.sellectObj.selectItem.length==projectAnalysisState.pageObj.itemLength&&$("#checkAll").prop("checked",!0)}},projectAnalysisState.paginationObj.normal=new Pagination(projectAnalysisState.pageObj.selector,projectAnalysisState.pageObj.pageOption);var a=getProjectAnalysisData(null,!0),n="";a.map(function(e,t){var a=e.wafer_id.value;-1<_.indexOf(projectAnalysisState.sellectObj.selectItem,a)&&(n+='<tr><td class="not_search"><input type="checkbox" data-ivalue="'+a+'"></td><td data-itext="第'+a+"条"+e.product_category.value+'">第'+a+"条"+e.product_category.value+'</td><td data-itext="'+e.lot_number.value+'">'+e.lot_number.value+'</td><td data-itext="'+e.wafer_number.value+'">'+e.wafer_number.value+'</td><td data-itext="'+e.qualified_rate.value+'">'+e.qualified_rate.value+'</td><td data-itext="'+e.test_start_date.value+'">'+e.test_start_date.value+'</td><td data-itext="'+e.archive_user.value+'">'+e.archive_user.value+'</td><td data-itext="'+e.description.value+'">'+e.description.value+"</td></tr>")}),$(".g_bodyin_body_bottom tbody").empty().append(n)}}),$(".g_info_m_in .form-control-feedback").click(function(){$(this).prev().children("input").val("")}),$(".g_info_r>.glyphicon-search").click(function(){var e=$(".g_info_m").innerWidth();$(this).css("position","relative").animate({left:-(e/2+20)+"px"},500,"swing",function(){$(this).fadeOut(200,function(){$(".g_info_m_in").fadeIn(200).fadeTo(1,1)})})}),$(".g_info_m_in span.input-group-addon").click(function(){$(".g_info_m_in").fadeTo(0,200,function(){$(this).fadeOut(200),$(".g_info_r>.glyphicon-search").fadeIn(100).animate({left:"0px"},600,"swing",function(){$(this).css("position","static")})})}),$("#search_input").on("input propertychange change",function(){""!=$(this).val().trim()?$(this).parent().parent().next().removeClass("btn-default").addClass("btn-primary").prop("disabled",!1):($(this).val(""),$(this).parent().parent().next().removeClass("btn-primary").addClass("btn-default").prop("disabled",!0))}).on("keyup",function(e){13==(e.keyCode||e.which||e.charCode)&&""!=$(this).val().trim()&&$(this).parent().parent().next().trigger("click")}),$(document).on("mouseover",".g_bodyin_bodyin_body td",function(){$(this).addClass("warning"),$(this).parent().addClass("info")}),$(document).on("mouseout",".g_bodyin_bodyin_body td",function(){$(this).removeClass("warning"),$(this).parent().removeClass("info")}).on("click",".g_bodyin_bodyin_body td",function(){$(this).parent().toggleClass("warning info").find("[type='checkbox']").prop("checked",!$(this).parent().find("[type='checkbox']").prop("checked")).change()}).on("click",".g_bodyin_bodyin_body tbody [type='checkbox']",function(e){e.stopPropagation(),$(this).parent().parent().toggleClass("warning info")}).on("change",".g_bodyin_bodyin_body tbody [type='checkbox']",function(){var e=$(this).data("ivalue").toString();$(this).prop("checked")?(projectAnalysisState.sellectObj.selectItem.push(e),projectAnalysisState.searchObj.hasSearch&&projectAnalysisState.sellectObj.selectSearchItem.push(e),$(".g_bodyin_body_bottom tbody>tr [type='checkbox'][data-ivalue='"+Number(e)+"']").parent().parent().remove(),$(".g_bodyin_body_bottom tbody").append($(this).parent().parent().clone()),$(".g_bodyin_body_bottom tbody tr, .g_bodyin_body_bottom tbody td").removeClass("info warning")):(_.pull(projectAnalysisState.sellectObj.selectItem,e),projectAnalysisState.searchObj.hasSearch&&_.pull(projectAnalysisState.sellectObj.selectSearchItem,e),$(".g_bodyin_body_bottom tbody [type='checkbox'][data-ivalue='"+Number(e)+"']").parent().parent().remove()),projectAnalysisState.sellectObj.selectItem=_.uniq(projectAnalysisState.sellectObj.selectItem),projectAnalysisState.sellectObj.selectSearchItem=_.uniq(projectAnalysisState.sellectObj.selectSearchItem),projectAnalysisState.searchObj.hasSearch?$("#checkAll").prop("checked",projectAnalysisState.pageSearchObj.itemLength==projectAnalysisState.sellectObj.selectItem.length):$("#checkAll").prop("checked",projectAnalysisState.pageObj.itemLength==projectAnalysisState.sellectObj.selectItem.length),projectAnalysisState.sellectObj.selectAll=$("#checkAll").prop("checked"),bottomTableANDAnalyzeBtn()}),$("#checkAll").on({click:function(){var e=$(this);if($(".g_bodyin_bodyin_body tbody [type='checkbox']").each(function(){$(this).prop("checked",e.prop("checked")),e.prop("checked")?$(this).parent().parent().removeClass("info").addClass("warning"):$(this).parent().parent().removeClass("warning info")}),projectAnalysisState.sellectObj.selectAll=e.prop("checked"),e.prop("checked")){projectAnalysisSwalMixin({title:"加载全部数据",text:"正在加载中......",type:"info",showConfirmButton:!1,showCancelButton:!1});var t=JSON.parse(store.get("futureDT2__datalist__pageDataObj")).data;if(projectAnalysisState.searchObj.hasSearch)projectAnalysisState.sellectObj.selectSearchItem=[],t.map(function(n,e){if("0"!=n.delete_status.value)return!0;_.forOwn(n,function(e){if(-1<String(e.value).indexOf(projectAnalysisState.searchObj.searchVal)){if(projectAnalysisState.sellectObj.selectSearchItem.push(n.wafer_id.value),-1==_.indexOf(projectAnalysisState.sellectObj.selectItem,n.wafer_id.value)){projectAnalysisState.sellectObj.selectItem.push(n.wafer_id.value);var t=n.wafer_id.value,a='<tr><td class="not_search"><input type="checkbox" data-ivalue="'+t+'"></td><td data-itext="第'+t+"条"+n.product_category.value+'">第'+t+"条"+n.product_category.value+'</td><td data-itext="'+n.lot_number.value+'">'+n.lot_number.value+'</td><td data-itext="'+n.wafer_number.value+'">'+n.wafer_number.value+'</td><td data-itext="'+n.qualified_rate.value+'">'+n.qualified_rate.value+'</td><td data-itext="'+n.test_start_date.value+'">'+n.test_start_date.value+'</td><td data-itext="'+n.archive_user.value+'">'+n.archive_user.value+'</td><td data-itext="'+n.description.value+'">'+n.description.value+"</td></tr>";$(".g_bodyin_body_bottom tbody>tr").length?$(".g_bodyin_body_bottom tbody>tr:first").before(a):$(".g_bodyin_body_bottom tbody").append(a)}return!1}})}),projectAnalysisState.sellectObj.selectItem=_.uniq(projectAnalysisState.sellectObj.selectItem);else{var n="";projectAnalysisState.sellectObj.selectItem=[],t.map(function(e,t){if("0"!=e.delete_status.value)return!0;projectAnalysisState.sellectObj.selectItem.push(e.wafer_id.value);var a=e.wafer_id.value;n='<tr><td class="not_search"><input type="checkbox" data-ivalue="'+a+'"></td><td data-itext="第'+a+"条"+e.product_category.value+'">第'+a+"条"+e.product_category.value+'</td><td data-itext="'+e.lot_number.value+'">'+e.lot_number.value+'</td><td data-itext="'+e.wafer_number.value+'">'+e.wafer_number.value+'</td><td data-itext="'+e.qualified_rate.value+'">'+e.qualified_rate.value+'</td><td data-itext="'+e.test_start_date.value+'">'+e.test_start_date.value+'</td><td data-itext="'+e.archive_user.value+'">'+e.archive_user.value+'</td><td data-itext="'+e.description.value+'">'+e.description.value+"</td></tr>"+n}),$(".g_bodyin_body_bottom tbody").empty().append(n)}bottomTableANDAnalyzeBtn(),setTimeout(function(){swal.clickCancel()},2e3)}else projectAnalysisState.searchObj.hasSearch?(projectAnalysisState.sellectObj.selectSearchItem.map(function(e){_.pull(projectAnalysisState.sellectObj.selectItem,e),$(".g_bodyin_body_bottom tbody [type='checkbox'][data-ivalue='"+Number(e)+"']").parent().parent().remove()}),projectAnalysisState.sellectObj.selectSearchItem=[]):(projectAnalysisState.sellectObj.selectItem=[],$(".g_bodyin_body_bottom tbody").empty()),bottomTableANDAnalyzeBtn()}}),$("#search_button").on("click",function(){$("#checkAll").prop("checked",!1),projectAnalysisState.sellectObj.selectSearchItem=[];var e=$("#search_input").val().trim();projectAnalysisState.searchObj.hasSearch=""!=e,projectAnalysisState.searchObj.searchVal=1==projectAnalysisState.searchObj.hasSearch?e:null;var t=getProjectAnalysisData(e);return!1!==t&&projectAnalysisRenderData({chunkArr:t,currentPage:1}),projectAnalysisState.searchObj.hasSearch?(projectAnalysisState.pageSearchObj.currentPage=1,projectAnalysisState.pageSearchObj.pageOption.curr=1,projectAnalysisState.pageSearchObj.pageOption.count=projectAnalysisState.pageSearchObj.itemLength,$("ol#pagelist").remove(),$("span.futureDT2_page_span").before('<ol class="pagination" id="pagelist"></ol>'),projectAnalysisState.paginationObj.search=new Pagination(projectAnalysisState.pageSearchObj.selector,projectAnalysisState.pageSearchObj.pageOption)):(projectAnalysisState.pageObj.pageOption.curr=1,projectAnalysisState.pageObj.pageOption.count=projectAnalysisState.pageObj.itemLength,$("ol#pagelist").remove(),$("span.futureDT2_page_span").before('<ol class="pagination" id="pagelist"></ol>'),projectAnalysisState.paginationObj.normal=new Pagination(projectAnalysisState.pageObj.selector,projectAnalysisState.pageObj.pageOption)),!1}),$("#jumpText").on("input propertychange",function(){$(this).val($(this).val().replace(/[^\d]/g,""))}),$("#jumpPage").on("click",function(){var e=Number($("#jumpText").val()),t=Number(projectAnalysisState.pageObj.currentPage),a=Number(projectAnalysisState.pageObj.pageCount);(projectAnalysisState.searchObj.hasSearch&&(t=Number(projectAnalysisState.pageSearchObj.currentPage),a=Number(projectAnalysisState.pageSearchObj.pageCount)),t==e||e<=0||a<e)?$("#jumpText").val(""):!1!==getProjectAnalysisData(projectAnalysisState.searchObj.searchVal)?projectAnalysisState.searchObj.hasSearch?(projectAnalysisState.pageSearchObj.pageOption.curr=e,projectAnalysisState.paginationObj.search.goPage(e),projectAnalysisState.paginationObj.search.renderPages(),projectAnalysisState.paginationObj.search.options.curr=e,console.log(projectAnalysisState.paginationObj.search),projectAnalysisState.paginationObj.search.options.callback&&projectAnalysisState.paginationObj.search.options.callback({curr:projectAnalysisState.paginationObj.search.pageNumber,isFirst:!1})):(projectAnalysisState.pageObj.pageOption.curr=e,projectAnalysisState.paginationObj.normal.goPage(e),projectAnalysisState.paginationObj.normal.renderPages(),projectAnalysisState.paginationObj.normal.options.curr=e,console.log(projectAnalysisState.paginationObj.normal),projectAnalysisState.paginationObj.normal.options.callback&&projectAnalysisState.paginationObj.normal.options.callback({curr:projectAnalysisState.paginationObj.normal.pageNumber,isFirst:!1})):projectAnalysisSwalMixin({title:"出错！",text:"页面将在2秒后刷新",type:"error",showConfirmButton:!1,timer:2e3}).then(function(e){e.dismiss!=swal.DismissReason.backdrop&&e.dismiss!=swal.DismissReason.esc&&e.dismiss!=swal.DismissReason.timer||window.location.reload()})}),$(".g_info_r>.glyphicon-user").click(function(){window.location.assign("admin.html")}),$(".g_body_rr_body_item").click(function(){if(0==projectAnalysisState.sellectObj.selectItem.length)return $(".g_body_rr_body_btn>input").prop("disabled",!0),!1;$(this).toggleClass("active").siblings(".g_body_rr_body_item").removeClass("active"),$(this).children("span").toggleClass("glyphicon-menu-right glyphicon-menu-down"),$(this).siblings(".g_body_rr_body_item").children("span").removeClass("glyphicon-menu-down").addClass("glyphicon-menu-right");var e=$(this).hasClass("active")?$(this).children(".g_body_rr_body_itemin").innerHeight():0;$(this).innerHeight(50+e),$(this).siblings(".g_body_rr_body_item").innerHeight(50),analyzeBtn()}),$(".g_body_rr_body_itemin").click(function(e){e.stopPropagation()}),$(".g_body_rr_body_btn>input").click(function(){var e={};e.selectedItem=projectAnalysisState.sellectObj.selectItem,e.curveType=$(".g_body_rr_body_item.active").data("icurvetype").toString(),store.set("futureDT2__projectAnalysis__selectedObj",e),window.location.assign("RF_SP2.html")});