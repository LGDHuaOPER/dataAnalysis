var dataListDetailSwalMixin=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"}),dataListDetailStore=Object.create(null);function renderTheadTbody(e){var i="<tr>";e.th&&(i="位置"==e.name?"<tr><th>类型</th><th>Die编号</th><th>Quality</th><th>"+e.name+"</th>":"<tr><th></th><th></th><th></th><th>"+e.name+"</th>");var r=dataListDetailStore.mock.allDetail.thead[0];return _.forEach(e.data,function(t,a){e.th?i+="<th>"+t+"</th>":e.td&&(2==a?i+=1==t?"<td>Pass</td>":'<td style="color: red;">Fail</td>':3<a&&(parseFloat(t)>parseFloat(r.UpLimit[a-4])||parseFloat(t)<parseFloat(r.LowerLimit[a-4]))?i+='<td style="color: red;">'+t+"</td>":i+="<td>"+t+"</td>")}),i+="</tr>"}function draw_map_good_rate_distribution(t,a){var e=t.innerWidth();t.innerHeight(.8*e);var i="canvas_"+t.attr("id");t.append("<canvas id='"+i+"'></canvas>"),t.append("<div class='criterion_"+i+"'></div>"),buildColorGradation({width:e,height:.8*e,container:i,bgFillColor:"#314067",waferData:futuredGlobal.S_getMockWaferData()[0],spacePercent:{x:.1,y:0},m_DieDataListNew:futuredGlobal.S_getMockWaferData()[0].waferMapDataList[a%5].m_DieDataListNew,colorGradation:{limitColor:"#FF0000",floorColor:"#00FF00",nums:256}})}function draw_map_color_order_distribution(e,t,a,i,r,o,n,l,s,d,c,p,h){var u=e.innerWidth();e.innerHeight(.8*u);var v="canvas_"+e.attr("id");e.append("<canvas id='"+v+"'></canvas>"),e.after("<div class='criterion_"+v+"'><div class='colorGradient'></div></div>"),buildColorGradation({width:u,height:.8*u,container:v,bgFillColor:"#314067",waferData:a,spacePercent:{x:.1,y:0},m_DieDataListNew:a.waferMapDataList[t%5].m_DieDataListNew,colorGradation:{theMinColor:"#0000FF",lowwerColor:"#00FFFF",midderColor:"#00FF00",upperColor:"#FFFF00",theMaxColor:"#FF0000",twoDiff:s,threeDiff:d,fourDiff:c,fiveDiff:p},colorOrder:!0,theMin:r,lowwer:o,midder:l,upper:n,theMax:i,otherColor:h});var m=e.next().find("div.colorGradient");m.width(e.next().width()-60).height(e.next().height()-30);var b=s+d+c+p,f=m.height(),g=m.width()/(1.2*b);m.append("<span class='colorGradientSpan oneSpan outSpan'><span style='height: "+f+"px; width: "+g+"px'></span></span>"),m.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+g+"px;'></span>"),_.times(s,function(t){var a=getGradientColor("#00FFFF","#0000FF",s,s-t);m.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+f+"px; width: "+g+"px'></span>")}),m.append("<span class='colorGradientSpan twoSpan outSpan'><span style='height: "+f+"px; width: "+g+"px'></span></span>"),m.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+g+"px;'></span>"),_.times(d,function(t){var a=getGradientColor("#00FF00","#00FFFF",d,d-t);m.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+f+"px; width: "+g+"px'></span>")}),m.append("<span class='colorGradientSpan threeSpan outSpan'><span style='height: "+f+"px; width: "+g+"px'></span></span>"),m.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+g+"px;'></span>"),_.times(c,function(t){var a=getGradientColor("#FFFF00","#00FF00",c,c-t);m.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+f+"px; width: "+g+"px'></span>")}),m.append("<span class='colorGradientSpan fourSpan outSpan'><span style='height: "+f+"px; width: "+g+"px'></span></span>"),m.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+g+"px;'></span>"),_.times(p,function(t){var a=getGradientColor("#FF0000","#FFFF00",p,p-t);m.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+f+"px; width: "+g+"px'></span>")}),m.append("<span class='colorGradientSpan fiveSpan outSpan'><span style='height: "+f+"px; width: "+g+"px'></span></span>"),m.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+g+"px;'></span>"),m.append("<span class='colorGradientSpan sixSpan outSpan'><span style='height: "+f+"px; width: "+g+"px'></span></span>");var y=_.countBy(a.waferMapDataList[t%5].m_DieDataListNew,function(t,a){var e;return _.forOwn(t,function(t,a){e=t.color.split(":")[0]}),e});$('<table class="table table-striped table-bordered table-condensed"><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table>').appendTo(e.parent().next()),_.forOwn(y,function(t,a){e.parent().next().find("th").eq(a-1).text(a+"区间"),e.parent().next().find("td").eq(a-1).text(t+"个")})}function draw_other_chart(t,a,e){var i,r,o,n,l,s,d,c,p,h,u=t.attr("id"),v=null,m=t.data("iparam");switch(a){case"histogram":i="直方图-"+m;r={categories:[["-∞",423e-8],[423e-8,448e-8],[448e-8,47300000000000005e-22],[47300000000000005e-22,498e-8],[498e-8,523e-8],[523e-8,548e-8],[548e-8,5729999999999999e-21],[5729999999999999e-21,59799999999999995e-22],[59799999999999995e-22,623e-8],[623e-8,"+∞"]],type:"linear",labels:{rotation:-45},plotLines:[{color:"#FF0000",width:2,value:.5},{color:"#FF0000",width:2,value:8.5}]},o={title:{text:"百分数"}};var b=[];_.forEach(dataListDetailStore.sellectObj.selectItem,function(t,a){var e={};e.name="wafer"+t+"频率分布",e.type="column",e.data=[2,8,10,5,15,20,3,7,10,20],b.push(e)}),_.forEach(dataListDetailStore.sellectObj.selectItem,function(t,a){var e={};e.name="wafer"+t+"频率累加",e.type="line",e.data=[2,10,20,25,40,60,63,70,80,100],b.push(e)}),n=b;break;case"boxlinediagram":i="箱线图-"+m,r={categories:_.forEach(_.cloneDeep(dataListDetailStore.sellectObj.selectItem),function(t,a,e){e[a]="wafer"+t}),title:{text:"晶圆"}},o={title:{text:"值"}};var f=dataListDetailStore.mock.boxlinediagram_data,g=[],y=[];_.forEach(dataListDetailStore.sellectObj.selectItem,function(t,a,e){var i=[],r=a%3+1;i.push(f["param"+r].lowerOfInner),i.push(f["param"+r].Q1),i.push(f["param"+r].Median),i.push(f["param"+r].Q3),i.push(f["param"+r].UpperOfInner),g.push(i);var o=[];o.push("wafer"+t),a%2==0?o.push(f["param"+r].lowerOfInner-1e-6):o.push(f["param"+r].UpperOfInner+2e-6),y.push(o)}),n=[{name:"观测值",data:g,tooltip:{headerFormat:"<em>晶圆： {point.key}</em><br/>"}},{name:"异常值",color:Highcharts.getOptions().colors[0],type:"scatter",data:y,marker:{fillColor:"white",lineWidth:1,lineColor:Highcharts.getOptions().colors[0]},tooltip:{pointFormat:"Observation: {point.y}"}}];break;case"CPK":i="CPK-"+m;var D=_.range(1,13);_.forEach(D,function(t,a,e){e[a]=eouluGlobal.S_numToChineseSm(t)}),r={categories:D},o={title:{text:"values"}};var S=[];_.forEach(dataListDetailStore.sellectObj.selectItem,function(t,a){var e={};e.name="wafer"+t;var i=[];_.times(12,function(){i.push(_.round(_.random(1,30,!0),2))}),e.data=i,S.push(e)}),n=S;break;case"gaussiandistribution":i="高斯分布图-"+m,r=[{categories:_.range(1,9,1),crosshair:!0,type:"linear"}],o=[{labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[1]}},title:{text:"频率",style:{color:Highcharts.getOptions().colors[1]}}},{title:{text:"正态分布",style:{color:Highcharts.getOptions().colors[0]}},labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[0]}},opposite:!0}];var w=function(t,a){return(a-t)/4},x=(30+10)/2,C=w(10,30),M=(d=w(l=10,s=30),h=((p=s+2*d)-(c=l-2*d))/100,_.range(c,p,h)).map(function(t){return{x:t,y:(a=t,e=x,i=C,1e3*Math.exp(-.5*Math.pow((a-e)/i,2)))};var a,e,i}),L=[];_.forEach(M,function(t,a){a%13==0&&L.push(t.y/10)}),iiiiseries=[{name:"频率",type:"column",data:[.5,2.5,7,26,38,20,5.5,.5],tooltip:{valueSuffix:"%"}},{name:"正态分布",type:"spline",yAxis:1,data:L,tooltip:{valueSuffix:""}}],n=iiiiseries,v=function(t){var a=$("#"+u).parent().next(),e=a.find("div.row>div").eq(0).find("tbody td"),i=a.find("div.row>div").eq(1).find("tbody td");e.eq(0).data("ivalue",498e-8),e.eq(1).data("ivalue",5e-6),e.eq(2).data("ivalue",623e-8),e.eq(3).data("ivalue",423e-8),i.eq(0).data("ivalue",4991e-9),i.eq(1).data("ivalue",Math.sqrt(5e-6*1.5)),i.eq(2).data("ivalue",5e-6*1e8*1.5/1e8),a.find("tbody td").each(function(){$(this).attr("title",$(this).data("ivalue")).text($(this).data("ivalue"))})};break;default:i="良品率图-"+m;var F={};F.name=m,F.data=[];var k=[];_.forEach(dataListDetailStore.sellectObj.selectItem,function(t,a,e){F.data.push(_.round(_.random(0,1,!0),4)),k.push("wafer"+t)}),r={categories:k},o={title:{text:"比率"},min:0,max:1,tickInterval:.1,labels:{formatter:function(){return this.value}}},n=[F]}dataCompareRenderChart({container:u,chart:{type:e},title:{text:i},subtitle:{text:null},xAxis:r,yAxis:o,series:_.cloneDeep(n),chartClassify:a,callback:v})}function calculateLayout(t,a,e){if("vectorMap"==$(".g_menu li[role='presentation'].active").data("iclassify")){var i,r=$(window).height(),o=$(window).width(),n=$(".vectorMap_r").innerHeight(),l=$(".vectorMap_r").innerWidth();i={w:_.sortBy([o,l])[0],h:_.sortBy([r,n])[0]};var s=.78*_.sortBy([i.w,i.h])[1],d=e.container,c=document.getElementById(d),p=c.width,h=c.height;c.getContext("2d").clearRect(0,0,p,h),c.width=s,c.height=.8*s,e.setPlotParam({centerX:s/2,centerY:.4*s,r:.4*s}),e.plot()}}function commonCalcLayout(){$(".tab-content div[role='tabpanel']").innerWidth($(".tab-content").innerWidth()).innerHeight($(".tab-content").innerHeight()),$(".vectorMap_l, .vectorMap_r").innerHeight($("#vectorMap").innerHeight()),$(".allDetail_body .table_body").innerHeight($(".allDetail_body").innerHeight()-$(".allDetail_body .table_head").innerHeight()),$(".allDetail_body .table_body>table").innerHeight()>$(".allDetail_body .table_body").innerHeight()+7&&$(".allDetail_body .table_head").innerWidth($(".allDetail_body").innerWidth()-7)}function drawDbCurve(t){var a=t.container,i=t.xCategories,e=t.series,r=t.msgDom,o=t.legend_enabled||!1,n=t.zoomType||"None",l=t.resetZoomButton,s=t.text||null;return Highcharts.chart(a,{chart:{type:"line",zoomType:n,resetZoomButton:l},title:{text:s},lang:{loading:"Loading..."},legend:{enabled:o},xAxis:{title:{text:"GHz"},categories:i},yAxis:{title:{text:"dB"},gridLineColor:"#eee",gridLineWidth:1},series:e,credits:{enabled:!1},tooltip:{formatter:function(t){return"<b>"+this.series.name+"</b><br>"+this.x+" GHz, "+this.y+" dB"},useHTML:!0},plotOptions:{series:{point:{events:{mouseOver:function(t){var a=i[this.x],e=this.y+" dB,"+a+" GHz";r&&r.find(".Smith_Msg2").text(e)}}},showCheckbox:!0}}})}function drawDbCurveANDSmith(t){var s=t.smithAndCurve,d=t.container;$("#"+d).empty().append('<div class="panel panel-info" data-dbcurveandsmith="S11"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>S11</div><div class="panel-body"><div class="picturetop"></div><div class="picturebottom"><div class="picturebottom_in"><div class="pictureline"><p></p></div><div class="smithdata"><p class="smithdata1"><span class="Smith_Paramter">1-0-S Paramter</span> (<span class="Smith_Msg1">S11</span>)</p><p class="smithdata2"><span class="Smith_Paramter">1-0-S Paramter</span> : <span class="Smith_Msg2">(0.83,-0.50),25.50GHz</span></p></div></div></div></div></div><div class="panel panel-info" data-dbcurveandsmith="S12"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>S12</div><div class="panel-body"><div class="picturetop"></div><div class="picturebottom"><div class="picturebottom_in"><div class="pictureline"><p></p></div><div class="smithdata"><p class="smithdata1"><span class="Smith_Paramter">1-0-S Paramter</span> (<span class="Smith_Msg1">S12</span>)</p><p class="smithdata2"><span class="Smith_Paramter">1-0-S Paramter</span> : <span class="Smith_Msg2">(0.83,-0.50),25.50GHz</span></p></div></div></div></div></div><div class="panel panel-info" data-dbcurveandsmith="S21"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>S21</div><div class="panel-body"><div class="picturetop"></div><div class="picturebottom"><div class="picturebottom_in"><div class="pictureline"><p></p></div><div class="smithdata"><p class="smithdata1"><span class="Smith_Paramter">1-0-S Paramter</span> (<span class="Smith_Msg1">S21</span>)</p><p class="smithdata2"><span class="Smith_Paramter">1-0-S Paramter</span> : <span class="Smith_Msg2">(0.83,-0.50),25.50GHz</span></p></div></div></div></div></div><div class="panel panel-info" data-dbcurveandsmith="S22"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>S22</div><div class="panel-body"><div class="picturetop"></div><div class="picturebottom"><div class="picturebottom_in"><div class="pictureline"><p></p></div><div class="smithdata"><p class="smithdata1"><span class="Smith_Paramter">1-0-S Paramter</span> (<span class="Smith_Msg1">S22</span>)</p><p class="smithdata2"><span class="Smith_Paramter">1-0-S Paramter</span> : <span class="Smith_Msg2">(0.83,-0.50),25.50GHz</span></p></div></div></div></div></div>').find("[data-dbcurveandsmith]").each(function(){var t=$(this).data("dbcurveandsmith"),a=$(this).find(".panel-body").innerWidth(),e=.5;if($(window).width()<=1199&&(e=1),$(this).find(".picturetop").innerHeight(a*e),"S11"==t||"S22"==t){var i=$(this).find(".picturetop")[0],r=$(this).find(".picturebottom")[0],o=smithChart(i,[""],[t],[s[t]],t,r);2==dataListDetailStore.state.vectorMap.smithObjArr.length&&(dataListDetailStore.state.vectorMap.smithObjArr.length=0),dataListDetailStore.state.vectorMap.smithObjArr.push(o)}else{$('<div id="'+d+"_"+t+'"></div>').appendTo($(this).find(".picturetop")).innerHeight($(this).find(".picturetop").innerHeight());var n=s[t],l={xCategories:[]};_.forEach(n,function(t,a){l.xCategories.push(Math.floor(t[0]/1e7)/100)}),l.series=[],l.series[0]={},l.series[0].data=[],_.forEach(n,function(t,a){l.series[0].data.push(parseFloat(t[1]))}),l.container=$(this).find(".picturetop").children("div").attr("id"),l.msgDom=$(this).find(".picturebottom"),l.resetZoomButton={position:{align:"left",x:0,y:0},relativeTo:"chart"},drawDbCurve(l)}})}function drawCurve(t){var a,e=t.dimension,i=t.curveType,r=(t.container,t.xAxisTitle),o=t.yAxisTitle,n=t.CVX,l=t.CVY,s=t.CVZ,d=(t.x_axis,t.y_axis,{credits:{enabled:!1},title:{text:i},subtitle:{text:null},lang:{loading:"Loading..."},xAxis:{title:{text:r},lineColor:"black"},yAxis:[{lineWidth:1,lineColor:"black",arrow:!0,reversed:!1,title:{text:o,align:"high",rotation:0}}]});if(3==e){var c=[],p=[];_.times(n.length,function(i){var r=[];_.forEach(n[i],function(t,a){var e={};e.x=n[i][a],e.y=l[i][a],e.z=s[i],r.push(e)}),p.push(r)}),_.forEach(p,function(t,a){var e=_.sortBy(p[a],function(t,a){return t.x});p[a]=e}),_.forEach(p,function(t,a){var e={};e.name="P="+t[0].z,e.data=[],_.forEach(p[a],function(t,a){e.data.push(t.y)}),c.push(e)}),a=Highcharts.chart(t.container,_.merge({},d,{tooltip:{headerFormat:"<b>{series.name}</b><br>",pointFormat:"{point.x}, {point.y}"},series:c}))}else 2==e&&(a=Highcharts.chart(t.container,_.merge({},d,{tooltip:{headerFormat:"<b>{series.name}</b><br>",pointFormat:"{point.x}, {point.y}"},series:[{data:y}]})));return a}function drawVectorChart(e){if(!_.isEmpty(e.data.curveinfos)){var t,a,i,r=_.find(e.data.curveinfos,function(t,a){return t.curveType==e.curveType}),o=r.dimension,n=r.Subdie,l=r.DeviceGroup,s=r.ParamX+(""==r.ParamXUnit?"":"("+r.ParamXUnit+"）"),d=r.ParamY+(""==r.ParamYUnit?"":"("+r.ParamYUnit+"）");if(0==o)console.log("只加载史密斯"),drawDbCurveANDSmith({smithAndCurve:r.smithAndCurve,container:e.container});else 1==o?dataListDetailSwalMixin({title:"加载数据",text:"当前曲线仅有一列数据！",type:"info",showConfirmButton:!1,showCancelButton:!1,timer:1500}):2==o?(x=r.axis[0].curvedatas,y=r.axis[1].curvedatas,drawCurve({dimension:o,curveType:e.curveType,container:e.container,xAxisTitle:s,yAxisTitle:d,CVX:t,CVY:a,CVZ:i,x_axis:void 0,y_axis:void 0})):3==o&&(i=r.ZAxis,t=r.XAxis,a=r.YAxis,drawCurve({dimension:o,curveType:e.curveType,container:e.container,xAxisTitle:s,yAxisTitle:d,CVX:t,CVY:a,CVZ:i,x_axis:void 0,y_axis:void 0}));e.callback&&e.callback(n,l)}}function buildChartContainer(t){var a="";-1<_.indexOf(dataListDetailStore.state.vectorMap.curveType,t)?(a='<div id="'+t+"_charts_"+dataListDetailStore.state.vectorMap.curCurveTypeNo+'"></div>',$("div.all_charts_rows>div."+t+"_col .panel_chart_body").empty().append(a),$("div.all_charts_rows>div."+t+"_col").fadeIn(200)):(a='<div class="col-sm-12 col-md-12 col-lg-12 '+t+'_col"><div class="panel panel-info"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>'+t+'</div><div class="panel-body"><div class="panel_chart_body"><div id="'+t+"_charts_"+dataListDetailStore.state.vectorMap.curCurveTypeNo+'"></div></div><div class="panel_chart_foot"></div></div></div></div>',$("div.all_charts_rows").append(a),dataListDetailStore.state.vectorMap.curveType.push(t.toString()));var e=t+"_charts_"+dataListDetailStore.state.vectorMap.curCurveTypeNo;return dataListDetailStore.state.vectorMap.curCurveTypeNo++,e}function renderChartByCoord(){$("div.all_charts_rows>div").fadeOut(100);var i=dataListDetailStore.mock.vectorMap.curveTypeData[_.random(0,4,!1)];console.log(i.curveinfos),_.forEach(i.curveinfos,function(t,a){var e=buildChartContainer(t.curveType);console.log(e),drawVectorChart({data:i,curveType:t.curveType,container:e,callback:null})})}dataListDetailStore.mock={allDetail:futuredGlobal.S_getDataListDetail().allDetail,allDetailThead:[],vectorMap:{filterArr:[],waferData:futuredGlobal.S_getMockWaferData()[0],waferData1:futuredGlobal.S_getMockWaferData()[1],curveTypeData:[futuredGlobal.S_getRF_SP2()[0],futuredGlobal.S_getRF_SP2()[1],futuredGlobal.S_getRF_SP2()[2],futuredGlobal.S_getDataListDetail().vectorMapChart[0],futuredGlobal.S_getDataListDetail().vectorMapChart[1]]},parameterMap:{parameter:["参数1","参数2","参数3"]},dataCompare:futuredGlobal.S_getDataCompare(),boxlinediagram_data:futuredGlobal.S_getDataCompare().boxlinediagram.data[5]},dataListDetailStore.state={allDetail:{tbody:{scrollTop:0,scrollLeft:0}},vectorMap:{canKeydown:!1,coordsArray:new HashTable,waferMapObj:Object.create(null),curSelectedDie:Object.create(null),curveType:["ID_VD","OutputCurve","SP2RF","MOS_Cgg_Vgs_Vds_ext","Noise_MOS_Normal"],curCurveTypeNo:0,renderChartByCoordFlag:!1,smithObjArr:[]},parameterMap:{curChartContainerNum:0,hasRender:!1},chartTypeMap:{good_rate:"spline",histogram:"column",boxlinediagram:"boxplot",CPK:"line",gaussiandistribution:"gaussiandistribution"}},dataListDetailStore.sellectObj={selectItem:["93"]},$(".tab-content div[role='tabpanel']").innerWidth($(".tab-content").innerWidth()).innerHeight($(".tab-content").innerHeight()),$(".vectorMap_l, .vectorMap_r").innerHeight($("#vectorMap").innerHeight()),_.forOwn(dataListDetailStore.mock.allDetail.thead[0],function(t,a){switch(a){case"PassPercent":dataListDetailStore.mock.allDetailThead[0]=t;break;case"UpLimit":dataListDetailStore.mock.allDetailThead[1]=t;break;case"LowerLimit":dataListDetailStore.mock.allDetailThead[2]=t;break;default:dataListDetailStore.mock.allDetailThead[3]=t}}),_.forEach(dataListDetailStore.mock.allDetailThead,function(t,a){var e;switch(a){case 0:e="合格率%";break;case 1:e="上限";break;case 2:e="下限";break;default:e="位置"}var i=renderTheadTbody({data:t,th:!0,name:e});$("#allDetail .allDetail_body .table_head thead").append(i)}),$(".allDetail_body .table_body").innerHeight($(".allDetail_body").innerHeight()-$(".allDetail_body .table_head").innerHeight()),_.forOwn(dataListDetailStore.mock.allDetail.tbody[0],function(t,a){var e=renderTheadTbody({data:t,td:!0});$("#allDetail .allDetail_body .table_body tbody").append(e)}),$(".allDetail_body .table_body>table").innerHeight()>$(".allDetail_body .table_body").innerHeight()+7&&$(".allDetail_body .table_head").innerWidth($(".allDetail_body").innerWidth()-7),$(function(){$("#allDetail>.table_data").html(futuredGlobal.S_getDataListDetail().allDetail);dataListDetailStore.mock.vectorMap.waferData1.waferMapDataList[0];dataListDetailStore.mock.vectorMap.filterArr=[],_.forEach(o,function(t,a){dataListDetailStore.mock.vectorMap.filterArr.push(_.keys(t)[0])});var i,t=1.25*($(".vectorMap_r").innerHeight()-20),a=$(".vectorMap_r").innerHeight()-20,o=dataListDetailStore.mock.vectorMap.waferData1.waferMapDataList[0].m_DieDataListNew;_.forEach(o,function(t,a){var e=!1;if(_.forOwn(t,function(t,a){1==t&&(i=a.toString(),e=!0)}),e)return!1}),_.isNil(i)&&(i="0:0"),dataListDetailStore.state.vectorMap.waferMapObj=buildColorGradation({width:t,height:a,container:"canvas_vectorMap",bgFillColor:"#314067",waferData:dataListDetailStore.mock.vectorMap.waferData1,spacePercent:{x:.1,y:0},m_DieDataListNew:o,colorGradation:{limitColor:"#FF0000",floorColor:"#008000",nums:256},filterArr:dataListDetailStore.mock.vectorMap.filterArr,currentDieCoord:i,isFirst:!0,coordsArra:dataListDetailStore.state.vectorMap.coordsArray,returnFlag:!0,addEvent:!0,curSelectedDie:dataListDetailStore.state.vectorMap.curSelectedDie,vectorMap:!0,callback:function(t){$(".vectorMap_l .positionFlag_div>img").attr("src","../img/modules/dataListDetail/"+t+".png");var a=dataListDetailStore.mock.vectorMap.waferData1.waferMapDataList[0].Yield;$(".qualifiedInformation_div .panel-body tbody>tr:eq(1)>td:eq(1)").text(100*a+"%");var e=_.countBy(o,function(t,a){var e;return _.forOwn(t,function(t,a){e=t}),e}),i=e[1],r=e[255];_.isNil(i)&&(i=0),_.isNil(r)&&(r=0),$(".qualifiedInformation_div .panel-body tbody>tr:eq(2)>td:eq(1)").text(i),$(".qualifiedInformation_div .panel-body tbody>tr:eq(3)>td:eq(1)").text(r)},clickCallback:function(t){$(".coordinateInformation_div .panel-body tbody>tr:eq(0)>td:eq(1)").text("（"+t+"）"),renderChartByCoord()},keydownCallback:function(t){$(".coordinateInformation_div .panel-body tbody>tr:eq(0)>td:eq(1)").text("（"+t+"）"),renderChartByCoord()},resizeCallback:function(t,a,e){$(window).on("resize",_.debounce(function(){calculateLayout(t,a,e)},200))}}),$("#parameterMap>div.panel").each(function(t,a){var e=$(a).data("iallstatistics"),i='<div class="container-fluid">';if(-1<["good_rate","CPK"].indexOf(e))i+='<div class="row">',i+='<div class="col-sm-12 col-md-6 col-lg-6">',i+='<div class="panel panel-info"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>'+dataListDetailStore.mock.parameterMap.parameter.join("&")+'</div><div class="panel-body"><div class="container-fluid"><div class="chart_title"></div><div class="chart_body"><div id="'+(e+dataListDetailStore.state.parameterMap.curChartContainerNum)+'" data-iparam="'+dataListDetailStore.mock.parameterMap.parameter.join("&")+'"></div></div><div class="chart_foot"></div></div></div></div>',i+="</div>",i+="</div>",dataListDetailStore.state.parameterMap.curChartContainerNum++;else{var r="";-1<_.indexOf(["gaussiandistribution"],e)&&(r='<div class="container-fluid"><div class="row"><div class="col-sm-12 col-md-12 col-lg-7"><table class="table table-striped table-bordered table-condensed"><thead><tr><th>中值</th><th>平均值</th><th>最大值</th><th>最小值</th></tr></thead><tbody><tr><td>中值</td><td>平均值</td><td>最大值</td><td>最小值</td></tr></tbody></table></div><div class="col-sm-12 col-md-12 col-lg-5"><table class="table table-striped table-bordered table-condensed"><thead><tr><th>期望</th><th>标准差</th><th>方差</th></tr></thead><tbody><tr><td>期望</td><td>标准差</td><td>方差</td></tr></tbody></table></div></div></div>'),dataListDetailStore.mock.parameterMap.parameter.map(function(t,a){a%2==0&&(i+='<div class="row">'),i+='<div class="col-sm-12 col-md-6 col-lg-6">',i+='<div class="panel panel-info"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>'+t+'</div><div class="panel-body"><div class="container-fluid"><div class="chart_title"></div><div class="chart_body"><div id="'+(e+dataListDetailStore.state.parameterMap.curChartContainerNum)+'" data-iparam="'+t+'"></div></div><div class="chart_foot">'+r+"</div></div></div></div>",i+="</div>",a%2!=0&&(i+="</div>"),dataListDetailStore.state.parameterMap.curChartContainerNum++})}i+="</div>",$(this).children(".panel-body").append(i)}),_.forEach(dataListDetailStore.state.vectorMap.curveType,function(t){buildChartContainer(t)})}),$(window).on("resize",_.debounce(commonCalcLayout,200)),$(window).on("resize",_.debounce(function(){_.forEach(dataListDetailStore.state.vectorMap.smithObjArr,function(t,a,e){e[a].onresize()})},200)),$(".allDetail_body .table_body").on("scroll",function(t){dataListDetailStore.state.allDetail.tbody.scrollTop-1<$(this).scrollTop()&&dataListDetailStore.state.allDetail.tbody.scrollTop+1>$(this).scrollTop()&&$(".allDetail_body .table_head").scrollLeft($(this).scrollLeft()),dataListDetailStore.state.allDetail.tbody.scrollTop=$(this).scrollTop(),dataListDetailStore.state.allDetail.tbody.scrollLeft=$(this).scrollLeft()}),$(document).on("click",".vectorMap_l div.panel-heading>span.glyphicon, #parameterMap div.panel-heading>span.glyphicon",function(){$(this).toggleClass("glyphicon-menu-down glyphicon-menu-right").parent().parent().toggleClass("panel-info panel-success"),$(this).hasClass("glyphicon-menu-right")?$(this).parent().next().slideUp(200):$(this).parent().next().slideDown(200)}),$(document).on("shown.bs.tab",'div.g_menu a[data-toggle="tab"]',function(t){var a=$(t.target).attr("aria-controls");"parameterMap"!=a||dataListDetailStore.state.parameterMap.hasRender?"allDetail"==a?_.debounce(commonCalcLayout,200)():"vectorMap"!=a||dataListDetailStore.state.vectorMap.renderChartByCoordFlag||(renderChartByCoord(),dataListDetailStore.state.vectorMap.renderChartByCoordFlag=!0):dataListDetailSwalMixin({title:"加载数据",text:"正在绘图中......",type:"info",showConfirmButton:!1,showCancelButton:!1,timer:1e3}).then(function(){dataListDetailSwalMixin({title:"加载数据",text:"正在绘图中......",type:"info",showConfirmButton:!1,showCancelButton:!1}),$("#parameterMap>div.panel").each(function(t,a){var e=$(a).data("iallstatistics");if("map_good_rate_distribution"==e)$(a).children(".panel-body").find(".chart_body>div").each(function(t,a){draw_map_good_rate_distribution($(this),t)});else if("map_color_order_distribution"==e){var i=_.cloneDeep(futuredGlobal.S_getMockWaferData()[0]),p={},h=200,u=300,r=Math.max(Math.abs(i.maxX),Math.abs(i.minX)),v=Math.sqrt(2)*r,m=_.round(80),b=_.round(480);_.forEach(i.waferMapDataList,function(t,a,e){_.forEach(e[a].m_DieDataListNew,function(t,a,e){_.forOwn(e[a],function(t,a,e){var i=_.random(m,b,!1),r=Number(a.toString().split(":")[0]),o=Number(a.toString().split(":")[1]),n=Math.pow(r,2)+Math.pow(o,2),l=_.round(_.mean([h,250])),s=_.round(_.mean([250,u])),d=_.round(_.mean([100,h])),c=_.round(_.mean([u,400]));Math.pow(3.2,2)*n<Math.pow(v,2)?i=_.random(l,s,!1):4*n<Math.pow(v,2)?i=Math.pow(2.67,2)*n<Math.pow(v,2)?_.random(h,l,!1):_.random(s,u,!1):Math.pow(1.33,2)*n<Math.pow(v,2)?i=Math.pow(1.6,2)*n<Math.pow(v,2)?_.random(d,h,!1):_.random(u,c,!1):n<=Math.pow(v,2)&&(i=(Math.abs(r)+Math.abs(o))%2==0?_.random(m,d,!1):_.random(c,b,!1)),i<100?(i=100,e[a]={bin:t,color:"1:"+i}):100<=i&&i<h?e[a]={bin:t,color:"2:"+i}:h<=i&&i<250?e[a]={bin:t,color:"3:"+i}:250<=i&&i<u?e[a]={bin:t,color:"4:"+i}:u<=i&&i<400?e[a]={bin:t,color:"5:"+i}:400<=i&&(i=400,e[a]={bin:t,color:"6:"+i}),12==t?("12:"in p||(p["12:"]="#fff"),e[a]={bin:12,color:"12:"}):-1==t&&("-1:"in p||(p["-1:"]="#314067"),e[a]={bin:-1,color:"-1:"})})})});$(a).children(".panel-body").find(".chart_body>div").each(function(t,a){draw_map_color_order_distribution($(this),t,i,400,100,h,u,250,100,50,50,100,p)})}else{var o=_.find(dataListDetailStore.state.chartTypeMap,function(t,a){return a==e});$(a).children(".panel-body").find(".chart_body>div").each(function(){draw_other_chart($(this),e,o)})}}),swal.clickCancel(),dataListDetailStore.state.parameterMap.hasRender=!0})});