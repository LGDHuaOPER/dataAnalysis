var dataStatisticsSwalMixin=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"}),dataStatisticsState=new Object;function eleResize(){var t=$(window).height();t<600&&(t=600),$("body").height(t),$(".g_bodyin_bodyin_bottom").innerHeight(t-150),$(".g_bodyin_bodyin_bottom_l, .g_bodyin_bodyin_bottom_r").innerHeight(t-150)}function eleResize2(){$(".g_bodyin_bodyin_bottom_lsub, .g_bodyin_bodyin_bottom_rsub").height($(".g_bodyin_bodyin_bottom").height()),$(".g_bodyin_bodyin_bottom_lsub_top, .g_bodyin_bodyin_bottom_lsub_mid").innerHeight(($(".g_bodyin_bodyin_bottom_lsub").innerHeight()-46)/2)}function renderSelectCsv(t,d,a){var l="";t.selectedItem.map(function(t,a){var i,e,n=dataStatisticsState.mock.selectedItem[a%dataStatisticsState.mock.selectedItem.length],o=n.from,s=n.times;_.forOwn(n,function(t,a){if(!_.isNumber(t))return i=a.substring(0,7),e=t[0],!1});var r=a+1;r="00"+r,i=i+eouluGlobal.S_getLastStr(r,3)+".csv",dataStatisticsState.mock.RF_SP2_render.push(i),dataStatisticsState.mock.RF_SP2_render=_.uniq(dataStatisticsState.mock.RF_SP2_render),l+='<div class="g_bodyin_bodyin_bottom_l'+d+'_item"><div class="g_bodyin_bodyin_bottom_l'+d+'_itemin"><div class="g_bodyin_bodyin_bottom_l'+d+'_itemin_main" data-icsv="'+i+'">'+i+'<span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span></div><div class="g_bodyin_bodyin_bottom_l'+d+'_itemin_sub" data-parentfile="'+i.replace(".csv","")+'">',_.times(s,function(t){var a=o+t+e.substring(1);l+='<div class="g_bodyin_bodyin_bottom_l'+d+'_itemin_subin">'+a+"</div>"}),l+="</div></div></div>"}),a.empty().append(l)}function renderChartCsvANDParam(e){var n="";"csv"==e.classify?e.csv.map(function(t,a){n+='<div class="g_bodyin_bodyin_bottom_l'+e.flag+'_item"><div class="g_bodyin_bodyin_bottom_l'+e.flag+'_itemin"><div class="g_bodyin_bodyin_bottom_l'+e.flag+'_itemin_main">'+t+'<span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span></div></div></div>'}):"table"==e.classify?(n+='<table class="table table-striped table-bordered table-hover table-condensed"><thead><tr><th>参数名称</th><th>下限</th><th>上限</th><th>等分数</th></tr></thead><tbody>',e.param.map(function(t,a){var i=e.ishowchart+String(dataStatisticsState.stateObj.chartRenderCurID++);n+='<tr data-chartcurid="'+i+'" data-ishowchartparam="'+t+'"><td>'+t+"</td><td>0.32</td><td>1.4</td><td>6</td></tr>"}),n+="</tbody></table>"):"ul"==e.classify&&(n+='<ul class="list-group">',e.param.map(function(t,a){var i=e.ishowchart+String(dataStatisticsState.stateObj.chartRenderCurID++);n+='<li class="list-group-item" data-chartcurid="'+i+'" data-ishowchartparam="'+t+'"><span class="badge">参数</span>'+t+"</li>"}),n+="</ul>"),e.insertDOM.empty().append(n)}function draw_map_color_order_distribution(e,t,a,i,n,o,s,r,d,l,c,p,b){var h=e.innerWidth(),m=e.innerHeight(),u="canvas_"+e.attr("id");e.append("<canvas id='"+u+"'></canvas>"),e.next().children(".colorOrder_g").append("<div class='colorGradient'></div>"),buildColorGradation({width:h,height:m,container:u,bgFillColor:"#314067",waferData:a,spacePercent:{x:.2,y:0},m_DieDataListNew:a.waferMapDataList[t%5].m_DieDataListNew,colorGradation:{theMinColor:"#0000FF",lowwerColor:"#00FFFF",midderColor:"#00FF00",upperColor:"#FFFF00",theMaxColor:"#FF0000",twoDiff:d,threeDiff:l,fourDiff:c,fiveDiff:p},colorOrder:!0,theMin:n,lowwer:o,midder:r,upper:s,theMax:i,otherColor:b});var g=e.next().children(".colorOrder_g").find("div.colorGradient");g.width(30).height(m-45);var y=d+l+c+p,S=g.width(),f=g.height()/(1.2*y);g.append("<span class='colorGradientSpan oneSpan outSpan'><span style='height: "+f+"px; width: "+S+"px'></span></span>"),g.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+S+"px;'></span>"),_.times(d,function(t){var a=getGradientColor("#00FFFF","#0000FF",d,d-t);g.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+f+"px; width: "+S+"px'></span>")}),g.append("<span class='colorGradientSpan twoSpan outSpan'><span style='height: "+f+"px; width: "+S+"px'></span></span>"),g.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+S+"px;'></span>"),_.times(l,function(t){var a=getGradientColor("#00FF00","#00FFFF",l,l-t);g.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+f+"px; width: "+S+"px'></span>")}),g.append("<span class='colorGradientSpan threeSpan outSpan'><span style='height: "+f+"px; width: "+S+"px'></span></span>"),g.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+S+"px;'></span>"),_.times(c,function(t){var a=getGradientColor("#FFFF00","#00FF00",c,c-t);g.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+f+"px; width: "+S+"px'></span>")}),g.append("<span class='colorGradientSpan fourSpan outSpan'><span style='height: "+f+"px; width: "+S+"px'></span></span>"),g.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+S+"px;'></span>"),_.times(p,function(t){var a=getGradientColor("#FF0000","#FFFF00",p,p-t);g.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+f+"px; width: "+S+"px'></span>")}),g.append("<span class='colorGradientSpan fiveSpan outSpan'><span style='height: "+f+"px; width: "+S+"px'></span></span>"),g.append("<span class='colorGradientSpan splitSpan' style='height: "+f+"px; width: "+S+"px;'></span>"),g.append("<span class='colorGradientSpan sixSpan outSpan'><span style='height: "+f+"px; width: "+S+"px'></span></span>");var v=_.countBy(a.waferMapDataList[t%5].m_DieDataListNew,function(t,a){var i;return _.forOwn(t,function(t,a){i=t.color.split(":")[0]}),i});$('<table class="table table-striped table-bordered table-condensed"><tbody><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr></tbody></table>').appendTo(e.next().children(".colorOrder_table")),console.log(v),_.forOwn(v,function(t,a){if(-1==a||12==a)return!0;var i=e.next().children(".colorOrder_table").find("tr").eq(a-1);i.children("td").eq(0).text(a+"区间"),i.children("td").eq(1).text(t+"个")}),e.next().children(".colorOrder_table").find("tr").each(function(t){_.isEmpty($(this).children("td").eq(0).text())&&($(this).children("td").eq(0).text(t+1+"区间"),$(this).children("td").eq(1).text("0个"))})}dataStatisticsState.mock={curveType:{DC:["IL","BW","VSWR","CF"],RTP:["IL","BW","VSWR","CF"],"RF-S2P":["IL","BW","VSWR","CF"]},selectedItem:[{"WaferID01.csv":["1-0-RF.S2P"],from:1,times:5},{"WaferID02.csv":["2-0-RF.S2P"],from:2,times:3},{"WaferID03.csv":["3-0-RF.S2P"],from:3,times:4},{"WaferID04.csv":["4-0-RF.S2P"],from:4,times:5}],RF_SP2:futuredGlobal.S_getRF_SP2(),RF_SP2_MagnitudeDB:futuredGlobal.S_getRF_SP2_MagnitudeDB(),RF_SP2_render:[]},dataStatisticsState.csvANDparamSelected={csv:[],param:[]},dataStatisticsState.stateObj={renderSelectCsvSub:!1,chartValidate:{histogram:{csvLen:"+",paramLen:1},boxlinediagram:{csvLen:"+",paramLen:1},CPK:{csvLen:1,paramLen:1},wafermap:{csvLen:"+",paramLen:1},gaussiandistribution:{csvLen:"+",paramLen:1}},chartRenderCurID:0},dataStatisticsState.chartMap={histogram:"column",boxlinediagram:"boxplot",CPK:"line",correlationgraph:"scatter",gaussiandistribution:"gaussiandistribution",wafermap:"wafermap"},$(".g_bodyin_bodyin_bottom_2, .g_bodyin_bodyin_bottom_rsubin").hide().css("opacity",1),$(function(){var i=store.get("futureDT2__projectAnalysis__selectedObj");if(_.isEmpty(i)||_.isNil(i))dataStatisticsSwalMixin({title:"未选中晶圆",text:"请重新选择！",type:"info",showConfirmButton:!1,timer:2e3}).then(function(t){t.dismiss!=swal.DismissReason.backdrop&&t.dismiss!=swal.DismissReason.esc&&t.dismiss!=swal.DismissReason.timer||window.location.assign("projectAnalysis.html")});else{var t=_.find(dataStatisticsState.mock.curveType,function(t,a){return a==i.curveType});"RF-S2P"==i.curveType&&(i.curveType="S2P");var a="";_.isEmpty(t)||_.isNil(t)||t.map(function(t){a+='<a href="javascript:;" class="list-group-item" data-iparam="'+t+'"><span class="badge">选中</span>'+t+"</a>"});var e=store.get("futureD__RF_SP2__paramCalc_tableStr");_.isNil(e)||$(e).each(function(){var t=$(this).children("td:eq(0)").text();a+='<a href="javascript:;" class="list-group-item" data-iparam="'+t+'"><span class="badge">选中</span>'+t+"</a>"}),$(".g_bodyin_bodyin_bottom_l_inbottom>.list-group").empty().append(a),$(".g_bodyin_bodyin_bottom_l_inbottom>.list-group>a").trigger("click"),renderSelectCsv(i,"",$(".g_bodyin_bodyin_bottom_l_intop")),$(".g_bodyin_bodyin_bottom_l_item .g_bodyin_bodyin_bottom_l_itemin_main").trigger("click")}eleResize(),$(window).on("resize",function(){eleResize(),eleResize2()})}),$(".g_info_r>.glyphicon-user").click(function(){window.location.assign("admin.html")}),$(document).on("click",".g_bodyin_bodyin_bottom_l_itemin_subin",function(){$(this).toggleClass("selected")}).on("click",".g_bodyin_bodyin_bottom_l_itemin_main",function(){$(this).toggleClass("active");var t=$(this).data("icsv").toString();$(this).hasClass("active")?dataStatisticsState.csvANDparamSelected.csv.push(t):_.pull(dataStatisticsState.csvANDparamSelected.csv,t)}),$(document).on("click",".g_bodyin_bodyin_bottom_lsub_itemin_main",function(){$(this).toggleClass("active")}),$(document).on("click",".g_bodyin_tit_r>span, .g_bodyin_bodyin_bottom_r .thumbnail",function(){if($(this).hasClass("cannotclick"))return!1;var t=$(this).data("ipage"),f=$(this).data("ichart");$("."+t).siblings().fadeOut(200),$(".g_bodyin_bodyin_bottom_rsubin:not([data-ishowchart='"+f+"'])").fadeOut(200),$("."+t).delay(200).fadeIn(200,function(){var S;"g_bodyin_bodyin_bottom_2"==t?($(".g_bodyin_tit_r>span").show(),renderChartCsvANDParam({classify:"csv",csv:_.cloneDeep(dataStatisticsState.csvANDparamSelected.csv),flag:"sub",insertDOM:$(".g_bodyin_bodyin_bottom_lsub_top"),ishowchart:f}),"histogram"==f||"wafermap"==f||"gaussiandistribution"==f?S="table":"boxlinediagram"!=f&&"CPK"!=f&&"correlationgraph"!=f||(S="ul"),renderChartCsvANDParam({classify:S,param:_.cloneDeep(dataStatisticsState.csvANDparamSelected.param),insertDOM:$(".g_bodyin_bodyin_bottom_lsub_mid"),ishowchart:f}),$(".g_bodyin_bodyin_bottom_lsub_item .g_bodyin_bodyin_bottom_lsub_itemin_main").trigger("click"),dataStatisticsState.stateObj.renderSelectCsvSub||(eleResize2(),dataStatisticsState.stateObj.renderSelectCsvSub=!0),$(".g_bodyin_bodyin_bottom_rsubin[data-ishowchart='"+f+"']").delay(50).fadeIn(200,function(){buildChartContainer({ishowchart:f}),$(".g_bodyin_bodyin_bottom_rsubin[data-ishowchart='"+f+"']>.chartBody>.container-fluid [data-initrenderchart]").each(function(t,a){var i,e=$(this).attr("id"),n=$(".g_bodyin_bodyin_bottom_lsub_mid [data-chartcurid='"+e+"']");"table"==S?i="等分数"+n.children("td:eq(3)").text():"ul"==S&&(i="");var o=_.find(dataStatisticsState.chartMap,function(t,a){return a==f}),s={},r={};if("wafermap"==o){var d=_.cloneDeep(futuredGlobal.S_getMockWaferData()[_.random(0,1,!1)]),p={},b=200,h=300,l=Math.max(Math.abs(d.maxX),Math.abs(d.minX)),m=Math.sqrt(2)*l,u=_.round(80),g=_.round(480);_.forEach(d.waferMapDataList,function(t,a,i){_.forEach(i[a].m_DieDataListNew,function(t,a,i){_.forOwn(i[a],function(t,a,i){var e=_.random(u,g,!1),n=Number(a.toString().split(":")[0]),o=Number(a.toString().split(":")[1]),s=Math.pow(n,2)+Math.pow(o,2),r=_.round(_.mean([b,250])),d=_.round(_.mean([250,h])),l=_.round(_.mean([100,b])),c=_.round(_.mean([h,400]));Math.pow(3.2,2)*s<Math.pow(m,2)?e=_.random(r,d,!1):4*s<Math.pow(m,2)?e=Math.pow(2.67,2)*s<Math.pow(m,2)?_.random(b,r,!1):_.random(d,h,!1):Math.pow(1.33,2)*s<Math.pow(m,2)?e=Math.pow(1.6,2)*s<Math.pow(m,2)?_.random(l,b,!1):_.random(h,c,!1):s<=Math.pow(m,2)&&(e=(Math.abs(n)+Math.abs(o))%2==0?_.random(u,l,!1):_.random(c,g,!1)),e<100?(e=100,i[a]={bin:t,color:"1:"+e}):100<=e&&e<b?i[a]={bin:t,color:"2:"+e}:b<=e&&e<250?i[a]={bin:t,color:"3:"+e}:250<=e&&e<h?i[a]={bin:t,color:"4:"+e}:h<=e&&e<400?i[a]={bin:t,color:"5:"+e}:400<=e&&(e=400,i[a]={bin:t,color:"6:"+e}),12==t?("12:"in p||(p["12:"]="#fff"),i[a]={bin:12,color:"12:"}):-1==t&&("-1:"in p||(p["-1:"]="#314067"),i[a]={bin:-1,color:"-1:"})})})});draw_map_color_order_distribution($(a),t,d,400,100,b,h,250,100,50,50,100,p)}else{var c=null;if("column"==o){r={categories:[["-∞",423e-8],[423e-8,448e-8],[448e-8,47300000000000005e-22],[47300000000000005e-22,498e-8],[498e-8,523e-8],[523e-8,548e-8],[548e-8,5729999999999999e-21],[5729999999999999e-21,59799999999999995e-22],[59799999999999995e-22,623e-8],[623e-8,"+∞"]],type:"linear",labels:{rotation:-45},plotLines:[{color:"#FF0000",width:2,value:.5},{color:"#FF0000",width:2,value:8.5}]},s={title:{text:"百分数"}};var y=[];_.forEach(["93"],function(t,a){var i={};i.name="wafer"+t,i.type="column",i.data=[2,8,10,5,15,20,3,7,10,20],y.push(i)}),y.push({name:"累加",type:"line",data:[2,10,20,25,40,60,63,70,80,100]}),c=_.cloneDeep(y)}else"boxplot"==o?(r={categories:["1","2","3","4","5"],title:{text:""}},s={title:{text:"观测值"},plotLines:[{value:932,color:"red",width:1,label:{text:"理论模型: 932",align:"center",style:{color:"gray"}}}]}):"line"==o?(r={categories:["一","二","三","四","五","六","七","八","九","十","十一","十二"]},s={title:{text:"values"}}):"scatter"==o?(r={title:{enabled:!0,text:"数据一"},startOnTick:!0,endOnTick:!0,showLastLabel:!0},s={title:{text:"数据二"}}):"gaussiandistribution"==o&&(r=[{categories:_.range(1,13,1),crosshair:!0,type:"linear"}],s=[{labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[1]}},title:{text:"频率",style:{color:Highcharts.getOptions().colors[1]}}},{title:{text:"正太分布",style:{color:Highcharts.getOptions().colors[0]}},labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[0]}},opposite:!0}]);initRenderChart({chart:{type:o},container:e,title:n.data("ishowchartparam"),subtitle:i,yAxis:s,xAxis:r,series:c})}})})):$(".g_bodyin_tit_r>span").hide()})}),$(document).on("click",".g_bodyin_bodyin_bottom_l_inbottom>.list-group>a",function(){$(this).toggleClass("list-group-item-info");var t=$(this),a=t.data("iparam").toString();t.hasClass("list-group-item-info")?dataStatisticsState.csvANDparamSelected.param.push(a):_.pull(dataStatisticsState.csvANDparamSelected.param,a);$(this).children("span").text(["选中","取消选中"][Number(t.hasClass("list-group-item-info"))])});