var RF_SP2SwalMixin=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"}),S_factorial=eouluGlobal.S_factorial,RF_SP2State=new Object;function eleResize(){var t=$(window).height();t<600&&(t=600),$("body").height(t),$(".g_bodyin_bodyin_bottom").innerHeight(t-180),$(".g_bodyin_bodyin_bottom_l, .g_bodyin_bodyin_bottom_r").innerHeight(t-190),$("div.picturetop").each(function(){if($(this).is("#picture2top")||$(this).is("#picture3top")){var t=1,e=0;3<RF_SP2State.waferSelected.length&&(t=2,e=7),$(this).innerHeight(~~($(this).parent().height()*t)).innerWidth(~~($(this).parent().width()-e))}else $(this).innerHeight($(this).parent().height()-50)}),$(".picturebottom_in_m ul>li").innerWidth($(".picturebottom_in_m").innerWidth())}function eleResize2(){$(".g_bodyin_bodyin_bottom_lsub, .g_bodyin_bodyin_bottom_rsub").height($(".g_bodyin_bodyin_bottom").height()),$(".g_bodyin_bodyin_bottom_lsub_top, .g_bodyin_bodyin_bottom_lsub_bottom").innerHeight($(".g_bodyin_bodyin_bottom_lsub").innerHeight()/2-1)}function renderSelectCsv(t,l,e){var c="";t.selectedItem.map(function(t,e){var i,a,n=RF_SP2State.mock.selectedItem[e%RF_SP2State.mock.selectedItem.length],r=n.from,o=n.times;_.forOwn(n,function(t,e){if(!_.isNumber(t))return i=e.substring(0,7),a=t[0],!1});var s=e+1;s="00"+s,i=i+eouluGlobal.S_getLastStr(s,3)+".csv",RF_SP2State.mock.RF_SP2_render.push(i),RF_SP2State.mock.RF_SP2_render=_.uniq(RF_SP2State.mock.RF_SP2_render),c+='<div class="g_bodyin_bodyin_bottom_l'+l+'_item"><div class="g_bodyin_bodyin_bottom_l'+l+'_itemin"><div class="g_bodyin_bodyin_bottom_l'+l+'_itemin_main">'+i+'<span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span></div><div class="g_bodyin_bodyin_bottom_l'+l+'_itemin_sub" data-parentfile="'+i.replace(".csv","")+'">',_.times(o,function(t){var e=r+t+a.substring(1);c+='<div class="g_bodyin_bodyin_bottom_l'+l+'_itemin_subin">'+e+"</div>"}),c+="</div></div></div>"}),e.empty().append(c)}function renderNavItem(t){var e="",i=t.item,a=t.type,n=t.index;if("RF-S2P"==i.curveType&&(i.curveType="S2P"),"g_bodyin_bodyin_bottom_1"==a)e+='<li class="active" data-targetclass="g_bodyin_bodyin_bottom_1">'+i.curveType+'</li><li data-targetclass="g_bodyin_bodyin_bottom_2">TCF</li>';else if("g_bodyin_bodyin_bottom_2"==a){e+='<li data-targetclass="g_bodyin_bodyin_bottom_1">返回'+i.curveType+"</li>";var r="";(1==n||_.isNil(n))&&(r="active"),e+='<li class="'+r+'" data-targetclass="g_bodyin_bodyin_bottom_2">TCF</li>',e+='<li data-targetclass="add"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></li>'}$(".g_bodyin_bodyin_top_wrap_m_in>ul").empty().append(e)}function markerJoinCalc(n){return _.forEach(RF_SP2State.stateObj.splineSelectedArr,function(i,t){if(-1==n.indexOf(i.markerName))return!0;var e=n.match(new RegExp(i.markerName+"\\.X","g")),a=n.match(new RegExp(i.markerName+"\\.Y","g"));_.forEach(e,function(t,e){n=n.replace(t,i.x)}),_.forEach(a,function(t,e){n=n.replace(t,i.y)})}),n}function markerMathCalc(o){return _.forOwn(RF_SP2State.MathMap,function(r,t){if(-1==o.indexOf(t))return!0;if(null==r.reg){var e=new RegExp(t,"g");o=_.replace(o,e,r.replace)}else{var i=o.match(r.reg);if(_.isNil(i))return!0;_.isNumber(r.index)?_.forEach(i,function(t,e){var i="("+r.replace+")",a=t.match(r.reg1)[r.index];i=i.replace("##1",a),o=o.replace(t,i)}):_.isArray(r.index)&&_.forEach(i,function(t,e){var i="("+r.replace+")",a=t.match(r.reg1)[r.index[0]],n=t.match(r.reg1)[r.index[1]];i=(i=i.replace("##1",a)).replace("##2",n),o=o.replace(t,i)})}}),o}function judgeLineSegmentIntersect(i,a,t){var n=!1;return _.isEmpty(t)?n=!1:_.forEach(t,function(t,e){if((t[0]<=i&&i<=t[1]||t[0]<=a&&a<=t[1]||i<=t[0]&&t[0]<=a||i<=t[1]&&t[1]<=a)&&(n=!0),t[0]==i&&t[1]==a&&(n=!0),n)return!1}),n}function getDataBuildBigS12S21(t){var n=t.iclassify,e=t.itargetchart;if(!0===t.contextFlag){switch(t.iflag){case"Smith":getDataBuildBigS12S21({iclassify:n,itargetchart:e,callback:t.callback});break;default:var r={xCategories:[]};_.forEach(RF_SP2State.mock.RF_SP2_MagnitudeDB[0][n],function(t,e){r.xCategories.push(Math.floor(t[0]/1e7)/100)}),r.series=[],_.forEach(RF_SP2State.waferSelected,function(t,e){var i=_.cloneDeep(RF_SP2State.mock.RF_SP2_MagnitudeDB[e%3][n]),a={};a.name=t,a.data=[],_.forEach(i,function(t,e){a.data.push(parseFloat(t[1]))}),r.series.push(a)}),r.container=e,r.legend_enabled=!0,r.zoomType="x",r.resetZoomButton={position:{align:"left",x:90,y:10},relativeTo:"chart"},r.text=n,r.showCheckbox=!0,r.callback=t.callback,drawRealS12S21(r)}}else{var a={xCategories:[]};_.forEach(RF_SP2State.mock.RF_SP2[0].curveinfos[2].smithAndCurve[n],function(t,e){a.xCategories.push(Math.floor(t[0]/1e7)/100)}),a.series=[],_.forEach(RF_SP2State.stateObj.S2PSmallChartSmithData[n],function(t,e){var i={};i.name=t.name,i.data=[],_.forEach(t.data,function(t,e){i.data.push(parseFloat(t[1]))}),i.color=t.color,a.series.push(i)}),_.times(a.series.length,function(t){RF_SP2State.stateObj.indicatrix_min_max[0]=_.min([RF_SP2State.stateObj.indicatrix_min_max[0],_.min(a.series[t].data)]),RF_SP2State.stateObj.indicatrix_min_max[1]=_.max([RF_SP2State.stateObj.indicatrix_min_max[1],_.max(a.series[t].data)])}),a.container=e,a.legend_enabled=!0,a.zoomType="x",a.resetZoomButton={position:{align:"left",x:90,y:10},relativeTo:"chart"},a.text=n,a.showCheckbox=!0,a.callback=t.callback,RF_SP2State.stateObj.smithSXCategories=_.cloneDeep(a.xCategories),drawRealS12S21(a)}}function getDataBuildBigS11S22(t){var r=t.iclassify,e=t.itargetchart,i=t.item,a=_.cloneDeep(RF_SP2State.stateObj.S2PSmallChartSmithData[r]);getDataBuildS11S22({wrapDOM:document.getElementById(e),title:[""],legendName:[r],data:_.reduce(a,function(t,e,i){return t.push(_.cloneDeep(e.data)),t},[]),classify:r,msgDOM:!0,lineColorArray:_.reduce(a,function(t,e,i){return t.push(e.color),t},[]),msgInitFun:function(t){buildS11ANDS22Bottom(r,$(".signalChart_div_foot .signalChart_div_foot_in_m_in ul"),function(){$(".signalChart_div_foot_in_m_in ul>li").innerHeight($(".signalChart_div_foot_in_m").innerHeight()).innerWidth(.5*$(".signalChart_div_foot_in_m").innerWidth()-1),_.isNil(i)?$(".signalChart_div_foot_in_m_in ul>li:first").addClass("active").next().addClass("active"):$(".signalChart_div_foot_in_m_in ul>li[data-iparamter='"+i+"']").addClass("active").next().addClass("active")}),$(".signalChart_div_foot_in_m_in ul>li.active").find(".Smith_Msg2").text(t)},msgFun:function(t,e,i){var a=RF_SP2State.stateObj.S2PSmallChartSmithData[r][e].name,n=$(".signalChart_div_foot_in_m_in ul>li[data-iparamter='"+a+"']");n.siblings().removeClass("active"),n.addClass("active").next().addClass("active").find(".Smith_Msg2").text(i),n.find(".Smith_Msg2").text(t)},callback:function(t){window.onresize=function(){t.onresize()}}})}function buildS11ANDS22Bottom(a,t,e){var n="";_.forEach(RF_SP2State.stateObj.S2PSmallChartSmithData[a],function(t,e){var i=t.name.split(" ")[1].replace(/\..*/,"");n+='<li data-iparamter="'+t.name+'"><div class="pictureline"><p style="background: '+t.color+'"></p></div><div class="smithdata"><p class="smithdata1"><span class="Smith_Paramter">'+i+' Paramter</span> (<span class="Smith_Msg1">'+a+'</span>)</p><p class="smithdata2"><span class="Smith_Paramter">'+i+' Paramter</span> : <span class="Smith_Msg2"></span></p></div></li>'}),t.empty().append(n),_.isFunction(e)&&e()}function msgInitFun(t,e,i,a){buildS11ANDS22Bottom(e,$("#picture"+i+"bottom .picturebottom_in_m_in ul"),function(){$("#picture"+i+"bottom .picturebottom_in_m_in ul>li").innerHeight($("#picture"+i+"bottom .picturebottom_in_m").innerHeight()).innerWidth($("#picture"+i+"bottom .picturebottom_in_m").innerWidth()),!1===a?$("#picture"+i+"bottom .picturebottom_in_m_in ul>li:first").addClass("active"):$("#picture"+i+"bottom .picturebottom_in_m_in ul>li[data-iparamter='"+a+"']").addClass("active")}),$("#picture"+i+"bottom .picturebottom_in_m_in ul>li.active").find(".Smith_Msg2").text(t)}function imsgFun(t,e,i,a){var n=RF_SP2State.stateObj.S2PSmallChartSmithData[i][e].name;$("#picture"+a+"bottom .picturebottom_in_m_in ul>li[data-iparamter='"+n+"']").addClass("active").siblings().removeClass("active"),$("#picture"+a+"bottom .picturebottom_in_m_in ul>li.active").find(".Smith_Msg2").text(t)}function getTCFDataANDDrawChart(t){var g=t.isComfirmKey,e=_.cloneDeep(RF_SP2State.mock.RF_SP2[2].curveinfos[2].smithAndCurve.S21),i=_.cloneDeep(RF_SP2State.mock.RF_SP2[_.random(0,1,!1)].curveinfos[2].smithAndCurve.S21);_.forEach(e,function(t,e){t[2]=t[2]-_.round(_.random(4e-4,9e-4,!0),5)}),_.forEach(i,function(t,e){t[2]=t[2]+_.round(_.random(4e-4,9e-4,!0),5)});var a=[];a[0]=[],a[1]=[];var y,n=[];n[0]=[],n[1]=[],_.forEach(e,function(t,e){a[0].push(t[0]/1e6),n[0].push(t[2])}),_.forEach(i,function(t,e){a[1].push(t[0]/1e6),n[1].push(t[2])}),_.isEmpty(RF_SP2State.stateObj.splineSelectedArr)||_.isNil(RF_SP2State.stateObj.splineSelectedArr)||(y=RF_SP2State.stateObj.splineSelectedArr[0].key),renderSpline({container:"markerChart",title:"marker图",data:{xData:a,yData:n},name:_.cloneDeep(RF_SP2State.waferTCFSelected),callback:function(a){if(!g)if("y"==y){RF_SP2State.stateObj.key_y=!1;var n=_.reduce(RF_SP2State.stateObj.splineSelectedArr,function(t,e,i){return-1==_.indexOf(t,e.y)&&t.push(e.y),t},[]),t=a.series[0].yData,e=a.series[1].yData;if(RF_SP2State.stateObj.splineSelectedArr.length=0,$(".buildMarker_body>div tbody").empty(),-1<_.indexOf(t,n[0]))a.series[0].options.point.events.click.call(a.series[0].points[_.indexOf(t,n[0])]);else if(-1<_.indexOf(e,n[0]))a.series[1].options.point.events.click.call(a.series[1].points[_.indexOf(e,n[0])]);else{var r,o,s,l,c,d,u,m,i,h,p;if(console.log("兩條曲綫都沒有真實點"),_.forEach(t,function(t,e,i){if(t>n[0])return r=i[e-1],o=i[e],c=a.xAxis[0].categories[e-1],d=a.xAxis[0].categories[e],u=e,!1}),_.isNil(r)||_.isNil(o))if(_.forEach(e,function(t,e,i){if(t>n[0])return s=i[e-1],l=i[e],a.xAxis[0].categories[e-1],a.xAxis[0].categories[e],m=e,!1}),_.isNil(s)||_.isNil(l))RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为key，两条曲线都未找到点",type:"info",timer:2e3});else{var S=getPointXY({one:[c,r],two:[d,o],baseVal:n[0]});console.log(S),i=_.cloneDeep(a.xAxis[0].categories),h=_.cloneDeep(t),p=_.cloneDeep(e),i.splice(m,0,S.x),p.splice(m,0,S.y),h.splice(m,0,h[m-1]),a.xAxis[0].setCategories(i),a.series[0].setData(h),a.series[1].setData(p),a.series[1].options.point.events.click.call(a.series[1].points[_.indexOf(p,n[0])])}else{var b=getPointXY({one:[c,r],two:[d,o],baseVal:n[0]});i=_.cloneDeep(a.xAxis[0].categories),h=_.cloneDeep(t),p=_.cloneDeep(e),i.splice(u,0,b.x),h.splice(u,0,b.y),p.splice(u,0,p[u-1]),a.xAxis[0].setCategories(i),a.series[0].setData(h),a.series[1].setData(p),a.series[0].options.point.events.click.call(a.series[0].points[_.indexOf(h,n[0])])}}}else if("x"==y){var f=_.reduce(RF_SP2State.stateObj.splineSelectedArr,function(t,e,i){return-1==_.indexOf(t,e.x)&&t.push(e.x),t},[]);1==f.length?(RF_SP2State.stateObj.splineSelectedArr.length=0,$(".buildMarker_body>div tbody").empty(),a.series[0].options.point.events.click.call(a.series[0].points[_.indexOf(a.xAxis[0].categories,f[0])])):2==f.length&&(RF_SP2State.stateObj.splineSelectedArr.length=0,$(".buildMarker_body>div tbody").empty(),a.series[0].options.point.events.click.call(a.series[0].points[_.indexOf(a.xAxis[0].categories,f[0])]),a.series[1].options.point.events.click.call(a.series[1].points[_.indexOf(a.xAxis[0].categories,f[1])]))}}})}RF_SP2State.mock={curveType:{DC:["IL","BW","VSWR","TCF","CF"],RTP:["VSWR","TCF","CF","IL","BW","VSWR"],"RF-S2P":["IL","BW","VSWR","TCF","CF","IL","BW","VSWR","TCF","CF","IL","BW","VSWR","TCF","CF","IL","BW","VSWR","TCF","CF","IL","BW","IL","BW","VSWR","TCF","CF","VSWR","TCF","CF"]},selectedItem:[{"WaferID01.csv":["1-0-RF.S2P"],from:1,times:5},{"WaferID02.csv":["2-0-RF.S2P"],from:2,times:3},{"WaferID03.csv":["3-0-RF.S2P"],from:3,times:4},{"WaferID04.csv":["4-0-RF.S2P"],from:4,times:5}],RF_SP2_render:[]},RF_SP2State.waferSelected=[],RF_SP2State.waferTCFSelected=[],RF_SP2State.contextObj={classify:null,flag:null},RF_SP2State.stateObj={renderSelectCsvSub:!1,calcTableIndex:-1,splineSelectedArr:[],splineSelectedCopyArr:[],comfirm_key:store.get("futureD__RF_SP2__comfirm_key"),key_y:!1,smithSXCategories:[],S12:{indicatrix_low:[],indicatrix_up:[]},S21:{indicatrix_low:[],indicatrix_up:[]},indicatrix_min_max:[],indicatrix_state_arr:[],indicatrix_copy:{low:[],up:[],delFlag:!1,submitFlag:!1},S2PCanRenderChart:!0,S2PSmallChartSmithArr:[],S2PSmallChartSmithData:{S11:[],S12:[],S21:[],S22:[]},dblclickFlag:!1},RF_SP2State.MathMap={sin:{replace:"Math.sin",reg:null,fun:null,index:-1},cos:{replace:"Math.cos",reg:null,fun:null,index:-1},tan:{replace:"Math.tan",reg:null,fun:null,index:-1},ln:{replace:"Math.log",reg:null,fun:null,index:-1},log:{replace:"Math.log(##2)/Math.log(##1)",reg:/log\(\d+\)\(\d+\)/g,reg1:/log\((\d+)\)\((\d+)\)/,fun:"match",index:[1,2]},"!":{replace:"S_factorial(##1)",reg:/\(\d+\)\!/g,reg1:/\((\d+)\)(?=\!)/,fun:"match",index:1},"π":{replace:"Math.PI",reg:null,fun:null,index:-1},e:{replace:"Math.E",reg:null,fun:null,index:-1},"^":{replace:"Math.pow(##1, ##2)",reg:/\(\d+\)\^\(\d+\)/,reg1:/\((\d+)\)\^\((\d+)\)/,fun:"match",index:[1,2]},"√":{replace:"Math.sqrt(##1)",reg:/√\(\d+\)/g,reg1:/√\((\d+)\)/,fun:"match",index:1},"°":{replace:"*Math.PI/180",reg:null,reg1:null,fun:null,index:-1}},RF_SP2State.allowKeyCode=[8,37,38,39,40,46,48,49,50,51,52,53,54,55,56,57,58,77,96,97,98,99,100,101,102,103,104,105,106,107,109,110,111,190],RF_SP2State.search_markerObj={awesomplete:null,list:null},$(".g_bodyin_bodyin_bottom_2, .signalChart_div, .reRenderBtnDiv, .g_bodyin_bodyin_top_wrap_m_in li[data-targetclass='add']").hide(),$(function(){var item=store.get("futureDT2__projectAnalysis__selectedObj");if(_.isEmpty(item)||_.isNil(item))RF_SP2SwalMixin({title:"未选中晶圆",text:"请重新选择！",type:"info",showConfirmButton:!1,timer:2e3}).then(function(t){t.dismiss!=swal.DismissReason.backdrop&&t.dismiss!=swal.DismissReason.esc&&t.dismiss!=swal.DismissReason.timer||window.location.assign("projectAnalysis.html")});else{eleResize(),$(window).on("resize",function(){eleResize(),eleResize2()});var data00=RF_SP2State.mock.RF_SP2[0];if(1<=data00.curveinfos.length){var smithAndCurve=data00.curveinfos[2].smithAndCurve;getDataBuildS12S21({allData:[{name:"",data:smithAndCurve.S12}],renderData:!1,container:"picture2top",zoomType:"None",showCheckbox:!1}),getDataBuildS12S21({allData:[{name:"",data:smithAndCurve.S21}],renderData:!1,container:"picture3top",zoomType:"None",showCheckbox:!1})}else RF_SP2SwalMixin({title:"信息",text:"此晶圆无曲线数据！",type:"info",showConfirmButton:!1,showCancelButton:!1,timer:2e3}).then(function(t){t.dismiss});renderNavItem({item:item,type:"g_bodyin_bodyin_bottom_1"}),renderSelectCsv(item,"",$(".g_bodyin_bodyin_bottom_l_intop")),$(".g_bodyin_bodyin_bottom_l_item:first .g_bodyin_bodyin_bottom_l_itemin_main").trigger("click"),$(".g_bodyin_bodyin_bottom_l_item:first .g_bodyin_bodyin_bottom_l_itemin_sub>.g_bodyin_bodyin_bottom_l_itemin_subin:first").trigger("click"),$(".g_bodyin_bodyin_top_wrap_m_in").innerWidth()>$(".g_bodyin_bodyin_top_wrap_m").innerWidth()&&$(".g_bodyin_bodyin_top_wrap_l>span, .g_bodyin_bodyin_top_wrap_r>span").show()}var saveMarkerFlag=store.get("futureD__RF_SP2__saveMarkerFlag");if("hasSave"==saveMarkerFlag&&($(".g_bodyin_bodyin_top_wrap_m_in li[data-targetclass='g_bodyin_bodyin_bottom_2']").trigger("click"),store.remove("futureD__RF_SP2__saveMarkerFlag")),RF_SP2State.stateObj.splineSelectedArr=store.get("futureD__RF_SP2__splineSelectedArr"),RF_SP2State.stateObj.splineSelectedCopyArr=store.get("futureD__RF_SP2__splineSelectedArr"),_.isNil(RF_SP2State.stateObj.splineSelectedArr))RF_SP2State.stateObj.splineSelectedArr=[];else{RF_SP2State.stateObj.key_y="y"==RF_SP2State.stateObj.comfirm_key;var iArra=[];_.forEach(RF_SP2State.stateObj.splineSelectedArr,function(t,e){_.isNil(t.x)&&(t.x=NaN)}),_.forEach(RF_SP2State.stateObj.splineSelectedArr,function(t,e){iArra.push({label:t.markerName+".X: "+t.x,value:t.markerName+".X"}),iArra.push({label:t.markerName+".Y: "+t.y,value:t.markerName+".Y"})}),RF_SP2State.search_markerObj.list=_.cloneDeep(iArra)}_.isNil(RF_SP2State.stateObj.comfirm_key)||$("#comfirm_key_sel").val(RF_SP2State.stateObj.comfirm_key);var tableStr=store.get("futureD__RF_SP2__paramCalc_tableStr");$(".g_bodyin_bodyin_bottom_lsub_bottom tbody").html(tableStr),$(".g_bodyin_bodyin_bottom_lsub_bottom tbody").append('<tr class="canCalc"><td></td><td></td><td></td></tr>'),$(".g_bodyin_bodyin_bottom_lsub_bottom tbody>tr").each(function(){var str=$(this).children("td:eq(2)").text().trim();if(_.isEmpty(str))return!0;str=markerJoinCalc(str),str=markerMathCalc(str);var iVal=eval(str);_.isNaN(iVal)?$(this).children("td:eq(1)").text("9E+37"):$(this).children("td:eq(1)").text(iVal.toFixed(2))}),RF_SP2State.search_markerObj.awesomplete=new Awesomplete(document.getElementById("clac_textarea"),{list:RF_SP2State.search_markerObj.list,minChars:1,maxItems:10,autoFirst:!0,filter:function(t,e){var i=eouluGlobal.S_getCaretPosition($("#clac_textarea")[0]);return"M"==e.substring(i-1,i)},replace:function(t){var e=eouluGlobal.S_getCaretPosition($("#clac_textarea")[0]),i=this.input.value.substring(0,e-1)+t.value+this.input.value.substring(e,this.input.value.length);$("#clac_textarea").val(i),eouluGlobal.S_setCaretPosition($("#clac_textarea")[0],e+t.value.length-1)}});var comboplete=new Awesomplete("#calc_text",{minChars:0,list:["TCF_L","TCF_R","TCF"]});$(".subAddParam_body button.awesomplete_btn").click(function(){0===comboplete.ul.childNodes.length?(comboplete.minChars=0,comboplete.evaluate()):comboplete.ul.hasAttribute("hidden")?comboplete.open():comboplete.close()})}),$(".g_info_r>.glyphicon-user").click(function(){window.location.assign("admin.html")}),$(window).on("resize",function(){_.forEach(RF_SP2State.stateObj.S2PSmallChartSmithArr,function(t,e,i){i[e].onresize()})}),$(document).on("click",".g_bodyin_bodyin_bottom_l_itemin_subin",function(){$(this).toggleClass("selected"),$(".g_bodyin_bodyin_bottom_l_inbottom>input").prop("checked",$(".g_bodyin_bodyin_bottom_l_itemin_subin").length===$(".g_bodyin_bodyin_bottom_l_itemin_subin.selected").length);var a=$(this).parent().data("parentfile")+" "+$(this).text();if($(this).hasClass("selected")?RF_SP2State.waferSelected.push(a):_.pull(RF_SP2State.waferSelected,a),RF_SP2State.stateObj.S2PCanRenderChart)if($(this).hasClass("selected")){var n=_.cloneDeep(RF_SP2State.mock.RF_SP2[RF_SP2State.waferSelected.length%3]);if(1<=n.curveinfos.length){_.forEach(n.curveinfos[2].smithAndCurve.S12,function(t,e,i){i[e][1]=i[e][1]+RF_SP2State.waferSelected.length/1e3}),_.forEach(n.curveinfos[2].smithAndCurve.S21,function(t,e,i){i[e][1]=i[e][1]+RF_SP2State.waferSelected.length/1e3}),_.forEach(n.curveinfos[2].smithAndCurve.S11,function(t,e,i){i[e][0]=i[e][0]+1e3*RF_SP2State.waferSelected.length,i[e][1]=i[e][1]+RF_SP2State.waferSelected.length/1e3}),_.forEach(n.curveinfos[2].smithAndCurve.S22,function(t,e,i){i[e][0]=i[e][0]+1e3*RF_SP2State.waferSelected.length,i[e][1]=i[e][1]+RF_SP2State.waferSelected.length/1e3});var i=[],r=[];if(_.forEach(n.curveinfos[2].smithAndCurve.S12,function(t,e){i.push(parseFloat(t[1]))}),_.forEach(n.curveinfos[2].smithAndCurve.S21,function(t,e){r.push(parseFloat(t[1]))}),$("#picture2top").highcharts().addSeries({name:a,data:i,showInLegend:!0,enableMouseTracking:!0,events:{mouseOver:function(){}},point:{events:{mouseOver:void 0}}}),$("#picture3top").highcharts().addSeries({name:a,data:r,showInLegend:!0,enableMouseTracking:!0,events:{mouseOver:function(){}},point:{events:{mouseOver:void 0}}}),3<RF_SP2State.waferSelected.length){var t=~~$("#picture_box2").innerHeight(),e=~~$("#picture_box2").innerWidth(),o=2;8<RF_SP2State.waferSelected.length&&(o=3),$("#picture2top, #picture3top").innerHeight(t*o).innerWidth(e-7),$("#picture2top").highcharts().setSize(e-7,t*o),$("#picture3top").highcharts().setSize(e-7,t*o)}var s=[],l=[],c=[],d=_.find($("#picture2top").highcharts().series,function(t){return t.name==a}).color;if(_.forOwn(RF_SP2State.stateObj.S2PSmallChartSmithData,function(t,e,i){i[e].push({name:a,data:_.cloneDeep(n.curveinfos[2].smithAndCurve[e]),color:d})}),_.forEach(RF_SP2State.stateObj.S2PSmallChartSmithData.S11,function(t){l.push(_.cloneDeep(t.data)),s.push(t.color)}),_.forEach(RF_SP2State.stateObj.S2PSmallChartSmithData.S22,function(t){c.push(_.cloneDeep(t.data))}),getDataBuildS11S22({wrapDOM:document.getElementById("picture1top"),title:[""],legendName:["S11"],data:l,classify:"S11",msgDOM:document.getElementById("picture1bottom"),lineColorArray:s,msgInitFun:_.bind(msgInitFun,this,_,"S11","1",a),msgFun:_.bind(imsgFun,this,_,_,"S11","1"),callback:function(t){2<=RF_SP2State.stateObj.S2PSmallChartSmithArr.length&&(RF_SP2State.stateObj.S2PSmallChartSmithArr.length=0),RF_SP2State.stateObj.S2PSmallChartSmithArr.push(t)}}),getDataBuildS11S22({wrapDOM:document.getElementById("picture4top"),title:[""],legendName:["S22"],data:c,classify:"S22",msgDOM:document.getElementById("picture4bottom"),lineColorArray:s,msgInitFun:_.bind(msgInitFun,this,_,"S22","4",a),msgFun:_.bind(imsgFun,this,_,_,"S22","4"),callback:function(t){2<=RF_SP2State.stateObj.S2PSmallChartSmithArr.length&&(RF_SP2State.stateObj.S2PSmallChartSmithArr.length=0),RF_SP2State.stateObj.S2PSmallChartSmithArr.push(t)}}),RF_SP2State.stateObj.dblclickFlag){var u=$("[id$=_chart_S]:visible").attr("id"),m=u.replace("_chart_S","");-1<_.indexOf(["S11","S22"],m)?getDataBuildBigS11S22({iclassify:m,itargetchart:u}):(getDataBuildBigS12S21({iclassify:m,itargetchart:u}),setTimeout(function(){$(".indicatrix_footin>.btn-success").trigger("click")},50))}}else{var h=$(this);RF_SP2SwalMixin({title:"信息",text:"此晶圆无曲线数据！",type:"info",showConfirmButton:!1,showCancelButton:!1,timer:2e3}).then(function(t){h.trigger("click")})}}else{var p=_.find($("#picture2top").highcharts().series,function(t){return t.name==a});if(!_.isNil(p)&&(p.remove(),_.find($("#picture3top").highcharts().series,function(t){return t.name==a}).remove(),RF_SP2State.waferSelected.length<4)){var S=~~$("#picture_box2").innerHeight(),b=~~$("#picture_box2").innerWidth();$("#picture2top, #picture3top").innerHeight(S).innerWidth(b),$("#picture2top").highcharts().setSize(b,S),$("#picture3top").highcharts().setSize(b,S)}var f=[];_.forOwn(RF_SP2State.stateObj.S2PSmallChartSmithData,function(t,e,i){_.pullAt(RF_SP2State.stateObj.S2PSmallChartSmithData[e],_.findIndex(RF_SP2State.stateObj.S2PSmallChartSmithData[e],function(t){return t.name==a}))});var g=[];_.forEach(RF_SP2State.stateObj.S2PSmallChartSmithData.S11,function(t){g.push(_.cloneDeep(t.data)),f.push(t.color)});var y=[];if(_.forEach(RF_SP2State.stateObj.S2PSmallChartSmithData.S22,function(t){y.push(_.cloneDeep(t.data))}),getDataBuildS11S22({wrapDOM:document.getElementById("picture1top"),title:[""],legendName:["S11"],data:g,classify:"S11",msgDOM:document.getElementById("picture1bottom"),lineColorArray:f,msgInitFun:_.bind(msgInitFun,this,_,"S11","1",!1),msgFun:_.bind(imsgFun,this,_,_,"S11","1"),callback:function(t){2<=RF_SP2State.stateObj.S2PSmallChartSmithArr.length&&(RF_SP2State.stateObj.S2PSmallChartSmithArr.length=0),RF_SP2State.stateObj.S2PSmallChartSmithArr.push(t)}}),getDataBuildS11S22({wrapDOM:document.getElementById("picture4top"),title:[""],legendName:["S22"],data:y,classify:"S22",msgDOM:document.getElementById("picture4bottom"),lineColorArray:f,msgInitFun:_.bind(msgInitFun,this,_,"S22","4",!1),msgFun:_.bind(imsgFun,this,_,_,"S22","4"),callback:function(t){2<=RF_SP2State.stateObj.S2PSmallChartSmithArr.length&&(RF_SP2State.stateObj.S2PSmallChartSmithArr.length=0),RF_SP2State.stateObj.S2PSmallChartSmithArr.push(t)}}),RF_SP2State.stateObj.dblclickFlag){var v=$("[id$=_chart_S]:visible").attr("id"),x=v.replace("_chart_S","");-1<_.indexOf(["S11","S22"],x)?getDataBuildBigS11S22({iclassify:x,itargetchart:v}):(getDataBuildBigS12S21({iclassify:x,itargetchart:v}),setTimeout(function(){$(".indicatrix_footin>.btn-success").trigger("click")},50))}}}).on("click",".g_bodyin_bodyin_bottom_l_itemin_main",function(){$(this).hasClass("active")?$(this).next().slideUp(1e3):$(this).next().slideDown(1e3),$(this).toggleClass("active")}),$(".g_bodyin_bodyin_bottom_l_inbottom>input").click(function(){$(this).prop("checked")?($(".g_bodyin_bodyin_bottom_l_itemin_main").each(function(){$(this).addClass("active").next().slideDown(1e3)}),RF_SP2SwalMixin({title:"信息",text:"正在绘图",type:"info",showConfirmButton:!1,showCancelButton:!1,timer:2e3}).then(function(t){RF_SP2SwalMixin({title:"信息",text:"正在绘图",type:"info",showConfirmButton:!1,showCancelButton:!1}),$(".g_bodyin_bodyin_bottom_l_itemin_subin").each(function(){if($(this).hasClass("selected"))return!0;$(this).trigger("click")}),swal.clickCancel()})):($(".g_bodyin_bodyin_bottom_l_itemin_main").each(function(){$(this).removeClass("active").next().slideUp(1e3)}),RF_SP2SwalMixin({title:"信息",text:"正在绘图",type:"info",showConfirmButton:!1,showCancelButton:!1,timer:2e3}).then(function(t){RF_SP2SwalMixin({title:"信息",text:"正在绘图",type:"info",showConfirmButton:!1,showCancelButton:!1}),$(".g_bodyin_bodyin_bottom_l_itemin_subin").each(function(){if(!$(this).hasClass("selected"))return!0;$(this).trigger("click")}),$("#picture1bottom .picturebottom_in_m_in ul, #picture4bottom .picturebottom_in_m_in ul").empty(),swal.clickCancel()}))}),$(".g_bodyin_bodyin_top_wrap_l>span").click(function(){var t=parseFloat($(".g_bodyin_bodyin_top_wrap_m_in").css("left")),e=($(".g_bodyin_bodyin_top_wrap_m_in").innerWidth(),$(".g_bodyin_bodyin_top_wrap_m").innerWidth(),t+60);0<=t&&(e=0),$(".g_bodyin_bodyin_top_wrap_m_in").animate({left:e+"px"},{speed:"slow",easing:"swing",queue:!1})}),$(".g_bodyin_bodyin_top_wrap_r>span").click(function(){var t=parseFloat($(".g_bodyin_bodyin_top_wrap_m_in").css("left")),e=$(".g_bodyin_bodyin_top_wrap_m_in").innerWidth()-$(".g_bodyin_bodyin_top_wrap_m").innerWidth(),i=t-60;Math.abs(t)>=e&&(i=-e),$(".g_bodyin_bodyin_top_wrap_m_in").animate({left:i+"px"},{speed:"slow",easing:"swing",queue:!1})}),$(document).on("click",".g_bodyin_bodyin_top_wrap_m_in li",function(){var t=$(this).data("targetclass");if("add"==t)RF_SP2SwalMixin({title:"敬请期待",text:"功能尚未开发",type:"info",showConfirmButton:!1,timer:2e3});else{$(this).addClass("active").siblings().removeClass("active");var e=$(this).index();$("."+t).siblings().fadeOut(300,function(){$(this).siblings().fadeIn(300),renderNavItem({item:store.get("futureDT2__projectAnalysis__selectedObj"),type:t,index:e}),"g_bodyin_bodyin_bottom_2"==t?($(".g_info .glyphicon-question-sign").hide(),2==RF_SP2State.waferTCFSelected.length?$(".reRenderBtnDiv").css({left:"310px",top:"180px"}).slideDown(200):$(".reRenderBtnDiv").css({left:"310px",top:"180px"}).slideUp(200),RF_SP2State.stateObj.renderSelectCsvSub||(renderSelectCsv(store.get("futureDT2__projectAnalysis__selectedObj"),"sub",$(".g_bodyin_bodyin_bottom_lsub_top")),eleResize2(),$(".g_bodyin_bodyin_bottom_lsub_item:first .g_bodyin_bodyin_bottom_lsub_itemin_main").trigger("click"),$(".g_bodyin_bodyin_bottom_lsub_item:first .g_bodyin_bodyin_bottom_lsub_itemin_sub>.g_bodyin_bodyin_bottom_lsub_itemin_subin:first").trigger("click").next().trigger("click"),getTCFDataANDDrawChart({isComfirmKey:!1}),RF_SP2State.stateObj.renderSelectCsvSub=!0)):($(".reRenderBtnDiv").hide(),$(".g_info .glyphicon-question-sign").show())})}}),$(document).on("click",".g_bodyin_bodyin_bottom_lsub_itemin_subin",function(t){var e=$(this).parent().data("parentfile")+" "+$(this).text();if($(this).hasClass("selected"))$(this).removeClass("selected"),_.pull(RF_SP2State.waferTCFSelected,e);else{if($(this).parent().parent().parent().siblings().each(function(){$(this).find(".g_bodyin_bodyin_bottom_lsub_itemin_subin.selected").each(function(){_.pull(RF_SP2State.waferTCFSelected,$(this).parent().data("parentfile")+" "+$(this).text()),$(this).removeClass("selected")})}),1<$(this).siblings(".selected").length){var i=$(this).siblings(".selected").eq(0),a=i.parent().data("parentfile")+" "+i.text();_.pull(RF_SP2State.waferTCFSelected,a),i.removeClass("selected")}$(this).addClass("selected"),RF_SP2State.waferTCFSelected.push(e)}2==RF_SP2State.waferTCFSelected.length?$(".reRenderBtnDiv").css({left:t.pageX+30+"px",top:t.pageY-50+"px"}).slideDown(200):$(".reRenderBtnDiv").css({left:t.pageX+30+"px",top:t.pageY-50+"px"}).slideUp(200)}).on("click",".g_bodyin_bodyin_bottom_lsub_itemin_main",function(){$(this).hasClass("active")?$(this).next().slideUp(1e3):$(this).next().slideDown(1e3),$(this).toggleClass("active")}),$(".reRenderBtnDiv").click(function(){if(2!=RF_SP2State.waferTCFSelected.length)return!1;getTCFDataANDDrawChart({isComfirmKey:!1})}),$(".g_bodyin_tit_r>.glyphicon-stats").click(function(){store.set("RF_SP2_renderCSV",RF_SP2State.mock.RF_SP2_render),window.location.assign("dataStatistics.html")}),$(document).on("click","tr.canCalc",function(){$(".RF_SP2_cover, .subAddParam").slideDown(200),$("#calc_text").val($(this).children("td:eq(0)").text()),$("#clac_textarea").val($(this).children("td:eq(2)").text()),RF_SP2State.stateObj.calcTableIndex=$(this).index()}).on("click",".subAddParam_tit>span, .subAddParam_footin>.btn-warning",function(){$(".RF_SP2_cover, .subAddParam").slideUp(200)}).on("click",".subAddParam_footin>.btn-primary",function(){if(_.isEmpty($("#calc_text").val().trim()))return RF_SP2SwalMixin({title:"公式提示",text:"参数必填",type:"error",timer:2e3}),!1;var str=$("#clac_textarea").val();if(""==str||""==str.trim())return!1;str=markerJoinCalc(str),str=markerMathCalc(str);try{var iVal=eval(str),tr=$(".g_bodyin_bodyin_bottom_lsub_bottom tbody>tr").eq(RF_SP2State.stateObj.calcTableIndex);_.isNaN(iVal)?tr.children().eq(1).text("9E+37"):tr.children().eq(1).text(iVal.toFixed(2)),tr.children().eq(0).text($("#calc_text").val()),tr.children().eq(2).text($("#clac_textarea").val());var noEmptyLen=0;$(".g_bodyin_bodyin_bottom_lsub_bottom tbody>tr").each(function(){var t=!1;$(this).children("td").each(function(){if(""!=$(this).text())return!(t=!0)}),t&&noEmptyLen++}),store.set("futureD__RF_SP2__paramCalc_tableStr",$(".g_bodyin_bodyin_bottom_lsub_bottom tbody").html()),noEmptyLen==$(".g_bodyin_bodyin_bottom_lsub_bottom tbody>tr").length&&$(".g_bodyin_bodyin_bottom_lsub_bottom tbody").append('<tr class="canCalc"><td></td><td></td><td></td></tr>'),$(".subAddParam_footin>.btn-warning").trigger("click")}catch(t){RF_SP2SwalMixin({title:"公式提示",text:"公式有误",type:"error",timer:2e3})}}),$(".calcin>div>.row>div>div").on({mousedown:function(){$(this).addClass("active")},mouseup:function(){$(this).removeClass("active");var t=$("#clac_textarea").val(),e=$(this).data("ivalue"),i=eouluGlobal.S_getCaretPosition($("#clac_textarea")[0]);if("Number"!=e&&"退格"!=e){var a=t.substring(0,i)+e+t.substring(i,t.length);$("#clac_textarea").val(a);var n=Number($(this).data("ipos"));eouluGlobal.S_setCaretPosition($("#clac_textarea")[0],i+e.toString().length+n)}else if("Number"==e)$(".row.toggleRow").slideToggle(150),eouluGlobal.S_setCaretPosition($("#clac_textarea")[0],i);else if("退格"==e){var r=$("#clac_textarea").val().substring(0,i-1)+$("#clac_textarea").val().substring(i,$("#clac_textarea").val().length);$("#clac_textarea").val(r),eouluGlobal.S_setCaretPosition($("#clac_textarea")[0],i-1)}}}),$("#clac_textarea").on("keydown",function(t){var e=t.keyCode||t.which||t.charCode;if(-1==_.indexOf(RF_SP2State.allowKeyCode,e))return!1}).on("input propertychange change",function(){var t=$(this).val();t=t.replace(/[\u4e00-\u9fa5]+/g,""),$("#clac_textarea").val(t),eouluGlobal.S_setCaretPosition($("#clac_textarea")[0],eouluGlobal.S_getCaretPosition($("#clac_textarea")[0]))}),$(".g_bodyin_bodyin_bottom_rsubin_tit>button").on({click:function(){var t=$(this).next();t.toggleClass("clicked"),t.hasClass("clicked")?(t.slideDown(600),$(this).html('<span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span> 关闭Marker设置')):(t.slideUp(600),$(this).html('<span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span> 打开Marker设置'))},mouseover:function(){var t=$(this).next();if(t.hasClass("clicked"))return!1;t.addClass("clicked").slideDown(600),$(this).html('<span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span> 关闭Marker设置')}}),$("#comfirm_key").click(function(){var t=$(this).parent().prev().children("select").val();RF_SP2State.stateObj.comfirm_key=t,RF_SP2State.stateObj.splineSelectedArr=[],$(".buildMarker_body>div tbody").empty(),store.set("futureD__RF_SP2__comfirm_key",RF_SP2State.stateObj.comfirm_key),RF_SP2SwalMixin({title:"Marker确认Key提示",text:"成功，现在可以选点了，请记得保存",type:"success",timer:1e3,showConfirmButton:!1}).then(function(t){"timer"==t.dismiss&&(getTCFDataANDDrawChart({isComfirmKey:!(RF_SP2State.stateObj.key_y=!1)}),RF_SP2State.stateObj.renderSelectCsvSub=!0)})}),$(document).on("input propertychange change",".buildMarker_body>.container-fluid tbody td:nth-child(1)",function(){var i=$(this).data("iorigin"),a=$(this).text(),n=!0;_.forEach(RF_SP2State.stateObj.splineSelectedArr,function(t,e){if(t.markerName!=i&&t.markerName==a)return n=!1}),n||$(this).text(i)}).on("blur",".buildMarker_body>.container-fluid tbody td:nth-child(1)",function(){var t=$(this).data("iorigin"),e=$(this).text();if(/Marker\d+/.test(e)){var i=$(this).parent().index(),a=!0;$(".buildMarker_body>.container-fluid tbody td:nth-child(1)").each(function(t){if(i!=t&&e==$(this).text())return a=!1}),a||$(this).text(t)}else $(this).text(t)}),$(".buildMarker_footin>.btn-primary").click(function(){_.forEach(RF_SP2State.stateObj.splineSelectedArr,function(t,e){var i=$(".buildMarker_body>.container-fluid tbody>tr[data-iflag='"+(t.name+t.x)+"']").children("td").eq(0).text();t.markerName=i,t.id=i.match(/Marker(\d+)/)[1]}),store.set("futureD__RF_SP2__splineSelectedArr",RF_SP2State.stateObj.splineSelectedArr),RF_SP2SwalMixin({title:"Marker提交提示",text:"保存成功",type:"success",timer:1200,showConfirmButton:!1}).then(function(t){t.dismiss!=swal.DismissReason.backdrop&&t.dismiss!=swal.DismissReason.esc&&t.dismiss!=swal.DismissReason.timer||(store.set("futureD__RF_SP2__saveMarkerFlag","hasSave"),window.location.reload())})}),$(document).on("click","div.awesomplete ul[role='listbox']>li",function(){}),$(document).on("dblclick",".chartWarp",function(){RF_SP2State.stateObj.dblclickFlag=!0;var e=$(this).data("itargetchart");$(".fourChart_div").fadeOut(200,function(){$(".signalChart_div").fadeIn(200),$("#"+e).siblings().fadeOut(100),$("#"+e).delay(100).fadeIn(150,function(){var t=e.replace("_chart_S","");"S12"==t||"S21"==t?($(".signalChart_div_foot").fadeOut(10),getDataBuildBigS12S21({iclassify:t,itargetchart:e}),$(".signalChart_div_tit>button:not(.backover)").prop("disabled",!1)):($(".signalChart_div_foot").fadeIn(10),getDataBuildBigS11S22({iclassify:t,itargetchart:e}),$(".signalChart_div_tit>button:not(.backover)").prop("disabled",!0))})})}),$(".signalChart_div_tit>button.backover").click(function(){$(".signalChart_div").fadeOut(200,function(){$(".fourChart_div").fadeTo(1,0).fadeIn(100,function(){var t=$(".g_bodyin_bodyin_bottom_l_itemin_subin.selected:first");t.trigger("click"),setTimeout(function(){t.trigger("click"),$(".fourChart_div").fadeTo(50,1)},50)}),RF_SP2State.stateObj.dblclickFlag=!1})}),$(".signalChart_div_tit>.open_del_indicatrix").click(function(){$(".RF_SP2_cover, .indicatrix_div").slideDown(200);var t=$("[id$='_chart_S']:visible").attr("id");if(_.isNil(t))return!1;var e=t.replace("_chart_S",""),i="",a="";_.forEach(RF_SP2State.stateObj[e].indicatrix_up,function(t,e){i+='<tr><td><input type="text" class="form-control AwesompleteX input_X1" value="'+t[0]+'"></td><td><input type="text" class="form-control AwesompleteX input_X2" value="'+t[1]+'"></td><td><input type="text" class="form-control input_Y0" value="'+t[2]+'"></td><td><span class="glyphicon glyphicon-ok" aria-hidden="true"></span><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></td></tr>'}),_.forEach(RF_SP2State.stateObj[e].indicatrix_low,function(t,e){a+='<tr><td><input type="text" class="form-control AwesompleteX input_X1" value="'+t[0]+'"></td><td><input type="text" class="form-control AwesompleteX input_X2" value="'+t[1]+'"></td><td><input type="text" class="form-control input_Y0" value="'+t[2]+'"></td><td><span class="glyphicon glyphicon-ok" aria-hidden="true"></span><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></td></tr>'}),RF_SP2State.stateObj[e].indicatrix_up.length=0,RF_SP2State.stateObj[e].indicatrix_low.length=0,$(".indicatrix_body #upflag_table tbody").empty().append(i),$(".indicatrix_body #lowflag_table tbody").empty().append(a),$(".indicatrix_body #upflag_table tbody").find(".glyphicon-ok").trigger("click"),$(".indicatrix_body #lowflag_table tbody").find(".glyphicon-ok").trigger("click"),_.isEmpty(_.concat(RF_SP2State.stateObj[e].indicatrix_low,RF_SP2State.stateObj[e].indicatrix_up))&&$(".indicatrix_footin>.btn-success").prop("disabled",!0),$(".indicatrix_body tbody").find("input[type='text']").each(function(t,e){new Awesomplete(e,{list:RF_SP2State.stateObj.smithSXCategories,minChars:1,maxItems:15,autoFirst:!0})})}),$(".indicatrix_tit>span.glyphicon, .indicatrix_footin>.btn-warning").click(function(){$(".RF_SP2_cover, .indicatrix_div").slideUp(200)}),$(document).on("click","#upflag_table>tbody .glyphicon-remove, #lowflag_table>tbody .glyphicon-remove",function(){var t=$("[id$='_chart_S']:visible").attr("id");if(_.isNil(t))return!1;var e=t.replace("_chart_S","");if($(this).parent().parent().hasClass("hasOk")){var i,a=[];$(this).parent().siblings("td").each(function(t){t<3&&(a[t]=parseFloat($(this).find("input[type='text']").val()))}),i=$(this).parents("#lowflag_table").length?RF_SP2State.stateObj[e].indicatrix_low:RF_SP2State.stateObj[e].indicatrix_up,_.pullAt(i,_.findIndex(i,function(t){return _.isEqual(t,a)}))}$(this).parent().parent().remove();var n=$("#upflag_table tbody tr.hasOk").length,r=$("#lowflag_table tbody tr.hasOk").length,o=$("#upflag_table tbody tr").length,s=$("#lowflag_table tbody tr").length;0===n&&0===r?(getDataBuildBigS12S21({iclassify:e,itargetchart:t}),$(".indicatrix_footin>.btn-success").prop("disabled",!0)):$(".indicatrix_footin>.btn-success").prop("disabled",!1);var l=$("#upflag_table").prev().children("span"),c=$("#lowflag_table").prev().children("span");0===o||o===n?l.fadeIn(100):l.fadeOut(100),0===s||s===r?c.fadeIn(100):c.fadeOut(100)}),$(".indicatrix_footin>.btn-success").click(function(){var e=$("[id$='_chart_S']:visible").attr("id");if(_.isNil(e))return!1;var t=e.replace("_chart_S","");if(_.isEmpty(_.concat(RF_SP2State.stateObj[t].indicatrix_low,RF_SP2State.stateObj[t].indicatrix_up)))return!1;if(!_.isNil(e)){RF_SP2State.stateObj.indicatrix_state_arr=[];var i=_.find(Highcharts.charts,function(t){if(!_.isNil(t))return $(t.renderTo).is("div#"+e)}),l=i.series,a=0,n=[];_.forEach(l,function(t,e){_.includes(t.name,"低于指标#")&&n.push(e),l[e].update({color:"#00FF00"})}),_.forEach(l,function(t,e){_.includes(t.name,"高于指标#")&&n.push(e)}),_.forEach(n,function(t,e){l[t-a].remove(),a++});var c=i.xAxis[0].categories,d=(RF_SP2State.stateObj.indicatrix_min_max[1]-RF_SP2State.stateObj.indicatrix_min_max[0])/40;_.forEach(RF_SP2State.stateObj[t].indicatrix_low,function(n,t){var e=[],r=_.indexOf(c,n[0]),o=_.indexOf(c,n[1]);e.push([r,n[2]-d]),e.push([r,n[2]]),e.push([o,n[2]]),e.push([o,n[2]-d]),i.addSeries({name:"低于指标#"+t,data:e,showInLegend:!1,enableMouseTracking:!0,dataLabels:{enabled:!0,formatter:function(){return this.x}},color:"#000",tooltip:{headerFormat:!1,pointFormat:!1,footerFormat:!1},events:{mouseOver:function(){var t=_.find(RF_SP2State.stateObj.indicatrix_state_arr,function(t,e){return this.name==t.name}.bind(this));_.forEach(t.seriesName,function(i,t){var e=_.find(l,function(t,e){return t.name==i});e.update({lineWidth:4}),e.select(!0)})},mouseOut:function(){var t=_.find(RF_SP2State.stateObj.indicatrix_state_arr,function(t,e){return this.name==t.name}.bind(this));_.forEach(t.seriesName,function(i,t){var e=_.find(l,function(t,e){return t.name==i});e.update({lineWidth:2}),e.select(!1)})}},point:{events:{mouseOver:void 0}}});var s=[];_.forEach(l,function(t,e){if(_.includes(t.name,"低于指标#"))return!0;if(_.includes(t.name,"高于指标#"))return!0;var i=t.yData,a=!1;_.forEach(i,function(t,e){if(r<=e&&e<=o&&t>n[2])return!(a=!0)}),a&&(s.push(l[e].name),"#FF0000"!=l[e].color&&"#ff0000"!=l[e].color&&l[e].update({color:"#FF0000"}))}),RF_SP2State.stateObj.indicatrix_state_arr.push({name:"低于指标#"+t,seriesName:s})}),_.forEach(RF_SP2State.stateObj[t].indicatrix_up,function(n,t){var e=[],r=_.indexOf(c,n[0]),o=_.indexOf(c,n[1]);e.push([r,n[2]+d]),e.push([r,n[2]]),e.push([o,n[2]]),e.push([o,n[2]+d]),i.addSeries({name:"高于指标#"+t,data:e,showInLegend:!1,enableMouseTracking:!0,dataLabels:{enabled:!0,formatter:function(){return this.x}},color:"#000",tooltip:{headerFormat:!1,pointFormat:!1,footerFormat:!1},events:{mouseOver:function(){var t=_.find(RF_SP2State.stateObj.indicatrix_state_arr,function(t,e){return this.name==t.name}.bind(this));_.forEach(t.seriesName,function(i,t){var e=_.find(l,function(t,e){return t.name==i});e.update({lineWidth:4}),e.select(!0)})},mouseOut:function(){var t=_.find(RF_SP2State.stateObj.indicatrix_state_arr,function(t,e){return this.name==t.name}.bind(this));_.forEach(t.seriesName,function(i,t){var e=_.find(l,function(t,e){return t.name==i});e.update({lineWidth:2}),e.select(!1)})}},point:{events:{mouseOver:void 0}}});var s=[];_.forEach(l,function(t,e){if(_.includes(t.name,"低于指标#"))return!0;if(_.includes(t.name,"高于指标#"))return!0;var i=t.yData,a=!1;_.forEach(i,function(t,e){if(r<=e&&e<=o&&t<n[2])return!(a=!0)}),a&&(s.push(l[e].name),"#FF0000"!=l[e].color&&"#ff0000"!=l[e].color&&l[e].update({color:"#FF0000"}))}),RF_SP2State.stateObj.indicatrix_state_arr.push({name:"高于指标#"+t,seriesName:s})}),_.forEach(RF_SP2State.stateObj.indicatrix_state_arr,function(e,t){if(_.isEmpty(e.seriesName))return!0;_.find(l,function(t){return t.name==e.name}).update({color:"#FF1493"})})}$(".indicatrix_footin>.btn-warning").trigger("click")}),$(".indicatrix_body legend>span").click(function(){$('<tr><td><input type="text" class="form-control AwesompleteX input_X1"></td><td><input type="text" class="form-control AwesompleteX input_X2"></td><td><input type="text" class="form-control input_Y0"></td><td><span class="glyphicon glyphicon-ok" aria-hidden="true"></span><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></td></tr>').appendTo($(this).parent().next().children("tbody")).find("input.AwesompleteX").each(function(t,e){new Awesomplete(e,{list:RF_SP2State.stateObj.smithSXCategories,minChars:1,maxItems:15,autoFirst:!0})}),$(this).fadeOut(100)}),$(document).on("click",".indicatrix_body tbody span.glyphicon-ok",function(){var t=$("[id$='_chart_S']:visible").attr("id");if(_.isNil(t))return!1;var e,i=t.replace("_chart_S",""),a=$(this).parent().parent(),n=a.find(".input_X1").val().trim(),r=a.find(".input_X2").val().trim(),o=a.find(".input_Y0").val().trim();if(_.isEmpty(n)||_.isEmpty(r)||_.isEmpty(o))return!1;$(this).parents().is("#upflag_table")?e=RF_SP2State.stateObj[i].indicatrix_up:$(this).parents().is("#lowflag_table")&&(e=RF_SP2State.stateObj[i].indicatrix_low);var s=Math.min(Number(n),Number(r)),l=Math.max(Number(n),Number(r)),c=Number(o);judgeLineSegmentIntersect(s,l,_.concat(RF_SP2State.stateObj[i].indicatrix_up,RF_SP2State.stateObj[i].indicatrix_low))?RF_SP2SwalMixin({title:"选择区间提示",text:"区间与已有区间重合，请重选",type:"info",showConfirmButton:!1,timer:1500}):(e.push([s,l,c]),a.find(".input_Y0").val(c),$(".indicatrix_footin>.btn-success").prop("disabled",!1),$(this).fadeOut(100).parent().parent().parent().parent().prev().children("span").fadeIn(100),a.addClass("hasOk").find("input[type='text']").prop("disabled",!0))}).on("input propertychange change",".input_Y0",function(){_.isNil($(this).val().match(/(\-|\+)?\d*\.?\d*/g))?$(this).val(""):$(this).val(_.head($(this).val().match(/(\-|\+)?\d*\.?\d*/g)))}),$(".indicatrix_footin>.btn-danger").click(function(){var t=$("[id$='_chart_S']:visible").attr("id");if(_.isNil(t))return!1;var e=t.replace("_chart_S","");if(_.isEmpty(_.concat(RF_SP2State.stateObj[e].indicatrix_up,RF_SP2State.stateObj[e].indicatrix_low)))return!1;$(".indicatrix_footin>.btn-warning").trigger("click"),$("#upflag_table>tbody, #lowflag_table>tbody").empty(),RF_SP2State.stateObj[e].indicatrix_up.length=0,RF_SP2State.stateObj[e].indicatrix_low.length=0,$(".indicatrix_footin>.btn-success").prop("disabled",!0),$(".indicatrix_body legend>span").fadeIn(100),getDataBuildBigS12S21({iclassify:e,itargetchart:t})});