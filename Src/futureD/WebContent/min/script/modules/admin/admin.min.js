var Pagination,Pagination1,adminSwalMixin=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"}),adminState=new Object;function staffSubmitBtn(t,e){0==$(".staff_"+e+"_r_bodyin div.row>div:nth-child(3)>.glyphicon-info-sign").length?$(".staff_"+e+"_r_foot>.btn-primary").prop("disabled",!1):1==$(".staff_"+e+"_r_bodyin div.row>div:nth-child(3)>.glyphicon-info-sign").length&&t.parent().next().children(".glyphicon-info-sign").length?$(".staff_"+e+"_r_foot>.btn-primary").prop("disabled",!1):$(".staff_"+e+"_r_foot>.btn-primary").prop("disabled",!0)}function adminRender(r,t){var e;adminState.staffPageObj.currentPage=r,adminState.staffPageObj.currentPage=0,adminState.staffPageObj.pageCount=0,adminState.staffPageObj.itemLength=0;var s=$("#search_input").val().trim();e=""!=s?{currentPage:r,keyword:s}:{currentPage:r},$.ajax({url:"UserManager",type:"get",dataType:"json",data:e,async:!1,success:function(t){console.log("data",t),$("body").attr("currentRole",t.currentRole);var i="";if(_.forEach(t.userList,function(t,e,a){var n=adminState.adminRoleMap[t.role_name];i+='<tr class="tr_admin"><td class="not_search"><input type="checkbox" data-ivalue="'+t.user_id+'" data-iname="'+t.user_name+'" class="user_id" ></td><td data-itext="'+(10*(r-1)+e+1)+'">'+(10*(r-1)+e+1)+'</td><td class="td__user_name showField" title="'+t.user_name+'" data-iuserId="'+t.user_id+'" data-itext="'+t.user_name+'" data-ivalue="'+t.user_name+'">'+t.user_name+'</td><td class="td__sex" title="'+t.sex+'" data-itext="'+t.sex+'" data-ivalue="'+t.sex+'">'+t.sex+'</td><td class="td__telephone showField" title="'+t.telephone+'" data-itext="'+t.telephone+'" data-ivalue="'+t.telephone+'">'+t.telephone+'</td><td class="td__email showField" title="'+t.email+'" data-itext="'+t.email+'" data-ivalue="'+t.email+'">'+t.email+'</td><td class="td__role_id" data-ivalue="'+n+'" title="'+t.role_name+'" data-itext="'+t.role_name+'">'+t.role_name+'</td><td class="td__operate not_search"><img src="assets/img/common/update_24px.svg"  data-iicon="glyphicon-edit" alt="修改" title="修改" data-ivalue="'+t.user_id+'" data-iname="'+t.user_name+'"><img src="assets/img/common/admin_32px.svg"  data-iicon="glyphicon-user" alt="授权" title="授权" style="margin-left: 5px;width: 24px;" data-ivalue="'+t.user_id+'" data-iname="'+t.user_name+'"><img src="assets/img/common/del_24px.svg"  data-iicon="glyphicon-remove" alt="删除" title="删除" style="margin-left: 5px;" data-ivalue="'+t.user_id+'" data-iname="'+t.user_name+'"></td></tr>'}),$(".staffManage_body tbody").empty().append(i),""!=s&&1<=$(".staffManage_body tbody .tr_admin").length)for(var e=new RegExp("("+s+")","g"),a=0;a<$(".staffManage_body tbody .tr_admin").length;a++)for(var n=0;n<$(".staffManage_body tbody .tr_admin").eq(a).find(".showField").length;n++){var o=(i=$(".staffManage_body tbody .tr_admin").eq(a).find(".showField").eq(n).text()).replace(e,"<font color=red>$1</font>");$(".staffManage_body tbody .tr_admin").eq(a).find(".showField").eq(n).text("").html(o)}adminState.staffPageObj.pageCount=t.totalPage,adminState.staffPageObj.itemLength=t.totalCount},error:function(t,e,a){}}),1==t&&(_.forEach(adminState.staffSellectObj.selectItem,function(t){$(".staffManage_body tbody .td__user_name[title='"+String(t)+"']").siblings("td:eq(0)").children("input").prop("checked",!0).parent().parent().addClass("warning").removeClass("info")}),$("#checkAll").prop("checked",adminState.staffPageObj.itemLength==adminState.staffSellectObj.selectItem.length),adminState.staffSellectObj.selectAll=$("#checkAll").prop("checked"))}function operateRendaer(t){console.log("cur",t);var d=$("#search_input2").val().trim();if(""==d)var e={currentPage:t};else e={currentPage:t,keyword:d};adminState.operateHasSearch=!1,$.ajax({url:"LogInfo",type:"GET",dataType:"json",data:e,async:!1,success:function(t){console.log("data",t),adminState.operateChunkArr=t.logList,adminState.operatePageObj.pageCount=t.totalPage,adminState.operatePageObj.itemLength=10*t.totalPage;var n=t.currentPage;adminState.operatePageObj.currentPage=n;var e=t.logList,i="";if(_.forEach(e,function(t,e,a){i+='<tr class="tr_operate"><td class="not_search"><input type="checkbox" data-ivalue="'+t.log_id+'"></td><td data-itext="'+(10*(n-1)+e+1)+'">'+(10*(n-1)+e+1)+'</td><td title="'+t.user_name+'" data-itext="'+t.user_name+'" class="showField td_user_name">'+t.user_name+'</td><td title="'+t.page+'" data-itext="'+t.page+'"  class="showField">'+t.page+'</td><td title="'+t.description+'" data-itext="'+t.description+'" class="showField log_description">'+t.description+'</td><td title="'+t.operate_date+" "+t.operate_time+'" data-itext="'+t.operate_date+" "+t.operate_time+'" class="showField">'+t.operate_date+" "+t.operate_time+'</td><td title="'+t.ip_address+'" data-itext="'+t.ip_address+'"  >'+t.ip_address+'</td><td title="'+t.location+'" data-itext="'+t.location+'"  class="showField">'+t.location+"</td></tr>"}),$(".operaDailyLog_body tbody").empty().append(i),""!=d&&(adminState.operateHasSearch=!0,1<=$(".operaDailyLog_body tbody .tr_operate").length))for(var a=new RegExp("("+d+")","g"),o=0;o<$(".operaDailyLog_body tbody .tr_operate").length;o++)for(var r=0;r<$(".operaDailyLog_body tbody .tr_operate").eq(o).find(".showField").length;r++){var s=(i=$(".operaDailyLog_body tbody .tr_operate").eq(o).find(".showField").eq(r).text()).replace(a,"<font color=red>$1</font>");$(".operaDailyLog_body tbody .tr_operate").eq(o).find(".showField").eq(r).text("").html(s)}adminState.operatePageObj.pageCount=t.totalPage,adminState.operatePageObj.itemLength=t.totalCount},error:function(t,e,a){adminSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}adminState.staffUpdateUser="",adminState.staffAuthorityUser="",adminState.adminRoleMap={"成员":"1","管理员":"2","超级管理员":"3"},adminState.staffPageObj={selector:null,pageOption:null,currentPage:null,pageCount:null,itemLength:1},adminState.staffHasSearch=!1,adminState.staffSellectObj={selectAll:!1,selectItem:[]},adminState.operatePageObj={selector:null,pageOption:null,currentPage:null,pageCount:null,itemLength:1},adminState.operateHasSearch=!1,adminState.operateSellectObj={selectAll:!1,selectItem:[]},adminState.hasRequestData=!1,adminState.operateChunkArr=[],adminState.authorityRender=!1,$(function(){$(".breadcrumb li:eq(0) a ").attr("href","./HomeInterface"),adminRender(1,!1),adminState.staffPageObj.selector="#pagelist",adminState.staffPageObj.pageOption={limit:10,count:adminState.staffPageObj.itemLength,curr:1,ellipsis:!0,pageShow:2,hash:!1,callback:function(t){(adminState.staffPageObj.currentPage=t.curr,t.isFirst)||(adminRender(t.curr,!1),adminState.staffHasSearch&&$("#search_button").trigger("click"),$(".staffManage_body tbody .td__user_name").each(function(){-1<_.indexOf(adminState.staffSellectObj.selectItem,$(this).attr("title").toString())&&$(this).siblings("td:eq(0)").children("input").prop("checked",!0).parent().parent().addClass("warning").removeClass("info")}),adminState.staffPageObj.currentPage=t.curr,$(".staffManage_body .tr_admin input[type=checkbox]:checked").length==$(".staffManage_body .tr_admin .td__role_id[data-ivalue!=3]").length?$("#checkAll").prop("checked",!0):$("#checkAll").prop("checked",!1),adminState.staffSellectObj.selectAll=$("#checkAll").prop("checked"))}},Pagination1=new Pagination(adminState.staffPageObj.selector,adminState.staffPageObj.pageOption),$("#jumpText").on("input propertychange",function(){$(this).val($(this).val().replace(/[^\d]/g,""))}),$("#jumpPage").on("click",function(){var t=Number($("#jumpText").val()),e=Number(adminState.staffPageObj.currentPage),a=Number(adminState.staffPageObj.pageCount);e==t||t<=0||a<t?$("#jumpText").val(""):(adminState.staffPageObj.pageOption.curr=t,Pagination1.goPage(t),Pagination1.renderPages(),adminRender(t,!1),adminState.staffHasSearch&&$("#search_button").trigger("click"))}),$(".staffManage_tit_l img[data-iicon='glyphicon-remove']").click(function(){if(console.log("adminState",adminState),0==adminState.staffSellectObj.selectItem.length)return swal({position:"center",type:"info",title:"未选中数据！",showConfirmButton:!1,timer:1500,animation:!1,customClass:"animated zoomIn"}),!1;adminSwalMixin({title:"确定删除吗？",text:"删除后该用户不再存在！",type:"warning",showCancelButton:!0,confirmButtonText:"确定，删除！",cancelButtonText:"不，取消！",reverseButtons:!1}).then(function(t){if(t.value){for(var e=adminState.staffSellectObj.selectItem,a="",n=0;n<e.length;n++)n==e.length-1?a+=$(".staffManage_body .tr_admin td[data-itext='"+e[n]+"']").data("iuserid"):a+=$(".staffManage_body .tr_admin td[data-itext='"+e[n]+"']").data("iuserid")+",";$.ajax({url:"UserRemove",type:"POST",data:{userId:a},dataType:"json",success:function(t){if(1==t){var e=1;adminState.staffSellectObj.selectAll&&(e=0),adminRender(e,!1),adminState.staffHasSearch&&$("#search_button").trigger("click"),adminState.staffPageObj.pageOption.count=adminState.staffPageObj.itemLength,adminState.staffPageObj.pageOption.curr=e,Pagination1.goPage(e),Pagination1.renderPages(),adminState.staffSellectObj.selectItem=[],adminState.staffSellectObj.selectAll&&($("#checkAll").prop("checked",!1),adminState.staffSellectObj.selectAll=!1),adminSwalMixin({title:"删除成功！",text:"被选中的记录已经删除",type:"success",showConfirmButton:!1,timer:1800})}},error:function(t,e,a){adminSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}else t.dismiss===swal.DismissReason.cancel&&adminSwalMixin({title:"取消了！",text:"不作处理",type:"error",showConfirmButton:!1,timer:1800})})}),$(document).on("click",".staffManage_body tbody td.not_search img[data-iicon='glyphicon-remove']",function(t){t.stopPropagation(),console.log("pageOption",adminState.staffPageObj);var n=$(this);return 3==n.parent().siblings(".td__role_id").data("ivalue")?(adminSwalMixin({title:"提示",text:"超级管理员不能被删除",type:"warning",showConfirmButton:!1,timer:2e3}),!1):n.parent().siblings(".td__role_id").data("ivalue")>adminState.adminRoleMap[$("body").attr("currentRole")]?(adminSwalMixin({title:"",text:"权限不足，您删除不了角色等级大于您的用户",type:"error",showConfirmButton:!1,timer:2e3}),!1):void adminSwalMixin({title:"确定删除吗？",text:"删除后该用户不再存在，点击刷新按钮可以重置数据！",type:"warning",showCancelButton:!0,confirmButtonText:"确定，删除！",cancelButtonText:"不，取消！",reverseButtons:!1}).then(function(t){if(t.value){var e=n.parent().parent().find(".user_id").data("ivalue");$.ajax({url:"UserRemove",type:"POST",data:{userId:e},dataType:"json",success:function(t){if(1==t){var e;e=adminState.staffPageObj.currentPage<adminState.staffPageObj.pageCount?adminState.staffPageObj.currentPage:adminState.staffPageObj.itemLength%10!=1?adminState.staffPageObj.currentPage:adminState.staffPageObj.currentPage-1;var a=n.data("iname").toString();adminRender(e,!1,!0),adminState.staffHasSearch&&$("#search_button").trigger("click"),adminState.staffPageObj.pageOption.count=adminState.staffPageObj.itemLength,adminState.staffPageObj.pageOption.curr=e,Pagination1.goPage(e),Pagination1.renderPages(),_.pull(adminState.staffSellectObj.selectItem,a),adminSwalMixin({title:"删除成功！",text:"被选中的记录已经删除",type:"success",showConfirmButton:!1,timer:1800}).then(function(){window.location.reload()})}},error:function(t,e,a){adminSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}else t.dismiss===swal.DismissReason.cancel&&adminSwalMixin({title:"取消了！",text:"不作处理",type:"error",showConfirmButton:!1,timer:1800})})}),$(document).on("click",".staffManage_body tbody td.not_search img[data-iicon='glyphicon-edit']",function(t){t.stopPropagation();var e=$(this);if(e.parent().siblings(".td__role_id").data("ivalue")>adminState.adminRoleMap[$("body").attr("currentrole")])return adminSwalMixin({title:"提示",text:"权限不足，您修改不了角色等级比你高的",type:"warning",showConfirmButton:!1,timer:2e3}),!1;var a=e.parent();3==e.parent().siblings(".td__role_id").data("ivalue")?$(".staff_update #staff_update_role_id option[value='3']").prop({selected:!0,disabled:!1}).parent().attr("readonly","readonly").prop("disabled",!0):($(".staff_update #staff_update_role_id option[value='请选择用户角色']").prop({selected:!0}).parent().removeAttr("readonly").prop("disabled",!1),$(".staff_update #staff_update_role_id option[value='3']").prop("disabled",!0)),$(".staff_update_r_bodyin #staff_update_user_name").attr("userId",a.parent().find(".not_search").eq(0).find("input").data("ivalue")),$("[id^='staff_update_']").each(function(){if($(this).is("#staff_update_password2"))return!0;var t=$(this).attr("id").replace("staff_update_","td__"),e=a.siblings("."+t).data("ivalue");_.isNil(e)&&(e=""),$(this).val(e.toString()),$(this).is("#staff_update_user_name")&&(adminState.staffUpdateUser=e.toString())}),$(".staff_update").prop("user_name",e.parent().siblings(".td__user_name").data("itext")),$(".staff_update_r_bodyin .container-fluid>.row .glyphicon").remove(),$(".futureDT2_bg_cover, .staff_update").slideDown(250),$(".staff_update_l, .staff_update_r").height($(".staff_update").height())}),$(".staff_update_r_foot .btn-warning").click(function(){$(".futureDT2_bg_cover, .staff_update").slideUp(250),adminState.staffUpdateUser=""})}),$(document).on("mouseover",".staffManage_body td",function(){$(this).addClass("warning"),$(this).parent().addClass("info")}).on("mouseout",".staffManage_body td",function(){$(this).removeClass("warning"),$(this).parent().removeClass("info")}).on("click",".staffManage_body td",function(){$(this).parent().toggleClass("warning info").find("[type='checkbox']").prop("checked",!$(this).parent().find("[type='checkbox']").prop("checked")).change()}).on("click",".staffManage_body tbody [type='checkbox']",function(t){if(t.stopPropagation(),3==$(this).parent().parent().find(".td__role_id").data("ivalue"))return!1;$(this).parent().parent().toggleClass("warning info")}).on("change",".staffManage_body tbody [type='checkbox']",function(){var t=$(this).data("iname").toString();$(this).prop("checked")?adminState.staffSellectObj.selectItem.push(t):_.pull(adminState.staffSellectObj.selectItem,t),adminState.staffSellectObj.selectItem=_.uniq(adminState.staffSellectObj.selectItem),$("#checkAll").prop("checked",adminState.staffPageObj.itemLength==adminState.staffSellectObj.selectItem.length),adminState.staffSellectObj.selectAll=$("#checkAll").prop("checked")}),$("#checkAll").on({click:function(){var t=$(this);if($(".staffManage_body tbody [type='checkbox']").each(function(){if(3==$(this).parent().parent().find(".td__role_id").data("ivalue"))return!0;$(this).prop("checked",t.prop("checked")),t.prop("checked")?$(this).parent().parent().removeClass("info").addClass("warning"):$(this).parent().parent().removeClass("warning info")}),adminState.staffSellectObj.selectAll=t.prop("checked"),t.prop("checked")){adminState.staffSellectObj.selectItem=[];for(var e=0;e<$(".tr_admin").length;e++)$(".tr_admin").eq(e).find("input[type='checkbox']").is(":checked")&&adminState.staffSellectObj.selectItem.push($(".tr_admin").eq(e).find(".td__user_name").attr("title").toString())}else adminState.staffSellectObj.selectItem=[]}}),$(".staffManage_tit_r_in .form-control-feedback").click(function(){$(this).prev().children("input").val("")}),$("#search_button").on("click",function(){adminRender(1,!1),adminState.staffPageObj.pageOption.count=adminState.staffPageObj.itemLength,Pagination1.pageCount=adminState.staffPageObj.pageCount,Pagination1.dataCount=adminState.staffPageObj.itemLength,Pagination1.goPage(1),Pagination1.renderPages()}),$("#search_input").on("input propertychange change",function(){""!=$(this).val().trim()?$(this).parent().parent().next().removeClass("btn-default").addClass("btn-primary").prop("disabled",!1):($(this).val(""),$(this).parent().parent().next().removeClass("btn-primary").addClass("btn-default").prop("disabled",!0))}).on("keyup",function(t){13==(t.keyCode||t.which||t.charCode)&&""!=$(this).val().trim()&&$(this).parent().parent().next().trigger("click")}),$(".staffManage_tit_l>img[data-iicon='glyphicon-remove-circle']").click(function(){$("#staff_addition_user_name,#staff_addition_password,#staff_addition_password2,#staff_addition_telephone,#staff_addition_email").val(""),$("#staff_addition_sex,#staff_addition_role_id").prop("selected",!1),$("#staff_addition_sex option:first,#staff_addition_role_id option:first").prop("selected","selected"),$(".staff_addition_r_bodyin\t.refresh  .glyphicon:not(.has-feedback .form-control-feedback)").remove(),$(".staff_addition_r_bodyin\t.row  .glyphicon").removeClass("glyphicon-ok-sign").addClass("glyphicon-info-sign"),$(".futureDT2_bg_cover, .staff_addition").slideDown(250),$(".staff_addition_l, .staff_addition_r").height($(".staff_addition").height())}),$(".staff_addition_r_foot .btn-warning").click(function(){$(".futureDT2_bg_cover, .staff_addition").slideUp(250)}),$(".isRequired").on("input propertychange change",function(){var t,e,a=$(this);$(this).parents(".staff_addition").length?e="addition":$(this).parents(".staff_update").length&&(e="update"),""===$(this).val().trim()||null==$(this).val()?(t='<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>',$(".staff_"+e+"_r_foot>.btn-primary").prop("disabled",!0)):$(this).is("#staff_"+e+"_password2")&&$("#staff_"+e+"_password").val()!=$("#staff_"+e+"_password2").val()?(t='<span class="glyphicon glyphicon-info-sign" aria-hidden="true"> <span>两次输入不一致</span></span> ',$(".staff_"+e+"_r_foot>.btn-primary").prop("disabled",!0)):(t='<span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span>',staffSubmitBtn(a,e)),$(this).parent().next().empty().append(t)}),$("#staff_addition_user_name").on("blur",function(){var e,t=$("#staff_addition_user_name").val().trim();if(""==t)return e='<span class="glyphicon glyphicon-info-sign" aria-hidden="true"><span>用户名不能为空</span></span>',$(".staff_addition_r_foot>.btn-primary").prop("disabled",!0),$(this).parent().next().empty().append(e),!1;$.ajax({url:"UserNameQuery",type:"get",data:{userName:t},dataType:"json",success:function(t){console.log("data",t),t?(e='<span class="glyphicon glyphicon-info-sign" aria-hidden="true"><span>用户名已存在</span></span>',$(".staff_addition_r_foot>.btn-primary").prop("disabled",!0)):(e='<span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span>',staffSubmitBtn($(this),"addition")),$("#staff_addition_user_name").parent().next().empty().append(e)},error:function(t,e,a){adminSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}),$("#staff_update_user_name").on("blur",function(){var e,t=$("#staff_update_user_name").val().trim();if(""==t)return e='<span class="glyphicon glyphicon-info-sign" aria-hidden="true"><span>用户名不能为空</span></span>',$(".staff_update_r_foot>.btn-primary").prop("disabled",!0),$(this).parent().next().empty().append(e),!1;$(".staff_update").prop("user_name")!=t?$.ajax({url:"UserNameQuery",type:"get",data:{userName:t},dataType:"json",success:function(t){console.log("data",t),t?(e='<span class="glyphicon glyphicon-info-sign" aria-hidden="true"><span>用户名已存在</span></span>',$(".staff_update_r_foot>.btn-primary").prop("disabled",!0)):(e='<span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span>',staffSubmitBtn($(this),"update")),$("#staff_update_user_name").parent().next().empty().append(e)},error:function(t,e,a){adminSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}}):(e='<span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span>',staffSubmitBtn($(this),"update"),$("#staff_update_user_name").parent().next().empty().append(e))}),$(".row .has-feedback .form-control-feedback").click(function(){console.log("nini"),$(this).is(".glyphicon-eye-open")?$(this).prev().attr("type","text"):$(this).is(".glyphicon-eye-close")&&$(this).prev().attr("type","password"),$(this).toggleClass("glyphicon-eye-open glyphicon-eye-close")}),$(".staff_addition_r_foot>.btn-primary").click(function(){var t=$("#staff_addition_user_name").val().trim(),e=$("#staff_addition_sex").val().trim(),a=$("#staff_addition_password2").val().trim(),n=$("#staff_addition_telephone").val().trim(),i=$("#staff_addition_email").val().trim(),o=$("#staff_addition_role_id").val();$.ajax({url:"UserOperate",type:"POST",dataType:"json",data:{userName:t,password:a,sex:e,telephone:n,email:i,roleId:o},success:function(t){"添加成功！"==t&&(adminRender(adminState.staffPageObj.currentPage,!1),Pagination1.goPage(Number(adminState.staffPageObj.currentPage)),Pagination1.renderPages(),adminState.staffHasSearch&&$("#search_button").trigger("click"),$(".futureDT2_bg_cover, .staff_addition").slideUp(250),adminSwalMixin({title:"添加成功",text:"成员信息添加成功！",type:"success",showConfirmButton:!1,timer:2e3}).then(function(){window.location.reload()}))},error:function(t,e,a){adminSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}),$(".staff_update_r_foot>.btn-primary").click(function(){var t=$(".staff_update_r #staff_update_user_name").attr("userId"),e=$("#staff_update_user_name").val().trim(),a=$("#staff_update_sex").val().trim(),n=$("#staff_update_telephone").val().trim(),i=$("#staff_update_email").val().trim(),o=$("#staff_update_role_id").val();$.ajax({url:"UserOperate",type:"POST",dataType:"json",data:{userId:t,userName:e,sex:a,telephone:n,email:i,roleId:o},success:function(t){"修改成功！"==t&&(adminRender(adminState.staffPageObj.currentPage,!1),Pagination1.goPage(Number(adminState.staffPageObj.currentPage)),Pagination1.renderPages(),adminState.staffHasSearch&&$("#search_button").trigger("click"),$(".futureDT2_bg_cover, .staff_update").slideUp(250),adminSwalMixin({title:"修改成功",text:"成员信息修改成功！",type:"success",showConfirmButton:!1,timer:2e3}).then(function(){window.location.reload()}))},error:function(t,e,a){adminSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(t){if($(".g_info img[data-iicon='glyphicon-question-sign']").show(),"operaDailyLog"==$(t.target).parent().data("iclassify")&&($(".g_info img[data-iicon='glyphicon-question-sign']").hide(),!adminState.hasRequestData)){operateRendaer(1),adminState.operatePageObj.selector="#pagelist2",adminState.operatePageObj.pageOption={limit:10,count:adminState.operatePageObj.itemLength,curr:1,ellipsis:!0,pageShow:2,hash:!1,callback:function(t){(adminState.operatePageObj.currentPage=t.curr,console.log("obj",t),t.isFirst)||(operateRendaer(t.curr),$(".operaDailyLog_body tbody [type='checkbox']").each(function(){-1<_.indexOf(adminState.operateSellectObj.selectItem,$(this).data("ivalue").toString())&&$(this).prop("checked",!0).parent().parent().addClass("warning").removeClass("info")}),$(".operaDailyLog_body .tr_operate input[type=checkbox]:checked").length==$(".operaDailyLog_body .tr_operate").length?$("#checkAll2").prop("checked",!0):$("#checkAll2").prop("checked",!1),adminState.operateSellectObj.selectAll=$("#checkAll2").prop("checked"))}},Pagination=new Pagination(adminState.operatePageObj.selector,adminState.operatePageObj.pageOption),adminState.hasRequestData=!0}}),$("#jumpText2").on("input propertychange",function(){$(this).val($(this).val().replace(/[^\d]/g,""))}),$("#jumpPage2").on("click",function(){var t=Number($("#jumpText2").val()),e=Number(adminState.operatePageObj.currentPage),a=Number(adminState.operatePageObj.pageCount);e==t||t<=0||a<t?$("#jumpText2").val(""):(adminState.operatePageObj.pageOption.curr=t,Pagination.goPage(t),Pagination.renderPages(),operateRendaer(t),adminState.operateHasSearch&&$("#search_button2").trigger("click"))}),$("#search_button2").on("click",function(){operateRendaer(1),adminState.operatePageObj.pageOption.count=adminState.operatePageObj.itemLength,Pagination.pageCount=adminState.operatePageObj.pageCount,Pagination.dataCount=adminState.operatePageObj.itemLength,Pagination.goPage(1),Pagination.renderPages()}),$(".operaDailyLog_tit_r .form-control-feedback").click(function(){$(this).prev().children("input").val(""),$(this).parent().next().removeClass("btn-default").addClass("btn-primary").prop("disabled",!1)}),$("#search_input2").on("input propertychange change",function(){""!=$(this).val().trim()?$(this).parent().parent().next().removeClass("btn-default").addClass("btn-primary").prop("disabled",!1):($(this).val(""),$(this).parent().parent().next().removeClass("btn-primary").addClass("btn-default").prop("disabled",!0))}).on("keyup",function(t){13==(t.keyCode||t.which||t.charCode)&&""!=$(this).val().trim()&&$(this).parent().parent().next().trigger("click")}),$("button.export_current,button.export_select").click(function(){var t="";if($(this).hasClass("export_select"))for(var e=0;e<adminState.operateSellectObj.selectItem.length;e++)t=adminState.operateSellectObj.selectItem.join(",");console.log("logIdStr",t),$.ajax({url:"LogExport",type:"get",dataType:"json",data:{logIdStr:t},success:function(t){console.log("data",t),""!=t&&(window.location.href=t)},error:function(t,e,a){adminSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}),$(document).on("mouseover",".operaDailyLog_body td",function(){$(this).addClass("warning"),$(this).parent().addClass("info")}).on("mouseout",".operaDailyLog_body td",function(){$(this).removeClass("warning"),$(this).parent().removeClass("info")}).on("click",".operaDailyLog_body td",function(){$(this).parent().toggleClass("warning info").find("[type='checkbox']").prop("checked",!$(this).parent().find("[type='checkbox']").prop("checked")).change()}).on("click",".operaDailyLog_body tbody [type='checkbox']",function(t){t.stopPropagation(),$(this).parent().parent().toggleClass("warning info")}).on("change",".operaDailyLog_body tbody [type='checkbox']",function(){var t=$(this).data("ivalue").toString();$(this).prop("checked")?adminState.operateSellectObj.selectItem.push(t):_.pull(adminState.operateSellectObj.selectItem,t),adminState.operateSellectObj.selectItem=_.uniq(adminState.operateSellectObj.selectItem),$("#checkAll2").prop("checked",adminState.operatePageObj.itemLength==adminState.operateSellectObj.selectItem.length),adminState.operateSellectObj.selectAll=$("#checkAll2").prop("checked"),0==adminState.operateSellectObj.selectItem.length?$("button.export_select").prop("disabled",!0):$("button.export_select").prop("disabled",!1)}),$("#checkAll2").on({click:function(){var t=$(this);if($(".operaDailyLog_body tbody [type='checkbox']").each(function(){$(this).prop("checked",t.prop("checked")),t.prop("checked")?$(this).parent().parent().removeClass("info").addClass("warning"):$(this).parent().parent().removeClass("warning info")}),adminState.operateSellectObj.selectAll=t.prop("checked"),t.prop("checked")){adminState.operateSellectObj.selectItem=[];for(var e=0;e<$(".tr_operate").length;e++)$(".tr_operate").eq(e).find("input[type='checkbox']").is(":checked")&&adminState.operateSellectObj.selectItem.push($(".tr_operate").eq(e).find("input[type='checkbox']").data("ivalue").toString())}else adminState.operateSellectObj.selectItem=[];$("button.export_select").prop("disabled",!t.prop("checked"))}}),$(document).on("click",".staffManage_body tbody td.not_search img[data-iicon='glyphicon-user']",function(t){t.stopPropagation();var e=$(this);if(e.parent().siblings(".td__role_id").data("ivalue")>adminState.adminRoleMap[$("body").attr("currentrole")])return adminSwalMixin({title:"异常",text:"权限不足，您修改不了角色等级比你高的",type:"error",showConfirmButton:!1,timer:2e3}),!1;3==e.parent().siblings(".td__role_id").data("ivalue")?$(".staff_authority_r_foot>.btn-primary").prop("disabled",!0):$(".staff_authority_r_foot>.btn-primary").prop("disabled",!1),$(".futureDT2_bg_cover, .staff_authority").slideDown(250);var a=e.parent();adminState.staffAuthorityUser=a.siblings(".td__user_name").data("ivalue").toString();a.siblings(".td__authority").data("ivalue");if(!adminState.authorityRender){var n=a.parent().find("td").eq(0).find("input").data("ivalue");$(".staff_authority_r_bodyin").attr("userId",n),$.ajax({url:"Authority",type:"get",dataType:"json",data:{userId:n},async:!1,success:function(t){console.log("data",t);var e="";for(var a in t)if("roleName"!=a&&"userAuthority"!=a)if(e+='<tr><td><span><input type="checkbox">'+a+"</span></td><td>",-1<t[a].authority.indexOf(","))for(var n=0;n<t[a].authority.split(",").length;n++)t[a].authorityName.split(",")[n]==a?e+='<span><input type="checkbox" data-ivalue="'+t[a].authority.split(",")[n]+'">访问'+t[a].authorityName.split(",")[n]+"</span>":e+='<span><input type="checkbox" data-ivalue="'+t[a].authority.split(",")[n]+'">'+t[a].authorityName.split(",")[n]+"</span>";else t[a].authorityName==a?e+='<span><input type="checkbox" data-ivalue="'+t[a].authority+'">访问'+t[a].authorityName+"</span>":e+='<span><input type="checkbox" data-ivalue="'+t[a].authority+'">'+t[a].authorityName+"</span>";if($(".staff_authority_r_bodyin tbody").empty().append(e),$(".staff_authority_r_bodyin tbody span>input").each(function(){$(this).prop("checked",!1)}),""!=t.userAuthority){var i=t.userAuthority.split(",");_.forEach(i,function(t){$(".staff_authority_r_bodyin tbody td:nth-child(2) span>input[data-ivalue='"+t+"']").prop("checked",!0)}),$(".staff_authority_r_bodyin tbody tr").each(function(){$(this).children("td:eq(0)").find("input").prop("checked",$(this).children("td:eq(1)").find("input").length==$(this).children("td:eq(1)").find("input").filter(":checked").length)})}},error:function(t,e,a){adminSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}$(".staff_authority_r_tit").text("详细信息 - "+adminState.staffAuthorityUser),$(".staff_authority_l, .staff_authority_r").height($(".staff_authority").height())}),$(".staff_authority_r_foot .btn-warning").click(function(){$(".futureDT2_bg_cover, .staff_authority").slideUp(250),adminState.staffAuthorityUser=""}),$(document).on("change",".staff_authority_r_bodyin tbody td:nth-child(1) span>input",function(){$(this).parent().parent().next().find("input").prop("checked",$(this).prop("checked"))}),$(document).on("change",".staff_authority_r_bodyin tbody td:nth-child(2) span>input",function(){$(this).parent().parent().prev().find("input").prop("checked",$(this).parent().parent().find("input").length==$(this).parent().parent().find("input").filter(":checked").length)}),$(".staff_authority_r_foot .btn-primary").click(function(){var t=[];$(".staff_authority_r_bodyin tbody td:nth-child(2) span>input:checked").each(function(){t.push($(this).data("ivalue"))});var e=$(".staff_authority_r_bodyin").attr("userId"),a=t.join(",");$.ajax({url:"AuthorityModify",type:"POST",dataType:"json",data:{userId:e,authority:a},success:function(t){console.log("data",t),1==t&&(adminSwalMixin({title:"授权成功！",text:"已经对"+adminState.staffAuthorityUser+"进行了授权，数据已更新",type:"success",showConfirmButton:!1,timer:2e3}),$(".staff_authority_r_foot .btn-warning").trigger("click"))},error:function(t,e,a){adminSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})});