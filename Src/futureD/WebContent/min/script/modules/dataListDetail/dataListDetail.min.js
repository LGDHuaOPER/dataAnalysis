var dataListDetailStore=Object.create(null);function renderTheadTbody(e){var i="<tr>";e.th&&(i="位置"==e.name?"<tr><th>类型</th><th>Die编号</th><th>Quality</th><th>"+e.name+"</th>":"<tr><th></th><th></th><th></th><th>"+e.name+"</th>");var r=dataListDetailStore.mock.allDetail.thead;return _.forEach(e.data,function(t,a){e.th?i+='<th title="'+t+'">'+t+"</th>":e.td&&(2==a?i+=1==t?"<td>Pass</td>":'<td style="color: red;">Fail</td>':3<a&&(parseFloat(t)>parseFloat(r.UpLimit[a-4])||parseFloat(t)<parseFloat(r.LowerLimit[a-4]))?i+='<td style="color: red;" title="'+t+'">'+t+"</td>":i+='<td title="'+t+'">'+t+"</td>")}),i+="</tr>"}function buildSignalTbodyData(t){dataListDetailStore.mock.allDetail.tbody=Object.create(null),_.forEach(t,function(t,a){var i,r=[],o=[];_.forOwn(t,function(t,a){switch(a){case"die_type":r[0]=t;break;case"die_number":r[1]=t,i=t;break;case"bin":r[2]=t;break;case"location":r[3]=t;break;default:var e={};e.key=a,e.value=t,o.push(e)}}),o=_.sortBy(o,function(t){return t.key}),_.forEach(o,function(t,a){r.push(t.value)}),dataListDetailStore.mock.allDetail.tbody[i]=_.cloneDeep(r)})}function renderSignalTbodyData(){dataListDetailStore.mock.allDetail.chunkIndex<dataListDetailStore.mock.allDetail.chunkTbodyData.length-1&&(dataListDetailStore.mock.allDetail.chunkIndex++,buildSignalTbodyData(dataListDetailStore.mock.allDetail.chunkTbodyData[dataListDetailStore.mock.allDetail.chunkIndex]),_.forOwn(dataListDetailStore.mock.allDetail.tbody,function(t,a){var e=renderTheadTbody({data:t,td:!0});$("#allDetail .allDetail_body .table_body tbody").append(e)}))}function getTableDataANDRender(){var t=$("body").data("result"),a=dataListDetailStore.mock.allDetail.thead,e=_.map(_.cloneDeep(t.yield),function(t){return _.floor(100*t,2)}),i=_.cloneDeep(t.paramLimit.upperList),r=_.cloneDeep(t.paramLimit.lowerList),o=_.cloneDeep(t.paramLimit.paramList);dataListDetailStore.mock.allDetailThead[0]=e,a.PassPercent=e,dataListDetailStore.mock.allDetailThead[1]=i,a.UpLimit=i,dataListDetailStore.mock.allDetailThead[2]=r,a.LowerLimit=r,dataListDetailStore.mock.allDetailThead[3]=o,a.Param=o,dataListDetailStore.mock.allDetail.chunkTbodyData=_.chunk(t.dataList,100),_.forEach(dataListDetailStore.mock.allDetailThead,function(t,a){var e;switch(a){case 0:e="合格率%";break;case 1:e="上限";break;case 2:e="下限";break;default:e="位置"}var i=renderTheadTbody({data:t,th:!0,name:e});$("#allDetail .allDetail_body .table_head thead").append(i)}),$(".allDetail_body .table_body").innerHeight($(".allDetail_body").innerHeight()-$(".allDetail_body .table_head").innerHeight()),renderSignalTbodyData(),$(".allDetail_body .table_body>table").innerHeight()>$(".allDetail_body .table_body").innerHeight()+dataListDetailStore.state.scrollBarWidth&&$(".allDetail_body .table_head").innerWidth($(".allDetail_body").innerWidth()-dataListDetailStore.state.scrollBarWidth)}function commonCalcLayout(){$(".tab-content div[role='tabpanel']").innerWidth($(".tab-content").innerWidth()).innerHeight($(".tab-content").innerHeight()),$(".vectorMap_l, .vectorMap_r").innerHeight($("#vectorMap").innerHeight()),$(".allDetail_body .table_body").innerHeight($(".allDetail_body").innerHeight()-$(".allDetail_body .table_head").innerHeight()),$(".allDetail_body .table_body>table").innerHeight()>$(".allDetail_body .table_body").innerHeight()+dataListDetailStore.state.scrollBarWidth&&$(".allDetail_body .table_head").innerWidth($(".allDetail_body").innerWidth()-dataListDetailStore.state.scrollBarWidth)}function renderVectorMapWafer(t){var a=t.mapInfo,i=[],e=1==a.containSubdie?a.waferDie.currentDieList:a.waferList.currentDieList;_.forOwn(e,function(t,a){var e={};e[a]=t.bin,i.push(e)}),_.forOwn(a.otherDieType,function(t,a){var e={};e[a]=t,i.push(e)});var r=1.25*($(".vectorMap_r").innerHeight()-20),o=$(".vectorMap_r").innerHeight()-20;dataListDetailStore.state.vectorMap.waferMapObj=buildColorGradation({width:r,height:o,container:"canvas_vectorMap",bgFillColor:"#314067",waferData:a,spacePercent:{x:.1,y:0},m_DieDataListNew:i,colorGradation:{limitColor:"#FF0000",floorColor:"#008000",nums:256},filterArr:dataListDetailStore.mock.vectorMap.filterArr,currentDieCoord:"",isFirst:!0,isSaveDieCoord:!0,saveDieCoord:dataListDetailStore.state.vectorMap.currentDieCoord,coordsArra:dataListDetailStore.state.vectorMap.coordsArray,returnFlag:!0,addEvent:!0,curSelectedDie:dataListDetailStore.state.vectorMap.curSelectedDie,vectorMap:!0,callback:function(t){$(".positionFlag_div>img").attr("src","assets/img/modules/dataListDetail/"+t+".png"),$(".qualifiedInformation_div .panel-body tbody>tr:eq(1)>td:eq(1)").text(a.waferList.yield),$(".qualifiedInformation_div .panel-body tbody>tr:eq(2)>td:eq(1)").text(a.waferList.qualify),$(".qualifiedInformation_div .panel-body tbody>tr:eq(3)>td:eq(1)").text(a.waferList.unqulify),$(".coordinateInformation_div .panel-body tbody>tr:eq(0)>td:eq(1)").text("（"+dataListDetailStore.state.vectorMap.currentDieCoord[0]+"）")},clickCallback:function(t){$(".coordinateInformation_div .panel-body tbody>tr:eq(0)>td:eq(1)").text("（"+t+"）"),dataListDetailStore.state.vectorMap.currentDieCoord[0]=t;var a=$("div.vectorMap_l").scrollTop();getIDByCoordANDRequ({callback:null,ajaxCallback:function(){setTimeout(function(){swal.close(),$("div.vectorMap_l").scrollTop(a)},1500)}})},keydownCallback:function(t){$(".coordinateInformation_div .panel-body tbody>tr:eq(0)>td:eq(1)").text("（"+t+"）"),dataListDetailStore.state.vectorMap.currentDieCoord[0]=t;var a=$("div.vectorMap_l").scrollTop();getIDByCoordANDRequ({callback:null,ajaxCallback:function(){setTimeout(function(){swal.close(),$("div.vectorMap_l").scrollTop(a)},1500)}})},resizeCallback:function(t,a,e){$(window).on("resize",_.debounce(function(){calculateLayout(t,a,e)},150))}})}function calculateLayout(t,a,e){if("vectorMap"==$(".g_menu li[role='presentation'].active").data("iclassify")){var i,r=$(window).height(),o=$(window).width(),n=$(".vectorMap_r").innerHeight(),l=$(".vectorMap_r").innerWidth();i={w:_.sortBy([o,l])[0],h:_.sortBy([r,n])[0]};var s=.78*_.sortBy([i.w,i.h])[1],d=e.container,c=document.getElementById(d),p=c.width,u=c.height;c.getContext("2d").clearRect(0,0,p,u),c.width=s,c.height=.8*s,e.setPlotParam({centerX:s/2,centerY:.4*s,r:.4*s}),e.plot()}}function buildChartContainer(t){var a="";-1<_.indexOf(dataListDetailStore.state.vectorMap.curveType,t)?(a='<div id="'+t+"_charts_"+dataListDetailStore.state.vectorMap.curCurveTypeNo+'"></div>',$("div.all_charts_rows>div."+t+"_col .panel_chart_body").empty().append(a),$("div.all_charts_rows>div."+t+"_col").fadeIn(200)):(a='<div class="col-sm-12 col-md-12 col-lg-12 '+t+'_col"><div class="panel panel-info"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>'+t+'</div><div class="panel-body"><div class="panel_chart_body"><div id="'+t+"_charts_"+dataListDetailStore.state.vectorMap.curCurveTypeNo+'"></div></div><div class="panel_chart_foot"></div></div></div></div>',$("div.all_charts_rows").append(a),dataListDetailStore.state.vectorMap.curveType.push(t.toString()));var e=t+"_charts_"+dataListDetailStore.state.vectorMap.curCurveTypeNo;return dataListDetailStore.state.vectorMap.curCurveTypeNo++,e}function renderChartByCoord(t){var a=t.ajaxData,e=t.callback,i=t.ajaxCallback;eouluGlobal.S_getSwalMixin()({title:"加载提示",text:"正在绘制曲线",type:"info",showConfirmButton:!1}),$("div.all_charts_rows>div").fadeOut(100),$(".row.all_charts_rows").find("div[data-highcharts-chart]").each(function(t,a){$(a).highcharts().destroy()}),$.ajax({type:"GET",url:"VectorCurve",data:a,dataType:"json"}).then(function(t){_.isNil(t)||_.isEmpty(t)?eouluGlobal.S_getSwalMixin()({title:"加载提示",text:"曲线数据获取失败或者为空",type:"warning",showConfirmButton:!1,timer:1600}):_.forOwn(t,function(t,a){judgeVectorCurveChart({container:buildChartContainer(a),curveData:t,curveType:a,callback:e})})}).always(function(){i&&_.isFunction(i)&&i()})}function judgeVectorCurveChart(t){var a=t.container,r=t.curveData,e=t.curveType,i=t.callback;if(2==_.keys(r).length){if(1==r.curve.length||0==r.curve.length)eouluGlobal.S_getSwalMixin()({title:"加载提示",text:"曲线数据不存在或只有一列",type:"warning",showConfirmButton:!1,timer:1600});else if(2==r.curve.length)drawCommonCurve({curveType:e,container:a,xAxisTitle:r.paramList[0],yAxisTitle:r.paramList[1],seriesData:[{name:e,data:r.curve[1]}],xcategories:_.map(r.curve[0],function(t){var a=!0;return 1<Math.abs(t)&&(a=!1),eouluGlobal.S_ComSCMRound(t,2,a)}),callback:i});else if(3==r.curve.length){var o,n=[];_.forOwn(_.countBy(r.curve[0]),function(t,a){var e=_.findIndex(r.curve[0],function(t){return _.toString(t)==_.toString(a)}),i={};i.name="P="+a,i.data=_.slice(r.curve[2],e,e+t),o=_.slice(r.curve[1],e,e+t),n.push(i)}),drawCommonCurve({curveType:e,container:a,xAxisTitle:r.paramList[1],yAxisTitle:r.paramList[2],seriesData:n,xcategories:o,callback:i})}}else 4==_.keys(r).length&&drawDbCurveANDSmith({smithAndCurve:r,container:a,callback:i})}function drawDbCurveANDSmith(t){var p=t.smithAndCurve,u=t.container,a=t.callback;$("#"+u).empty().append('<div class="panel panel-info" data-dbcurveandsmith="S11"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>S11</div><div class="panel-body"><div class="picturetop"></div><div class="picturebottom"><div class="picturebottom_in"><div class="pictureline"><p></p></div><div class="smithdata"><p class="smithdata1"><span class="Smith_Paramter">1-0-S Paramter</span> (<span class="Smith_Msg1">S11</span>)</p><p class="smithdata2"><span class="Smith_Paramter">1-0-S Paramter</span> : <span class="Smith_Msg2">(0.83,-0.50),25.50GHz</span></p></div></div></div></div></div><div class="panel panel-info" data-dbcurveandsmith="S12"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>S12</div><div class="panel-body"><div class="picturetop"></div><div class="picturebottom"><div class="picturebottom_in"><div class="pictureline"><p></p></div><div class="smithdata"><p class="smithdata1"><span class="Smith_Paramter">1-0-S Paramter</span> (<span class="Smith_Msg1">S12</span>)</p><p class="smithdata2"><span class="Smith_Paramter">1-0-S Paramter</span> : <span class="Smith_Msg2">(0.83,-0.50),25.50GHz</span></p></div></div></div></div></div><div class="panel panel-info" data-dbcurveandsmith="S21"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>S21</div><div class="panel-body"><div class="picturetop"></div><div class="picturebottom"><div class="picturebottom_in"><div class="pictureline"><p></p></div><div class="smithdata"><p class="smithdata1"><span class="Smith_Paramter">1-0-S Paramter</span> (<span class="Smith_Msg1">S21</span>)</p><p class="smithdata2"><span class="Smith_Paramter">1-0-S Paramter</span> : <span class="Smith_Msg2">(0.83,-0.50),25.50GHz</span></p></div></div></div></div></div><div class="panel panel-info" data-dbcurveandsmith="S22"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>S22</div><div class="panel-body"><div class="picturetop"></div><div class="picturebottom"><div class="picturebottom_in"><div class="pictureline"><p></p></div><div class="smithdata"><p class="smithdata1"><span class="Smith_Paramter">1-0-S Paramter</span> (<span class="Smith_Msg1">S22</span>)</p><p class="smithdata2"><span class="Smith_Paramter">1-0-S Paramter</span> : <span class="Smith_Msg2">(0.83,-0.50),25.50GHz</span></p></div></div></div></div></div>').find("[data-dbcurveandsmith]").each(function(){var e=$(this).data("dbcurveandsmith"),t=$(this).find(".panel-body").innerWidth(),a=.5;$(window).width()<=1199&&(a=1),$(this).find(".picturetop").innerHeight(t*a);var i=_.find(p,function(t,a){if(-1<_.toString(a).indexOf(e))return!0});if("S11"==e||"S22"==e){var r=$(this).find(".picturetop")[0],o=$(this).find(".picturebottom")[0],n=[e],l=[];l.push(i);var s=smithChart({dom:r,titleOneArr:[""],legendNameOneArr:n,allDataArr:l,Type:e,msgdom:o,GHzFlag:!0});2==dataListDetailStore.state.vectorMap.smithObjArr.length&&(dataListDetailStore.state.vectorMap.smithObjArr.length=0),dataListDetailStore.state.vectorMap.smithObjArr.push(s)}else{$('<div id="'+u+"_"+e+'"></div>').appendTo($(this).find(".picturetop")).innerHeight($(this).find(".picturetop").innerHeight());var d=i,c={xCategories:[]};_.forEach(d,function(t,a){c.xCategories.push(t[0])}),c.series=[],c.series[0]={},c.series[0].data=[],_.forEach(d,function(t,a){c.series[0].data.push(parseFloat(t[1]))}),c.container=$(this).find(".picturetop").children("div").attr("id"),c.msgDom=$(this).find(".picturebottom"),c.resetZoomButton={position:{align:"left",x:0,y:0},relativeTo:"chart"},drawDbCurve(c)}}),setTimeout(function(){a&&_.isFunction(a)&&a(null,"SmithCurve")},500)}function drawDbCurve(t){var a=t.container,i=t.xCategories,e=t.series,r=t.msgDom,o=t.legend_enabled||!1,n=t.zoomType||"None",l=t.resetZoomButton,s=t.text||null;return Highcharts.chart(a,{chart:{type:"line",zoomType:n,resetZoomButton:l},title:{text:s},lang:{loading:"Loading..."},legend:{enabled:o},xAxis:{title:{text:"GHz"},categories:i},yAxis:{title:{text:"dB"},gridLineColor:"#eee",gridLineWidth:1},series:e,credits:{enabled:!1},tooltip:{formatter:function(t){return"<b>"+this.series.name+"</b><br>"+this.x+" GHz, "+this.y+" dB"},useHTML:!0},plotOptions:{series:{point:{events:{mouseOver:function(t){var a=i[this.x],e=this.y+" dB,"+a+" GHz";r&&r.find(".Smith_Msg2").text(e)}}},showCheckbox:!0}}})}function drawCommonCurve(t){var a,e=t.curveType,i=(t.container,t.xAxisTitle),r=t.yAxisTitle,o=t.seriesData,n=t.xcategories,l=t.callback,s={credits:{enabled:!1},title:{text:e},subtitle:{text:null},lang:{loading:"Loading..."},xAxis:{title:{text:i},lineColor:"black",categories:n},yAxis:[{lineWidth:1,lineColor:"black",arrow:!0,reversed:!1,title:{text:r,align:"high",rotation:0}}]};return a=Highcharts.chart(t.container,_.merge({},s,{tooltip:{headerFormat:"{point.key}, {point.y}<br>",pointFormat:"<b>{series.name}</b>"},series:o})),l&&_.isFunction(l)&&l(a,"CommonCurve"),a}function getIDByCoordANDRequ(t){if(_.isNil(dataListDetailStore.mock.vectorMap.waferAjaxData))eouluGlobal.S_getSwalMixin()({title:"加载曲线提示",text:"获取不到参数",type:"warning",showConfirmButton:!1,timer:1600});else{var a=1==dataListDetailStore.mock.vectorMap.waferAjaxData.mapInfo.containSubdie?dataListDetailStore.mock.vectorMap.waferAjaxData.mapInfo.waferList.currentSubdieList:dataListDetailStore.mock.vectorMap.waferAjaxData.mapInfo.waferList.currentDieList,e=_.find(a,function(t,a){return a==dataListDetailStore.state.vectorMap.currentDieCoord[0]});if(_.isNil(e))eouluGlobal.S_getSwalMixin()({title:"加载曲线提示",text:"选择die异常，获取不到参数",type:"warning",showConfirmButton:!1,timer:1600});else{var i={};i.coordinateId=e.coordinateId;var r=$("#SubdieSel").val(),o=$("#GroupSel").val(),n=$("#DieTypeSel").val();(_.isNil(r)||"AllSubdie"==r)&&(r=void 0),(_.isNil(o)||"AllGroup"==o)&&(o=void 0),(_.isNil(n)||"AllDieType"==n)&&(n=void 0),i.subdie=r,i.deviceGroup=o,i.dieType=n,console.log,renderChartByCoord({ajaxData:i,callback:t.callback,ajaxCallback:t.ajaxCallback})}}}function calcCoordImgWH(){1366<$(window).width()?($(".positionFlag_div").css({width:"108px",height:"108px"}),$(".positionFlag_div>img").attr({width:"108",height:"108"})):($(".positionFlag_div").css({width:"100px",height:"100px"}),$(".positionFlag_div>img").attr({width:"100",height:"100"}))}function findParamUpLow(e){var t={};if("ALL"==e.toLocaleUpperCase())t.up="无",t.low="无";else{var a=$("body").data("result").paramLimit,i=_.findIndex(a.paramList,function(t,a){return t.replace(/\([\s\S]*\)$/,"")==e});t.low=-1==i?t.up="无":(t.up=a.upperList[i],a.lowerList[i])}return _.cloneDeep(t)}function buildParameterChartContainer(t){var i=t.classify,a=t.paramsArr,r='<div class="container-fluid">',o=[];if(-1<["good_rate"].indexOf(i)){var e="良品率（"+a.length+"个参数）",n=_.join(a,", ");r+='<div class="row">',r+='<div class="col-sm-12 col-md-12 col-lg-12">',r+='<div class="panel panel-info" data-contextualparam="'+e+'"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>'+e+'</div><div class="panel-body"><div class="container-fluid"><div class="chart_title"></div><div class="chart_body"><div id="'+(i+dataListDetailStore.state.parameterMap.curChartContainerNum)+'" data-iparam="'+n+'"></div></div><div class="chart_foot"></div></div></div></div>',r+="</div>",r+="</div>",o.push({id:i+dataListDetailStore.state.parameterMap.curChartContainerNum,param:n,isAll:!0}),dataListDetailStore.state.parameterMap.curChartContainerNum++}else if(-1<["histogram","boxlinediagram","CPK","gaussiandistribution","map_good_rate_distribution","map_color_order_distribution"].indexOf(i)){-1<["histogram"].indexOf(i)&&(a=_.pull(a,"sectionX"));var l="";-1<_.indexOf(["gaussiandistribution"],i)&&(l='<table class="table table-striped table-bordered table-condensed"><tbody><tr><td>中值</td><td>中值</td></tr><tr><td>平均值</td><td>平均值</td></tr><tr><td>最大值</td><td>最大值</td></tr><tr><td>最小值</td><td>最小值</td></tr><tr><td></td><td></td></tr><tr><td>期望</td><td>期望</td></tr><tr><td>标准差</td><td>标准差</td></tr><tr><td>方差</td><td>方差</td></tr></tbody></table>'),_.forEach(a,function(t,a,e){a%2==0&&(r+='<div class="row">'),r+='<div class="col-sm-12 col-md-6 col-lg-6">',r+='<div class="panel panel-info" data-contextualparam="'+t+'"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>'+t+'</div><div class="panel-body"><div class="container-fluid"><div class="chart_title"></div><div class="chart_body"><div id="'+(i+dataListDetailStore.state.parameterMap.curChartContainerNum)+'" data-iparam="'+t+'"></div></div><div class="chart_foot">'+l+"</div></div></div></div>",r+="</div>",(a%2==1||a%2==0&&a==e.length-1)&&(r+="</div>"),o.push({id:i+dataListDetailStore.state.parameterMap.curChartContainerNum,param:t,isAll:!1}),dataListDetailStore.state.parameterMap.curChartContainerNum++})}return r+="</div>",$("#parameterMap>div.panel[data-iallstatistics='"+i+"']").children(".panel-body").append(r),o}function draw_map_good_rate(t){console.log("draw_map_good_rate==obj",t);var a=t.data,e=t.waferNO;if(_.isNil(e))return!1;var r=t.IDParamObj,o=$("#"+r.id),i=o.innerWidth();o.innerHeight(.8*i);var n="canvas_"+o.attr("id");o.append("<canvas id='"+n+"'></canvas>"),o.append("<div class='criterion_"+n+"'></div>");var l=_.find(a,function(t,a){return _.toString(a)==_.toString(e)}),s=[],d=_.find(l.waferList,function(t,a){return _.toString(t.parameter)==_.toString(r.param)});_.forOwn(d.currentDieList,function(t,a){var e={};e[a]=t,s.push(e)}),_.forOwn(l.otherDieType,function(t,a){var e={};e[a]=t,s.push(e)}),buildColorGradation({width:i,height:.8*i,container:n,bgFillColor:"#314067",waferData:l,spacePercent:{x:.1,y:0},m_DieDataListNew:s,colorGradation:{limitColor:"#FF0000",floorColor:"#00FF00",nums:256},param:t.IDParamObj.param,callback:function(t,a){var e=findParamUpLow(r.param),i='<div class="container-fluid"><table class="table table-striped table-bordered table-hover table-condensed"><thead><tr><th>合格数</th><th>不合格数</th><th>良率</th><th>下限</th><th>上限</th></tr></thead><tbody><tr><td>'+d.qualify+"</td><td>"+d.unqulify+"</td><td>"+d.yield+"</td><td>"+e.low+"</td><td>"+e.up+"</td></tr></tbody></table></div>";o.parent().next().append(i)}})}function draw_map_color_order_distribution(t){console.log("draw_map_color_order_distribution",t);var a=t.data,e=t.IDParamObj,i=t.waferNO,r=$("#"+e.id),o=_.find(a,function(t,a){return _.toString(a)==_.toString(i)});dieData=[],subdieData=[],currentDieItem=_.find(o.waferList,function(t,a){return _.toString(t.parameter)==_.toString(e.param)}),theMax=200,theMin=-100,lowwer=theMin+_.floor((theMax-theMin)/3),upper=theMin+2*_.floor((theMax-theMin)/3),midder=_.floor((theMax+theMin)/2),otherColor={},twoDiff=lowwer-theMin,threeDiff=midder-lowwer,fourDiff=upper-midder,fiveDiff=theMax-upper,precision=0;var n=o.containSubdie?o.waferDie.currentDieList:currentDieItem.currentDieList,l=o.containSubdie?[n]:[n,o.otherDieType];_.forEach(l,function(t,a){_.forOwn(t,function(t,a){var e,i,r,o,n,l={};n=_.isObject(t)?(o=t.percent,t.bin||t.subdieBin):o=t,e=_.round(parseFloat(o)*Math.pow(10,precision));var s=_.toString(o).match(/^\+/),d=_.toString(o).match(/^\-/);if(_.isObject(t)?_.isNil(s)&&_.isNil(d)?r=1:(_.isNil(s)||(r=100),_.isNil(d)||(r=-100)):_.isNil(s)&&_.isNil(d)?r=0:(_.isNil(s)||(r=2),_.isNil(d)||(r=-2)),2<r&&(e+=r),5e3==(i=n))"5000:"in otherColor||(otherColor["5000:"]="#FDFDFD"),l[a]={bin:5e3,color:"5000:"};else if(5001==i)"5001:"in otherColor||(otherColor["5001:"]="#fff"),l[a]={bin:5001,color:"5001:"};else if(-1==i)"-1:"in otherColor||(otherColor["-1:"]="#314067"),l[a]={bin:-1,color:"-1:"};else{var c=_.round(e);_.isNil(s)&&_.isNil(d)?lowwer<=e&&e<midder?l[a]={bin:i,color:"3:"+c}:midder<=e&&e<=upper&&(l[a]={bin:i,color:"4:"+c}):(_.isNil(s)||(upper<=e&&e<theMax?l[a]={bin:i,color:"5:"+c}:theMax<=e&&(e=theMax,l[a]={bin:i,color:"6:"+c})),_.isNil(d)||(e<=theMin?(e=theMin,l[a]={bin:i,color:"1:"+c}):theMin<e&&e<=lowwer&&(l[a]={bin:i,color:"2:"+c})))}dieData.push(l)})});var s=o.containSubdie?currentDieItem.currentSubdieList:{},d=(o.containSubdie&&o.otherSubdieType,o.containSubdie?[s]:[]);_.forEach(d,function(t,a){_.forOwn(t,function(t,a){var e,i,r,o,n,l={};n=_.isObject(t)?(o=t.percent,t.subdieBin):o=t,e=_.round(parseFloat(o)*Math.pow(10,precision));var s=_.toString(o).match(/^\+/),d=_.toString(o).match(/^\-/);if(_.isObject(t)?_.isNil(s)&&_.isNil(d)?r=1:(_.isNil(s)||(r=100),_.isNil(d)||(r=-100)):_.isNil(s)&&_.isNil(d)?r=0:(_.isNil(s)||(r=2),_.isNil(d)||(r=-2)),2<r&&(e+=r),5e3==(i=n))"5000:"in otherColor||(otherColor["5000:"]="#FDFDFD"),l[a]={bin:5e3,color:"5000:"};else if(5001==i)"5001:"in otherColor||(otherColor["5001:"]="#fff"),l[a]={bin:5001,color:"5001:"};else if(-1==i)"-1:"in otherColor||(otherColor["-1:"]="#314067"),l[a]={bin:-1,color:"-1:"};else{var c=_.round(e);_.isNil(s)&&_.isNil(d)?lowwer<=e&&e<midder?l[a]={bin:i,color:"3:"+c}:midder<=e&&e<=upper&&(l[a]={bin:i,color:"4:"+c}):(_.isNil(s)||(upper<=e&&e<theMax?l[a]={bin:i,color:"5:"+c}:theMax<=e&&(e=theMax,l[a]={bin:i,color:"6:"+c})),_.isNil(d)||(e<=theMin?(e=theMin,l[a]={bin:i,color:"1:"+c}):theMin<e&&e<=lowwer&&(l[a]={bin:i,color:"2:"+c})))}subdieData.push(l)})});var c={1:[],2:[],3:[],4:[],5:[],6:[],5e3:[],5001:[],"-1":[],12:[]};_.forEach(dieData,function(t,a){var e=_.values(t)[0].color.split(":")[0],i=_.keys(t)[0],r={};r.old1=_.find(currentDieItem.currentDieList,function(t,a){return a==i}),r.new1=t,c[e].push(r)}),window.ArraMap=c;var p=r.innerWidth();r.innerHeight(.8*p);var u="canvas_"+r.attr("id");r.append("<canvas id='"+u+"'></canvas>"),r.after("<div class='criterion_"+u+"'><div class='colorGradient'></div></div>"),buildColorGradation({width:p,height:.8*p,container:u,bgFillColor:"#314067",waferData:o,spacePercent:{x:.1,y:0},m_DieDataListNew:dieData,colorGradation:{theMinColor:"#0000FF",lowwerColor:"#00FFFF",midderColor:"#00FF00",upperColor:"#FFFF00",theMaxColor:"#FF0000",twoDiff:twoDiff,threeDiff:threeDiff,fourDiff:fourDiff,fiveDiff:fiveDiff},colorOrder:!0,theMin:theMin,lowwer:lowwer,midder:midder,upper:upper,theMax:theMax,otherColor:otherColor,param:t.IDParamObj.param,subcoordsArray:subdieData});var h=r.next().find("div.colorGradient");h.width(r.next().width()-60).height(r.next().height()-30);var f=twoDiff+threeDiff+fourDiff+fiveDiff,m=h.height(),v=h.width()/(1.2*f),b=_.floor((theMax-theMin)/200);$("body").innerWidth()<1920&&(b+=.5),$("body").innerWidth()<1366&&(b+=.5),console.log("multip",b),h.append("<span class='colorGradientSpan oneSpan outSpan'><span style='height: "+m+"px; width: "+v+"px'></span></span>"),h.append("<span class='colorGradientSpan splitSpan' style='height: "+m+"px; width: "+v*b+"px;'></span>"),_.times(twoDiff,function(t){var a=getGradientColor("#00FFFF","#0000FF",twoDiff,twoDiff-t);h.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+m+"px; width: "+v+"px'></span>")}),h.append("<span class='colorGradientSpan twoSpan outSpan'><span style='height: "+m+"px; width: "+v+"px'></span></span>"),h.append("<span class='colorGradientSpan splitSpan' style='height: "+m+"px; width: "+v*b+"px;'></span>"),_.times(threeDiff,function(t){var a=getGradientColor("#00FF00","#00FFFF",threeDiff,threeDiff-t);h.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+m+"px; width: "+v+"px'></span>")}),h.append("<span class='colorGradientSpan threeSpan outSpan'><span style='height: "+m+"px; width: "+v+"px'></span></span>"),h.append("<span class='colorGradientSpan splitSpan' style='height: "+m+"px; width: "+v*b+"px;'></span>"),_.times(fourDiff,function(t){var a=getGradientColor("#FFFF00","#00FF00",fourDiff,fourDiff-t);h.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+m+"px; width: "+v+"px'></span>")}),h.append("<span class='colorGradientSpan fourSpan outSpan'><span style='height: "+m+"px; width: "+v+"px'></span></span>"),h.append("<span class='colorGradientSpan splitSpan' style='height: "+m+"px; width: "+v*b+"px;'></span>"),_.times(fiveDiff,function(t){var a=getGradientColor("#FF0000","#FFFF00",fiveDiff,fiveDiff-t);h.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+m+"px; width: "+v+"px'></span>")}),h.append("<span class='colorGradientSpan fiveSpan outSpan'><span style='height: "+m+"px; width: "+v+"px'></span></span>"),h.append("<span class='colorGradientSpan splitSpan' style='height: "+m+"px; width: "+v*b+"px;'></span>"),h.append("<span class='colorGradientSpan sixSpan outSpan'><span style='height: "+m+"px; width: "+v+"px'></span></span>");var g=_.countBy(dieData,function(t,a){var e;return _.forOwn(t,function(t,a){e=t.color.split(":")[0]}),e});$('<table class="table table-striped table-bordered table-condensed"><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th><th>合格数</th><th>不合格数</th><th>良率</th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td><td></td><td></td><td class="qualify_tt" data-ipara="qualify">0</td><td class="unqulify_tt" data-ipara="unqulify">0</td><td class="yield_tt" data-ipara="yield">0%</td></tr></tbody></table>').appendTo(r.parent().next()),_.forOwn(g,function(t,a){if(-1==_.indexOf(["1","2","3","4","5","6"],a))return!0;r.parent().next().find("th").eq(a-1).text(a+"区间"),r.parent().next().find("td").eq(a-1).text(t+"个")});var y=r.parent().next();y.find("[class$='_tt']").each(function(){var t=$(this).data("ipara");$(this).text(currentDieItem[t])}),y.find("th").each(function(t){""==$(this).text().trim()&&($(this).text(t+1+"区间"),y.find("td").eq(t).text("0个"))})}function draw_other_chart(t){var a,e,i,r,o=t.chartType,n=t.classify,l=t.IDParamObj,s=t.paramsArr,d=t.data,c=t.curWaferId,p=t.errorArr,u=t.waferNO,h=l.id,f=l.param,m=(l.isAll,null);switch(n){case"CPK":if(_.find(_.find(d,function(t,a){return _.toString(a)==_.toString(f)}),function(t,a){return _.toString(a)==_.toString(u)}).length<20){var v=_.find(p,function(t,a){return"CPK图"==t.chartCNName});return _.isNil(v)?p.push({chartCNName:"CPK图",errorParamArr:[f],classify:n,message:"参数数据不足"}):v.errorParamArr.push(f),p}break;case"gaussiandistribution":var b=_.find(d,function(t,a){return _.toString(a)==_.toString(f)});if(-1<_.indexOf(_.keys(b),"status")){var g=_.find(p,function(t,a){return"高斯分布图"==t.chartCNName});return _.isNil(g)?p.push({chartCNName:"高斯分布图",errorParamArr:[f],classify:n,message:b.status}):g.errorParamArr.push(f),p}}switch(n){case"histogram":var y=_.find(d,function(t,a){return _.toString(a)==_.toString(f)});a="直方图-"+f,e={categories:_.map(y.sectionX,function(t,a){var e=t.split("~");return _.forEach(e,function(t,a,e){var i;i=-1<t.indexOf("∞")?t:8<t.length?numeral(t).format("0.0000e+0"):t,e[a]=i}),_.join(e,"~")}),type:"linear",labels:{rotation:-45},plotLines:[{color:"#FF0000",width:2,value:.5},{color:"#FF0000",width:2,value:y.sectionX.length-1.5}]},i={title:{text:"百分数"}};var D=[],S=_.find(y.percentList,function(t,a){return _.toString(a)==c});D.push({name:f+"频率分布",type:"column",data:_.map(S.percent,function(t){return parseFloat(t)})}),D.push({name:f+"频率累加",type:"line",data:_.map(S.proportion,function(t){return parseFloat(t)})}),r=D;break;case"boxlinediagram":a="箱线图-"+f,e={categories:[f],title:{text:"参数"}},i={title:{text:"值"}};var w=_.find(_.find(d,function(t,a){return _.toString(a)==_.toString(f)}),function(t,a){return _.toString(a)==_.toString(c)});r=[{name:"观测值",data:[w.eigenValue],tooltip:{headerFormat:"<em>参数： {point.key}</em><br/>"}},{name:"极端异常值",color:Highcharts.getOptions().colors[0],type:"scatter",data:w.extreme,marker:{fillColor:"white",lineWidth:1,lineColor:Highcharts.getOptions().colors[0]},tooltip:{pointFormat:"极端异常值: {point.y}"}},{name:"温和异常值",color:Highcharts.getOptions().colors[1],type:"scatter",data:w.soft,marker:{fillColor:"#ccc",lineWidth:1,lineColor:Highcharts.getOptions().colors[1]},tooltip:{pointFormat:"温和异常值: {point.y}"}}];break;case"CPK":a="CPK-"+f;var x={};x.name=f;var C=_.find(_.find(d,function(t,a){return _.toString(a)==_.toString(f)}),function(t,a){return _.toString(a)==_.toString(u)});x.data=_.map(C,function(t,a){var e=!0;return 1<Math.abs(parseFloat(t))&&(e=!1),_.toNumber(eouluGlobal.S_ComSCMRound(parseFloat(t),2,e))}),e={categories:_.reduce(C,function(t,a,e,i){return t.push(eouluGlobal.S_numToChineseSm(e+1)),t},[])},i={title:{text:"values"}},r=[x];break;case"gaussiandistribution":var M=_.find(d,function(t,a){return _.toString(a)==_.toString(f)});a="高斯分布图-"+f,e=[{categories:_.map(M.groupX,function(t){var a=!0;return 1<Math.abs(t)&&(a=!1),eouluGlobal.S_ComSCMRound(t,2,a)}),crosshair:!0,type:"linear"}],i=[{labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[1]}},title:{text:"频次",style:{color:Highcharts.getOptions().colors[1]}}},{title:{text:"正态分布",style:{color:Highcharts.getOptions().colors[0]}},labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[0]}},opposite:!0}],r=[{name:"频次",type:"column",data:M.frequency,tooltip:{valueSuffix:""}},{name:"正态分布",type:"spline",yAxis:1,data:M.density,tooltip:{valueSuffix:""}}],m=function(t){var a=$("#"+h).parent().next().find("tbody>tr");a.eq(0).children("td").eq(1).data("ivalue",M.median),a.eq(1).children("td").eq(1).data("ivalue",M.average),a.eq(2).children("td").eq(1).data("ivalue",M.max),a.eq(3).children("td").eq(1).data("ivalue",M.min),a.eq(5).children("td").eq(1).data("ivalue",M.expectation),a.eq(6).children("td").eq(1).data("ivalue",M.standard),a.eq(7).children("td").eq(1).data("ivalue",M.variance),a.find("td:nth-child(2)").each(function(t,a){if(4==t)return!0;var e=!0;1<Math.abs(parseFloat($(this).data("ivalue")))&&(e=!1);var i=eouluGlobal.S_ComSCMRound(parseFloat($(this).data("ivalue")),2,e);$(this).attr("title",$(this).data("ivalue")).text(i)})};break;default:a="良品率图";var L={name:"良品率",data:[]};_.forOwn(d,function(t,a){L.data[_.findIndex(s,function(t){return _.toString(t)==_.toString(a)})]=parseFloat(_.values(t)[0])}),e={categories:s},i={title:{text:"%"},min:0,max:110,tickInterval:10,labels:{formatter:function(){return this.value}}},r=[L]}return dataCompareRenderChart({container:h,chart:{type:o},title:{text:a},subtitle:{text:null},xAxis:e,yAxis:i,series:_.cloneDeep(r),chartClassify:n,callback:m}),p}function ajax_all_chart(t){var o=t.times,n=t.alltimes,l=t.whenArr,s=t.errorArr||[],d=l[o];$.ajax({type:"GET",url:d.chartAjaxUrl,data:{waferIdStr:$("body").data("waferid")},dataType:"json",beforeSend:function(){$("body").data("iglobalerror","allow"),$("#swal2-content").text("正在请求"+d.chartCNName+"数据，绘图进度 "+(o+1)+"/"+n)}}).then(function(e){if(_.isEmpty(e)||_.isNil(e))s.push({chartCNName:d.chartCNName,errorParamArr:[],classify:d.classify,message:"数据为空"});else{$("#parameterMap>div.panel[data-iallstatistics='"+d.classify+"']").fadeIn(100),$("#swal2-content").text("正在绘制"+d.chartCNName+"，绘图进度 "+(o+1)+"/"+n);var i,r=$("body").data("waferid");if(-1<["map_good_rate_distribution","map_color_order_distribution"].indexOf(d.classify)){var t=_.find(e,function(t,a){return _.toString(a)==_.toString(r)}).waferList;i=_.reduce(t,function(t,a,e){return t.push(a.parameter),t},[])}else i=_.keys(e),i=_.sortBy(i,function(t,a){return _.isNil(t.match(/\d+/))?0:_.toNumber(t.match(/\d+/)[0])});var a=buildParameterChartContainer({classify:d.classify,paramsArr:_.cloneDeep(i)});_.forEach(a,function(t,a){"map_good_rate_distribution"==d.classify?draw_map_good_rate({IDParamObj:t,data:_.cloneDeep(e),waferNO:r}):"map_color_order_distribution"==d.classify?draw_map_color_order_distribution({data:_.cloneDeep(e),IDParamObj:t,waferNO:r}):s=draw_other_chart({chartType:d.chartType,classify:d.classify,IDParamObj:t,paramsArr:i,data:_.cloneDeep(e),curWaferId:$("body").data("waferid").toString(),errorArr:s,waferNO:r})})}++o!=n?setTimeout(function(){ajax_all_chart({times:o,alltimes:n,whenArr:l,errorArr:s})},50):eouluGlobal.S_getSwalMixin()({title:"加载提示",text:"数据请求完成",type:"info",showConfirmButton:!1,timer:900}).then(function(){if(_.isEmpty(s))eouluGlobal.S_getSwalMixin()({title:"加载提示",text:"全部图表绘制完成",type:"success",showConfirmButton:!1,timer:1200});else{var i="部分图表绘制完成，以下图表请求/绘制失败";i+='<div class="container-fluid"><table class="table table-striped table-bordered table-hover table-condensed"><thead><tr><th style="font-size:14px;width: 80px;text-align:center;">图表名字</th><th style="font-size:14px;text-align:center;">参数及原因</th></tr></thead><tbody>',_.forEach(s,function(a){if(i+='<tr><td style="vertical-align: top;font-size:14px;width: 80px;">'+a.chartCNName+'</td><td style="vertical-align: top;font-size:14px;">',_.isEmpty(a.errorParamArr))i+=a.message,setTimeout(function(){$("div.panel.panel_"+a.classify).data("icontextual","danger").removeClass("panel-info panel-success panel-warning").addClass("panel-danger").children(".panel-heading").children("span.glyphicon").trigger("click")},20);else{var e=$("div.panel.panel_"+a.classify);e.data("icontextual","warning").removeClass("panel-info panel-success panel-danger").addClass("panel-warning"),_.forEach(a.errorParamArr,function(t){i+=t+"："+a.message+"<br/>",e.find(".panel-body div.panel[data-contextualparam='"+t+"']").data("icontextual","warning").children(".panel-heading").children("span.glyphicon").trigger("click")}),e.find(".panel-body div.panel[data-contextualparam]").length==a.errorParamArr.length&&e.children(".panel-heading").children("span.glyphicon").trigger("click")}i+="</td></tr>"}),i+="</tbody></table></div>",eouluGlobal.S_getSwalMixin()({title:"加载提示",html:i,showConfirmButton:!0})}$("body").data("iglobalerror","unallow"),dataListDetailStore.state.parameterMap.hasRender=!0})},function(){eouluGlobal.S_getSwalMixin()({title:"加载提示",text:d.chartCNName+"数据请求失败，请刷新页面或重新登录",type:"error",showConfirmButton:!1,timer:1800}).then(function(){$("body").data("iglobalerror","unallow")})}).always(function(){})}dataListDetailStore.mock=Object.create(null),dataListDetailStore.mock.allDetail={thead:{PassPercent:null,UpLimit:null,LowerLimit:null,Param:null},tbody:{},chunkTbodyData:null,chunkIndex:-1},dataListDetailStore.mock.allDetailThead=[],dataListDetailStore.mock.vectorMap={filterArr:[],waferAjaxData:null},dataListDetailStore.state=Object.create(null),dataListDetailStore.state={allDetail:{tbody:{scrollTop:0,scrollLeft:0}},vectorMap:{canKeydown:!1,coordsArray:new HashTable,waferMapObj:Object.create(null),curSelectedDie:Object.create(null),curveType:[],curCurveTypeNo:0,renderChartByCoordFlag:!1,smithObjArr:[],currentDieCoord:[]},parameterMap:{curChartContainerNum:0,hasRender:!1,ajaxLength:0},chartTypeMap:{map_good_rate_distribution:null,map_color_order_distribution:null,good_rate:"spline",histogram:"column",boxlinediagram:"boxplot",CPK:"line",gaussiandistribution:"gaussiandistribution"},chartAjaxUrlMap:{map_good_rate_distribution:"WaferMap",map_color_order_distribution:"ColorMap",good_rate:"ShowYield",histogram:"Histogram",boxlinediagram:"Boxplot",CPK:"CPKServlet",gaussiandistribution:"GaussianDistribution"},chartCNNameMap:{map_good_rate_distribution:"Map良率分布",map_color_order_distribution:"Map色阶分布",good_rate:"良品率图",histogram:"直方图",boxlinediagram:"箱线图",CPK:"CPK图",gaussiandistribution:"高斯分布图"},authorityJQDomMap:{"管理员":[$(".g_info_r .AdminOperat")],"导出":[$("div.webParam button")],"矢量数据":[$(".g_menu li[role='presentation'][data-iclassify='vectorMap']")],"参数分布":[$(".g_menu li[role='presentation'][data-iclassify='parameterMap']")]},authorityNull:!1,scrollBarWidth:_.get(eouluGlobal.S_getPageAllConfig(),"futureDT2.scrollBarWidth",7)},$(".tab-content div[role='tabpanel']").innerWidth($(".tab-content").innerWidth()).innerHeight($(".tab-content").innerHeight()),$(".vectorMap_l, .vectorMap_r").innerHeight($("#vectorMap").innerHeight()),eouluGlobal.S_getSwalMixin()({title:"加载提示",text:"正在加载数据",type:"info",showConfirmButton:!1}),$(function(){if(eouluGlobal.C_pageAuthorityCommonHandler({authorityJQDomMap:_.cloneDeep(dataListDetailStore.state.authorityJQDomMap),callback:function(){if(0==$(".g_menu li[role='presentation'][data-iclassify]:visible").length)return eouluGlobal.S_getSwalMixin()({title:"权限判断提示",text:"权限不足，请先申请",type:"error",showConfirmButton:!1,timer:2e3}).then(function(){eouluGlobal.S_settingURLParam({},!1,!1,!1,"DataList")}),!(dataListDetailStore.state.authorityNull=!0);0==$(".g_menu li[role='presentation'][data-iclassify]:visible.active").length?$(".g_menu li[role='presentation'][data-iclassify]:visible:not(.active)").eq(0).children("a").trigger("click"):setTimeout(function(){swal.close()},300)}}),!0!==dataListDetailStore.state.authorityNull){setTimeout(function(){getTableDataANDRender()},50);var t,a,e=eouluGlobal.S_getUrlPrmt().webParam,i=t=_.isNil(e)?"晶圆信息获取失败!":"晶圆信息："+(a=e.split("futureDT2OnlineDataListSplitor"))[0]+" / "+a[1]+" / "+a[2]+" / "+a[3];80<t.length&&(t=t.substr(0,80)+"..."),t+='<button type="button" class="btn btn-default" aria-label="Left Align"><span class="glyphicon glyphicon-export" aria-hidden="true"></span> 导出</button>',$("div.webParam").html(t).attr("title",i);var r=eouluGlobal.S_getUrlPrmt().waferId,o=eouluGlobal.S_getUrlPrmt().dataFormat;if(_.isNil(r)||_.isNil(o))return eouluGlobal.S_getSwalMixin()({title:"异常",text:"参数不完整",type:"warning",showConfirmButton:!1,timer:1500}).then(function(t){t.dismiss!=swal.DismissReason.backdrop&&t.dismiss!=swal.DismissReason.esc&&t.dismiss!=swal.DismissReason.timer||eouluGlobal.S_settingURLParam({},!1,!1,!1,"DataList")}),!1;$("body").data({waferid:r,dataformat:o}),_.forEach(dataListDetailStore.state.vectorMap.curveType,function(t){buildChartContainer(t)}),_.forEach(_.compact([a[3]]),function(t,a){$("#DieTypeSel").append('<option value="'+t+'">'+t+"</option>")}),calcCoordImgWH()}}),$(window).on("resize",_.debounce(commonCalcLayout,150)),$(window).on("resize",_.debounce(function(){_.forEach(dataListDetailStore.state.vectorMap.smithObjArr,function(t,a,e){e[a].onresize()}),calcCoordImgWH()},150)),$(".allDetail_body .table_body").on("scroll",_.debounce(function(){dataListDetailStore.state.allDetail.tbody.scrollTop-1<$(this).scrollTop()&&dataListDetailStore.state.allDetail.tbody.scrollTop+1>$(this).scrollTop()?$(".allDetail_body .table_head").scrollLeft($(this).scrollLeft()):$(this).scrollTop()>dataListDetailStore.state.allDetail.tbody.scrollTop+1&&$(this).scrollTop()>.95*($(".allDetail_body .table_body table").innerHeight()-$(".allDetail_body .table_body").innerHeight())&&renderSignalTbodyData(),dataListDetailStore.state.allDetail.tbody.scrollTop=$(this).scrollTop(),dataListDetailStore.state.allDetail.tbody.scrollLeft=$(this).scrollLeft()},100)),$(document).on("click","div.webParam button",function(){var t,a=$("body").data("webparam");if(_.isNil(a))return eouluGlobal.S_getSwalMixin()({title:"异常",text:"参数不完整",type:"warning",showConfirmButton:!1,timer:1500}),!1;t=a.split("futureDT2OnlineDataListSplitor")[2];var i=$(this);eouluGlobal.C_btnDisabled(i,!1),eouluGlobal.S_XHR({status200:function(t){console.log(t),t=t.replace("#","%23"),window.location.href=t},statusError:function(t,a){eouluGlobal.C_server500Message({callback:null})},readyState4:function(t,a,e){eouluGlobal.C_btnAbled(i,!1)},type:"GET",getObject:{url:"ExportWafer",data:{waferId:$("body").data("waferid"),dataFormat:$("body").data("dataformat"),waferNO:t},isObject:!0,responseType:"text"}})}),$(document).on("click",".vectorMap_l div.panel-heading>span.glyphicon:not(.glyphicon-ok), #parameterMap div.panel-heading>span.glyphicon:not(.glyphicon-ok)",function(){$(this).toggleClass("glyphicon-menu-down glyphicon-menu-right");var t=$(this).parent().parent();if($(this).hasClass("glyphicon-menu-right")){$(this).parent().next().slideUp(200),t.removeClass("panel-warning panel-danger panel-info");var a=t.data("icontextual");_.isNil(a)||_.isEmpty(a)?t.addClass("panel-success"):t.addClass("panel-"+a)}else $(this).parent().next().slideDown(200),t.removeClass("panel-warning panel-danger panel-success").addClass("panel-info")}),$(document).on("shown.bs.tab",'div.g_menu a[data-toggle="tab"]',function(t){var a=$(t.target).attr("aria-controls");"parameterMap"!=a||dataListDetailStore.state.parameterMap.hasRender?"allDetail"==a?_.debounce(commonCalcLayout,150)():"vectorMap"!=a||dataListDetailStore.state.vectorMap.renderChartByCoordFlag||$.ajax({type:"GET",url:"VectorMap",data:{waferId:$("body").data("waferid")},dataType:"json"}).then(function(t){console.log("data",t),dataListDetailStore.mock.vectorMap.waferAjaxData=_.cloneDeep(t),dataListDetailStore.mock.vectorMap.filterArr=[],_.forEach(_.compact(t.subdie),function(t,a){$("#SubdieSel").append('<option value="'+t+'">'+t+"</option>")}),_.forEach(_.compact(t.deviceGroup),function(t,a){$("#GroupSel").append('<option value="'+t+'">'+t+"</option>")}),renderVectorMapWafer({mapInfo:t.mapInfo}),getIDByCoordANDRequ({callback:null,ajaxCallback:function(){setTimeout(function(){swal.close()},1500)}}),dataListDetailStore.state.vectorMap.renderChartByCoordFlag=!0},function(){}):($("#parameterMap>div.panel").hide(),eouluGlobal.S_getSwalMixin()({title:"加载数据",text:"正在绘图中......",type:"info",showConfirmButton:!1,showCancelButton:!1}),setTimeout(function(){var n=[];$("#parameterMap>div.panel").each(function(t,a){var e=$(a).data("iallstatistics"),i=_.find(dataListDetailStore.state.chartTypeMap,function(t,a){return a==e}),r=_.find(dataListDetailStore.state.chartAjaxUrlMap,function(t,a){return a==e}),o=_.find(dataListDetailStore.state.chartCNNameMap,function(t,a){return a==e});n.push({chartType:i,chartAjaxUrl:r,chartCNName:o,classify:e})}),ajax_all_chart({times:0,alltimes:n.length,whenArr:_.cloneDeep(n)})},50))}),$(document).on("click","#filterMap",function(t){t.stopPropagation(),eouluGlobal.S_getSwalMixin()({title:"加载数据",text:"正在请求过滤后Map数据...",type:"info",showConfirmButton:!1,showCancelButton:!1});var a={},e=$("#SubdieSel").val(),i=$("#GroupSel").val(),r=$("#DieTypeSel").val();(_.isNil(e)||"AllSubdie"==e)&&(e=void 0),(_.isNil(i)||"AllGroup"==i)&&(i=void 0),(_.isNil(r)||"AllDieType"==r)&&(r=void 0),a.waferId=$("body").data("waferid"),a.subdie=e,a.deviceGroup=i,a.dieType=r,$.ajax({type:"GET",url:"VectorMapFilter",data:a,dataType:"json"}).then(function(t){if(_.isNil(t)||_.isEmpty(t));else{$("#swal2-content").text("请求Map数据完成，正在请求曲线数据...");var a=$("div.vectorMap_l").scrollTop();dataListDetailStore.mock.vectorMap.filterArr=_.keys(t.currentDieList),renderVectorMapWafer({mapInfo:dataListDetailStore.mock.vectorMap.waferAjaxData.mapInfo}),getIDByCoordANDRequ({callback:null,ajaxCallback:function(){setTimeout(function(){swal.close(),$("div.vectorMap_l").scrollTop(a)},1500)}})}})}),$.contextMenu({selector:"div.vectorMap_l div.panel[data-dbcurveandsmith]>.panel-body",callback:function(t,a){alert(t+"图功能正在开发")},items:{Smith:{name:"Smith",icon:""},Polar:{name:"Polar",icon:""},XYOfPhase:{name:"XYOfPhase",icon:""},XYOfMagnitude:{name:"XYOfMagnitude",icon:""},XYdBOfMagnitude:{name:"XYdBOfMagnitude",icon:""}}});