var projectAnalysisSwalMixin=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"}),projectAnalysisState=new Object;function projectAnalysisRenderData(r){var a=$("#search_input").val().trim();$.ajax({url:"DataListAjax",type:"GET",data:{currentPage:r,keyword:a},dataType:"json",async:!1,success:function(t){console.log("data",t);var i="";t.waferInfo.map(function(t,e,a){var n=t.wafer_id,o=t.test_operator?t.test_operator:"";i+='<tr><td class="not_search"><input type="checkbox" data-ivalue="'+n+'"></td><td class="product_category" data-itext="'+t.product_category+'">'+t.product_category+'</td><td class="device_number" data-itext="'+t.device_number+'">'+t.device_number+'</td><td class="lot_number" data-itext="'+t.lot_number+'">'+t.lot_number+'</td><td class="wafer_number" data-itext="'+t.wafer_number+'">'+t.wafer_number+'</td><td class="die_type" data-itext="'+t.die_type+'">'+t.die_type+'</td><td class="qualified_rate" data-itext="'+t.qualified_rate+'">'+t.qualified_rate+'</td><td class="test_end_date" data-itext="'+t.test_end_date+'">'+t.test_end_date+'</td><td class="test_operator" data-itext="'+o+'">'+o+'</td><td class="description" data-itext="'+t.description+'">'+t.description+'</td><td class="data_format" data-itext="'+t.data_format+'" style="display:none;">'+t.data_format+'</td><td class="data_trash not_search"   data-page="'+r+'" ><img src="assets/img/common/del_24px.svg"  data-iicon="glyphicon-remove" alt="删除" title="删除" ></td></tr>'}),$(".g_bodyin_bodyin_body tbody").empty().append(i),projectAnalysisState.pageObj.pageCount=t.totalPage,projectAnalysisState.pageObj.itemLength=t.totalCount,projectAnalysisState.pageObj.data=t.waferInfo,console.log("searchVal",projectAnalysisState.sellectObj),projectAnalysisState.searchObj.hasSearch?(projectAnalysisState.searchObj.searchVal=a,$(".g_bodyin_body_top  tbody [type='checkbox']").each(function(){-1<_.indexOf(projectAnalysisState.sellectObj.selectItem,$(this).data("ivalue").toString())&&$(this).prop("checked",!0).parent().parent().addClass("warning").removeClass("info")}),$(".g_bodyin_body_top  tbody td:not(.not_search)").each(function(){var t=$(this).text(),e="<b style='color:red'>"+projectAnalysisState.searchObj.searchVal+"</b>",a=t.replace(new RegExp(projectAnalysisState.searchObj.searchVal,"g"),e);$(this).empty().html(a)})):$(".g_bodyin_body_top  tbody [type='checkbox']").each(function(){-1<_.indexOf(projectAnalysisState.sellectObj.selectItem,$(this).data("ivalue").toString())&&$(this).prop("checked",!0).parent().parent().addClass("warning").removeClass("info")}),$("#checkAll").prop("checked",projectAnalysisState.pageObj.itemLength==projectAnalysisState.sellectObj.selectItem.length),projectAnalysisState.curPageSelectAll={};for(var e=0;e<t.totalPage;e++)projectAnalysisState.curPageSelectAll[e+1]=!1},error:function(t,e,a){projectAnalysisSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}function SaveSelectedToLocal(){for(var t=[],e=[],a=0;a<$(".g_bodyin_body_bottom  tbody  tr input[type='checkbox']").length;a++)t.push($(".g_bodyin_body_bottom  tbody  tr input[type='checkbox']").eq(a).data("ivalue")),e.push($(".g_bodyin_body_bottom  tbody  tr input[type='checkbox']").eq(a).parent().parent().html());localStorage.setItem("eoulu_projectAnalysis_select_id",t.join(",")),localStorage.setItem("eoulu_projectAnalysis_select_item",e.join("ee_&oo&_uu"))}function GetSelectedFromLocal(){var t=localStorage.getItem("eoulu_projectAnalysis_select_item"),e=localStorage.getItem("eoulu_projectAnalysis_select_id");if(t&&""!=t)t.split("ee_&oo&_uu"),e.split(",")}function analyzeBtn(){$(".g_body_rr_body_item.active").length?$(".g_body_rr_body_btn>input").prop("disabled",!1):$(".g_body_rr_body_btn>input").prop("disabled",!0)}function bottomTableANDAnalyzeBtn(){console.log("len",projectAnalysisState.sellectObj.selectItem.length),0==projectAnalysisState.sellectObj.selectItem.length?($(".g_bodyin_body_bottom tbody").css("border-bottom","0px solid #fff"),$(".g_body_rr_body_btn>input").prop("disabled",!0)):analyzeBtn()}projectAnalysisState.paginationObj={normal:null,search:null},projectAnalysisState.pageObj={selector:null,pageOption:null,currentPage:null,pageCount:null,itemLength:null,data:null},projectAnalysisState.pageSearchObj={selector:"#pagelist",pageOption:{limit:10,count:0,curr:0,ellipsis:!0,pageShow:2,hash:!1,callback:function(t){projectAnalysisState.pageSearchObj.currentPage=t.curr,t.isFirst}},currentPage:null,pageCount:null,itemLength:null,data:null},projectAnalysisState.searchObj={hasSearch:!1,searchVal:null,searchItem:[]},projectAnalysisState.sellectObj={selectAll:!1,selectItem:[],selectSearchItem:[]},$(".g_info_m_in").hide(),$(".g_bodyin_body_top").innerHeight($(".g_bodyin_body").height()/2),$(".g_bodyin_body_bottom").innerHeight($(".g_bodyin_body").height()/2-10),$(function(){$(window).on("resize",function(){$(".g_bodyin_body_top").height($(".g_bodyin_body").height()/2),$(".g_bodyin_body_bottom").height($(".g_bodyin_body").height()/2-30)}),$(".breadcrumb li:eq(0) a ").attr("href","./HomeInterface"),projectAnalysisRenderData(1),projectAnalysisState.pageObj.selector="#pagelist",projectAnalysisState.pageObj.pageOption={limit:10,count:projectAnalysisState.pageObj.itemLength,curr:1,ellipsis:!0,pageShow:2,hash:!1,callback:function(t){projectAnalysisState.pageObj.currentPage=t.curr,t.isFirst||projectAnalysisRenderData(projectAnalysisState.pageObj.currentPage)}},projectAnalysisState.paginationObj.normal=new Pagination(projectAnalysisState.pageObj.selector,projectAnalysisState.pageObj.pageOption)}),$(".g_info_m_in .form-control-feedback").click(function(){$(this).prev().children("input").val("")}),$(".g_info_r>.glyphicon-search").click(function(){var t=$(".g_info_m").innerWidth();$(this).css("position","relative").animate({left:-(t/2+20)+"px"},500,"swing",function(){$(this).fadeOut(200,function(){$(".g_info_m_in").fadeIn(200).fadeTo(1,1)})})}),$(".g_info_m_in span.input-group-addon").click(function(){$(".g_info_m_in").fadeTo(0,200,function(){$(this).fadeOut(200),$(".g_info_r>.glyphicon-search").fadeIn(100).animate({left:"0px"},600,"swing",function(){$(this).css("position","static")})})}),$("#search_input").on("input propertychange change",function(){""!=$(this).val().trim()?$(this).parent().parent().next().removeClass("btn-default").addClass("btn-primary").prop("disabled",!1):($(this).val(""),$(this).parent().parent().next().removeClass("btn-primary").addClass("btn-default").prop("disabled",!0))}).on("keyup",function(t){13==(t.keyCode||t.which||t.charCode)&&""!=$(this).val().trim()&&$(this).parent().parent().next().trigger("click")}),$(document).on("mouseover",".g_bodyin_body_top  td",function(){$(this).addClass("warning").parent().addClass("info")}).on("mouseout",".g_bodyin_body_top  td",function(){$(this).removeClass("warning").parent().removeClass("info")}).on("click",".g_bodyin_body_top  td",function(){var e=$(this),t=e.parent().find("input[type='checkbox']").data("ivalue").toString();$.ajax({url:"Examine",type:"GET",data:{waferId:t},dataType:"json",success:function(t){if(!t)return projectAnalysisSwalMixin({title:"提示",text:"无数据，不能访问",type:"warning",showConfirmButton:!1,timer:2e3}),!1;e.parent().toggleClass("warning info").find("[type='checkbox']").prop("checked",!e.parent().find("[type='checkbox']").prop("checked")).change()},error:function(t,e,a){projectAnalysisSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}).on("click",".g_bodyin_body_top  tbody [type='checkbox']",function(t){t.stopPropagation(),$(this).parent().parent().toggleClass("warning info")}).on("change",".g_bodyin_body_top  tbody [type='checkbox']",function(){var t=$(this).data("ivalue").toString(),e=!0;if($(this).prop("checked")){if($.ajax({url:"Examine",type:"GET",data:{waferId:t},dataType:"json",async:!1,success:function(t){e=t},error:function(t,e,a){projectAnalysisSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}}),!e)return $(this).prop("checked",!1),projectAnalysisSwalMixin({title:"提示",text:"无数据，不能访问",type:"warning",showConfirmButton:!1,timer:2e3}),!1;projectAnalysisState.sellectObj.selectItem.push(t),projectAnalysisState.searchObj.hasSearch&&projectAnalysisState.sellectObj.selectSearchItem.push(t),$(".g_bodyin_body_bottom tbody>tr [type='checkbox'][data-ivalue='"+Number(t)+"']").parent().parent().remove(),$(".g_bodyin_body_bottom tbody").append($(this).parent().parent().clone()),$(".g_bodyin_body_bottom tbody tr, .g_bodyin_body_bottom tbody td").removeClass("info warning")}else _.pull(projectAnalysisState.sellectObj.selectItem,t),projectAnalysisState.searchObj.hasSearch&&_.pull(projectAnalysisState.sellectObj.selectSearchItem,t),$(".g_bodyin_body_bottom tbody [type='checkbox'][data-ivalue='"+Number(t)+"']").parent().parent().remove(),projectAnalysisState.curPageSelectAll[projectAnalysisState.pageObj.currentPage]=!1;projectAnalysisState.sellectObj.selectItem=_.uniq(projectAnalysisState.sellectObj.selectItem),projectAnalysisState.sellectObj.selectSearchItem=_.uniq(projectAnalysisState.sellectObj.selectSearchItem),$("#checkAll").prop("checked",$(".g_bodyin_body_top  tbody tr.warning").length==$(".g_bodyin_body_top  tbody tr").length),projectAnalysisState.sellectObj.selectAll=$("#checkAll").prop("checked"),bottomTableANDAnalyzeBtn(),SaveSelectedToLocal()}),$("#checkAll").on({click:function(){var o=projectAnalysisState.pageObj.currentPage,t=$(this);if(projectAnalysisState.curPageSelectAll[o])t.prop("checked",!1),projectAnalysisState.curPageSelectAll[o]=!1,$(".g_bodyin_body_top  tbody tr.warning").each(function(){-1<_.indexOf(projectAnalysisState.sellectObj.selectItem,$(this).find("input[type='checkbox']").data("ivalue").toString())&&(projectAnalysisState.sellectObj.selectItem.splice(projectAnalysisState.sellectObj.selectItem.indexOf($(this).find("input[type='checkbox']").data("ivalue").toString()),1),$(".g_bodyin_body_bottom tbody>tr  input[data-ivalue ='"+$(this).find("input[type='checkbox']").data("ivalue")+"']").parent().parent().remove(),$(this).removeClass("warning info").find("input[type='checkbox']").prop("checked",!1))});else{projectAnalysisState.curPageSelectAll[o]=!0;var i=0,r=[];if($(".g_bodyin_body_top  tbody [type='checkbox']").each(function(){var t=$(this).data("ivalue"),n=$(this);$.ajax({url:"Examine",type:"GET",data:{waferId:t},dataType:"json",async:!1,success:function(t){var e=n.parent().parent();if(t){if(_.indexOf(projectAnalysisState.sellectObj.selectItem,n.data("ivalue").toString())<0){n.prop("checked",!0),n.parent().parent().removeClass("info").addClass("warning"),i++,projectAnalysisState.sellectObj.selectItem.push(n.data("ivalue").toString());var a='<tr><td class="not_search"><input type="checkbox" data-ivalue="'+e.find("input[type='checkbox']").data("ivalue")+'"></td><td class="product_category" data-itext="'+e.find(".product_category").text()+'">'+e.find(".product_category").text()+'</td><td class="device_number" data-itext="'+e.find(".device_number").text()+'">'+e.find(".device_number").text()+'</td><td class="lot_number" data-itext="'+e.find(".lot_number").text()+'">'+e.find(".lot_number").text()+'</td><td class="wafer_number" data-itext="'+e.find(".wafer_number").text()+'">'+e.find(".wafer_number").text()+'</td><td class="die_type" data-itext="'+e.find(".die_type").text()+'">'+e.find(".die_type").text()+'</td><td class="qualified_rate" data-itext="'+e.find(".qualified_rate").text()+'">'+e.find(".qualified_rate").text()+'</td><td class="test_end_date" data-itext="'+e.find(".test_end_date").text()+'">'+e.find(".test_end_date").text()+'</td><td class="test_operator" data-itext="'+e.find(".test_operator").text()+'">'+e.find(".test_operator").text()+'</td><td class="description" data-itext="'+e.find(".description").text()+'">'+e.find(".description").text()+'</td><td class="data_format" data-itext="'+e.find(".data_format").text()+'" style="display:none;">'+e.find(".data_format").text()+'</td><td  class="data_trash" data-page="'+o+'"><img src="assets/img/common/del_24px.svg"  data-iicon="glyphicon-remove" alt="删除" title="删除" ></td></tr>';$(".g_bodyin_body_bottom tbody>tr").length?$(".g_bodyin_body_bottom tbody>tr:first").before(a):$(".g_bodyin_body_bottom tbody").append(a)}}else r.push([e.find(".wafer_number").text(),e.find(".die_type").text()])},error:function(t,e,a){projectAnalysisSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}),!_.isEmpty(r)){var e="";e+='<div class="container-fluid"><table class="table table-striped table-bordered table-hover table-condensed"><thead><tr><th style="font-size:14px;width: 80px;text-align:center;">无数据晶圆</th></tr></thead><tbody>';for(var a=0;a<r.length;a++)e+='<tr><td style="vertical-align: top;font-size:14px;">'+r[a][0]+" : "+r[a][1]+"</td></tr>";e+="</tbody></table></div>",eouluGlobal.S_getSwalMixin()({title:"当前页部分晶圆无数据",html:e,showConfirmButton:!0})}t.prop("checked",i==$(".g_bodyin_body_top  tbody tr").length)}projectAnalysisState.sellectObj.selectAll=t.prop("checked"),bottomTableANDAnalyzeBtn(),SaveSelectedToLocal()}}),$(document).on("click",".g_bodyin_body_bottom  .data_trash",function(){var e=$(this).parent().find("input[type='checkbox']").data("ivalue").toString();$(".g_bodyin_body_top tr input[type='checkbox'][data-ivalue='"+e+"']").prop("checked",!1).parent().parent().removeClass("warning"),_.remove(projectAnalysisState.sellectObj.selectItem,function(t){return t==e}),$("#checkAll").prop("checked",!1),projectAnalysisState.sellectObj.selectAll=$("#checkAll").prop("checked"),$(this).parent().remove(),projectAnalysisState.curPageSelectAll[$(this).data("page")]=!1,bottomTableANDAnalyzeBtn(),SaveSelectedToLocal()}),$(document).on("dblclick",".g_bodyin_body_bottom .g_bodyin_body_bottom_del_all",function(){$(".g_bodyin_body_top .warning").removeClass("warning").find("input[type='checkbox']").prop("checked",!1),projectAnalysisState.sellectObj.selectItem=[],$("#checkAll").prop("checked",!1),projectAnalysisState.sellectObj.selectAll=$("#checkAll").prop("checked"),$(".g_bodyin_body_bottom tbody").empty(),_.forOwn(projectAnalysisState.curPageSelectAll,function(t,e){projectAnalysisState.curPageSelectAll[e]=!1}),bottomTableANDAnalyzeBtn(),SaveSelectedToLocal()}),$("#search_button").on("click",function(){$("#checkAll").prop("checked",!1),projectAnalysisState.sellectObj.selectSearchItem=[];var t=$("#search_input").val().trim();return projectAnalysisState.searchObj.hasSearch=""!=t,projectAnalysisState.searchObj.searchVal=1==projectAnalysisState.searchObj.hasSearch?t:null,projectAnalysisRenderData(1),projectAnalysisState.searchObj.hasSearch?(projectAnalysisState.pageSearchObj.currentPage=1,projectAnalysisState.pageSearchObj.pageOption.curr=1,projectAnalysisState.pageSearchObj.pageOption.count=projectAnalysisState.pageSearchObj.itemLength,$("ol#pagelist").remove(),$("span.futureDT2_page_span").before('<ol class="pagination" id="pagelist"></ol>'),projectAnalysisState.paginationObj.search=new Pagination(projectAnalysisState.pageSearchObj.selector,projectAnalysisState.pageSearchObj.pageOption)):(projectAnalysisState.pageObj.pageOption.curr=1,projectAnalysisState.pageObj.pageOption.count=projectAnalysisState.pageObj.itemLength,$("ol#pagelist").remove(),$("span.futureDT2_page_span").before('<ol class="pagination" id="pagelist"></ol>'),projectAnalysisState.paginationObj.normal=new Pagination(projectAnalysisState.pageObj.selector,projectAnalysisState.pageObj.pageOption)),!1}),$("#jumpText").on("input propertychange",function(){$(this).val($(this).val().replace(/[^\d]/g,""))}),$("#jumpPage").on("click",function(){var t=Number($("#jumpText").val()),e=Number(projectAnalysisState.pageObj.currentPage),a=Number(projectAnalysisState.pageObj.pageCount);projectAnalysisState.searchObj.hasSearch&&(e=Number(projectAnalysisState.pageSearchObj.currentPage),a=Number(projectAnalysisState.pageSearchObj.pageCount)),e==t||t<=0||a<t?$("#jumpText").val(""):projectAnalysisState.searchObj.hasSearch?(projectAnalysisState.pageSearchObj.pageOption.curr=t,projectAnalysisState.paginationObj.search.goPage(t),projectAnalysisState.paginationObj.search.renderPages(),projectAnalysisRenderData(projectAnalysisState.paginationObj.search.options.curr=t)):(projectAnalysisState.pageObj.pageOption.curr=t,projectAnalysisState.paginationObj.normal.goPage(t),projectAnalysisState.paginationObj.normal.renderPages(),projectAnalysisRenderData(projectAnalysisState.paginationObj.normal.options.curr=t))}),$(".g_info_r>.glyphicon-user").click(function(){window.location.assign("admin.html")}),$(".g_body_rr_body_item").click(function(){if(0==projectAnalysisState.sellectObj.selectItem.length)return $(".g_body_rr_body_btn>input").prop("disabled",!0),!1;$(this).toggleClass("active").siblings(".g_body_rr_body_item").removeClass("active"),$(this).children("span").toggleClass("glyphicon-menu-right glyphicon-menu-down"),$(this).siblings(".g_body_rr_body_item").children("span").removeClass("glyphicon-menu-down").addClass("glyphicon-menu-right");var t=$(this).hasClass("active")?$(this).children(".g_body_rr_body_itemin").innerHeight():0;$(this).innerHeight(50+t),$(this).siblings(".g_body_rr_body_item").innerHeight(50),analyzeBtn()}),$(".g_body_rr_body_itemin").click(function(t){t.stopPropagation()}),$(".g_body_rr_body_btn>input").click(function(){for(var t=$(".g_body_rr_body_item.active").find(".g_body_rr_body_itemin>div").text(),e=[],a=[],n=0;n<$(".g_bodyin_body_bottom tbody tr").length;n++)e.push($(".g_bodyin_body_bottom tbody tr").eq(n).find("input[type='checkbox']").data("ivalue")),a.push($(".g_bodyin_body_bottom tbody tr").eq(n).find(".wafer_number").data("itext"));$.ajax({url:"ProjectVerification",type:"GET",data:{classify:t,waferId:e,waferNO:a},dataType:"json",success:function(t){"success"==t?eouluGlobal.S_settingURLParam({wafer:e},!1,!1,!1,"Analysis"):projectAnalysisSwalMixin({title:"异常",text:t,type:"error",showConfirmButton:!1,timer:2e3})},error:function(t,e,a){projectAnalysisSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})});