var dataStatisticsSwalMixin=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"}),dataStatisticsState=new Object;function eleResize(){var t=$(window).height();t<600&&(t=600),$("body").height(t),$(".g_bodyin_bodyin_bottom").innerHeight(t-150),$(".g_bodyin_bodyin_bottom_l, .g_bodyin_bodyin_bottom_r").innerHeight(t-150)}function eleResize2(){$(".g_bodyin_bodyin_bottom_lsub, .g_bodyin_bodyin_bottom_rsub").height($(".g_bodyin_bodyin_bottom").height()),$(".g_bodyin_bodyin_bottom_lsub_top, .g_bodyin_bodyin_bottom_lsub_mid").innerHeight(($(".g_bodyin_bodyin_bottom_lsub").innerHeight()-46)/2)}function renderSelectCsv(t,i,a,o){for(var n="",e=0;e<t.length;e++)n+='<div class="g_bodyin_bodyin_bottom_l'+i+'_item"><div class="g_bodyin_bodyin_bottom_l'+i+'_itemin"><div class="g_bodyin_bodyin_bottom_l'+i+'_itemin_main " data-icsv="'+t[e]+'"  data-iwaferid="'+o[e]+'">'+t[e]+"</div></div></div>";a.empty().append(n)}function renderChartCsvANDParam(o){console.log("objP",o);var n="",t=$(".g_bodyin_bodyin_bottom_1 .g_bodyin_bodyin_bottom_l_inbottom .list-group .list-group-item");if("csv"==o.classify)o.csv.map(function(t,i){var a=$(".g_bodyin_bodyin_bottom_l_intop .g_bodyin_bodyin_bottom_l_itemin_main[data-icsv='"+t+"'] ").data("iwaferid");n+='<div class="g_bodyin_bodyin_bottom_l'+o.flag+'_item"><div class="g_bodyin_bodyin_bottom_l'+o.flag+'_itemin"><div class="g_bodyin_bodyin_bottom_l'+o.flag+'_itemin_main" data-iwaferid="'+a+'">'+t+"</div></div></div>"});else if("table"==o.classify){n+='<table class="table table-striped table-bordered table-hover table-condensed"><thead><tr><th>参数名称</th><th>下限</th><th>上限</th><th>等分数</th></tr></thead><tbody>';for(var i=0;i<t.length;i++){var a=-1<_.indexOf(o.param,t.eq(i).data("iparam"))?"info":"",e=o.ishowchart+String(dataStatisticsState.stateObj.chartRenderCurID++);n+='<tr class="'+a+'" data-chartcurid="'+e+'" data-ishowchartparam="'+t.eq(i).data("iparam")+'"><td  class="g_bodyin_bodyin_bottom_lsub_mid_iparam" title="'+t.eq(i).data("iparam")+'">'+t.eq(i).data("iparam")+'</td><td class="g_bodyin_bodyin_bottom_lsub_mid_min" title="'+t.eq(i).data("min")+'"><input type="text" value="'+t.eq(i).data("min")+'" ></td><td class="g_bodyin_bodyin_bottom_lsub_mid_max" title="'+t.eq(i).data("max")+'"><input type="text" value="'+t.eq(i).data("max")+'" ></td><td class="g_bodyin_bodyin_bottom_lsub_mid_equal"  title="8"><input type="text" value="8"></td></tr>'}n+="</tbody></table>"}else if("ul"==o.classify){n+='<ul class="list-group">';for(i=0;i<t.length;i++){a=-1<_.indexOf(o.param,t.eq(i).data("iparam"))?"list-group-item-info info":"";console.log(a);var d=o.ishowchart+String(dataStatisticsState.stateObj.chartRenderCurID++);n+='<li class="list-group-item '+a+'" data-chartcurid="'+d+'" data-min="'+t.eq(i).data("min")+'" data-max="'+t.eq(i).data("max")+'" data-ishowchartparam="'+t.eq(i).data("iparam")+'"><span class="badge">参数</span>'+t.eq(i).data("iparam")+"</li>"}n+="</ul>"}o.insertDOM.empty().append(n)}function renderParam(t){if(""!=t){var o="";$.ajax({type:"GET",url:"WaferParameter",data:{waferIdStr:t},dataType:"json",success:function(a){if(0==a.paramList.length)return $(".g_bodyin_bodyin_bottom_r .thumbnail").addClass("cannotclick"),void $(".g_bodyin_bodyin_bottom_l_inbottom>.list-group").empty();a.paramList.length<2&&$(".g_bodyin_bodyin_bottom_r .thumbnail[data-ichart='correlationgraph']").addClass("cannotclick"),_.forOwn(a.paramList,function(t,i){o+='<a href="javascript:;" class="list-group-item" data-iparam="'+t+'" data-iparam="'+t+'" data-min="'+a.rangeList[t][0]+'" data-max="'+a.rangeList[t][1]+'">'+t+"</a>"}),$(".g_bodyin_bodyin_bottom_l_inbottom>.list-group").empty().append(o),$(".g_bodyin_bodyin_bottom_r .thumbnail").removeClass("cannotclick")},error:function(){dataStatisticsSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}else $(".g_bodyin_bodyin_bottom_l_inbottom>.list-group").empty()}dataStatisticsState.csvANDparamSelected={csv:[],param:[]},dataStatisticsState.stateObj={renderSelectCsvSub:!1,chartValidate:{histogram:{csvLen:"+",paramLen:1},boxlinediagram:{csvLen:"+",paramLen:1},CPK:{csvLen:1,paramLen:1},wafermap:{csvLen:"+",paramLen:1},gaussiandistribution:{csvLen:"+",paramLen:1}},chartRenderCurID:0,curChartContainerNum:0},dataStatisticsState.chartMap={histogram:"column",boxlinediagram:"boxplot",CPK:"line",correlationgraph:"scatter",gaussiandistribution:"gaussiandistribution",wafermap:"wafermap"},dataStatisticsState.ajaxurl={histogram:"Histogram",boxlinediagram:"Boxplot",CPK:"CPKServlet",correlationgraph:"Correlation",gaussiandistribution:"GaussianDistribution",wafermap:"ColorMap"},dataStatisticsState.chartCNNameMap={histogram:"直方图",boxlinediagram:"箱线图",CPK:"CPK图",correlationgraph:"相关性图",gaussiandistribution:"高斯分布",wafermap:"晶圆图"},$(".g_bodyin_bodyin_bottom_2, .g_bodyin_bodyin_bottom_rsubin").hide().css("opacity",1),$(function(){var t=$("body").data("wafer").waferId;renderSelectCsv($("body").data("wafer").waferNO,"",$(".g_bodyin_bodyin_bottom_l_intop"),t),renderParam(t[0]),$(".g_bodyin_bodyin_bottom_l_item .g_bodyin_bodyin_bottom_l_itemin_main").eq(0).trigger("click"),eleResize(),$(window).on("resize",function(){eleResize(),eleResize2()})}),$(document).on("click",".g_bodyin_bodyin_bottom_l_itemin_subin",function(){$(this).toggleClass("selected")}).on("click",".g_bodyin_bodyin_bottom_l_itemin_main",function(){if(!$(this).hasClass("active")){$(this).addClass("active").parent().parent().siblings().find(".g_bodyin_bodyin_bottom_l_itemin_main").removeClass("active");var t=$(this).data("icsv").toString();dataStatisticsState.csvANDparamSelected.csv=[],$(this).hasClass("active")?dataStatisticsState.csvANDparamSelected.csv.push(t):_.pull(dataStatisticsState.csvANDparamSelected.csv,t);var i=[];if(0==$(".g_bodyin_bodyin_bottom_l_intop .active").length)$(".g_bodyin_bodyin_bottom_l_inbottom .list-group").empty();else for(var a=0;a<$(".g_bodyin_bodyin_bottom_l_intop .active").length;a++)i.push($(".g_bodyin_bodyin_bottom_l_intop .active").eq(a).data("iwaferid"));dataStatisticsState.csvANDparamSelected.param=[],renderParam(i.join(","))}}),$(document).on("click",".g_bodyin_bodyin_bottom_lsub_itemin_main",function(){$(this).toggleClass("active")}),$(document).on("click",".g_bodyin_tit_r>span, .g_bodyin_bodyin_bottom_r .thumbnail",function(){if($(this).hasClass("cannotclick"))return!1;var i=$(this).data("ipage"),d=$(this).data("ichart");$("."+i).siblings().fadeOut(200),$(".g_bodyin_bodyin_bottom_rsubin:not([data-ishowchart='"+d+"'])").fadeOut(200),$("."+i).delay(200).fadeIn(200,function(){var t;"g_bodyin_bodyin_bottom_2"==i?($(".g_bodyin_tit_r>span").show(),renderChartCsvANDParam({classify:"csv",csv:_.cloneDeep(dataStatisticsState.csvANDparamSelected.csv),flag:"sub",insertDOM:$(".g_bodyin_bodyin_bottom_lsub_top"),ishowchart:d}),"histogram"==d||"wafermap"==d||"gaussiandistribution"==d?t="table":"boxlinediagram"!=d&&"CPK"!=d&&"correlationgraph"!=d||(t="ul"),renderChartCsvANDParam({classify:t,param:_.cloneDeep(dataStatisticsState.csvANDparamSelected.param),insertDOM:$(".g_bodyin_bodyin_bottom_lsub_mid"),ishowchart:d}),$(".g_bodyin_bodyin_bottom_lsub_item .g_bodyin_bodyin_bottom_lsub_itemin_main").trigger("click"),dataStatisticsState.stateObj.renderSelectCsvSub||(eleResize2(),dataStatisticsState.stateObj.renderSelectCsvSub=!0),$(".g_bodyin_bodyin_bottom_rsubin[data-ishowchart='"+d+"']").delay(50).fadeIn(200,function(){for(var n=[],e={},t=0;t<$(".g_bodyin_bodyin_bottom_l_intop .active").length;t++)n.push($(".g_bodyin_bodyin_bottom_l_intop .active").eq(t).data("iwaferid")),e[$(".g_bodyin_bodyin_bottom_l_intop .active").eq(t).data("iwaferid")]=$(".g_bodyin_bodyin_bottom_l_intop .active").eq(t).data("icsv");eouluGlobal.S_getSwalMixin()({title:"加载数据",text:"数据加载绘制图形中...",type:"info",showConfirmButton:!1,showCancelButton:!1}),setTimeout(function(){var t=dataStatisticsState.chartMap[d],i=dataStatisticsState.ajaxurl[d],a=dataStatisticsState.chartCNNameMap[d],o=[];o.push({chartType:t,chartAjaxUrl:i,chartCNName:a,classify:d}),ajax_all_chart({whenArr:_.cloneDeep(o),curWaferName:e,curWaferID:n})},50)})):$(".g_bodyin_tit_r>span").hide()})}),$(document).on("click",".g_bodyin_bodyin_bottom_lsub_bottom>input",function(){for(var n=$(".g_bodyin_bodyin_bottom_rsub>div:visible").data("ishowchart"),e=[],d=[],s={},b=[],r=[],l=[],t=0;t<$(".g_bodyin_bodyin_bottom_lsub_top .active").length;t++)e.push($(".g_bodyin_bodyin_bottom_lsub_top .active").eq(t).data("iwaferid")),s[$(".g_bodyin_bodyin_bottom_lsub_top .active").eq(t).data("iwaferid")]=$(".g_bodyin_bodyin_bottom_lsub_top .active").eq(t).text();for(t=0;t<$(".g_bodyin_bodyin_bottom_lsub_mid .info").length;t++)"correlationgraph"==n||"boxlinediagram"==n||"CPK"==n?(d.push($(".g_bodyin_bodyin_bottom_lsub_mid .list-group .info").eq(t).data("ishowchartparam")),b.push($(".g_bodyin_bodyin_bottom_lsub_mid .list-group .info").eq(t).data("min")),r.push($(".g_bodyin_bodyin_bottom_lsub_mid .list-group .info").eq(t).data("max"))):(d.push($(".g_bodyin_bodyin_bottom_lsub_mid table .info").eq(t).data("ishowchartparam")),b.push($(".g_bodyin_bodyin_bottom_lsub_mid table .info").eq(t).find(".g_bodyin_bodyin_bottom_lsub_mid_min").attr("title")),r.push($(".g_bodyin_bodyin_bottom_lsub_mid table .info").eq(t).find(".g_bodyin_bodyin_bottom_lsub_mid_max").attr("title"))),l.push(8);console.log("curParam",d),console.log("leftrange",b),console.log("rightrange",r),console.log("equal",l),eouluGlobal.S_getSwalMixin()({title:"加载数据",text:"数据加载绘制图形中...",type:"info",showConfirmButton:!1,showCancelButton:!1}),setTimeout(function(){var t=dataStatisticsState.chartMap[n],i=dataStatisticsState.ajaxurl[n],a=dataStatisticsState.chartCNNameMap[n],o=[];o.push({chartType:t,chartAjaxUrl:i,chartCNName:a,classify:n}),ajax_all_chart({whenArr:_.cloneDeep(o),curWaferName:s,curWaferID:e,curParam:d,leftrange:b,rightrange:r,equal:l})},50)}),$(".g_bodyin_tit_r .RF_SP2").click(function(){eouluGlobal.S_settingURLParam({wafer:$("body").data("wafer").waferId},!1,!1,!1,"Analysis")}),$(document).on("blur",".g_bodyin_bodyin_bottom_2 .g_bodyin_bodyin_bottom_lsub_mid tbody tr td:not(.g_bodyin_bodyin_bottom_lsub_mid_iparam) input",function(){var t=$(this).parent().attr("title");""==$(this).val()&&$(this).val(t),$(this).parent().attr("title",$(this).val())}),$(document).on("click",".g_bodyin_bodyin_bottom_2 .g_bodyin_bodyin_bottom_lsub_mid .list-group .list-group-item",function(){"correlationgraph"==$(".g_bodyin_bodyin_bottom_rsub>div:visible").data("ishowchart")?($(this).toggleClass("list-group-item-info info"),2<$(".g_bodyin_bodyin_bottom_2 .g_bodyin_bodyin_bottom_lsub_mid .list-group .list-group-item-info").length?$(".g_bodyin_bodyin_bottom_lsub_bottom>input").attr("disabled",!0):$(".g_bodyin_bodyin_bottom_lsub_bottom>input").attr("disabled",!1)):$(this).addClass("list-group-item-info info").siblings().removeClass("list-group-item-info info")}),$(document).on("click",".g_bodyin_bodyin_bottom_2 .g_bodyin_bodyin_bottom_lsub_mid tbody tr .g_bodyin_bodyin_bottom_lsub_mid_iparam",function(){$(this).parent().toggleClass("info"),$(this).parent().find("input").toggleClass("mid_newbg")}),$(document).on("focus",".g_bodyin_bodyin_bottom_2 .g_bodyin_bodyin_bottom_lsub_mid tbody tr input",function(){$(this).parent().parent().addClass("info"),$(this).parent().parent().find("input").addClass("mid_newbg")});