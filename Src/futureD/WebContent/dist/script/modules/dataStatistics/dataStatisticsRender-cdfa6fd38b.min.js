function dataCompareRenderChart(t){var a,e={chart:{type:t.chart.type},credits:{enabled:!1},title:{text:t.title.text},subtitle:{text:t.subtitle.text},xAxis:t.xAxis,yAxis:t.yAxis};return"histogram"==t.chartClassify?a=Highcharts.chart(t.container,_.merge({},e,{tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y:.1f} %</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{groupPadding:.1,pointPadding:0}},series:t.series})):"boxlinediagram"==t.chartClassify?a=Highcharts.chart(t.container,_.merge({},e,{legend:{enabled:!0},tooltip:{pointFormat:'<span style="color:{point.color}">●</span> <b> {series.name}</b><br/>最大值: {point.high}<br/>Q2\t: {point.q3}<br/>中位数: {point.median}<br/>Q1\t: {point.q1}<br/>最小值: {point.low}<br/>'},series:t.series})):"CPK"==t.chartClassify?a=Highcharts.chart(t.container,_.merge({},e,{tooltip:{headerFormat:"<b>{point.key}</b><br>",pointFormat:"{point.x}, {point.y}"},plotOptions:{line:{dataLabels:{enabled:!0},enableMouseTracking:!0}},series:t.series})):"correlationgraph"==t.chartClassify?a=Highcharts.chart(t.container,_.merge({},e,{chart:{zoomType:"xy"},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",floating:!1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",borderWidth:0},plotOptions:{scatter:{marker:{radius:5,states:{hover:{enabled:!0,lineColor:"rgb(100,100,100)"}}},states:{hover:{marker:{enabled:!1}}},tooltip:{headerFormat:"<b>{series.name}</b><br>",pointFormat:"{point.x}, {point.y}"}}},series:t.series})):"gaussiandistribution"==t.chartClassify&&(a=Highcharts.chart(t.container,_.merge({},e,{chart:{zoomType:"xy",type:"line"},tooltip:{shared:!0},legend:{layout:"vertical",align:"left",x:55,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},series:t.series}))),_.isFunction(t.callback)&&t.callback(a),a}function draw_other_chart(e){console.log("draw_other_chart",e);var t,a,r,i=e.chartType,n=e.classify,o=e.IDParamObj,s=(e.paramsArr,e.data),l=e.errorArr,d=e.curWaferId,c=e.curWaferName,p=o.id,h=o.param,f=(o.isAll,null);switch(n){case"histogram":var u=_.find(s,function(t,a){return _.toString(a)==_.toString(h)});t="直方图-"+h,a={categories:_.map(u.sectionX,function(t,a){var e=t.split("~");return _.forEach(e,function(t,a,e){var r;r=-1<t.indexOf("∞")?t:8<t.length?numeral(t).format("0.0000e+0"):t,e[a]=r}),_.join(e,"~")}),type:"linear",labels:{rotation:-45},plotLines:[{color:"#FF0000",width:2,value:.5},{color:"#FF0000",width:2,value:u.sectionX.length-1.5}]},r={title:{text:"百分数"}};var m,g=[];_.forEach(d,function(t){m=u.percentList[t],g.push({name:c[t],type:"column",data:_.map(m.percent,function(t){return parseFloat(t)})}),g.push({name:h+"频率累加",type:"line",data:_.map(m.proportion,function(t){return parseFloat(t)})})}),y=g;break;case"boxlinediagram":for(var b=[],v=0;v<d.length;v++)b.push(c[d[v]]);t="箱线图-"+h,a={categories:b},r={title:{text:"值"}};u=_.find(s,function(t,a){return _.toString(a)==_.toString(h)});var y=[],x=[],w=[],S=[];for(var F in u)x.push(u[F].eigenValue),w=u[F].extreme,S=u[F].soft;y=[{name:"观测值",data:x,tooltip:{headerFormat:"<em>参数： {point.key}</em><br/>"}},{name:"温和异常值",color:Highcharts.getOptions().colors[1],type:"scatter",data:S,marker:{fillColor:"#ccc",lineWidth:1,lineColor:Highcharts.getOptions().colors[1]},tooltip:{pointFormat:"温和异常值: {point.y}"}},{name:"极端异常值",color:Highcharts.getOptions().colors[0],type:"scatter",data:w,marker:{fillColor:"white",lineWidth:1,lineColor:Highcharts.getOptions().colors[0]},tooltip:{pointFormat:"极端异常值: {point.y}"}}];break;case"CPK":for(var C=[],D=(u=_.find(s,function(t,a){return _.toString(a)==_.toString(h)}),0);D<e.curWaferId.length;D++){var N=_.find(u,function(t,a){return _.toString(a)==_.toString(e.curWaferId[D])}),M=e.curWaferName[e.curWaferId[D]];if(N.length<20){var O=_.find(l,function(t,a){return"CPK图"==t.chartCNName});_.isNil(O)?l.push({chartCNName:"CPK图",errorParamArr:[M+":"+h],classify:n,message:"参数数据不足"}):O.errorParamArr.push(M+":"+h)}else{var j={};j.name=c[e.curWaferId[D]],j.data=u[e.curWaferId[D]],C.push(j)}}t="CPK-"+h,a={categories:["一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八","十九","二十"]},r={title:{text:"values"}},y=C;break;case"correlationgraph":var k;for(var A in t="相关性图-"+h,c)if(h===c[A]){k=A;break}u=_.find(s,function(t,a){return _.toString(a)==_.toString(k)});a={title:{enabled:!0,text:e.curParam[0],style:{fontFamily:"arial",float:"top"}},lineWidth:1,startOnTick:!0,endOnTick:!0,showLastLabel:!0,labels:{useHTML:!0,formatter:function(){return'<a href="javascript:alert(\'hello\')" style="font-size:11px;color:#666666;">'+this.value+"</a>"}}},r={title:{text:e.curParam[1]}},(W={}).name=h;for(var G=[],q=0;q<u.X.length;q++){var I=[];I.push(parseFloat(u.X[q])),I.push(parseFloat(u.Y[q])),G.push(I)}W.data=G,y=[W];break;case"gaussiandistribution":var P=_.find(s,function(t,a){return _.toString(a)==_.toString(h)})[d[0]];t="高斯分布图-"+h,a=[{categories:_.map(P.groupX,function(t){var a=!0;return 1<Math.abs(t)&&(a=!1),eouluGlobal.S_ComSCMRound(t,2,a)}),crosshair:!0,type:"linear"}],r=[{labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[1]}},title:{text:"频次",style:{color:Highcharts.getOptions().colors[1]}}},{title:{text:"正态分布",style:{color:Highcharts.getOptions().colors[0]}},labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[0]}},opposite:!0}],y=[{name:"频次",type:"column",data:P.frequency,tooltip:{valueSuffix:""}},{name:"正态分布",type:"spline",yAxis:1,data:P.density,tooltip:{valueSuffix:""}}],f=function(t){var a=$("#"+p).parent().next().find("tbody>tr");a.eq(0).children("td").eq(1).data("ivalue",P.median),a.eq(1).children("td").eq(1).data("ivalue",P.average),a.eq(2).children("td").eq(1).data("ivalue",P.max),a.eq(3).children("td").eq(1).data("ivalue",P.min),a.eq(5).children("td").eq(1).data("ivalue",P.expectation),a.eq(6).children("td").eq(1).data("ivalue",P.standard),a.eq(7).children("td").eq(1).data("ivalue",P.variance),a.find("td:nth-child(2)").each(function(t,a){if(4==t)return!0;var e=!0;1<Math.abs(parseFloat($(this).data("ivalue")))&&(e=!1);var r=eouluGlobal.S_ComSCMRound(parseFloat($(this).data("ivalue")),2,e);$(this).attr("title",$(this).data("ivalue")).text(r)})};break;default:var W;t="良品率图",(W={}).name=h,W.data=[];var H=[];u=_.find(s,function(t,a){return _.toString(a)==_.toString(h)});_.forEach(d,function(t){H.push(c[t]);var a=parseFloat(u[t]);W.data.push(a)}),a={categories:H},r={title:{text:"比率(%)"},min:0,max:100,tickInterval:10,labels:{formatter:function(){return this.value}}},y=[W]}return dataCompareRenderChart({container:p,chart:{zoomType:"x",type:i},title:{text:t},subtitle:{text:null},xAxis:a,yAxis:r,series:_.cloneDeep(y),chartClassify:n,callback:f}),l}function ajax_all_chart(t){console.log("obj11",t);var a=t.whenArr,o=t.errorArr||[],s=t.curWaferName,l=a[0],d=t.curWaferID,c=t.curParam;if(c)if("correlationgraph"===l.classify)e={waferIdStr:d.join(","),paramX:c[0],paramY:c[1],minX:t.leftrange[0],minY:t.leftrange[1],maxX:t.rightrange[0],maxY:t.rightrange[1]};else if("wafermap"===l.classify)e={waferIdStr:d.join(","),parameter:c.join(""),leftRange:t.leftrange[0],rightRange:t.rightrange[0]};else if("gaussiandistribution"===l.classify||"histogram"===l.classify)e={waferIdStr:d.join(","),parameter:c.join(""),leftRange:t.leftrange[0],rightRange:t.rightrange[0],equal:t.equal[0]};else e={waferIdStr:d.join(","),parameter:c.join("")};else var e={waferIdStr:d.join(",")};$.ajax({type:"GET",url:l.chartAjaxUrl,data:e,dataType:"json",beforeSend:function(){}}).then(function(e){console.log("ajaxdata",e);var t=d;if(_.isEmpty(e)||_.isNil(e))o.push({chartCNName:l.chartCNName,errorParamArr:[],classify:l.classify,message:"数据为空"});else{var r;if(-1<["wafermap"].indexOf(l.classify)){r=[];for(var a=0;a<e[d[0]].waferList.length;a++)r.push(e[d[0]].waferList[a].parameter)}else if(-1<["correlationgraph"].indexOf(l.classify))for(var i in delete e.status,r=[],s)r.push(s[i]);else r=_.keys(e),r=_.sortBy(r,function(t,a){return _.isNil(t.match(/\d+/))?0:_.toNumber(t.match(/\d+/)[0])});var n=buildParameterChartContainer({classify:l.classify,paramsArr:_.cloneDeep(r),waferArr:_.cloneDeep(t),curWaferName:s});_.forEach(n,function(t,a){"wafermap"==l.classify?draw_map_color_order_distribution({data:_.cloneDeep(e),IDParamObj:t,curWaferName:s,paramsArr:r}):o=draw_other_chart({chartType:l.chartType,classify:l.classify,IDParamObj:t,paramsArr:r,data:_.cloneDeep(e),curWaferId:d,errorArr:o,curWaferName:s,curParam:c})}),eouluGlobal.S_getSwalMixin()({title:"加载提示",text:"数据请求完成",type:"info",showConfirmButton:!1,timer:1200})}},function(){}).always(function(){})}function buildParameterChartContainer(r){console.log("buildParameterChartContainer",r);var i=r.classify,t=r.paramsArr,n="",o=[],s="";return-1<["histogram","boxlinediagram","CPK","gaussiandistribution","wafermap"].indexOf(i)?(-1<["histogram"].indexOf(i)&&(t=_.pull(t,"sectionX")),-1<_.indexOf(["gaussiandistribution"],i)&&(s='<table class="table table-striped table-bordered table-condensed"><tbody><tr><td>中值</td><td>中值</td></tr><tr><td>平均值</td><td>平均值</td></tr><tr><td>最大值</td><td>最大值</td></tr><tr><td>最小值</td><td>最小值</td></tr><tr><td></td><td></td></tr><tr><td>标准差</td><td>标准差</td></tr><tr><td>方差</td><td>方差</td></tr></tbody></table>'),_.forEach(t,function(t,a,e){a%2==0&&(n+='<div class="row">'),n+='<div class="col-sm-12 col-md-6 col-lg-6">',n+='<div class="panel panel-info"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>'+t+'</div><div class="panel-body"><div class="container-fluid"><div class="chart_title"></div><div class="chart_body"><div id="'+(i+dataStatisticsState.stateObj.curChartContainerNum)+'" data-iparam="'+t+'"></div></div><div class="chart_foot">'+s+"</div></div></div></div>",n+="</div>",(a%2==1||a%2==0&&a==e.length-1)&&(n+="</div>"),o.push({id:i+dataStatisticsState.stateObj.curChartContainerNum,param:t,isAll:!1,wafer:r.waferArr[0]}),dataStatisticsState.stateObj.curChartContainerNum++})):-1<["correlationgraph"].indexOf(i)&&_.forEach(t,function(t,a,e){n+='<div class="col-sm-24 col-md-12 col-lg-12">',n+='<div class="panel panel-info"><div class="panel-heading"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>'+t+'</div><div class="panel-body"><div class="container-fluid"><div class="chart_title"></div><div class="chart_body"><div id="'+(i+dataStatisticsState.stateObj.curChartContainerNum)+'" data-iparam="'+t+'"></div></div><div class="chart_foot">'+s+"</div></div></div></div>",n+="</div>",o.push({id:i+dataStatisticsState.stateObj.curChartContainerNum,param:t,isAll:!1,wafer:r.waferArr[0]}),dataStatisticsState.stateObj.curChartContainerNum++}),$(".g_bodyin_bodyin_bottom_rsubin[data-ishowchart='"+i+"']>.chartBody>.container-fluid").empty().append(n),o}function draw_map_color_order_distribution(t){console.log("draw_map_color_order_distribution",t);var a=t.data,e=t.IDParamObj,r=t.IDParamObj.wafer,i=$("#"+e.id),n=_.find(a,function(t,a){return _.toString(a)==_.toString(r)});console.log("waferData",n),dieData=[],subdieData=[],currentDieItem=_.find(n.waferList,function(t,a){return _.toString(t.parameter)==_.toString(e.param)}),theMax=200,theMin=-100,lowwer=theMin+_.floor((theMax-theMin)/3),upper=theMin+2*_.floor((theMax-theMin)/3),midder=_.floor((theMax+theMin)/2),otherColor={},twoDiff=lowwer-theMin,threeDiff=midder-lowwer,fourDiff=upper-midder,fiveDiff=theMax-upper,precision=0;var o=n.containSubdie?n.waferDie.currentDieList:currentDieItem.currentDieList,s=n.containSubdie?[o]:[o,n.otherDieType];_.forEach(s,function(t,a){_.forOwn(t,function(t,a){var e,r,i,n,o,s={};o=_.isObject(t)?(n=t.percent,t.bin||t.subdieBin):n=t,e=_.round(parseFloat(n)*Math.pow(10,precision));var l=_.toString(n).match(/^\+/),d=_.toString(n).match(/^\-/);if(_.isObject(t)?_.isNil(l)&&_.isNil(d)?i=1:(_.isNil(l)||(i=100),_.isNil(d)||(i=-100)):_.isNil(l)&&_.isNil(d)?i=0:(_.isNil(l)||(i=2),_.isNil(d)||(i=-2)),2<i&&(e+=i),5e3==(r=o))"5000:"in otherColor||(otherColor["5000:"]="#FDFDFD"),s[a]={bin:5e3,color:"5000:"};else if(5001==r)"5001:"in otherColor||(otherColor["5001:"]="#fff"),s[a]={bin:5001,color:"5001:"};else if(-1==r)"-1:"in otherColor||(otherColor["-1:"]="#314067"),s[a]={bin:-1,color:"-1:"};else{var c=_.round(e);_.isNil(l)&&_.isNil(d)?lowwer<=e&&e<midder?s[a]={bin:r,color:"3:"+c}:midder<=e&&e<=upper&&(s[a]={bin:r,color:"4:"+c}):(_.isNil(l)||(upper<=e&&e<theMax?s[a]={bin:r,color:"5:"+c}:theMax<=e&&(e=theMax,s[a]={bin:r,color:"6:"+c})),_.isNil(d)||(e<=theMin?(e=theMin,s[a]={bin:r,color:"1:"+c}):theMin<e&&e<=lowwer&&(s[a]={bin:r,color:"2:"+c})))}dieData.push(s)})});var l=n.containSubdie?currentDieItem.currentSubdieList:{},d=(n.containSubdie&&n.otherSubdieType,n.containSubdie?[l]:[]);_.forEach(d,function(t,a){_.forOwn(t,function(t,a){var e,r,i,n,o,s={};o=_.isObject(t)?(n=t.percent,t.subdieBin):n=t,e=_.round(parseFloat(n)*Math.pow(10,precision));var l=_.toString(n).match(/^\+/),d=_.toString(n).match(/^\-/);if(_.isObject(t)?_.isNil(l)&&_.isNil(d)?i=1:(_.isNil(l)||(i=100),_.isNil(d)||(i=-100)):_.isNil(l)&&_.isNil(d)?i=0:(_.isNil(l)||(i=2),_.isNil(d)||(i=-2)),2<i&&(e+=i),5e3==(r=o))"5000:"in otherColor||(otherColor["5000:"]="#FDFDFD"),s[a]={bin:5e3,color:"5000:"};else if(5001==r)"5001:"in otherColor||(otherColor["5001:"]="#fff"),s[a]={bin:5001,color:"5001:"};else if(-1==r)"-1:"in otherColor||(otherColor["-1:"]="#314067"),s[a]={bin:-1,color:"-1:"};else{var c=_.round(e);_.isNil(l)&&_.isNil(d)?lowwer<=e&&e<midder?s[a]={bin:r,color:"3:"+c}:midder<=e&&e<=upper&&(s[a]={bin:r,color:"4:"+c}):(_.isNil(l)||(upper<=e&&e<theMax?s[a]={bin:r,color:"5:"+c}:theMax<=e&&(e=theMax,s[a]={bin:r,color:"6:"+c})),_.isNil(d)||(e<=theMin?(e=theMin,s[a]={bin:r,color:"1:"+c}):theMin<e&&e<=lowwer&&(s[a]={bin:r,color:"2:"+c})))}subdieData.push(s)})});var c={1:[],2:[],3:[],4:[],5:[],6:[],5e3:[],5001:[],"-1":[],12:[]};_.forEach(dieData,function(t,a){var e=_.values(t)[0].color.split(":")[0],r=_.keys(t)[0],i={};i.old1=_.find(currentDieItem.currentDieList,function(t,a){return a==r}),i.new1=t,c[e].push(i)}),window.ArraMap=c;var p=i.innerWidth();i.innerHeight(.8*p);var h="canvas_"+i.attr("id");i.append("<canvas id='"+h+"'></canvas>"),i.after("<div class='criterion_"+h+" ' style='height:60px;text-align: center;'><div class='colorGradient' style=' margin-bottom: 30px;display: inline-block;'></div></div>"),buildColorGradation({width:p,height:.8*p,container:h,bgFillColor:"#314067",waferData:n,spacePercent:{x:.1,y:0},m_DieDataListNew:dieData,colorGradation:{theMinColor:"#0000FF",lowwerColor:"#00FFFF",midderColor:"#00FF00",upperColor:"#FFFF00",theMaxColor:"#FF0000",twoDiff:twoDiff,threeDiff:threeDiff,fourDiff:fourDiff,fiveDiff:fiveDiff},colorOrder:!0,theMin:theMin,lowwer:lowwer,midder:midder,upper:upper,theMax:theMax,otherColor:otherColor,param:t.IDParamObj.param,subcoordsArray:subdieData});var f=i.next().find("div.colorGradient");f.width(i.next().width()-60).height(i.next().height()-30);var u=twoDiff+threeDiff+fourDiff+fiveDiff,m=f.height(),g=f.width()/(1.2*u),b=_.floor((theMax-theMin)/200);$("body").innerWidth()<1920&&(b+=.5),$("body").innerWidth()<1366&&(b+=.5),f.append("<span class='colorGradientSpan oneSpan outSpan'><span style='height: "+m+"px; width: "+g+"px'></span></span>"),f.append("<span class='colorGradientSpan splitSpan' style='height: "+m+"px; width: "+g*b+"px;'></span>"),_.times(twoDiff,function(t){var a=getGradientColor("#00FFFF","#0000FF",twoDiff,twoDiff-t);f.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+m+"px; width: "+g+"px'></span>")}),f.append("<span class='colorGradientSpan twoSpan outSpan'><span style='height: "+m+"px; width: "+g+"px'></span></span>"),f.append("<span class='colorGradientSpan splitSpan' style='height: "+m+"px; width: "+g*b+"px;'></span>"),_.times(threeDiff,function(t){var a=getGradientColor("#00FF00","#00FFFF",threeDiff,threeDiff-t);f.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+m+"px; width: "+g+"px'></span>")}),f.append("<span class='colorGradientSpan threeSpan outSpan'><span style='height: "+m+"px; width: "+g+"px'></span></span>"),f.append("<span class='colorGradientSpan splitSpan' style='height: "+m+"px; width: "+g*b+"px;'></span>"),_.times(fourDiff,function(t){var a=getGradientColor("#FFFF00","#00FF00",fourDiff,fourDiff-t);f.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+m+"px; width: "+g+"px'></span>")}),f.append("<span class='colorGradientSpan fourSpan outSpan'><span style='height: "+m+"px; width: "+g+"px'></span></span>"),f.append("<span class='colorGradientSpan splitSpan' style='height: "+m+"px; width: "+g*b+"px;'></span>"),_.times(fiveDiff,function(t){var a=getGradientColor("#FF0000","#FFFF00",fiveDiff,fiveDiff-t);f.append("<span class='colorGradientSpan' data-icolor='"+a+"' style='background: "+a+"; height: "+m+"px; width: "+g+"px'></span>")}),f.append("<span class='colorGradientSpan fiveSpan outSpan'><span style='height: "+m+"px; width: "+g+"px'></span></span>"),f.append("<span class='colorGradientSpan splitSpan' style='height: "+m+"px; width: "+g*b+"px;'></span>"),f.append("<span class='colorGradientSpan sixSpan outSpan'><span style='height: "+m+"px; width: "+g+"px'></span></span>");var v=_.countBy(dieData,function(t,a){var e;return _.forOwn(t,function(t,a){e=t.color.split(":")[0]}),e});$('<table class="table table-striped table-bordered table-condensed colorinterval"><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th><th>合格数</th><th>不合格数</th><th>良率</th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td><td></td><td></td><td class="qualify_tt" data-ipara="qualify">0</td><td class="unqulify_tt" data-ipara="unqulify">0</td><td class="yield_tt" data-ipara="yield">0%</td></tr></tbody></table>').appendTo(i.parent().next()),_.forOwn(v,function(t,a){if(-1==_.indexOf(["1","2","3","4","5","6"],a))return!0;i.parent().next().find("th").eq(a-1).text(a+"区间"),i.parent().next().find("td").eq(a-1).text(t+"个")});var y=i.parent().next();y.find("[class$='_tt']").each(function(){var t=$(this).data("ipara");$(this).text(currentDieItem[t])}),y.find("th").each(function(t){""==$(this).text().trim()&&($(this).text(t+1+"区间"),y.find("td").eq(t).text("0个"))})}