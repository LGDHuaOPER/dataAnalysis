var dataStatisticsSwalMixin=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"}),dataStatisticsState=new Object;function eleResize(){var t=$(window).height();t<600&&(t=600),$("body").height(t),$(".g_bodyin_bodyin_bottom").innerHeight(t-150),$(".g_bodyin_bodyin_bottom_l, .g_bodyin_bodyin_bottom_r").innerHeight(t-150)}function eleResize2(){$(".g_bodyin_bodyin_bottom_lsub, .g_bodyin_bodyin_bottom_rsub").height($(".g_bodyin_bodyin_bottom").height()),$(".g_bodyin_bodyin_bottom_lsub_top, .g_bodyin_bodyin_bottom_lsub_mid").innerHeight(($(".g_bodyin_bodyin_bottom_lsub").innerHeight()-46)/2)}function renderSelectCsv(t,a,i,o){for(var n="",e=0;e<t.length;e++)n+='<div class="g_bodyin_bodyin_bottom_l'+a+'_item"><div class="g_bodyin_bodyin_bottom_l'+a+'_itemin"><div class="g_bodyin_bodyin_bottom_l'+a+'_itemin_main" data-icsv="'+t[e]+'"  data-iwaferid="'+o[e]+'">'+t[e]+"</div></div></div>";i.empty().append(n)}function renderChartCsvANDParam(o){var n="";"csv"==o.classify?o.csv.map(function(t,a){n+='<div class="g_bodyin_bodyin_bottom_l'+o.flag+'_item"><div class="g_bodyin_bodyin_bottom_l'+o.flag+'_itemin"><div class="g_bodyin_bodyin_bottom_l'+o.flag+'_itemin_main">'+t+"</div></div></div>"}):"table"==o.classify?(n+='<table class="table table-striped table-bordered table-hover table-condensed"><thead><tr><th>参数名称</th><th>下限</th><th>上限</th><th>等分数</th></tr></thead><tbody>',o.param.map(function(t,a){var i=o.ishowchart+String(dataStatisticsState.stateObj.chartRenderCurID++);n+='<tr data-chartcurid="'+i+'" data-ishowchartparam="'+t+'"><td>'+t+"</td><td>0.32</td><td>1.4</td><td>8</td></tr>"}),n+="</tbody></table>"):"ul"==o.classify&&(n+='<ul class="list-group">',o.param.map(function(t,a){var i=o.ishowchart+String(dataStatisticsState.stateObj.chartRenderCurID++);n+='<li class="list-group-item" data-chartcurid="'+i+'" data-ishowchartparam="'+t+'"><span class="badge">参数</span>'+t+"</li>"}),n+="</ul>"),o.insertDOM.empty().append(n)}function changeChartCanClick(){var t=$(".g_bodyin_bodyin_bottom_l_inbottom .list-group .list-group-item.list-group-item-info").length;$(".g_bodyin_bodyin_bottom_r .thumbnail").removeClass("cannotclick"),t&&0!=t?1==t?$(".g_bodyin_bodyin_bottom_r .thumbnail[data-ichart='correlationgraph']").addClass("cannotclick"):2==t?($(".g_bodyin_bodyin_bottom_r .thumbnail").addClass("cannotclick"),$(".g_bodyin_bodyin_bottom_r .thumbnail[data-ichart='correlationgraph']").removeClass("cannotclick")):$(".g_bodyin_bodyin_bottom_r .thumbnail").addClass("cannotclick"):$(".g_bodyin_bodyin_bottom_r .thumbnail").addClass("cannotclick")}function renderParam(t){var o="";$.ajax({type:"GET",url:"WaferParameter",data:{waferIdStr:t},dataType:"json",success:function(i){_.forOwn(i.paramList,function(t,a){o+='<a href="javascript:;" class="list-group-item" data-iparam="'+t+'" data-iparam="'+t+'" data-min="'+i.rangeList[t][0]+'" data-max="'+i.rangeList[t][1]+'"><span class="badge">选中</span>'+t+"</a>"}),$(".g_bodyin_bodyin_bottom_l_inbottom>.list-group").empty().append(o)},error:function(){dataStatisticsSwalMixin({title:"异常",text:"服务器繁忙！",type:"error",showConfirmButton:!1,timer:2e3})}})}dataStatisticsState.csvANDparamSelected={csv:[],param:[]},dataStatisticsState.stateObj={renderSelectCsvSub:!1,chartValidate:{histogram:{csvLen:"+",paramLen:1},boxlinediagram:{csvLen:"+",paramLen:1},CPK:{csvLen:1,paramLen:1},wafermap:{csvLen:"+",paramLen:1},gaussiandistribution:{csvLen:"+",paramLen:1}},chartRenderCurID:0,curChartContainerNum:0},dataStatisticsState.chartMap={histogram:"column",boxlinediagram:"boxplot",CPK:"line",correlationgraph:"scatter",gaussiandistribution:"gaussiandistribution",wafermap:"wafermap"},dataStatisticsState.ajaxurl={histogram:"Histogram",boxlinediagram:"Boxplot",CPK:"CPKServlet",correlationgraph:"Correlation",gaussiandistribution:"GaussianDistribution",wafermap:"ColorMap"},dataStatisticsState.chartCNNameMap={histogram:"直方图",boxlinediagram:"箱线图",CPK:"CPK图",correlationgraph:"相关性图",gaussiandistribution:"高斯分布",wafermap:"晶圆图"},$(".g_bodyin_bodyin_bottom_2, .g_bodyin_bodyin_bottom_rsubin").hide().css("opacity",1),$(function(){var t=$("body").data("wafer").waferId;renderSelectCsv($("body").data("wafer").waferNO,"",$(".g_bodyin_bodyin_bottom_l_intop"),t),$(".g_bodyin_bodyin_bottom_l_item .g_bodyin_bodyin_bottom_l_itemin_main").trigger("click"),changeChartCanClick(),eleResize(),$(window).on("resize",function(){eleResize(),eleResize2()})}),$(document).on("click",".g_bodyin_bodyin_bottom_l_itemin_subin",function(){$(this).toggleClass("selected")}).on("click",".g_bodyin_bodyin_bottom_l_itemin_main",function(){$(this).toggleClass("active");var t=$(this).data("icsv").toString();$(this).hasClass("active")?dataStatisticsState.csvANDparamSelected.csv.push(t):_.pull(dataStatisticsState.csvANDparamSelected.csv,t);var a=[];if(0==$(".g_bodyin_bodyin_bottom_l_intop .active").length)$(".g_bodyin_bodyin_bottom_l_inbottom .list-group").empty();else for(var i=0;i<$(".g_bodyin_bodyin_bottom_l_intop .active").length;i++)a.push($(".g_bodyin_bodyin_bottom_l_intop .active").eq(i).data("iwaferid"));dataStatisticsState.csvANDparamSelected.param=[],renderParam(a.join(","))}),$(document).on("click",".g_bodyin_bodyin_bottom_lsub_itemin_main",function(){$(this).toggleClass("active")}),$(document).on("click",".g_bodyin_tit_r>span, .g_bodyin_bodyin_bottom_r .thumbnail",function(){if($(this).hasClass("cannotclick"))return!1;var a=$(this).data("ipage"),r=$(this).data("ichart");$("."+a).siblings().fadeOut(200),$(".g_bodyin_bodyin_bottom_rsubin:not([data-ishowchart='"+r+"'])").fadeOut(200),$("."+a).delay(200).fadeIn(200,function(){var t;"g_bodyin_bodyin_bottom_2"==a?($(".g_bodyin_tit_r>span").show(),renderChartCsvANDParam({classify:"csv",csv:_.cloneDeep(dataStatisticsState.csvANDparamSelected.csv),flag:"sub",insertDOM:$(".g_bodyin_bodyin_bottom_lsub_top"),ishowchart:r}),"histogram"==r||"wafermap"==r||"gaussiandistribution"==r?t="table":"boxlinediagram"!=r&&"CPK"!=r&&"correlationgraph"!=r||(t="ul"),renderChartCsvANDParam({classify:t,param:_.cloneDeep(dataStatisticsState.csvANDparamSelected.param),insertDOM:$(".g_bodyin_bodyin_bottom_lsub_mid"),ishowchart:r}),$(".g_bodyin_bodyin_bottom_lsub_item .g_bodyin_bodyin_bottom_lsub_itemin_main").trigger("click"),dataStatisticsState.stateObj.renderSelectCsvSub||(eleResize2(),dataStatisticsState.stateObj.renderSelectCsvSub=!0),$(".g_bodyin_bodyin_bottom_rsubin[data-ishowchart='"+r+"']").delay(50).fadeIn(200,function(){for(var n=[],e=[],s={},t=0;t<$(".g_bodyin_bodyin_bottom_l_intop .active").length;t++)n.push($(".g_bodyin_bodyin_bottom_l_intop .active").eq(t).data("iwaferid")),s[$(".g_bodyin_bodyin_bottom_l_intop .active").eq(t).data("iwaferid")]=$(".g_bodyin_bodyin_bottom_l_intop .active").eq(t).data("icsv");for(t=0;t<$(".g_bodyin_bodyin_bottom_l_inbottom .list-group  .list-group-item-info").length;t++)e.push($(".g_bodyin_bodyin_bottom_l_inbottom .list-group  .list-group-item-info").eq(t).data("iparam"));setTimeout(function(){var t=dataStatisticsState.chartMap[r],a=dataStatisticsState.ajaxurl[r],i=dataStatisticsState.chartCNNameMap[r],o=[];o.push({chartType:t,chartAjaxUrl:a,chartCNName:i,classify:r}),ajax_all_chart({whenArr:_.cloneDeep(o),curWaferName:s,curWaferID:n,curParam:e})},50)})):$(".g_bodyin_tit_r>span").hide()})}),$(document).on("click",".g_bodyin_bodyin_bottom_l_inbottom>.list-group>a",function(){$(this).toggleClass("list-group-item-info");var t=$(this),a=t.data("iparam").toString();t.hasClass("list-group-item-info")?dataStatisticsState.csvANDparamSelected.param.push(a):_.pull(dataStatisticsState.csvANDparamSelected.param,a);$(this).children("span").text(["选中","取消选中"][Number(t.hasClass("list-group-item-info"))]),changeChartCanClick()});