function getDataBuildS12S21(e){var a=e.allData,t=e.container,r=e.zoomType,i=e.showCheckbox,n=e.title,s=e.legend_enabled,o=e.renderData,l=e.GHzFlag,d=e.callback,c=e.pointMouseOverCallback,x={xCategories:[]};_.forEach(a[0].data,function(e,a){!0===l?x.xCategories.push(e[0]):x.xCategories.push(Math.floor(e[0]/1e7)/100)}),x.series=[],o&&_.forEach(a,function(e,a){var t={};t.name=e.name,t.data=[],_.forEach(e.data,function(e,a){t.data.push(parseFloat(e[1]))}),x.series.push(t)}),x.container=t,x.zoomType=r,x.resetZoomButton={position:{align:"left",x:0,y:0},relativeTo:"chart"},x.showCheckbox=i,x.title=n,x.legend_enabled=s,x.callback=d,x.pointMouseOverCallback=c,drawRealS12S21(x)}function getDataBuildS11S22(e){var a=smithChart({dom:e.wrapDOM,titleOneArr:e.title,legendNameOneArr:e.legendName,allDataArr:e.data,Type:e.classify,msgdom:e.msgDOM,lineColorArray:e.lineColorArray,msgFun:e.msgFun,msgInitFun:e.msgInitFun,GHzFlag:e.GHzFlag});_.isFunction(e.callback)&&e.callback(a)}function drawRealS12S21(a){var e=a.container,t=a.xCategories,r=a.series,i=!!_.isNil(a.legend_enabled)||a.legend_enabled,n=a.zoomType||"None",s=a.resetZoomButton,o=a.title||{text:null},l=a.showCheckbox||!1,d=Highcharts.chart(e,{chart:{type:"line",zoomType:n,resetZoomButton:s},title:o,lang:{loading:"Loading..."},legend:{enabled:i},xAxis:{title:{text:"GHz"},categories:t},yAxis:{title:{text:"dB"},gridLineColor:"#eee",gridLineWidth:1},series:r,credits:{enabled:!1},tooltip:{formatter:function(e){return"<b>"+this.series.name+"</b><br>"+this.x+" GHz, "+this.y+" dB"},useHTML:!0},plotOptions:{series:{point:{events:{mouseOver:function(e){_.isFunction(a.pointMouseOverCallback)&&a.pointMouseOverCallback(this,d,e)}}},showCheckbox:l}}});return _.isFunction(a.callback)&&a.callback(d),d}function getEventPosition(e){var a,t;return e.layerX||0==e.layerX?(a=e.layerX,t=e.layerY):(e.offsetX||0==e.offsetX)&&(a=e.offsetX,t=e.offsetY),{x:a,y:t}}function renderSpline(a){var j=a.name,E=Highcharts.chart(a.container,{chart:{type:"spline",zoomType:"x",resetZoomButton:{position:{align:"left",x:90,y:10},relativeTo:"chart"}},title:{text:a.title},lang:{loading:"Loading..."},legend:{enabled:!0},xAxis:{title:{text:"Mhz"},categories:a.data.xData[0],gridLineColor:"#197F07",gridLineWidth:0,crosshair:{dashStyle:"LongDashDotDot",width:2,color:"#bbbbbb",snap:!0}},yAxis:{title:{text:"dB"},gridLineColor:"#eee",gridLineWidth:1,crosshair:{dashStyle:"LongDashDotDot",width:2,color:"#bbbbbb",snap:!0}},series:[{name:a.name[0],data:a.data.yData[0]},{name:a.name[1],data:a.data.yData[1]}],credits:{enabled:!1},tooltip:{formatter:function(e){return"y"==RF_SP2Store.stateObj.comfirm_key?"<b>"+this.series.name+"</b><br>"+this.x+' Mhz, <b class="underline_b">'+this.y+" dB</b>":"x"==RF_SP2Store.stateObj.comfirm_key?"<b>"+this.series.name+'</b><br><b class="underline_b">'+this.x+" Mhz</b>, "+this.y+" dB":"<b>"+this.series.name+"</b><br>"+this.x+" Mhz, "+this.y+" dB"},useHTML:!0},plotOptions:{series:{allowPointSelect:!1,connectNulls:!0,marker:{enabled:!0,radius:1,symbol:"diamond",states:{hover:{fillColor:"white",lineColor:"black",lineWidth:3},select:{fillColor:"white",lineColor:"red",lineWidth:3,radius:4}}},cursor:"pointer",point:{events:{mouseOver:function(e){0==this.colorIndex?($(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(0).children().text(this.series.name+" "+this.category+"Mhz, "+this.y+"dB"),$(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(1).children().text(a.name[1]+" "+this.category+"Mhz, "+a.data.yData[1][this.x]+"dB")):($(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(1).children().text(this.series.name+" "+this.category+"Mhz, "+this.y+"dB"),$(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(0).children().text(a.name[0]+" "+this.category+"Mhz, "+a.data.yData[0][this.x]+"dB"))},click:function(e){if(_.isNil(RF_SP2Store.stateObj.comfirm_key)||_.isEqual(RF_SP2Store.stateObj.comfirm_key,"请选择"))return RF_SP2SwalMixin({title:"Key值设置提醒",text:"请先设置Key值并保存",type:"info",showConfirmButton:!1,timer:2e3}),!1;var a=RF_SP2Store.stateObj.TCFsParameter,t=!this.colorIndex,r=this.series.name,i=E.series[Number(t)].name,n=this.category,s=this.y,o=this.x;if("x"==RF_SP2Store.stateObj.comfirm_key){var l=E.series[Number(t)].yData[o];if(this.selected)this.select(!1,!0),E.series[Number(t)].data[o].select(!1,!0),_.pull(RF_SP2Store.stateObj.splineSelectedArr[a],_.find(RF_SP2Store.stateObj.splineSelectedArr[a],function(e){var a=!1;return e.name==r&&e.x==n&&(a=!0),a})),_.pull(RF_SP2Store.stateObj.splineSelectedArr[a],_.find(RF_SP2Store.stateObj.splineSelectedArr[a],function(e){var a=!1;return e.name==i&&e.x==n&&(a=!0),a})),$(".buildMarker_body>.container-fluid tbody>tr[data-iflag='"+(r+n)+"']").remove(),$(".buildMarker_body>.container-fluid tbody>tr[data-iflag='"+(i+n)+"']").remove();else{var d=0;if(_.forEach(RF_SP2Store.stateObj.splineSelectedArr[a],function(e){e.name==r&&d++}),1<d)return RF_SP2SwalMixin({title:"Marker打点提示",text:"以x为Key时一条曲线最多打2个点",type:"error",timer:2500}),!1;this.select(!0,!0),E.series[Number(t)].data[o].select(!0,!0),saveMarkerANDaddTr(r,n,s,!1,o),saveMarkerANDaddTr(i,n,l,!1,o)}}else if("y"==RF_SP2Store.stateObj.comfirm_key)if(this.selected)_.forEach(RF_SP2Store.stateObj.splineSelectedArr[a],function(e,a){if(!_.isNil(e.isNew)){var t=_.indexOf(j,e.name);E.series[t].data[_.indexOf(E.xAxis[0].categories,e.x)].select(!1,!0)}}),RF_SP2Store.stateObj.splineSelectedArr[a]=[],$(".buildMarker_body>.container-fluid tbody").empty(),RF_SP2Store.stateObj.key_y=!1;else{if(RF_SP2Store.stateObj.key_y)return!1;var c=E.series[Number(!t)].yData,x=_.lastIndexOf(c,s),u=_.indexOf(c,s);if(o==x&&o==u){var f=judgeIntersect(c,o,1,s),b=_.reverse(_.cloneDeep(c)),y=b.length-o-1,m=judgeIntersect(b,y,1,s);if(f||m){if(f&&!m)console.warn("第一步，自己曲线找","以y为Key时，当前曲线另一点存在但是还未找到，位置大于当前点"),renderPointToChart({iindex:o,yData1:c,y:s,chart:E,ii:t,name:r,x:n,flag:"last"});else if(!f&&m)console.warn("第一步，自己曲线找","以y为Key时，当前曲线另一点存在但是还未找到，位置小于当前点"),renderPointToChart({iindex:y,yData1:b,y:s,chart:E,ii:t,name:r,x:n,flag:"first"});else if(f&&m){console.warn("第一步，自己曲线找","以y为Key时，当前曲线存在两极");var h=findPointCombinatorial({fromIndex:0,Arr:c,baseVal:s,flag:"last"}),D=[],S=E.xAxis[0].categories;_.forEach([_.head(h),_.last(h)],function(e,a){var t=S[e.index],r=S[e.index+1],i=e.arr[0],n=e.arr[1];D.push(getPointXY({one:[t,i],two:[r,n],baseVal:s,index:e.index}))});var p=buildNewxyData({pointArr:D,xData:_.cloneDeep(S),yData:_.cloneDeep(c),yData2:_.cloneDeep(E.series[Number(t)].yData)});E.xAxis[0].setCategories(p.xData),E.series[Number(!t)].setData(p.yData),E.series[Number(t)].setData(p.yData2),saveMarkerANDaddTr(r,D[0].x,s,!0,D[0].index+1),saveMarkerANDaddTr(r,D[1].x,s,!0,D[1].index+2)}}else RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为Key时，当前曲线另一点不存在",type:"error",timer:2e3}),saveMarkerANDaddTr(r,n,s,!1,o),saveMarkerANDaddTr(r,NaN,s,null,-1)}else o==x&&o!=u?(console.warn("第一步，自己曲线找","当前曲线两点都存在，另一点位置在"+u),saveMarkerANDaddTr(r,n,s,!1,o),saveMarkerANDaddTr(r,E.xAxis[0].categories[u],s,!1,u)):o!=x&&o==u?(console.warn("第一步，自己曲线找","当前曲线两点都存在，另一点位置在"+x),saveMarkerANDaddTr(r,n,s,!1,o),saveMarkerANDaddTr(r,E.xAxis[0].categories[x],s,!1,x)):o!=x&&o!=u&&(console.warn("第一步，自己曲线找","当前曲线两点都存在，两点位置在"+u+","+x),saveMarkerANDaddTr(r,E.xAxis[0].categories[u],s,!1,u),saveMarkerANDaddTr(r,E.xAxis[0].categories[x],s,!1,x));var g=E.xAxis[0].categories,N=E.series[Number(t)].yData,v=[];if(_.forEach(N,function(e,a){e==s&&v.push(a)}),0==v.length)if(judgeIntersect(N,0,0,s)){var A,k=findPointCombinatorial({fromIndex:0,Arr:N,baseVal:s,flag:"last"}),P=[];1==k.length?(_.forEach([_.head(k)],function(e,a){var t=g[e.index],r=g[e.index+1],i=e.arr[0],n=e.arr[1];P.push(getPointXY({one:[t,i],two:[r,n],baseVal:s,index:e.index}))}),A=buildNewxyData({pointArr:P,xData:_.cloneDeep(g),yData:_.cloneDeep(N),yData2:_.cloneDeep(E.series[Number(!t)].yData)}),E.xAxis[0].setCategories(A.xData),E.series[Number(t)].setData(A.yData),E.series[Number(!t)].setData(A.yData2),saveMarkerANDaddTr(i,NaN,s,null,-1),saveMarkerANDaddTr(i,P[0].x,s,!0,P[0].index+1)):(_.forEach([_.head(k),_.last(k)],function(e,a){var t=g[e.index],r=g[e.index+1],i=e.arr[0],n=e.arr[1];P.push(getPointXY({one:[t,i],two:[r,n],baseVal:s,index:e.index}))}),A=buildNewxyData({pointArr:P,xData:_.cloneDeep(g),yData:_.cloneDeep(N),yData2:_.cloneDeep(E.series[Number(!t)].yData)}),E.xAxis[0].setCategories(A.xData),E.series[Number(t)].setData(A.yData),E.series[Number(!t)].setData(A.yData2),saveMarkerANDaddTr(i,P[0].x,s,!0,P[0].index+1),saveMarkerANDaddTr(i,P[1].x,s,!0,P[1].index+2))}else RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为Key时，另一条曲线两点都不存在",type:"error",timer:2e3}),saveMarkerANDaddTr(i,NaN,s,null,-1),saveMarkerANDaddTr(i,NaN,s,null,-1);else if(1==v.length){console.warn("第二步，另一条曲线找","另一条曲线有相同的y，有一个");var F=_.reverse(_.cloneDeep(N)),M=F.length-_.head(v)-1,w=judgeIntersect(N,_.head(v),1,s),T=judgeIntersect(F,M,1,s);if(w||T){if(w&&!T)console.warn("第二步，另一条曲线找","向后找有，向前找没"),renderPointToChart({iindex:_.head(v),yData1:N,y:s,chart:E,ii:!t,name:i,x:g[_.head(v)],flag:"last"});else if(!w&&T)console.warn("第二步，另一条曲线找","向前找有，向后找没"),renderPointToChart({iindex:M,yData1:F,y:s,chart:E,ii:!t,name:i,x:g[_.head(v)],flag:"first"});else if(w&&T){console.warn("第二步，另一条曲线找","另一条曲存在两极点");var O,C=findPointCombinatorial({fromIndex:0,Arr:N,baseVal:s,flag:"last"}),R=[];_.forEach([_.head(C),_.last(C)],function(e,a){var t=g[e.index],r=g[e.index+1],i=e.arr[0],n=e.arr[1];R.push(getPointXY({one:[t,i],two:[r,n],baseVal:s,index:e.index}))}),O=buildNewxyData({pointArr:R,xData:_.cloneDeep(g),yData:_.cloneDeep(N),yData2:_.cloneDeep(E.series[Number(!t)].yData)}),E.xAxis[0].setCategories(O.xData),E.series[Number(t)].setData(O.yData),E.series[Number(!t)].setData(O.yData2),saveMarkerANDaddTr(i,R[0].x,s,!0,R[0].index+1),saveMarkerANDaddTr(i,R[1].x,s,!0,R[1].index+2)}}else RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为Key时，另一条曲线只存在一个点",type:"info",timer:2e3}),saveMarkerANDaddTr(i,g[_.head(v)],s,!1,_.head(v)),saveMarkerANDaddTr(i,NaN,s,null,-1)}else console.warn("第二步，另一条曲线找","另一条曲线有相同的y，大于一个"),saveMarkerANDaddTr(i,g[_.head(v)],s,!1,_.head(v)),saveMarkerANDaddTr(i,g[_.last(v)],s,!1,_.last(v));_.forEach(RF_SP2Store.stateObj.splineSelectedArr[a],function(e,a){if(!_.isNil(e.isNew)){var t=_.indexOf(j,e.name);E.series[t].data[_.indexOf(E.xAxis[0].categories,e.x)].select(!0,!0)}}),RF_SP2Store.stateObj.key_y=!0}}}}}}});_.isFunction(a.callback)&&a.callback(E)}function judgeIntersect(t,r,i,n){var s=!1;return _.forEach(t,function(e,a){if(r<a)if(t[r+i]>n){if(e<n)return!(s=!0)}else{if(!(t[r+i]<n))return!(s=!0);if(n<e)return!(s=!0)}}),s}function saveMarkerANDaddTr(a,e,t,r,i){_.isNil(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter])&&(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter]=[]);var n=RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter],s=_.find(RF_SP2Store.waferTCFSelected,function(e){return _.isEqual(RF_SP2Store.stateObj.TCFsParameter,e.sParameter)&&2==(e.selected||[]).length});if(!_.isNil(s)){var o,l,d,c=_.find(s.selected,function(e){return _.isEqual(e.curvefile,a.split("  ")[1])}).curvetypeid,x=_.find(n,function(e){return _.isEqual(RF_SP2Store.stateObj.TCFsParameter,e.sParameter)&&_.isEqual(e.name,a)}),u=_.findIndex(s.selected,function(e){return _.isEqual(e.curvefile,a.split("  ")[1])})+1;if(_.isNil(x))o="L";else o=x.x<=e?"R":(x.markerName="Marker"+u+"_R","L");l=_.isNil(n)||_.isEmpty(n)?"1_L":u+o,d="Marker"+u+"_"+o,n.push({name:a,x:e,y:t,markerName:d,key:RF_SP2Store.stateObj.comfirm_key,id:l,isNew:r,newIndex:i,curvetypeid:c,sParameter:s.sParameter}),renderMarkerAddTr()}}function renderMarkerAddTr(){_.isNil(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter])&&(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter]=[]);var e=RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter],a="";_.forEach(e,function(e){a+='<tr data-iflag="'+(e.name+e.x)+'" data-curvetypeid="'+e.curvetypeid+'" data-imarkername="'+e.markerName+'" data-ix="'+e.x+'"><td contenteditable="true" title="点击修改" data-iorigin="'+e.markerName+'">'+e.markerName+"</td><td>"+e.x+"</td><td>"+e.y+"</td><td>"+e.key+"</td></tr>"}),$(".buildMarker_body>.container-fluid tbody").empty().append(a)}function findPointCombinatorial(s){s.fromIndex;var o=[];return _.reduce(s.Arr,function(e,a,t,r){if(t>s.fromIndex){var i,n;if(_.sortBy([e,a])[0]<s.baseVal&&s.baseVal<_.sortBy([e,a])[1])"last"==s.flag?(i=t-1,n=[e,a]):"first"==s.flag&&(i=r.length-t-1,n=[a,e]),o.push({index:i,arr:n});return a}},s.Arr[s.fromIndex+1]),o}function getPointXY(e){var a=(e.two[1]-e.one[1])/e.two[0]-e.one[0],t=e.two[0]-(e.two[1]-e.baseVal)/a;return{x:t=Math.floor(100*t)/100,y:e.baseVal,index:e.index}}function buildNewxyData(t){return _.forEach(t.pointArr,function(e,a){t.xData.splice(e.index+a+1,0,e.x),t.yData.splice(e.index+a+1,0,e.y),t.yData2.splice(e.index+a+1,0,t.yData2[e.index+a])}),{xData:_.cloneDeep(t.xData),yData:_.cloneDeep(t.yData),yData2:_.cloneDeep(t.yData2)}}function renderPointToChart(e){var a=e.iindex,t=e.yData1,s=e.y,r=e.chart,o=r.xAxis[0].categories,i=e.ii,n=e.name,l=e.x,d=e.flag,c=findPointCombinatorial({fromIndex:a,Arr:t,baseVal:s,flag:d}),x=[],u=[];"last"==d||"first"==d?u[0]=_.last(c):"twoSlide"==d&&(u[0]=_.last(c)),_.forEach(u,function(e,a){var t=o[e.index],r=o[e.index+1],i=e.arr[0],n=e.arr[1];x.push(getPointXY({one:[t,i],two:[r,n],baseVal:s,index:e.index}))});var f=buildNewxyData({pointArr:x,xData:_.cloneDeep(o),yData:_.cloneDeep(r.series[Number(!i)].yData),yData2:_.cloneDeep(r.series[Number(i)].yData)});r.xAxis[0].setCategories(f.xData),r.series[Number(!i)].setData(f.yData),r.series[Number(i)].setData(f.yData2),saveMarkerANDaddTr(n,l,s,!1,a),saveMarkerANDaddTr(n,_.last(x).x,_.last(x).y,!0,_.last(x).index+1)}