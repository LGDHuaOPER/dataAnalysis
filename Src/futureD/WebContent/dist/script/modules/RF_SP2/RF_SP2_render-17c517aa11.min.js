function getDataBuildS12S21(e){var a=e.allData,t=e.container,r=e.zoomType,i=e.showCheckbox,n=e.title,s=e.legend_enabled,o=e.renderData,l=e.GHzFlag,d=e.callback,c=e.pointMouseOverCallback,x={xCategories:[]};_.forEach(a[0].data,function(e,a){!0===l?x.xCategories.push(e[0]):x.xCategories.push(Math.floor(e[0]/1e7)/100)}),x.series=[],o&&_.forEach(a,function(e,a){var t={};t.name=e.name,t.data=[],_.forEach(e.data,function(e,a){t.data.push(parseFloat(e[1]))}),x.series.push(t)}),x.container=t,x.zoomType=r,x.resetZoomButton={position:{align:"left",x:0,y:0},relativeTo:"chart"},x.showCheckbox=i,x.title=n,x.legend_enabled=s,x.callback=d,x.pointMouseOverCallback=c,drawRealS12S21(x)}function getDataBuildS11S22(e){var a=smithChart({dom:e.wrapDOM,titleOneArr:e.title,legendNameOneArr:e.legendName,allDataArr:e.data,Type:e.classify,msgdom:e.msgDOM,lineColorArray:e.lineColorArray,msgFun:e.msgFun,msgInitFun:e.msgInitFun,GHzFlag:e.GHzFlag});_.isFunction(e.callback)&&e.callback(a)}function drawRealS12S21(a){var e=a.container,t=a.xCategories,r=a.series,i=!!_.isNil(a.legend_enabled)||a.legend_enabled,n=a.zoomType||"None",s=a.resetZoomButton,o=a.title||{text:null},l=a.showCheckbox||!1,d=Highcharts.chart(e,{chart:{type:"line",zoomType:n,resetZoomButton:s},title:o,lang:{loading:"Loading..."},legend:{enabled:i},xAxis:{title:{text:"GHz"},categories:t},yAxis:{title:{text:"dB"},gridLineColor:"#eee",gridLineWidth:1},series:r,credits:{enabled:!1},tooltip:{formatter:function(e){return"<b>"+this.series.name+"</b><br>"+this.x+" GHz, "+this.y+" dB"},useHTML:!0},plotOptions:{series:{point:{events:{mouseOver:function(e){_.isFunction(a.pointMouseOverCallback)&&a.pointMouseOverCallback(this,d,e)}}},showCheckbox:l}}});return _.isFunction(a.callback)&&a.callback(d),d}function getEventPosition(e){var a,t;return e.layerX||0==e.layerX?(a=e.layerX,t=e.layerY):(e.offsetX||0==e.offsetX)&&(a=e.offsetX,t=e.offsetY),{x:a,y:t}}function renderSpline(a){var R=a.name,j=Highcharts.chart(a.container,{chart:{type:"spline",zoomType:"x",resetZoomButton:{position:{align:"left",x:90,y:10},relativeTo:"chart"}},title:{text:a.title},lang:{loading:"Loading..."},legend:{enabled:!0},xAxis:{title:{text:"Mhz"},categories:a.data.xData[0],gridLineColor:"#197F07",gridLineWidth:0,crosshair:{dashStyle:"LongDashDotDot",width:2,color:"#bbbbbb",snap:!0}},yAxis:{title:{text:"dB"},gridLineColor:"#eee",gridLineWidth:1,crosshair:{dashStyle:"LongDashDotDot",width:2,color:"#bbbbbb",snap:!0}},series:[{name:a.name[0],data:a.data.yData[0]},{name:a.name[1],data:a.data.yData[1]}],credits:{enabled:!1},tooltip:{formatter:function(e){return"y"==RF_SP2Store.stateObj.comfirm_key?"<b>"+this.series.name+"</b><br>"+this.x+' Mhz, <b class="underline_b">'+this.y+" dB</b>":"x"==RF_SP2Store.stateObj.comfirm_key?"<b>"+this.series.name+'</b><br><b class="underline_b">'+this.x+" Mhz</b>, "+this.y+" dB":"<b>"+this.series.name+"</b><br>"+this.x+" Mhz, "+this.y+" dB"},useHTML:!0},plotOptions:{series:{allowPointSelect:!1,connectNulls:!0,marker:{enabled:!0,radius:1,symbol:"diamond",states:{hover:{fillColor:"white",lineColor:"black",lineWidth:3},select:{fillColor:"white",lineColor:"red",lineWidth:3,radius:4}}},cursor:"pointer",point:{events:{mouseOver:function(e){0==this.colorIndex?($(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(0).children().text(this.series.name+" "+this.category+"Mhz, "+this.y+"dB"),$(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(1).children().text(a.name[1]+" "+this.category+"Mhz, "+a.data.yData[1][this.x]+"dB")):($(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(1).children().text(this.series.name+" "+this.category+"Mhz, "+this.y+"dB"),$(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(0).children().text(a.name[0]+" "+this.category+"Mhz, "+a.data.yData[0][this.x]+"dB"))},click:function(e){if(_.isNil(RF_SP2Store.stateObj.comfirm_key))return RF_SP2SwalMixin({title:"Key值设置提醒",text:"请先设置Key值并保存",type:"info",showConfirmButton:!1,timer:2e3}),!1;var a=!this.colorIndex,t=this.series.name,r=j.series[Number(a)].name,i=this.category,s=this.y,n=this.x;if("x"==RF_SP2Store.stateObj.comfirm_key){var o=j.series[Number(a)].yData[n];if(this.selected)this.select(!1,!0),j.series[Number(a)].data[n].select(!1,!0),_.pull(RF_SP2Store.stateObj.splineSelectedArr,_.find(RF_SP2Store.stateObj.splineSelectedArr,function(e){var a=!1;return e.name==t&&e.x==i&&(a=!0),a})),_.pull(RF_SP2Store.stateObj.splineSelectedArr,_.find(RF_SP2Store.stateObj.splineSelectedArr,function(e){var a=!1;return e.name==r&&e.x==i&&(a=!0),a})),$(".buildMarker_body>.container-fluid tbody>tr[data-iflag='"+(t+i)+"']").remove(),$(".buildMarker_body>.container-fluid tbody>tr[data-iflag='"+(r+i)+"']").remove();else{var l=0;if(_.forEach(RF_SP2Store.stateObj.splineSelectedArr,function(e){e.name==t&&l++}),1<l)return RF_SP2SwalMixin({title:"Marker打点提示",text:"以x为Key时一条曲线最多打2个点",type:"error",timer:2500}),!1;this.select(!0,!0),j.series[Number(a)].data[n].select(!0,!0),saveMarkerANDaddTr(t,i,s,!1,n),saveMarkerANDaddTr(r,i,o,!1,n)}}else if("y"==RF_SP2Store.stateObj.comfirm_key)if(this.selected)_.forEach(RF_SP2Store.stateObj.splineSelectedArr,function(e,a){if(!_.isNil(e.isNew)){var t=_.indexOf(R,e.name);j.series[t].data[_.indexOf(j.xAxis[0].categories,e.x)].select(!1,!0)}}),RF_SP2Store.stateObj.splineSelectedArr=[],$(".buildMarker_body>.container-fluid tbody").empty(),RF_SP2Store.stateObj.key_y=!1;else{if(RF_SP2Store.stateObj.key_y)return!1;var d=j.series[Number(!a)].yData,c=_.lastIndexOf(d,s),x=_.indexOf(d,s);if(n==c&&n==x){var b=judgeIntersect(d,n,1,s),y=_.reverse(_.cloneDeep(d)),f=y.length-n-1,u=judgeIntersect(y,f,1,s);if(b||u){if(b&&!u)console.warn("第一步，自己曲线找","以y为Key时，当前曲线另一点存在但是还未找到，位置大于当前点"),renderPointToChart({iindex:n,yData1:d,y:s,chart:j,ii:a,name:t,x:i,flag:"last"});else if(!b&&u)console.warn("第一步，自己曲线找","以y为Key时，当前曲线另一点存在但是还未找到，位置小于当前点"),renderPointToChart({iindex:f,yData1:y,y:s,chart:j,ii:a,name:t,x:i,flag:"first"});else if(b&&u){console.warn("第一步，自己曲线找","以y为Key时，当前曲线存在两极");var h=findPointCombinatorial({fromIndex:0,Arr:d,baseVal:s,flag:"last"}),D=[],m=j.xAxis[0].categories;_.forEach([_.head(h),_.last(h)],function(e,a){var t=m[e.index],r=m[e.index+1],i=e.arr[0],n=e.arr[1];D.push(getPointXY({one:[t,i],two:[r,n],baseVal:s,index:e.index}))});var g=buildNewxyData({pointArr:D,xData:_.cloneDeep(m),yData:_.cloneDeep(d),yData2:_.cloneDeep(j.series[Number(a)].yData)});j.xAxis[0].setCategories(g.xData),j.series[Number(!a)].setData(g.yData),j.series[Number(a)].setData(g.yData2),saveMarkerANDaddTr(t,D[0].x,s,!0,D[0].index+1),saveMarkerANDaddTr(t,D[1].x,s,!0,D[1].index+2)}}else RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为Key时，当前曲线另一点不存在",type:"error",timer:2e3}),saveMarkerANDaddTr(t,i,s,!1,n),saveMarkerANDaddTr(t,NaN,s,null,-1)}else n==c&&n!=x?(console.warn("第一步，自己曲线找","当前曲线两点都存在，另一点位置在"+x),saveMarkerANDaddTr(t,i,s,!1,n),saveMarkerANDaddTr(t,j.xAxis[0].categories[x],s,!1,x)):n!=c&&n==x?(console.warn("第一步，自己曲线找","当前曲线两点都存在，另一点位置在"+c),saveMarkerANDaddTr(t,i,s,!1,n),saveMarkerANDaddTr(t,j.xAxis[0].categories[c],s,!1,c)):n!=c&&n!=x&&(console.warn("第一步，自己曲线找","当前曲线两点都存在，两点位置在"+x+","+c),saveMarkerANDaddTr(t,j.xAxis[0].categories[x],s,!1,x),saveMarkerANDaddTr(t,j.xAxis[0].categories[c],s,!1,c));var p=j.xAxis[0].categories,N=j.series[Number(a)].yData,S=[];if(_.forEach(N,function(e,a){e==s&&S.push(a)}),0==S.length)if(judgeIntersect(N,0,0,s)){var v,A=findPointCombinatorial({fromIndex:0,Arr:N,baseVal:s,flag:"last"}),k=[];1==A.length?(_.forEach([_.head(A)],function(e,a){var t=p[e.index],r=p[e.index+1],i=e.arr[0],n=e.arr[1];k.push(getPointXY({one:[t,i],two:[r,n],baseVal:s,index:e.index}))}),v=buildNewxyData({pointArr:k,xData:_.cloneDeep(p),yData:_.cloneDeep(N),yData2:_.cloneDeep(j.series[Number(!a)].yData)}),j.xAxis[0].setCategories(v.xData),j.series[Number(a)].setData(v.yData),j.series[Number(!a)].setData(v.yData2),saveMarkerANDaddTr(r,NaN,s,null,-1),saveMarkerANDaddTr(r,k[0].x,s,!0,k[0].index+1)):(_.forEach([_.head(A),_.last(A)],function(e,a){var t=p[e.index],r=p[e.index+1],i=e.arr[0],n=e.arr[1];k.push(getPointXY({one:[t,i],two:[r,n],baseVal:s,index:e.index}))}),v=buildNewxyData({pointArr:k,xData:_.cloneDeep(p),yData:_.cloneDeep(N),yData2:_.cloneDeep(j.series[Number(!a)].yData)}),j.xAxis[0].setCategories(v.xData),j.series[Number(a)].setData(v.yData),j.series[Number(!a)].setData(v.yData2),saveMarkerANDaddTr(r,k[0].x,s,!0,k[0].index+1),saveMarkerANDaddTr(r,k[1].x,s,!0,k[1].index+2))}else RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为Key时，另一条曲线两点都不存在",type:"error",timer:2e3}),saveMarkerANDaddTr(r,NaN,s,null,-1),saveMarkerANDaddTr(r,NaN,s,null,-1);else if(1==S.length){console.warn("第二步，另一条曲线找","另一条曲线有相同的y，有一个");var M=_.reverse(_.cloneDeep(N)),w=M.length-_.head(S)-1,P=judgeIntersect(N,_.head(S),1,s),T=judgeIntersect(M,w,1,s);if(P||T){if(P&&!T)console.warn("第二步，另一条曲线找","向后找有，向前找没"),renderPointToChart({iindex:_.head(S),yData1:N,y:s,chart:j,ii:!a,name:r,x:p[_.head(S)],flag:"last"});else if(!P&&T)console.warn("第二步，另一条曲线找","向前找有，向后找没"),renderPointToChart({iindex:w,yData1:M,y:s,chart:j,ii:!a,name:r,x:p[_.head(S)],flag:"first"});else if(P&&T){console.warn("第二步，另一条曲线找","另一条曲存在两极点");var O,F=findPointCombinatorial({fromIndex:0,Arr:N,baseVal:s,flag:"last"}),C=[];_.forEach([_.head(F),_.last(F)],function(e,a){var t=p[e.index],r=p[e.index+1],i=e.arr[0],n=e.arr[1];C.push(getPointXY({one:[t,i],two:[r,n],baseVal:s,index:e.index}))}),O=buildNewxyData({pointArr:C,xData:_.cloneDeep(p),yData:_.cloneDeep(N),yData2:_.cloneDeep(j.series[Number(!a)].yData)}),j.xAxis[0].setCategories(O.xData),j.series[Number(a)].setData(O.yData),j.series[Number(!a)].setData(O.yData2),saveMarkerANDaddTr(r,C[0].x,s,!0,C[0].index+1),saveMarkerANDaddTr(r,C[1].x,s,!0,C[1].index+2)}}else RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为Key时，另一条曲线只存在一个点",type:"info",timer:2e3}),saveMarkerANDaddTr(r,p[_.head(S)],s,!1,_.head(S)),saveMarkerANDaddTr(r,NaN,s,null,-1)}else console.warn("第二步，另一条曲线找","另一条曲线有相同的y，大于一个"),saveMarkerANDaddTr(r,p[_.head(S)],s,!1,_.head(S)),saveMarkerANDaddTr(r,p[_.last(S)],s,!1,_.last(S));_.forEach(RF_SP2Store.stateObj.splineSelectedArr,function(e,a){if(!_.isNil(e.isNew)){var t=_.indexOf(R,e.name);j.series[t].data[_.indexOf(j.xAxis[0].categories,e.x)].select(!0,!0)}}),RF_SP2Store.stateObj.key_y=!0}}}}}}});a.callback&&a.callback(j)}function judgeIntersect(t,r,i,n){var s=!1;return _.forEach(t,function(e,a){if(r<a)if(t[r+i]>n){if(e<n)return!(s=!0)}else{if(!(t[r+i]<n))return!(s=!0);if(n<e)return!(s=!0)}}),s}function saveMarkerANDaddTr(e,a,t,r,i){var n,s="Marker"+(n=_.isNil(RF_SP2Store.stateObj.splineSelectedArr)||_.isEmpty(RF_SP2Store.stateObj.splineSelectedArr)?1:Number(_.last(_.sortBy(RF_SP2Store.stateObj.splineSelectedArr,function(e){return e.id})).id)+1);RF_SP2Store.stateObj.splineSelectedArr.push({name:e,x:a,y:t,markerName:s,key:RF_SP2Store.stateObj.comfirm_key,id:n,isNew:r,newIndex:i}),$(".buildMarker_body>.container-fluid tbody").append('<tr data-iflag="'+(e+a)+'"><td contenteditable="true" title="点击修改" data-iorigin="'+s+'">'+s+"</td><td>"+a+"</td><td>"+t+"</td><td>"+RF_SP2Store.stateObj.comfirm_key+"</td></tr>")}function findPointCombinatorial(s){s.fromIndex;var o=[];return _.reduce(s.Arr,function(e,a,t,r){if(t>s.fromIndex){var i,n;if(_.sortBy([e,a])[0]<s.baseVal&&s.baseVal<_.sortBy([e,a])[1])"last"==s.flag?(i=t-1,n=[e,a]):"first"==s.flag&&(i=r.length-t-1,n=[a,e]),o.push({index:i,arr:n});return a}},s.Arr[s.fromIndex+1]),o}function getPointXY(e){var a=(e.two[1]-e.one[1])/e.two[0]-e.one[0],t=e.two[0]-(e.two[1]-e.baseVal)/a;return{x:t=Math.floor(100*t)/100,y:e.baseVal,index:e.index}}function buildNewxyData(t){return _.forEach(t.pointArr,function(e,a){t.xData.splice(e.index+a+1,0,e.x),t.yData.splice(e.index+a+1,0,e.y),t.yData2.splice(e.index+a+1,0,t.yData2[e.index+a])}),{xData:_.cloneDeep(t.xData),yData:_.cloneDeep(t.yData),yData2:_.cloneDeep(t.yData2)}}function renderPointToChart(e){var a=e.iindex,t=e.yData1,s=e.y,r=e.chart,o=r.xAxis[0].categories,i=e.ii,n=e.name,l=e.x,d=e.flag,c=findPointCombinatorial({fromIndex:a,Arr:t,baseVal:s,flag:d}),x=[],b=[];"last"==d||"first"==d?b[0]=_.last(c):"twoSlide"==d&&(b[0]=_.last(c)),_.forEach(b,function(e,a){var t=o[e.index],r=o[e.index+1],i=e.arr[0],n=e.arr[1];x.push(getPointXY({one:[t,i],two:[r,n],baseVal:s,index:e.index}))});var y=buildNewxyData({pointArr:x,xData:_.cloneDeep(o),yData:_.cloneDeep(r.series[Number(!i)].yData),yData2:_.cloneDeep(r.series[Number(i)].yData)});r.xAxis[0].setCategories(y.xData),r.series[Number(!i)].setData(y.yData),r.series[Number(i)].setData(y.yData2),saveMarkerANDaddTr(n,l,s,!1,a),saveMarkerANDaddTr(n,_.last(x).x,_.last(x).y,!0,_.last(x).index+1)}