function getDataBuildS12S21(e){var t=e.allData,a=e.container,r=e.zoomType,i=e.showCheckbox,n=e.title,s=e.legend_enabled,o=e.renderData,l=e.GHzFlag,d=e.callback,c=e.pointMouseOverCallback,u={xCategories:[]};_.forEach(t[0].data,function(e,t){!0===l?u.xCategories.push(e[0]):u.xCategories.push(Math.floor(e[0]/1e7)/100)}),u.series=[],o&&_.forEach(t,function(e,t){var a={};a.name=e.name,a.data=[],_.forEach(e.data,function(e,t){a.data.push(parseFloat(e[1]))}),u.series.push(a)}),u.container=a,u.zoomType=r,u.resetZoomButton={position:{align:"left",x:0,y:0},relativeTo:"chart"},u.showCheckbox=i,u.title=n,u.legend_enabled=s,u.callback=d,u.pointMouseOverCallback=c,drawRealS12S21(u)}function getDataBuildS11S22(e){var t=smithChart({dom:e.wrapDOM,titleOneArr:e.title,legendNameOneArr:e.legendName,allDataArr:e.data,Type:e.classify,msgdom:e.msgDOM,lineColorArray:e.lineColorArray,msgFun:e.msgFun,msgInitFun:e.msgInitFun,GHzFlag:e.GHzFlag});_.isFunction(e.callback)&&e.callback(t)}function drawRealS12S21(t){var e=t.container,a=t.xCategories,r=t.series,i=!!_.isNil(t.legend_enabled)||t.legend_enabled,n=t.zoomType||"None",s=t.resetZoomButton,o=t.title||{text:null},l=t.showCheckbox||!1,d=Highcharts.chart(e,{chart:{type:"line",zoomType:n,resetZoomButton:s},title:o,lang:{loading:"Loading..."},legend:{enabled:i},xAxis:{title:{text:"GHz"},categories:a},yAxis:{title:{text:"dB"},gridLineColor:"#eee",gridLineWidth:1},series:r,credits:{enabled:!1},tooltip:{formatter:function(e){return"<b>"+this.series.name+"</b><br>"+this.x+" GHz, "+this.y+" dB"},useHTML:!0},plotOptions:{series:{point:{events:{mouseOver:function(e){_.isFunction(t.pointMouseOverCallback)&&t.pointMouseOverCallback(this,d,e)}}},showCheckbox:l}}});return _.isFunction(t.callback)&&t.callback(d),d}function getEventPosition(e){var t,a;return e.layerX||0==e.layerX?(t=e.layerX,a=e.layerY):(e.offsetX||0==e.offsetX)&&(t=e.offsetX,a=e.offsetY),{x:t,y:a}}function renderSpline(t){var q=t.name,z=Highcharts.chart(t.container,{chart:{type:"spline",zoomType:"x",resetZoomButton:{position:{align:"left",x:90,y:10},relativeTo:"chart"}},title:{text:t.title},lang:{loading:"Loading..."},legend:{enabled:!0},xAxis:{title:{text:"GHz"},categories:t.data.xData[0],gridLineColor:"#197F07",gridLineWidth:0,crosshair:{dashStyle:"LongDashDotDot",width:2,color:"#bbbbbb",snap:!0}},yAxis:{title:{text:"dB"},gridLineColor:"#eee",gridLineWidth:1,crosshair:{dashStyle:"LongDashDotDot",width:2,color:"#bbbbbb",snap:!0}},series:[{name:t.name[0],data:t.data.yData[0]},{name:t.name[1],data:t.data.yData[1]}],credits:{enabled:!1},tooltip:{formatter:function(e){return"y"==RF_SP2Store.stateObj.comfirm_key?"<b>"+this.series.name+"</b><br>"+this.x+' GHz, <b class="underline_b">'+this.y+" dB</b>":"x"==RF_SP2Store.stateObj.comfirm_key?"<b>"+this.series.name+'</b><br><b class="underline_b">'+this.x+" GHz</b>, "+this.y+" dB":"<b>"+this.series.name+"</b><br>"+this.x+" GHz, "+this.y+" dB"},useHTML:!0},plotOptions:{series:{allowPointSelect:!1,connectNulls:!0,marker:{enabled:!0,radius:1,symbol:"diamond",states:{hover:{fillColor:"white",lineColor:"black",lineWidth:3},select:{fillColor:"white",lineColor:"red",lineWidth:3,radius:4}}},cursor:"pointer",point:{events:{mouseOver:function(e){0==this.colorIndex?($(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(0).children().text(this.series.name+" "+this.category+"GHz, "+this.y+"dB"),$(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(1).children().text(t.name[1]+" "+this.category+"GHz, "+t.data.yData[1][this.x]+"dB")):($(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(1).children().text(this.series.name+" "+this.category+"GHz, "+this.y+"dB"),$(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(0).children().text(t.name[0]+" "+this.category+"GHz, "+t.data.yData[0][this.x]+"dB"))},click:function(e){if(_.isNil(RF_SP2Store.stateObj.comfirm_key)||_.isEqual(RF_SP2Store.stateObj.comfirm_key,"请选择"))return RF_SP2SwalMixin({title:"Key值设置提醒",text:"请先设置Key值并保存",type:"info",showConfirmButton:!1,timer:1900}),!1;var t=RF_SP2Store.stateObj.TCFsParameter,a=!this.colorIndex,r=this.series.name,i=z.series[Number(a)].name,n=this.category,s=this.y,o=this.x,l=RF_SP2Store.util.curTCFSelectWafer();if(_.isNil(l))return RF_SP2SwalMixin({title:"Key值设置提醒",text:"请检查是否更换选择了曲线文件，但是未重新绘图",type:"warning",showConfirmButton:!1,timer:2500}),!1;var d=l.waferfile.replace(/\..*$/,""),c=_.some(l.selected,function(e){return _.eq(d+"  "+e.curvefile,r)}),u=_.some(l.selected,function(e){return _.eq(d+"  "+e.curvefile,i)});if(!c||!u)return RF_SP2SwalMixin({title:"Key值设置提醒",text:"请检查是否更换选择了曲线文件，但是未重新绘图",type:"warning",showConfirmButton:!1,timer:2500}),!1;if("x"==RF_SP2Store.stateObj.comfirm_key){var x=z.series[Number(a)].yData[o];if(this.selected)this.select(!1,!0),z.series[Number(a)].data[o].select(!1,!0),_.pull(RF_SP2Store.stateObj.splineSelectedArr[t],_.find(RF_SP2Store.stateObj.splineSelectedArr[t],function(e){var t=!1;return e.name==r&&e.x==n&&(t=!0),t})),_.pull(RF_SP2Store.stateObj.splineSelectedArr[t],_.find(RF_SP2Store.stateObj.splineSelectedArr[t],function(e){var t=!1;return e.name==i&&e.x==n&&(t=!0),t})),$(".buildMarker_body>.container-fluid tbody>tr[data-iflag='"+(r+n)+"']").remove(),$(".buildMarker_body>.container-fluid tbody>tr[data-iflag='"+(i+n)+"']").remove();else{var f=0;if(_.forEach(RF_SP2Store.stateObj.splineSelectedArr[t],function(e){e.name==r&&f++}),1<f)return RF_SP2SwalMixin({title:"Marker打点提示",text:"以x为Key时一条曲线最多打2个点",type:"error",timer:2500}),!1;this.select(!0,!0),z.series[Number(a)].data[o].select(!0,!0),saveMarkerANDaddTr(r,n,s,!1,o),saveMarkerANDaddTr(i,n,x,!1,o)}}else if("y"==RF_SP2Store.stateObj.comfirm_key)if(this.selected)_.forEach(RF_SP2Store.stateObj.splineSelectedArr[t],function(a,e){if(!_.isNil(a.isNew)){var r=z.series[_.indexOf(q,a.name)],t=_.findIndex(z.xAxis[0].categories,function(e,t){return _.eq(r.yData[t],a.y)&&_.eq(e,a.x)});!_.eq(t,-1)&&r.data[t].select(!1,!0)}}),RF_SP2Store.stateObj.splineSelectedArr[t]=[],$(".buildMarker_body>.container-fluid tbody").empty(),RF_SP2Store.stateObj.key_y=!1;else{if(RF_SP2Store.stateObj.key_y)return RF_SP2SwalMixin({title:"Key值设置提醒",text:"以y为key时，仅可选取一次",type:"info",showConfirmButton:!1,timer:1900}),!1;var y=z.series[Number(!a)].yData,b=_.lastIndexOf(y,s),m=_.indexOf(y,s);if(o==b&&o==m){var D=judgeIntersect(y,o,1,s),h=_.reverse(_.cloneDeep(y)),S=h.length-o-1,g=judgeIntersect(h,S,1,s);if(D||g){if(D&&!g)console.warn("第一步，自己曲线找","以y为Key时，当前曲线另一点存在但是还未找到，位置大于当前点"),renderPointToChart({iindex:o,yData1:y,y:s,chart:z,ii:a,name:r,x:n,flag:"last"});else if(!D&&g)console.warn("第一步，自己曲线找","以y为Key时，当前曲线另一点存在但是还未找到，位置小于当前点"),renderPointToChart({iindex:S,yData1:h,y:s,chart:z,ii:a,name:r,x:n,flag:"first"});else if(D&&g){console.warn("第一步，自己曲线找","以y为Key时，当前曲线存在两极");var p=findPointCombinatorial({fromIndex:0,Arr:y,baseVal:s,flag:"last"}),v=[],N=z.xAxis[0].categories;_.forEach([_.head(p),_.last(p)],function(e,t){var a=N[e.index],r=N[e.index+1],i=e.arr[0],n=e.arr[1];v.push(getPointXY({one:[a,i],two:[r,n],baseVal:s,index:e.index}))});var A=buildNewxyData({pointArr:v,xData:_.cloneDeep(N),yData:_.cloneDeep(y),yData2:_.cloneDeep(z.series[Number(a)].yData)});z.xAxis[0].setCategories(A.xData),z.series[Number(!a)].setData(A.yData),z.series[Number(a)].setData(A.yData2),saveMarkerANDaddTr(r,v[0].x,s,!0,v[0].index+1),saveMarkerANDaddTr(r,v[1].x,s,!0,v[1].index+2)}}else RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为Key时，当前曲线另一点不存在",type:"error",timer:2e3}),saveMarkerANDaddTr(r,n,s,!1,o),saveMarkerANDaddTr(r,NaN,s,null,-1)}else o==b&&o!=m?(console.warn("第一步，自己曲线找","当前曲线两点都存在，点击点位置在"+o+"，另一点位置在"+m),saveMarkerANDaddTr(r,n,s,!1,o),saveMarkerANDaddTr(r,z.xAxis[0].categories[m],s,!1,m)):o!=b&&o==m?(console.warn("第一步，自己曲线找","当前曲线两点都存在，点击点位置在"+o+"，另一点位置在"+b),saveMarkerANDaddTr(r,n,s,!1,o),saveMarkerANDaddTr(r,z.xAxis[0].categories[b],s,!1,b)):o!=b&&o!=m&&(console.warn("第一步，自己曲线找","当前曲线两点都存在，两点位置在"+m+","+b),saveMarkerANDaddTr(r,z.xAxis[0].categories[m],s,!1,m),saveMarkerANDaddTr(r,z.xAxis[0].categories[b],s,!1,b));var k=z.xAxis[0].categories,P=z.series[Number(a)].yData,F=[];if(_.forEach(P,function(e,t){e==s&&F.push(t)}),0==F.length)if(judgeIntersect(P,0,0,s)){var w,M=findPointCombinatorial({fromIndex:0,Arr:P,baseVal:s,flag:"last"}),T=[];1==M.length?(_.forEach([_.head(M)],function(e,t){var a=k[e.index],r=k[e.index+1],i=e.arr[0],n=e.arr[1];T.push(getPointXY({one:[a,i],two:[r,n],baseVal:s,index:e.index}))}),w=buildNewxyData({pointArr:T,xData:_.cloneDeep(k),yData:_.cloneDeep(P),yData2:_.cloneDeep(z.series[Number(!a)].yData)}),z.xAxis[0].setCategories(w.xData),z.series[Number(a)].setData(w.yData),z.series[Number(!a)].setData(w.yData2),saveMarkerANDaddTr(i,NaN,s,null,-1),saveMarkerANDaddTr(i,T[0].x,s,!0,T[0].index+1)):(_.forEach([_.head(M),_.last(M)],function(e,t){var a=k[e.index],r=k[e.index+1],i=e.arr[0],n=e.arr[1];T.push(getPointXY({one:[a,i],two:[r,n],baseVal:s,index:e.index}))}),w=buildNewxyData({pointArr:T,xData:_.cloneDeep(k),yData:_.cloneDeep(P),yData2:_.cloneDeep(z.series[Number(!a)].yData)}),z.xAxis[0].setCategories(w.xData),z.series[Number(a)].setData(w.yData),z.series[Number(!a)].setData(w.yData2),saveMarkerANDaddTr(i,T[0].x,s,!0,T[0].index+1),saveMarkerANDaddTr(i,T[1].x,s,!0,T[1].index+2))}else RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为Key时，另一条曲线两点都不存在",type:"error",timer:2e3}),saveMarkerANDaddTr(i,NaN,s,null,-1),saveMarkerANDaddTr(i,NaN,s,null,-1);else if(1==F.length){console.warn("第二步，另一条曲线找","另一条曲线有相同的y，有一个");var C=_.reverse(_.cloneDeep(P)),O=C.length-_.head(F)-1,R=judgeIntersect(P,_.head(F),1,s),j=judgeIntersect(C,O,1,s);if(R||j){if(R&&!j)console.warn("第二步，另一条曲线找","向后找有，向前找没"),renderPointToChart({iindex:_.head(F),yData1:P,y:s,chart:z,ii:!a,name:i,x:k[_.head(F)],flag:"last"});else if(!R&&j)console.warn("第二步，另一条曲线找","向前找有，向后找没"),renderPointToChart({iindex:O,yData1:C,y:s,chart:z,ii:!a,name:i,x:k[_.head(F)],flag:"first"});else if(R&&j){console.warn("第二步，另一条曲线找","另一条曲线存在两极点");var E,B=findPointCombinatorial({fromIndex:0,Arr:P,baseVal:s,flag:"last"}),I=[];_.forEach([_.head(B),_.last(B)],function(e,t){var a=k[e.index],r=k[e.index+1],i=e.arr[0],n=e.arr[1];I.push(getPointXY({one:[a,i],two:[r,n],baseVal:s,index:e.index}))}),E=buildNewxyData({pointArr:I,xData:_.cloneDeep(k),yData:_.cloneDeep(P),yData2:_.cloneDeep(z.series[Number(!a)].yData)}),z.xAxis[0].setCategories(E.xData),z.series[Number(a)].setData(E.yData),z.series[Number(!a)].setData(E.yData2),saveMarkerANDaddTr(i,I[0].x,s,!0,I[0].index+1),saveMarkerANDaddTr(i,I[1].x,s,!0,I[1].index+2)}}else RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为Key时，另一条曲线只存在一个点",type:"info",timer:2e3}),saveMarkerANDaddTr(i,k[_.head(F)],s,!1,_.head(F)),saveMarkerANDaddTr(i,NaN,s,null,-1)}else console.warn("第二步，另一条曲线找","另一条曲线有相同的y，大于一个"),saveMarkerANDaddTr(i,k[_.head(F)],s,!1,_.head(F)),saveMarkerANDaddTr(i,k[_.last(F)],s,!1,_.last(F));_.forEach(RF_SP2Store.stateObj.splineSelectedArr[t],function(a,e){if(!_.isNil(a.isNew)){var r=z.series[_.indexOf(q,a.name)],t=_.findIndex(z.xAxis[0].categories,function(e,t){return _.eq(r.yData[t],a.y)&&_.eq(e,a.x)});!_.eq(t,-1)&&r.data[t].select(!0,!0)}}),RF_SP2Store.stateObj.key_y=!0}}}}}}});_.isFunction(t.callback)&&t.callback(z)}function judgeIntersect(a,r,i,n){var s=!1;return _.forEach(a,function(e,t){if(r<t)if(a[r+i]>n){if(e<n)return!(s=!0)}else{if(!(a[r+i]<n))return!(s=!0);if(n<e)return!(s=!0)}}),s}function saveMarkerANDaddTr(t,e,a,r,i){_.isNil(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter])&&(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter]=[]);var n=RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter],s=_.find(RF_SP2Store.waferTCFSelected,function(e){return _.isEqual(RF_SP2Store.stateObj.TCFsParameter,e.sParameter)&&2==(e.selected||[]).length});if(!_.isNil(s)){var o,l,d,c=_.find(s.selected,function(e){return _.isEqual(e.curvefile,t.split("  ")[1])}).curvetypeid,u=_.find(n,function(e){return _.isEqual(RF_SP2Store.stateObj.TCFsParameter,e.sParameter)&&_.isEqual(e.name,t)}),x=_.findIndex(s.selected,function(e){return _.isEqual(e.curvefile,t.split("  ")[1])})+1;if(_.isNil(u))o="L";else o=u.x<=e?"R":(u.markerName="Marker"+x+"_R","L");l=_.isNil(n)||_.isEmpty(n)?"1_L":x+o,d="Marker"+x+"_"+o,n.push({name:t,x:e,y:a,markerName:d,key:RF_SP2Store.stateObj.comfirm_key,id:l,isNew:r,newIndex:i,curvetypeid:c,sParameter:s.sParameter}),renderMarkerAddTr()}}function renderMarkerAddTr(){_.isNil(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter])&&(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter]=[]);var e=RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter],t="";_.forEach(e,function(e){t+='<tr data-iflag="'+(e.name+e.x)+'" data-curvetypeid="'+e.curvetypeid+'" data-imarkername="'+e.markerName+'" data-ix="'+e.x+'"><td contenteditable="true" title="点击修改" data-iorigin="'+e.markerName+'">'+e.markerName+"</td><td>"+e.x+"</td><td>"+e.y+"</td><td>"+e.key+"</td></tr>"}),$(".buildMarker_body>.container-fluid tbody").empty().append(t)}function findPointCombinatorial(s){s.fromIndex;var o=[];return _.reduce(s.Arr,function(e,t,a,r){if(a>s.fromIndex){var i,n;if(_.sortBy([e,t])[0]<s.baseVal&&s.baseVal<_.sortBy([e,t])[1])"last"==s.flag?(i=a-1,n=[e,t]):"first"==s.flag&&(i=r.length-a-1,n=[t,e]),o.push({index:i,arr:n});return t}},s.Arr[s.fromIndex+1]),o}function getPointXY(e){var t=(e.two[1]-e.one[1])/e.two[0]-e.one[0],a=e.two[0]-(e.two[1]-e.baseVal)/t;return console.log("1",a),a=_.round(1e3*a)/1e3,console.log("2",e.one[0]),console.log("3",e.two[0]),console.log("4",a),{x:a,y:e.baseVal,index:e.index}}function buildNewxyData(a){return _.forEach(a.pointArr,function(e,t){a.xData.splice(e.index+t+1,0,e.x),a.yData.splice(e.index+t+1,0,e.y),a.yData2.splice(e.index+t+1,0,a.yData2[e.index+t])}),{xData:_.cloneDeep(a.xData),yData:_.cloneDeep(a.yData),yData2:_.cloneDeep(a.yData2)}}function renderPointToChart(e){var t=e.iindex,a=e.yData1,s=e.y,r=e.chart,o=r.xAxis[0].categories,i=e.ii,n=e.name,l=e.x,d=e.flag,c=findPointCombinatorial({fromIndex:t,Arr:a,baseVal:s,flag:d}),u=[],x=[];"last"==d||"first"==d?x[0]=_.last(c):"twoSlide"==d&&(x[0]=_.last(c)),_.forEach(x,function(e,t){var a=o[e.index],r=o[e.index+1],i=e.arr[0],n=e.arr[1];u.push(getPointXY({one:[a,i],two:[r,n],baseVal:s,index:e.index}))});var f=buildNewxyData({pointArr:u,xData:_.cloneDeep(o),yData:_.cloneDeep(r.series[Number(!i)].yData),yData2:_.cloneDeep(r.series[Number(i)].yData)});r.xAxis[0].setCategories(f.xData),r.series[Number(!i)].setData(f.yData),r.series[Number(i)].setData(f.yData2),saveMarkerANDaddTr(n,l,s,!1,t),saveMarkerANDaddTr(n,_.last(u).x,_.last(u).y,!0,_.last(u).index+1)}