$(".g_bodyin_bodyin_bottom_2, .signalChart_div, .reRenderBtnDiv, .g_bodyin_bodyin_top_wrap_m_in li[data-targetclass='add']").hide(),$(".reRenderBtnDiv, button.backover, button.open_del_indicatrix, .g_bodyin_bodyin_bottom_rsubin_tit>button").css({opacity:1});var RF_SP2SwalMixin=swal.mixin({confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,animation:!1,customClass:"animated zoomIn"}),S_factorial=eouluGlobal.S_factorial,RF_SP2Store=Object.create(null);function markerJoinCalc(r){return _.forEach(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter],function(a,t){if(-1==r.indexOf(a.markerName))return!0;var e=r.match(new RegExp(a.markerName+"\\.X","g")),i=r.match(new RegExp(a.markerName+"\\.Y","g"));_.forEach(e,function(t,e){r=r.replace(t,"("+a.x+")")}),_.forEach(i,function(t,e){r=r.replace(t,"("+a.y+")")})}),r}function markerMathCalc(o){return _.forOwn(RF_SP2Store.MathMap,function(n,t){if(-1==o.indexOf(t))return!0;if(null==n.reg){var e=new RegExp(t,"g");o=_.replace(o,e,n.replace)}else{var a=o.match(n.reg);if(_.isNil(a))return!0;_.isNumber(n.index)?_.forEach(a,function(t,e){var a="("+n.replace+")",i=t.match(n.reg1)[n.index];a=a.replace("##1",i),o=o.replace(t,a)}):_.isArray(n.index)&&_.forEach(a,function(t,e){var a="("+n.replace+")",i=t.match(n.reg1)[n.index[0]],r=t.match(n.reg1)[n.index[1]];a=(a=a.replace("##1",i)).replace("##2",r),o=o.replace(t,a)})}}),o}function markerBackMathCalc(o){return _.forOwn(_.sortBy(RF_SP2Store.MathMapBack,function(t){return t.priority}),function(n){if(null===n.reg){var t=new RegExp(n.name,"g");o=_.replace(o,t,n.replace)}else{var e=o.match(n.reg);if(_.isNil(e))return!0;_.isNumber(n.index)?_.forEach(e,function(t,e){var a=n.name,i=t.match(n.reg1)[n.index];a=a.replace("##1",i),o=o.replace(t,a)}):_.isArray(n.index)&&_.forEach(e,function(t,e){var a=n.name,i=t.match(n.reg1)[n.index[0]],r=t.match(n.reg1)[n.index[1]];a=(a=a.replace("##1",i)).replace("##2",r),o=o.replace(t,a)})}}),o}function judgeLineSegmentIntersect(a,i,t){var r=!1;return _.isEmpty(t)?r=!1:_.forEach(t,function(t,e){if((t[0]<=a&&a<=t[1]||t[0]<=i&&i<=t[1]||a<=t[0]&&t[0]<=i||a<=t[1]&&t[1]<=i)&&(r=!0),t[0]==a&&t[1]==i&&(r=!0),r)return!1}),r}function getDataBuildBigS12S21(t){$(".signalChart_div_foot").fadeOut(10);var e,a=t.iclassify,i=t.itargetchart,r=t.contextFlag,n=t.graphStyle,o=t.callback;e=!0===r?_.cloneDeep(RF_SP2Store.stateObj.S2PBigChartSmithData[a][n]):_.cloneDeep(RF_SP2Store.stateObj.S2PSmallChartSmithData[a]);var l={xCategories:[]},s=!1;l.series=[],_.forEach(e,function(t,e){var a={};a.name=t.name,a.data=[],_.forEach(t.data,function(t,e){a.data.push(parseFloat(t[1])),s||l.xCategories.push(parseFloat(t[0]))}),a.color=t.color,l.series.push(a),s=!0}),_.isEmpty(l.series)||RF_SP2Store.util.min_maxHandler({series:_.cloneDeep(l.series)}),l.container=i,l.legend_enabled=!0,l.zoomType="x",l.resetZoomButton={position:{align:"left",x:90,y:10},relativeTo:"chart"},_.isNil(n)?l.text=a:l.text=a+" - "+n,l.showCheckbox=!0,l.callback=o,RF_SP2Store.stateObj.smithSXCategories=_.cloneDeep(l.xCategories),drawRealS12S21(l)}function getDataBuildBigS11S22(t){$(".signalChart_div_foot").fadeIn(10);var e,n=t.iclassify,a=t.itargetchart,i=t.item,o=t.contextFlag||!1,l=t.graphStyle,r=t.callback;!0===o?e=_.cloneDeep(RF_SP2Store.stateObj.S2PBigChartSmithData[n][l]):!1===o&&(e=_.cloneDeep(RF_SP2Store.stateObj.S2PSmallChartSmithData[n])),getDataBuildS11S22({wrapDOM:document.getElementById(a),title:[""],legendName:[n],data:_.reduce(e,function(t,e,a){return t.push(_.cloneDeep(e.data)),t},[]),classify:n,msgDOM:!0,lineColorArray:_.reduce(e,function(t,e,a){return t.push(e.color),t},[]),msgInitFun:function(t){buildS11ANDS22Bottom({classify:n,bottomJQDOM:$(".signalChart_div_foot .signalChart_div_foot_in_m_in ul"),callback:function(){$(".signalChart_div_foot_in_m_in ul>li").innerHeight($(".signalChart_div_foot_in_m").innerHeight()).innerWidth(.5*$(".signalChart_div_foot_in_m").innerWidth()-1),_.isNil(i)?$(".signalChart_div_foot_in_m_in ul>li:first").addClass("active").next().addClass("active"):$(".signalChart_div_foot_in_m_in ul>li[data-iparamter='"+i+"']").addClass("active").next().addClass("active")}}),$(".signalChart_div_foot_in_m_in ul>li.active").find(".Smith_Msg2").text(t)},msgFun:function(t,e,a){var i=RF_SP2Store.stateObj.S2PSmallChartSmithData[n][e].name;!0===o&&(i=RF_SP2Store.stateObj.S2PBigChartSmithData[n][l][e].name);var r=$(".signalChart_div_foot_in_m_in ul>li[data-iparamter='"+i+"']");r.siblings().removeClass("active"),r.addClass("active").next().addClass("active").find(".Smith_Msg2").text(a),r.find(".Smith_Msg2").text(t)},GHzFlag:!0,callback:function(t){window.onresize=function(){t.onresize()},_.isFunction(r)&&r(t)}})}function buildS11ANDS22Bottom(t){var e,a=t.classify,i=t.bottomJQDOM,r=t.callback,n=t.contextFlag,o=t.graphStyle,l="";e=!0===n?RF_SP2Store.stateObj.S2PBigChartSmithData[a][o]:RF_SP2Store.stateObj.S2PSmallChartSmithData[a],_.forEach(e,function(t,e){l+='<li data-iparamter="'+t.name+'"><div class="pictureline"><p style="background: '+t.color+'"></p></div><div class="smithdata"><p class="smithdata1"><span class="Smith_Paramter">'+t.name+' </span>(<span class="Smith_Msg1">'+a+'</span>): <span class="Smith_Msg2"></span></p></div></li>'}),i.empty().append(l),_.isFunction(r)&&r()}function msgInitFun(t,e,a,i){buildS11ANDS22Bottom({classify:e,bottomJQDOM:$("#picture"+a+"bottom .picturebottom_in_m_in ul"),callback:function(){$("#picture"+a+"bottom .picturebottom_in_m_in ul>li").innerHeight($("#picture"+a+"bottom .picturebottom_in_m").innerHeight()).innerWidth($("#picture"+a+"bottom .picturebottom_in_m").innerWidth()),!1===i?$("#picture"+a+"bottom .picturebottom_in_m_in ul>li:first").addClass("active"):$("#picture"+a+"bottom .picturebottom_in_m_in ul>li[data-iparamter='"+i+"']").addClass("active")}}),$("#picture"+a+"bottom .picturebottom_in_m_in ul>li.active").find(".Smith_Msg2").text(t)}function imsgFun(t,e,a,i){var r=RF_SP2Store.stateObj.S2PSmallChartSmithData[a][e].name;$("#picture"+i+"bottom .picturebottom_in_m_in ul>li[data-iparamter='"+r+"']").addClass("active").siblings().removeClass("active"),$("#picture"+i+"bottom .picturebottom_in_m_in ul>li.active").find(".Smith_Msg2").text(t)}RF_SP2Store.waferSelected=[],RF_SP2Store.waferTCFSelected={},RF_SP2Store.contextObj={classify:null,flag:null},RF_SP2Store.stateObj={renderSelectCsvSub:{S11:!1,S12:!1,S21:!1,S22:!1},calcTableIndex:-1,splineSelectedArr:{S11:[],S12:[],S21:[],S22:[]},splineSelectedCopyArr:{S11:[],S12:[],S21:[],S22:[]},comfirm_key:"请选择",key_y:!1,smithSXCategories:[],S12:{indicatrix_low:[],indicatrix_up:[]},S21:{indicatrix_low:[],indicatrix_up:[]},S11:{indicatrix_low:[],indicatrix_up:[]},S22:{indicatrix_low:[],indicatrix_up:[]},indicatrix_min_max:[],indicatrix_state_arr:[],indicatrix_copy:{low:[],up:[],delFlag:!1,submitFlag:!1},S2PSmallChartSmithArr:[],S2PSmallChartSmithData:{S11:[],S12:[],S21:[],S22:[]},dblclickFlag:!1,smithSmallContainerFlag:{S11:!1,S12:!1,S21:!1,S22:!1},navCurveType:"RF-S2P",S2PBigChartSmithData:{S11:{},S12:{},S21:{},S22:{}},RFSP2Checkbox:null,TCFsParameter:"S11",changeMarkerName:!1,changeKey:!1,indicatrix_awesomplete:!1},RF_SP2Store.MathMap={sin:{replace:"Math.sin",reg:null,fun:null,index:-1},cos:{replace:"Math.cos",reg:null,fun:null,index:-1},tan:{replace:"Math.tan",reg:null,fun:null,index:-1},ln:{replace:"Math.log",reg:null,fun:null,index:-1},log:{replace:"Math.log(##2)/Math.log(##1)",reg:/log\(([1-9]\d*|0)(\.\d+)?,([1-9]\d*|0)(\.\d+)?\)/g,reg1:/log\((([1-9]\d*|0)(\.\d+)?),(([1-9]\d*|0)(\.\d+)?)\)/,fun:"match",index:[1,4]},"!":{replace:"S_factorial(##1)",reg:/\(\d+\)\!/g,reg1:/\((\d+)\)(?=\!)/,fun:"match",index:1},"π":{replace:"Math.PI",reg:null,fun:null,index:-1},e:{replace:"Math.E",reg:null,fun:null,index:-1},"^":{replace:"Math.pow(##1, ##2)",reg:/\(-?([1-9]\d*|0)(\.\d+)?\)\^\(-?([1-9]\d*|0)(\.\d+)?\)/g,reg1:/\((-?([1-9]\d*|0)(\.\d+)?)\)\^\((-?([1-9]\d*|0)(\.\d+)?)\)/,fun:"match",index:[1,4]},"√":{replace:"(Math.pow(##2, 1/##1))",reg:/\(-?([1-9]\d*|0)(\.\d+)?\)√\(-?([1-9]\d*|0)(\.\d+)?\)/g,reg1:/\((-?([1-9]\d*|0)(\.\d+)?)\)√\((-?([1-9]\d*|0)(\.\d+)?)\)/,fun:"match",index:[1,4]},"°":{replace:"*Math.PI/180",reg:null,reg1:null,fun:null,index:-1}},RF_SP2Store.MathMapBack=[{replace:"sin",reg:null,fun:null,index:-1,priority:1,name:"Math.sin"},{replace:"cos",reg:null,fun:null,index:-1,priority:1,name:"Math.cos"},{replace:"tan",reg:null,fun:null,index:-1,priority:1,name:"Math.tan"},{replace:"",reg:/Math\.[sincota]+\(-?([1-9]\d*|0)(\.\d+)?\*Math\.PI\/180\)/g,reg1:/Math\.([sincota]+)\((-?([1-9]\d*|0)(\.\d+)?)\*Math\.PI\/180\)/,fun:"match",index:[1,2],priority:0,name:"##1g(##2)"},{replace:"",reg:/\(Math.log\(([1-9]\d*|0)(\.\d+)?\)\/Math.log\(([1-9]\d*|0)(\.\d+)?\)\)/g,reg1:/\(Math.log\((([1-9]\d*|0)(\.\d+)?)\)\/Math.log\((([1-9]\d*|0)(\.\d+)?)\)\)/,fun:"match",index:[1,4],priority:2,name:"log(##2, ##1)"},{replace:"ln",reg:null,fun:null,index:-1,priority:3,name:"Math.log"},{replace:"",reg:/\(S_factorial\(\d+\)\)/g,reg1:/\(S_factorial\((\d+)\)\)/,fun:"match",index:1,priority:4,name:"factorial(##1)"},{replace:"π",reg:null,fun:null,index:-1,priority:7,name:"Math.PI"},{replace:"e(1)",reg:null,fun:null,index:-1,priority:7,name:"Math.E"},{replace:"",reg:/\(\(Math.pow\(-?([1-9]\d*|0)(\.\d+)?,\s*\d+\/?\d*\)\)\)/g,reg1:/\(\(Math.pow\((-?([1-9]\d*|0)(\.\d+)?),\s*(\d+\/?\d*)\)\)\)/,fun:"match",index:[1,4],priority:5,name:"sqrt(##1, 1/(##2))"},{replace:"pow",reg:null,fun:null,index:-1,priority:6,name:"Math.pow"}],RF_SP2Store.allowKeyCode=[8,37,38,39,40,46,48,49,50,51,52,53,54,55,56,57,58,77,96,97,98,99,100,101,102,103,104,105,106,107,109,110,111,190],RF_SP2Store.search_markerObj={awesomplete:null,list:[]},RF_SP2Store.util=Object.create(null),RF_SP2Store.util.renderWaferFile=function(t){var e=t.data||[],i=t.waferFile,r='<div class="panel panel-default slideUp"><div class="panel-heading" title="点击展开" data-waferid="'+t.waferId+'" data-waferfile="'+i+'">'+i+'<span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span></div><ul class="list-group">';return e=_.sortBy(e,function(t){return t[2]}),_.forEach(e,function(t,e){var a=_.eq(_.toNumber(t[4]),0)?"dieid":"subdieid";r+='<li class="list-group-item" data-waferfile="'+i+'" data-curvefile="'+t[0]+'" data-curvetypeid="'+t[1]+'" data-dieid="'+t[2]+'" data-subdieid="'+t[3]+'" data-subdieflag="'+a+'">'+t[0]+"</li>"}),r+="</ul></div>"},RF_SP2Store.util.eleResize=function(t){var e=(t=t||{}).classify||1;if(1===e){var a=$(window).height();a<600&&(a=600),$("body").height(a),$(".g_bodyin_bodyin_bottom").innerHeight(a-180),$(".g_bodyin_bodyin_bottom_l, .g_bodyin_bodyin_bottom_r").innerHeight(a-190),$("div.picturetop").each(function(){if($(this).is("#picture2top")||$(this).is("#picture3top")){var t=1,e=0;20<RF_SP2Store.waferSelected.length&&(t=2,e=_.get(eouluGlobal.S_getPageAllConfig(),"futureDT2.scrollBarWidth",7)),$(this).innerHeight(~~($(this).parent().height()*t)-30).innerWidth(~~($(this).parent().width()-e))}else $(this).innerHeight($(this).parent().height()-30)}),$(".picturebottom_in_m ul>li").innerWidth($(".picturebottom_in_m").innerWidth())}else 2===e&&($(".g_bodyin_bodyin_bottom_lsub, .g_bodyin_bodyin_bottom_rsub").height($(".g_bodyin_bodyin_bottom").height()),$(".g_bodyin_bodyin_bottom_lsub_top, .g_bodyin_bodyin_bottom_lsub_bottom").innerHeight($(".g_bodyin_bodyin_bottom_lsub").innerHeight()/2-1))},RF_SP2Store.util.smithHandler=function(t){var r=t.s,n=t.data,o=t.seriesName,e=t.delLi||!1;if(_.isEqual(r,"S11")||_.isEqual(r,"S22")){if(!1===e)setTimeout(function(){var t,e=[],a=[],i=_.find($("#picture2top").highcharts().series,function(t){return t.name==o}).color;RF_SP2Store.stateObj.S2PSmallChartSmithData[r].push({name:o,data:_.cloneDeep(n),color:i}),_.forEach(RF_SP2Store.stateObj.S2PSmallChartSmithData[r],function(t){a.push(_.cloneDeep(t.data)),e.push(t.color)}),t=_.isEqual(r,"S11")?"1":"4",getDataBuildS11S22({wrapDOM:document.getElementById("picture"+t+"top"),title:[""],legendName:[r],data:a,classify:r,msgDOM:document.getElementById("picture"+t+"bottom"),lineColorArray:e,msgInitFun:_.bind(msgInitFun,this,_,r,t,o),msgFun:_.bind(imsgFun,this,_,_,r,t),GHzFlag:!0,callback:function(t){2<=RF_SP2Store.stateObj.S2PSmallChartSmithArr.length&&(RF_SP2Store.stateObj.S2PSmallChartSmithArr.length=0),RF_SP2Store.stateObj.S2PSmallChartSmithArr.push(t)}})},10);else if(!0===e){_.pullAt(RF_SP2Store.stateObj.S2PSmallChartSmithData[r],_.findIndex(RF_SP2Store.stateObj.S2PSmallChartSmithData[r],function(t){return t.name==o}));var a,i=[],l=[];a=_.isEqual(r,"S11")?"1":"4",_.forEach(RF_SP2Store.stateObj.S2PSmallChartSmithData[r],function(t){l.push(_.cloneDeep(t.data)),i.push(t.color)}),getDataBuildS11S22({wrapDOM:document.getElementById("picture"+a+"top"),title:[""],legendName:[r],data:l,classify:r,msgDOM:document.getElementById("picture"+a+"bottom"),lineColorArray:i,msgInitFun:_.bind(msgInitFun,this,_,r,a,!1),msgFun:_.bind(imsgFun,this,_,_,r,a),GHzFlag:!0,callback:function(t){2<=RF_SP2Store.stateObj.S2PSmallChartSmithArr.length&&(RF_SP2Store.stateObj.S2PSmallChartSmithArr.length=0),RF_SP2Store.stateObj.S2PSmallChartSmithArr.push(t)}})}}else if(_.isEqual(r,"S12")||_.isEqual(r,"S21")){var s;if(s=_.isEqual(r,"S12")?"2":"3",!1===e){var c="("+n[0][1].toFixed(2)+" dB,"+n[0][0].toFixed(2)+" GHz)";if(!1===RF_SP2Store.stateObj.smithSmallContainerFlag[r])getDataBuildS12S21({allData:[{name:o,data:n}],renderData:!0,container:"picture"+s+"top",zoomType:"None",showCheckbox:!1,title:{text:r,floating:!0,align:"right",x:-10,y:10},legend_enabled:!1,GHzFlag:!0,callback:function(){RF_SP2Store.stateObj.smithSmallContainerFlag[r]=!0,setTimeout(function(){msgInitFun(c,r,s,!1)},10)},pointMouseOverCallback:function(t,e,a){var i=e.xAxis[0].categories,r="("+t.y+" dB,"+i[t.x]+" GHz)";$("#picture"+s+"bottom .picturebottom_in_m_in ul>li[data-iparamter='"+t.series.name+"']").addClass("active").siblings().removeClass("active"),$("#picture"+s+"bottom .picturebottom_in_m_in ul>li.active").find(".Smith_Msg2").text(r)}});else{var d=[];_.forEach(n,function(t,e){d.push(parseFloat(t[1]))}),$("#picture"+s+"top").highcharts().addSeries({name:o,data:d,showInLegend:!0,enableMouseTracking:!0,events:{mouseOver:function(){}}}),setTimeout(function(){msgInitFun(c,r,s,o)},10)}var u=_.find($("#picture"+s+"top").highcharts().series,function(t){return t.name==o}).color;RF_SP2Store.stateObj.S2PSmallChartSmithData[r].push({name:o,data:_.cloneDeep(n),color:u})}else if(!0===e){var p=_.find($("#picture"+s+"top").highcharts().series,function(t){return t.name==o});!_.isNil(p)&&p.remove(),_.pullAt(RF_SP2Store.stateObj.S2PSmallChartSmithData[r],_.findIndex(RF_SP2Store.stateObj.S2PSmallChartSmithData[r],function(t){return t.name==o}))}}},RF_SP2Store.util.linkage=function(t){var e=t.classify||1,a=t.jQDOM,i=t.TCFflag||!1;0<a.children(".list-group-item-info").length?a.parent().removeClass("panel-default").addClass("panel-success"):a.parent().removeClass("panel-success").addClass("panel-default"),!0===i||!1===i&&1===e&&$(".g_bodyin_bodyin_bottom_l_inbottom>input").prop("checked",$(".g_bodyin_bodyin_bottom_l_intop li.list-group-item").length===$(".g_bodyin_bodyin_bottom_l_intop li.list-group-item.list-group-item-info").length)},RF_SP2Store.util.renderNav=function(t){var e="",a="RF-S2P"==t.item?"SP2":t.item,i=t.type,r=t.index;if("g_bodyin_bodyin_bottom_1"==i)e+='<li class="active" data-targetclass="g_bodyin_bodyin_bottom_1">'+a+'</li><li data-targetclass="g_bodyin_bodyin_bottom_2">TCF</li>';else if("g_bodyin_bodyin_bottom_2"==i){e+='<li data-targetclass="g_bodyin_bodyin_bottom_1">返回'+a+"</li>";var n="";(1==r||_.isNil(r))&&(n="active"),e+='<li class="'+n+'" data-targetclass="g_bodyin_bodyin_bottom_2">TCF</li>',e+='<li data-targetclass="add"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></li>'}$(".g_bodyin_bodyin_top_wrap_m_in>ul").empty().append(e)},RF_SP2Store.util.graphStyleHandler=function(t){var e=t.graphStyle,a=t.iclassify,i=t.itargetchart,r=(t.contextFlag,t.callback);if("XYOfPhase"==e||"XYOfMagnitude"==e){$(".signalChart_div_foot").fadeOut(10);var n,o=RF_SP2Store.stateObj.S2PBigChartSmithData[a][e],l=_.map(o,function(t,e){var a={};return a.name=t.name,a.color=t.color,a.data=_.zip.apply(void 0,t.data)[1],a});n=_.isNil(l[0])?[]:(RF_SP2Store.util.min_maxHandler({series:_.cloneDeep(o)}),_.zip.apply(void 0,o[0].data)[0]),RF_SP2Store.util.graphStyleDraw({graphStyle:e,sParameter:a,container:i,series:l,xCategories:n,callback:r})}else if("Polar"==e){$(".signalChart_div_foot").fadeIn(10);var s=[],c=RF_SP2Store.stateObj.S2PBigChartSmithData[a][e];_.forEach(c,function(t,e){var r={};r.name=t.name,r.color=t.color,r.data=[],_.forEach(t.data,function(t,e){var a,i;i=(a=t[2]<0?t[2]+360:t[2])<=90?a-90+360:a-90,r.data.push([i,t[1]])}),s.push(r)}),RF_SP2Store.util.graphStyleDraw({graphStyle:e,sParameter:a,container:i,data:_.cloneDeep(c),series:s,callback:r})}},RF_SP2Store.util.graphStyleDraw=function(e){var a,t=e.container,i=e.graphStyle,r=e.sParameter,n=e.xCategories,o=e.series,l=e.callback;if("XYOfPhase"==i||"XYOfMagnitude"==i)a=Highcharts.chart(t,{chart:{type:"line",zoomType:"x",resetZoomButton:{position:{align:"left",x:0,y:0},relativeTo:"chart"}},title:{text:r+" - "+i},lang:{loading:"Loading..."},legend:{enabled:!0},xAxis:{title:{text:"GHz"},categories:n},yAxis:{title:{text:_.isEqual(i,"XYOfPhase")?"Degrees":"Magnitude"},gridLineColor:"#eee",gridLineWidth:1},series:o,credits:{enabled:!1},tooltip:{formatter:function(t){return"<b>"+this.series.name+"</b><br>"+this.x+" GHz, "+this.y+" "+(_.isEqual(i,"XYOfPhase")?"Degrees":"Magnitude")},useHTML:!0},plotOptions:{series:{point:{events:{mouseOver:function(t){_.isFunction(e.pointMouseOverCallback)&&e.pointMouseOverCallback(this,a,t)}}},showCheckbox:!0}}}),RF_SP2Store.stateObj.smithSXCategories=_.cloneDeep(n);else if("Polar"==i){var s=e.data;a=Highcharts.chart(t,{chart:{polar:!0,type:"scatter",backgroundColor:"#fff"},credits:{enabled:!1},title:{text:r+" - "+i},pane:{startAngle:0,endAngle:360},tooltip:{backgroundColor:null,borderWidth:0,shadow:!1,useHTML:!0,style:{padding:0},formatter:function(){var t;return t=270<=this.x?this.x+90-360:this.x+90,t=_.round(t,2),'<span style="color:'+this.point.color+'">●</span> '+this.series.name+": <br/>角度：<b>"+t+"°</b><br/>半径：<b>"+this.y+"</b><br/>"}},xAxis:{tickInterval:45,minTickInterval:45,min:0,max:360,labels:{formatter:function(){return(270<=this.value?this.value+90-360:this.value+90)+"°"}},tickmarkPlacement:"on",gridLineColor:"#ccc",gridLineWidth:1,gridZIndex:1,lineColor:null,lineWidth:0,reversed:!0},yAxis:{min:0,lineWidth:0,gridLineColor:"#ccc",gridLineWidth:1,gridLineInterpolation:"circle",gridZIndex:1},plotOptions:{series:{pointStart:0,pointInterval:45,lineWidth:0,point:{events:{mouseOver:function(t){var a,e,i,r=this,n=_.find(s,function(t,e){return a=e,t.name==r.series.name}).data[this.index],o="("+n[3].toFixed(2)+","+n[4].toFixed(2)+"),"+n[0].toFixed(2)+"GHz";i=1==s.length?"( , ), GHz":(a==s.length-1&&(a=-1),"("+(e=_.cloneDeep(s[a+1].data[0]))[3].toFixed(2)+","+e[4].toFixed(2)+"),"+e[0].toFixed(2)+"GHz"),curDOM=$(".signalChart_div_foot_in_m_in ul>li[data-iparamter='"+r.series.name+"']"),curDOM.siblings().removeClass("active"),curDOM.addClass("active").next().addClass("active").find(".Smith_Msg2").text(i),curDOM.find(".Smith_Msg2").text(o)}}}}},series:o})}return _.isFunction(l)&&l(a),a},RF_SP2Store.util.graphStyleDispatch=function(t){var r=t.graphStyle,a=(t.callback,[]),i=[];$(".g_bodyin_bodyin_bottom_l_intop .panel>ul>li.list-group-item-info").each(function(t,e){a.push($(e).data("curvetypeid")),i.push($(e).data("waferfile")+"  "+$(e).data("curvefile"))});var e=$("[id$=_chart_S]:visible").attr("id"),n=e.replace("_chart_S","");if(_.isEmpty(a)){var o;switch(RF_SP2Store.stateObj.S2PBigChartSmithData[n][r]=[],$(".signalChart_div_tit>button:not(.backover)").prop("disabled",!0),r){case"Smith":o=getDataBuildBigS11S22;break;case"Polar":case"XYOfPhase":case"XYOfMagnitude":o=RF_SP2Store.util.graphStyleHandler;break;case"XYdBOfMagnitude":o=getDataBuildBigS12S21}o.call(void 0,{iclassify:n,itargetchart:e,contextFlag:!0,graphStyle:r}),$(".signalChart_div_foot").fadeOut(10)}else RF_SP2SwalMixin({title:"信息",text:"正在绘图，请勿点击",type:"info",showConfirmButton:!1,showCancelButton:!1}),RF_SP2Store.ajax.AnalysisCurve({curveTypeId:a,legend:i,graphStyle:r,sParameter:n,async:!1,done:function(t){if(_.isNil(t)||_.isEmpty(t))eouluGlobal.S_getSwalMixin()({title:"信息",text:"所选晶圆无曲线数据！",html:void 0,type:"info",showConfirmButton:!1,timer:1900}).then(function(){});else{switch(RF_SP2Store.stateObj.S2PBigChartSmithData[n][r]=[],_.forOwn(t,function(t,i){_.forOwn(t,function(t,e){var a={};a.name=i,a.data=_.cloneDeep(t),a.color=_.find($("#picture2top").highcharts().series,function(t){return t.name==i}).color,RF_SP2Store.stateObj.S2PBigChartSmithData[n][r].push(a)})}),r){case"Smith":getDataBuildBigS11S22({iclassify:n,itargetchart:e,contextFlag:!0,graphStyle:r,callback:function(t){$(".signalChart_div_tit>button:not(.backover)").prop("disabled",!0)}});break;case"Polar":RF_SP2Store.util.graphStyleHandler({iclassify:n,itargetchart:e,contextFlag:!0,graphStyle:r,callback:function(t){$(".signalChart_div_tit>button:not(.backover)").prop("disabled",!0),buildS11ANDS22Bottom({classify:n,bottomJQDOM:$(".signalChart_div_foot .signalChart_div_foot_in_m_in ul"),callback:function(){$(".signalChart_div_foot_in_m_in ul>li").innerHeight($(".signalChart_div_foot_in_m").innerHeight()).innerWidth(.5*$(".signalChart_div_foot_in_m").innerWidth()-1),$(".signalChart_div_foot_in_m_in ul>li:first").addClass("active").next().addClass("active")},contextFlag:!0,graphStyle:r});var e=_.cloneDeep(RF_SP2Store.stateObj.S2PBigChartSmithData[n][r][0].data),a="("+e[0][3].toFixed(2)+","+e[0][4].toFixed(2)+"),"+e[0][0].toFixed(2)+"GHz";$(".signalChart_div_foot_in_m_in ul>li.active").find(".Smith_Msg2").text(a)}});break;case"XYOfPhase":RF_SP2Store.util.graphStyleHandler({iclassify:n,itargetchart:e,contextFlag:!0,graphStyle:r,callback:function(t){setTimeout(function(){$(".indicatrix_footin>.btn-success").trigger("click")},50),$(".signalChart_div_tit>button:not(.backover)").prop("disabled",!1)}});break;case"XYOfMagnitude":RF_SP2Store.util.graphStyleHandler({iclassify:n,itargetchart:e,contextFlag:!0,graphStyle:r,callback:function(t){setTimeout(function(){$(".indicatrix_footin>.btn-success").trigger("click")},50),$(".signalChart_div_tit>button:not(.backover)").prop("disabled",!1)}});break;case"XYdBOfMagnitude":getDataBuildBigS12S21({iclassify:n,itargetchart:e,contextFlag:!0,graphStyle:r,callback:function(){setTimeout(function(){$(".indicatrix_footin>.btn-success").trigger("click")},50),$(".signalChart_div_tit>button:not(.backover)").prop("disabled",!1)}})}swal.close()}}})},RF_SP2Store.util.min_maxHandler=function(t){var e=t.series,a=[],i=!1;_.isArray(e[0].data[0])&&(i=!0),_.times(e.length,function(t){a[1]=i?(a[0]=_.min([a[0],_.min(_.zip.apply(void 0,e[t].data)[1])]),_.max([a[1],_.max(_.zip.apply(void 0,e[t].data)[1])])):(a[0]=_.min([a[0],_.min(e[t].data)]),_.max([a[1],_.max(e[t].data)]))}),RF_SP2Store.stateObj.indicatrix_min_max[0]=a[0],RF_SP2Store.stateObj.indicatrix_min_max[1]=a[1]},RF_SP2Store.util.judgeIndicatrixApply=function(t){var e,a=(t=t||{}).noeqCallback,i=t.eqCallback,r=t.eqZeroCallback,n=$("#upflag_table tbody tr.hasOk").length,o=$("#lowflag_table tbody tr.hasOk").length,l=$("#upflag_table tbody tr").length,s=$("#lowflag_table tbody tr").length;e=n!=l||o!=s?(_.isFunction(a)&&a({uphasOk:n,lowhasOk:o,upTr:l,lowTr:s}),!0):0===n&&0===o?(_.isFunction(r)&&r({uphasOk:n,lowhasOk:o,upTr:l,lowTr:s}),!0):(_.isFunction(i)&&i({uphasOk:n,lowhasOk:o,upTr:l,lowTr:s}),!1),$(".indicatrix_footin>.btn-success").prop("disabled",e)},RF_SP2Store.util.MarkerCurveHandler=function(t){var e=t.data,a=t.container,i=t.title||"marker图",r=t.findData,n=_.isFunction(t.callback)?t.callback:null,o=[],l=[],s=[];_.forOwn(e,function(t,a){var e=_.find(r.selected,function(t,e){return _.isEqual(t.curvetypeid,_.toString(a))}).curvefile;s.push(r.waferfile.replace(/\..*$/,"")+"  "+e);var i=_.zip.apply(void 0,t.curveData);o.push(i[0]),l.push(i[1])}),renderSpline({container:a,title:i,data:{xData:o,yData:l},name:s,callback:n})},RF_SP2Store.util.echoMarker=function(t){var e,a=t.classify||"select",i=t.chart,r=t.markerData,n=t.changeMarkerName||!1,o=RF_SP2Store.stateObj.TCFsParameter;if(_.isEmpty(RF_SP2Store.stateObj.splineSelectedArr[o])||_.isNil(RF_SP2Store.stateObj.splineSelectedArr[o])||(e=RF_SP2Store.stateObj.splineSelectedArr[o][0].key),"select"==a){if(RF_SP2Store.stateObj.key_y=!1,"y"==e){var l=_.reduce(RF_SP2Store.stateObj.splineSelectedArr[o],function(t,e,a){var i=_.toNumber(e.y);return-1==_.indexOf(t,i)&&t.push(i),t},[]),s=i.series[0].yData,c=i.series[1].yData;if(RF_SP2Store.stateObj.splineSelectedArr[o].length=0,-1<_.indexOf(s,l[0]))i.series[0].options.point.events.click.call(i.series[0].points[_.indexOf(s,l[0])]);else if(-1<_.indexOf(c,l[0]))i.series[1].options.point.events.click.call(i.series[1].points[_.indexOf(c,l[0])]);else{var d,u,p,S,f,h,m,g,b,y,v;if(console.warn("Marker点回显","兩條曲綫都沒有真實點"),_.forEach(s,function(t,e,a){if(t>l[0])return d=a[e-1],u=a[e],f=i.xAxis[0].categories[e-1],h=i.xAxis[0].categories[e],m=e,!1}),_.isNil(d)||_.isNil(u))if(_.forEach(c,function(t,e,a){if(t>l[0])return p=a[e-1],S=a[e],i.xAxis[0].categories[e-1],i.xAxis[0].categories[e],g=e,!1}),_.isNil(p)||_.isNil(S))RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为key，两条曲线都未找到点",type:"info",timer:2e3});else{var x=getPointXY({one:[f,d],two:[h,u],baseVal:l[0]});b=_.cloneDeep(i.xAxis[0].categories),y=_.cloneDeep(s),v=_.cloneDeep(c),b.splice(g,0,x.x),v.splice(g,0,x.y),y.splice(g,0,y[g-1]),i.xAxis[0].setCategories(b),i.series[0].setData(y),i.series[1].setData(v),i.series[1].options.point.events.click.call(i.series[1].points[_.indexOf(v,l[0])])}else{var F=getPointXY({one:[f,d],two:[h,u],baseVal:l[0]});b=_.cloneDeep(i.xAxis[0].categories),y=_.cloneDeep(s),v=_.cloneDeep(c),b.splice(m,0,F.x),y.splice(m,0,F.y),v.splice(m,0,v[m-1]),i.xAxis[0].setCategories(b),i.series[0].setData(y),i.series[1].setData(v),i.series[0].options.point.events.click.call(i.series[0].points[_.indexOf(y,l[0])])}}}else if("x"==e){var P=_.reduce(RF_SP2Store.stateObj.splineSelectedArr[o],function(t,e,a){var i=_.toNumber(e.x);return-1==_.indexOf(t,i)&&t.push(i),t},[]);1==P.length?(RF_SP2Store.stateObj.splineSelectedArr[o].length=0,!_.isEqual(P[0],NaN)&&i.series[0].options.point.events.click.call(i.series[0].points[_.indexOf(i.xAxis[0].categories,P[0])])):2==P.length&&(RF_SP2Store.stateObj.splineSelectedArr[o].length=0,i.series[0].options.point.events.click.call(i.series[0].points[_.indexOf(i.xAxis[0].categories,P[0])]),setTimeout(function(){i.series[1].options.point.events.click.call(i.series[1].points[_.indexOf(i.xAxis[0].categories,P[1])])},50))}setTimeout(function(){RF_SP2Store.util.addMarkerId({data:r,changeMarkerName:n})},80)}else if("awesomplete"==a){var k=[];_.forEach(RF_SP2Store.stateObj.splineSelectedArr[o],function(t,e){(_.isNil(t.x)||_.isEqual(t.x,"NaN"))&&(t.x=NaN)}),_.forEach(RF_SP2Store.stateObj.splineSelectedArr[o],function(t,e){k.push({label:t.markerName+".X: "+t.x,value:t.markerName+".X"}),k.push({label:t.markerName+".Y: "+t.y,value:t.markerName+".Y"})}),RF_SP2Store.search_markerObj.list=_.cloneDeep(k),RF_SP2Store.search_markerObj.awesomplete&&RF_SP2Store.search_markerObj.awesomplete.destroy(),RF_SP2Store.search_markerObj.awesomplete=new Awesomplete(document.getElementById("clac_textarea"),{list:RF_SP2Store.search_markerObj.list,minChars:1,maxItems:10,autoFirst:!0,filter:function(t,e){var a=eouluGlobal.S_getCaretPosition($("#clac_textarea")[0]);return"M"==e.substring(a-1,a)},replace:function(t){var e=eouluGlobal.S_getCaretPosition($("#clac_textarea")[0]),a=this.input.value.substring(0,e-1)+t.value+this.input.value.substring(e,this.input.value.length);$("#clac_textarea").val(a),eouluGlobal.S_setCaretPosition($("#clac_textarea")[0],e+t.value.length-1)}})}},RF_SP2Store.util.addMarkerId=function(t){var e=t.data,i=t.changeMarkerName||!1;_.forEach(e,function(e){var t;!0===i?(t=$('.buildMarker_body>.container-fluid tbody>tr[data-curvetypeid="'+_.toNumber(e[0])+'"][data-ix="'+_.toNumber(e[3])+'"]'),RF_SP2Store.stateObj.changeMarkerName=!1):t=$('.buildMarker_body>.container-fluid tbody>tr[data-curvetypeid="'+_.toNumber(e[0])+'"][data-ix="'+_.toNumber(e[3])+'"][data-imarkername="'+e[2]+'"]'),t.data("markerid",e[1]).addClass("success"),i&&t.data("imarkername",e[2]).children("td:eq(0)").text(e[2]).data("iorigin",e[2]);var a=_.find(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter],function(t){return console.log(typeof t.curvetypeid,t.curvetypeid),console.log(_.toString(e[0])),console.log(typeof(null===t.x?NaN:t.x),null===t.x?NaN:t.x),console.log(_.toNumber(e[3])),_.isEqual(t.curvetypeid,_.toString(e[0]))&&_.isEqual(null===t.x?NaN:t.x,_.toNumber(e[3]))});console.log(a),i&&(a.markerName=e[2]),a.markerid=e[1]});var n=[];$(".buildMarker_body>.container-fluid tbody>tr.success").each(function(){n.push(_.toString($(this).data("imarkername")))}),$(".buildMarker_body>.container-fluid tbody>tr:not(.success)").each(function(t){var e=$(this),a=e.data("imarkername");if(-1<_.indexOf(n,_.toString(a))){var i=a+"("+(t+1)+")";e.data("imarkername",i).children("td:eq(0)").text(i).data("iorigin",i);var r=e.children("td");_.find(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter],function(t){return _.isEqual(t.curvetypeid,_.toString(e.data("curvetypeid")))&&_.isEqual(null===t.x?NaN:t.x,_.toNumber(r.eq(1).text()))}).markerName=i}}),RF_SP2Store.util.applyOtherDieBtn()},RF_SP2Store.util.curTCFSelectWafer=function(t){return _.find(RF_SP2Store.waferTCFSelected,function(t){return _.isEqual(RF_SP2Store.stateObj.TCFsParameter,t.sParameter)&&2==(t.selected||[]).length})},RF_SP2Store.util.judgeCoordinateId=function(t){var e,a=[],i=!0,r="dieid",n="0",o=RF_SP2Store.util.curTCFSelectWafer();return _.isNil(o)?i=e=!1:(i=!0,r=o.selected[0].subdieflag,n=_.eq(r,"subdieid")?"1":"0",e=1==(a=_.reduce(o.selected,function(t,e){return-1==_.indexOf(t,e[r])&&t.push(e[r]),t},[])).length),{coordinateId:a,unique:e,isExist:i,subdieFlag:n}},RF_SP2Store.util.applyOtherDieBtn=function(t){var e=RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter],a=[];_.forEach(e,function(t){_.isNil(t.markerid)||a.push(t.markerid)}),0<a.length?$(".buildMarker_footin>.btn-success").prop("disabled",!1):$(".buildMarker_footin>.btn-success").prop("disabled",!0)},RF_SP2Store.ajax=Object.create(null),RF_SP2Store.ajax.AnalysisFile=function(t){$.ajax({type:"GET",url:"AnalysisFile",data:{wafer:t.wafer},dataType:"json"}).then(t.done)},RF_SP2Store.ajax.AnalysisCurve=function(t){var e=t.iasync;_.isNil(e)&&(e=!0),$.ajax({type:"GET",url:"AnalysisCurve",async:e,data:{curveTypeId:t.curveTypeId,legend:t.legend||void 0,graphStyle:t.graphStyle||void 0,sParameter:t.sParameter||void 0},dataType:"json"}).then(t.done)},RF_SP2Store.ajax.MarkerCurve=function(t){var e=t.curveTypeId,a=t.waferId,i=t.sParameter||"S11";$.ajax({type:"GET",url:"MarkerCurve",data:{curveTypeId:e,waferId:a,sParameter:i},dataType:"json"}).then(t.done)},RF_SP2Store.ajax.GetMarker=function(t){var e=t.curveTypeId;$.ajax({type:"GET",url:"GetMarker",data:{curveTypeId:e,sParameter:RF_SP2Store.stateObj.TCFsParameter},dataType:"json"}).then(t.done)},$(function(){var t=$("body").data("wafer");if(_.isNil(t)||_.isEmpty(t))return eouluGlobal.S_getSwalMixin()({showConfirmButton:!1,title:"参数验证",text:"传参出错！请至工程分析页面重新选取",timer:1900,type:"error"}).then(function(){eouluGlobal.S_settingURLParam({},!1,!1,!1,"ProjectAnalysis")}),!1;RF_SP2Store.ajax.AnalysisFile({wafer:t,done:function(t){if(!_.isNil(t)&&!_.isEmpty(t)){var a="",i=0;_.forOwn(t,function(t,e){i+=t.curveFile.length,a+=RF_SP2Store.util.renderWaferFile({data:t.curveFile,waferFile:t.waferFile,waferId:e})});var e=eouluGlobal.S_getPageAllConfig().colorArray;Highcharts.setOptions({chart:{colorCount:i},colors:_.sampleSize(e,i)}),$(".g_bodyin_bodyin_bottom_l_intop").empty().append(a).children("div.panel:eq(0)").children("div.panel-heading").trigger("click").siblings("ul").children("li:eq(0)").trigger("click"),$(".g_bodyin_bodyin_bottom_lsub_top").empty().append(a).children("div.panel:eq(0)").children("div.panel-heading").trigger("click")}RF_SP2Store.util.eleResize(),$(window).on("resize",function(){RF_SP2Store.util.eleResize(),RF_SP2Store.util.eleResize({classify:2})})}}),eouluGlobal.C_pageAuthorityCommonHandler({authorityJQDomMap:{UserInstall:[$(".g_info_r .AdminOperat")],DataStatistics:[$(".g_bodyin_tit_r>.glyphicon-stats")]},getKey:"url"}),RF_SP2Store.util.renderNav({item:RF_SP2Store.stateObj.navCurveType,type:"g_bodyin_bodyin_bottom_1"}),$(".g_bodyin_bodyin_top_wrap_m_in").innerWidth()>$(".g_bodyin_bodyin_top_wrap_m").innerWidth()&&$(".g_bodyin_bodyin_top_wrap_l>span, .g_bodyin_bodyin_top_wrap_r>span").show(),$("#comfirm_key_sel").val(RF_SP2Store.stateObj.comfirm_key),$(".indicatrix_div, .allLegends").draggable({distance:5});var e=store.get("futureDT2Online__RF_SP2__saveMarkerFlag");_.isNil(e)||$(".g_bodyin_bodyin_top_wrap_m_in li[data-targetclass='g_bodyin_bodyin_bottom_2']").trigger("click")}),$(document).on("click",".g_bodyin_bodyin_bottom_l_intop .panel>.panel-heading, .g_bodyin_bodyin_bottom_lsub_top .panel>.panel-heading",function(){$(this).children("span").toggleClass("glyphicon-menu-right glyphicon-menu-down"),($(this).parent().hasClass("slideUp")?jQuery().slideDown:jQuery().slideUp).call($(this).siblings("ul"),800),$(this).parent().toggleClass("slideUp")}).on("click",".g_bodyin_bodyin_bottom_l_intop .panel>ul>li",function(){var c=$(this),d=_.toString(c.data("curvetypeid")),u=c.data("waferfile")+"  "+c.data("curvefile"),p=c.parent();if(c.hasClass("list-group-item-info")){if(_.pull(RF_SP2Store.waferSelected,d),c.removeClass("list-group-item-info"),RF_SP2Store.util.linkage({classify:1,jQDOM:p}),_.forEach(["S11","S12","S21","S22"],function(t,e){RF_SP2Store.util.smithHandler({s:t,seriesName:u,delLi:!0})}),RF_SP2Store.waferSelected.length<21){var t=~~$("#picture_box2").innerHeight(),e=~~$("#picture_box2").innerWidth();$("#picture2top, #picture3top").innerHeight(t).innerWidth(e),$("#picture2top").highcharts().setSize(e,t),$("#picture3top").highcharts().setSize(e,t)}if(!1!==RF_SP2Store.stateObj.dblclickFlag){var a=$("[id$=_chart_S]:visible"),i=a.data("iclassify"),r=a.attr("id"),n=a.data("iflag");null===RF_SP2Store.stateObj.RFSP2Checkbox?"initial"==n?-1<_.indexOf(["S11","S22"],i)?getDataBuildBigS11S22({iclassify:i,itargetchart:r}):getDataBuildBigS12S21({iclassify:i,itargetchart:r,callback:function(){setTimeout(function(){$(".indicatrix_footin>.btn-success").trigger("click")},50)}}):RF_SP2Store.util.graphStyleDispatch({graphStyle:n}):!1===RF_SP2Store.stateObj.RFSP2Checkbox&&0==$(".g_bodyin_bodyin_bottom_l_intop .panel>ul>li.list-group-item-info").length&&("initial"==n?-1<_.indexOf(["S11","S22"],i)?getDataBuildBigS11S22({iclassify:i,itargetchart:r}):getDataBuildBigS12S21({iclassify:i,itargetchart:r}):RF_SP2Store.util.graphStyleDispatch({graphStyle:n}))}}else RF_SP2Store.ajax.AnalysisCurve({curveTypeId:[d],async:!1,done:function(t){if(_.isNil(t)||_.isEmpty(t))eouluGlobal.S_getSwalMixin()({title:"信息",text:"此晶圆无曲线数据！",html:void 0,type:"info",showConfirmButton:!1,timer:1900}).then(function(){});else{if(1==_.keys(t).length&&_.forOwn(t,function(t,e){_.forOwn(t,function(t,e){RF_SP2Store.util.smithHandler({s:e,data:t,seriesName:u})})}),RF_SP2Store.waferSelected.push(d),c.addClass("list-group-item-info"),RF_SP2Store.util.linkage({classify:1,jQDOM:p}),20<RF_SP2Store.waferSelected.length){var e=~~$("#picture_box2").innerHeight(),a=~~$("#picture_box2").innerWidth(),i=2,r=_.get(eouluGlobal.S_getPageAllConfig(),"futureDT2.scrollBarWidth",7);40<RF_SP2Store.waferSelected.length&&(i=3),$("#picture2top, #picture3top").innerHeight(e*i).innerWidth(a-r),$("#picture2top").highcharts().setSize(a-r,e*i),$("#picture3top").highcharts().setSize(a-r,e*i)}if(!1!==RF_SP2Store.stateObj.dblclickFlag){var n=$("[id$=_chart_S]:visible"),o=n.data("iclassify"),l=n.attr("id"),s=n.data("iflag");"initial"==s?-1<_.indexOf(["S11","S22"],o)?setTimeout(function(){getDataBuildBigS11S22({iclassify:o,itargetchart:l})},30):getDataBuildBigS12S21({iclassify:o,itargetchart:l,callback:function(){setTimeout(function(){$(".indicatrix_footin>.btn-success").trigger("click")},50)}}):RF_SP2Store.util.graphStyleDispatch({graphStyle:s})}}}})}).on("click",".g_bodyin_bodyin_bottom_lsub_top .panel>ul>li",function(t){t=t||window.event;var e=$(this),a=e.parent(),i=_.toString(a.prev().data("waferid")),r=e.data("waferfile"),n=e.data("curvefile"),o=_.toString(e.data("curvetypeid")),l=_.toString(e.data("dieid")),s=_.toString(e.data("subdieid")),c=e.data("subdieflag"),d=i+"-"+RF_SP2Store.stateObj.TCFsParameter;if(e.hasClass("list-group-item-info"))e.removeClass("list-group-item-info"),_.pullAt(RF_SP2Store.waferTCFSelected[d].selected,_.findIndex(RF_SP2Store.waferTCFSelected[d].selected,function(t,e){return _.isEqual(t.curvetypeid,o)}));else{if(e.addClass("list-group-item-info"),_.isNil(RF_SP2Store.waferTCFSelected[d])&&(RF_SP2Store.waferTCFSelected[d]={}),RF_SP2Store.waferTCFSelected[d].waferfile=r,RF_SP2Store.waferTCFSelected[d].waferid=i,RF_SP2Store.waferTCFSelected[d].sParameter=RF_SP2Store.stateObj.TCFsParameter,_.isNil(RF_SP2Store.waferTCFSelected[d].selected)&&(RF_SP2Store.waferTCFSelected[d].selected=[]),2<=RF_SP2Store.waferTCFSelected[d].selected.length){var u=RF_SP2Store.waferTCFSelected[d].selected.shift();$('.g_bodyin_bodyin_bottom_lsub_top .panel>ul>li[data-curvetypeid="'+u.curvetypeid+'"]').removeClass("list-group-item-info")}RF_SP2Store.waferTCFSelected[d].selected.push({curvefile:n,curvetypeid:o,dieid:l,subdieid:s,subdieflag:c}),_.forEach(RF_SP2Store.waferTCFSelected,function(t,e,a){if(_.isEqual(_.toString(e),d))return!0;_.isNil(t.selected)||_.forEach(a[e].selected,function(t,e){$('.g_bodyin_bodyin_bottom_lsub_top .panel>ul>li[data-curvetypeid="'+t.curvetypeid+'"]').removeClass("list-group-item-info")}),a[e].selected=[]})}$(".g_bodyin_bodyin_bottom_lsub_top>.panel>ul").each(function(t,e){RF_SP2Store.util.linkage({jQDOM:$(e),TCFflag:!0})});var p=RF_SP2Store.util.curTCFSelectWafer();_.isNil(p)?$(".reRenderBtnDiv").css({left:t.pageX+30+"px",top:t.pageY-50+"px"}).slideUp(200):$(".reRenderBtnDiv").css({left:t.pageX+30+"px",top:t.pageY-50+"px"}).slideDown(200)}),$(window).on("resize",function(){_.forEach(RF_SP2Store.stateObj.S2PSmallChartSmithArr,function(t,e,a){a[e].onresize()})}),$(".g_bodyin_bodyin_bottom_l_inbottom>input").click(function(){var t;if($(this).prop("checked")){t="glyphicon-menu-right";var c=[],a=[];if($(".g_bodyin_bodyin_bottom_l_intop .panel>ul>li:not(.list-group-item-info)").each(function(t,e){c.push($(e).data("curvetypeid")),a.push($(e).data("waferfile")+"  "+$(e).data("curvefile"))}),_.isNil(c))return!1;RF_SP2SwalMixin({title:"信息",text:"正在绘图，请勿点击",type:"info",showConfirmButton:!1,showCancelButton:!1}),RF_SP2Store.ajax.AnalysisCurve({curveTypeId:c,legend:a,async:!1,done:function(t){if(_.isNil(t)||_.isEmpty(t))eouluGlobal.S_getSwalMixin()({title:"信息",text:"所选晶圆无曲线数据！",html:void 0,type:"info",showConfirmButton:!1,timer:1900}).then(function(){});else{if(_.forOwn(t,function(t,a){_.forOwn(t,function(t,e){RF_SP2Store.util.smithHandler({s:e,data:t,seriesName:a})});var e=a.split("  ");$('.g_bodyin_bodyin_bottom_l_intop .panel>ul>li:not(.list-group-item-info)[data-waferfile="'+e[0]+'"][data-curvefile="'+e[1]+'"]').addClass("list-group-item-info")}),Array.prototype.push.apply(RF_SP2Store.waferSelected,_.cloneDeep(c)),$(".g_bodyin_bodyin_bottom_l_intop .panel>.panel-heading").each(function(){var t=$(this).siblings("ul");RF_SP2Store.util.linkage({classify:2,jQDOM:t})}),20<RF_SP2Store.waferSelected.length){var e=~~$("#picture_box2").innerHeight(),a=~~$("#picture_box2").innerWidth(),i=2,r=_.get(eouluGlobal.S_getPageAllConfig(),"futureDT2.scrollBarWidth",7);40<RF_SP2Store.waferSelected.length&&(i=3),$("#picture2top, #picture3top").innerHeight(e*i).innerWidth(a-r),$("#picture2top").highcharts().setSize(a-r,e*i),$("#picture3top").highcharts().setSize(a-r,e*i)}if(!1!==RF_SP2Store.stateObj.dblclickFlag){var n=$("[id$=_chart_S]:visible"),o=n.attr("id"),l=n.data("iclassify"),s=n.data("iflag");"initial"==s?-1<_.indexOf(["S11","S22"],l)?setTimeout(function(){getDataBuildBigS11S22({iclassify:l,itargetchart:o})},40):getDataBuildBigS12S21({iclassify:l,itargetchart:o,callback:function(){setTimeout(function(){$(".indicatrix_footin>.btn-success").trigger("click")},50)}}):RF_SP2Store.util.graphStyleDispatch({graphStyle:s})}swal.close()}}})}else t="glyphicon-menu-down",checkedF=!1,RF_SP2SwalMixin({title:"信息",text:"正在绘图，请勿点击",type:"info",showConfirmButton:!1,showCancelButton:!1}),RF_SP2Store.stateObj.RFSP2Checkbox=!1,setTimeout(function(){$(".g_bodyin_bodyin_bottom_l_intop .panel>ul>li.list-group-item-info").each(function(t,e){$(this).trigger("click")}),swal.close(),RF_SP2Store.stateObj.RFSP2Checkbox=null},30);$(".g_bodyin_bodyin_bottom_l_intop .panel>.panel-heading").each(function(){$(this).children("span").hasClass(t)&&$(this).trigger("click")})}),$(".g_bodyin_bodyin_top_wrap_l>span").click(function(){var t=parseFloat($(".g_bodyin_bodyin_top_wrap_m_in").css("left")),e=($(".g_bodyin_bodyin_top_wrap_m_in").innerWidth(),$(".g_bodyin_bodyin_top_wrap_m").innerWidth(),t+60);0<=t&&(e=0),$(".g_bodyin_bodyin_top_wrap_m_in").animate({left:e+"px"},{speed:"slow",easing:"swing",queue:!1})}),$(".g_bodyin_bodyin_top_wrap_r>span").click(function(){var t=parseFloat($(".g_bodyin_bodyin_top_wrap_m_in").css("left")),e=$(".g_bodyin_bodyin_top_wrap_m_in").innerWidth()-$(".g_bodyin_bodyin_top_wrap_m").innerWidth(),a=t-60;Math.abs(t)>=e&&(a=-e),$(".g_bodyin_bodyin_top_wrap_m_in").animate({left:a+"px"},{speed:"slow",easing:"swing",queue:!1})}),$(document).on("click",".g_bodyin_bodyin_top_wrap_m_in li",function(){var r=$(this).data("targetclass");if("add"==r)RF_SP2SwalMixin({title:"敬请期待",text:"功能尚未开发",type:"info",showConfirmButton:!1,timer:2e3});else{$(this).addClass("active").siblings().removeClass("active");var n=$(this).index();$("."+r).siblings().fadeOut(300,function(){if($(this).siblings().fadeIn(300),RF_SP2Store.util.renderNav({item:RF_SP2Store.stateObj.navCurveType,type:r,index:n}),"g_bodyin_bodyin_bottom_2"==r){var t=store.get("futureDT2Online__RF_SP2__saveMarkerFlag");if(_.isNil(t)?RF_SP2Store.stateObj.TCFsParameter="S11":(RF_SP2Store.stateObj.TCFsParameter="S11",store.remove("futureDT2Online__RF_SP2__saveMarkerFlag")),$(".g_info [data-iicon='glyphicon-question-sign']").hide(),!RF_SP2Store.stateObj.renderSelectCsvSub[RF_SP2Store.stateObj.TCFsParameter]){var e=new Awesomplete("#calc_text",{minChars:0,list:["TCF_L","TCF_R","TCF"]});$(".subAddParam_body button.awesomplete_btn").click(function(){0===e.ul.childNodes.length?(e.minChars=0,e.evaluate()):e.ul.hasAttribute("hidden")?e.open():e.close()}),RF_SP2Store.util.eleResize({classify:2});var a=$(".g_bodyin_bodyin_bottom_lsub_top>.panel:eq(0)>ul>li");a.eq(0).removeClass("list-group-item-info"),a.eq(1).removeClass("list-group-item-info"),a.eq(0).trigger("click"),a.eq(1).trigger("click"),$(".reRenderBtnDiv").trigger("click");var i=RF_SP2Store.util.curTCFSelectWafer();_.isNil(i)?eouluGlobal.S_getSwalMixin()({title:"请求参数数据",text:"异常！未选中曲线",type:"warning",showConfirmButton:!1,showCancelButton:!1,timer:1900}):$.ajax({type:"GET",url:"CalculationData",data:{waferId:i.waferid},dataType:"json"}).then(function(t){var a="";_.isNil(t)||_.isEmpty(t)?a='<tr class="canCalc"><td></td><td></td><td></td></tr>':(_.forEach(t,function(t,e){a+='<tr class="canCalc" data-ivalue="'+t.calculationId+'" data-oldparameter="'+t.custom_parameter+'" data-olduserformula="'+t.user_formula+'" data-oldformula="'+t.calculate_formula+'"><td>'+t.custom_parameter+"</td><td>"+t.calculation_result+"</td><td>"+t.user_formula+"</td></tr>"}),a+='<tr class="canCalc"><td></td><td></td><td></td></tr>'),$(".g_bodyin_bodyin_bottom_lsub_bottom tbody").empty().append(a)}),RF_SP2Store.stateObj.renderSelectCsvSub[RF_SP2Store.stateObj.TCFsParameter]=!0}$(".reRenderBtnDiv").slideDown(200)}else $(".reRenderBtnDiv").hide(),$(".g_info [data-iicon='glyphicon-question-sign']").show(),RF_SP2Store.stateObj.TCFsParameter="S11"})}}),$(".reRenderBtnDiv").click(function(){var r=RF_SP2Store.util.curTCFSelectWafer();if(!_.isNil(r)){var a=[],t=r.waferid,n=RF_SP2Store.stateObj.TCFsParameter;_.forEach(r.selected,function(t,e){a.push(t.curvetypeid)}),RF_SP2Store.ajax.MarkerCurve({curveTypeId:a,waferId:t,sParameter:n,done:function(t){if(!_.isNil(t)){var i;if(RF_SP2Store.stateObj.changeKey)RF_SP2Store.stateObj.changeKey=!1;else{var e=[];if(_.forOwn(t,function(t){_.isNil(t.markerData)||_.isEmpty(t.markerData)||e.push(t.markerData[0].location_key)}),e=_.uniq(e),RF_SP2Store.stateObj.comfirm_key=1==e.length?e[0]:"请选择",$("#comfirm_key_sel").val(RF_SP2Store.stateObj.comfirm_key),2==e.length)return eouluGlobal.S_getSwalMixin()({title:"key值异常",text:"选中曲线有不一样的key，请先切换key删除原来的Marker点",type:"warning",showConfirmButton:!1,showCancelButton:!1,timer:2500}),!1}i=RF_SP2Store.stateObj.comfirm_key,_.isNil(i)||_.isEqual(i,"请选择")?(RF_SP2Store.util.MarkerCurveHandler({data:t,container:"markerChart",findData:r}),RF_SP2Store.util.echoMarker({classify:"awesomplete"})):RF_SP2Store.ajax.GetMarker({curveTypeId:_.reduce(r.selected,function(t,e){return _.isEmpty(t)?e.curvetypeid:t+","+e.curvetypeid},""),done:function(e){RF_SP2Store.stateObj.splineSelectedArr[n]=[],$(".buildMarker_body>div tbody").empty(),_.isNil(e)||_.isEmpty(e)?(RF_SP2Store.stateObj.key_y=!1,RF_SP2Store.util.MarkerCurveHandler({data:t,container:"markerChart",findData:r,callback:function(){RF_SP2Store.util.applyOtherDieBtn()}})):(_.forEach(e,function(e,t){var a={};a.name=r.waferfile+"  "+_.find(r.selected,function(t){return _.isEqual(t.curvetypeid,e[0])}).curvefile,a.x=e[3],a.y=e[4],a.markerName=e[2],a.key=e[5],a.id=e[2].replace("Marker",""),a.isNew="y"===i,a.newIndex=-1,a.curvetypeid=e[0],a.sParameter=n,RF_SP2Store.stateObj.splineSelectedArr[n].push(a)}),RF_SP2Store.util.MarkerCurveHandler({data:t,container:"markerChart",findData:r,callback:function(t){RF_SP2Store.util.echoMarker({classify:"select",chart:t,markerData:e,changeMarkerName:RF_SP2Store.stateObj.changeMarkerName})}})),setTimeout(function(){RF_SP2Store.util.echoMarker({classify:"awesomplete"})},100)}})}}})}}),$(".g_bodyin_tit_r>.glyphicon-stats").click(function(){for(var t=[],e=0;e<$(".g_bodyin_bodyin_bottom_l .panel-heading").length;e++)t.push($(".g_bodyin_bodyin_bottom_l .panel-heading").eq(e).data("waferfile"));eouluGlobal.S_settingURLParam({waferId:$("body").data("wafer"),waferNO:t},!1,!1,!1,"DataStatistics")}),$(document).on({click:function(){$(".RF_SP2_cover, .subAddParam").slideDown(200);var t=$(this).children("td:eq(0)").text();$("#calc_text").val(t).data("oldparameter",t),$("#clac_textarea").val($(this).children("td:eq(2)").text()),$("#clac_textarea").trigger("input");var e=_.eq(_.trim(t),"")?"":"参数可用";$("div.parammessage").text(e).data("parammessage",e),RF_SP2Store.stateObj.calcTableIndex=$(this).index()}},"tr.canCalc").on("click",".subAddParam_tit>span, .subAddParam_footin>.btn-warning",function(){$(".RF_SP2_cover, .subAddParam").slideUp(200)}).on("click",".subAddParam_footin>.btn-primary",function(){var t=$("#preview").data("frontformulahasmarker");if(_.isNil(t)||_.eq(t,"未填公式")||_.eq(t,"公式有误"))return!1;var i=$("#calc_text").val().trim(),r=$("#clac_textarea").val();if(_.isEmpty(i)||_.isEqual(_.trim(r),""))return RF_SP2SwalMixin({title:"公式提示",text:"参数或公式必填",type:"warning",timer:1900}),!1;var n=$(".g_bodyin_bodyin_bottom_lsub_bottom tbody>tr").eq(RF_SP2Store.stateObj.calcTableIndex),o=_.isNil(n.data("oldparameter"))?void 0:n.data("oldparameter"),e=n.data("olduserformula");if(!_.isNil(o)&&_.eq(o,i)&&_.eq(e,r))return RF_SP2SwalMixin({title:"公式提示",text:"参数和公式均未做修改",type:"warning",timer:1900}),!1;var a=RF_SP2Store.util.curTCFSelectWafer(),l=RF_SP2Store.util.judgeCoordinateId(),s=l.subdieFlag;if(_.isNil(a))return RF_SP2SwalMixin({title:"参数提示",text:"未选择曲线或选择出错",type:"warning",timer:1900}),!1;var c=$("div.parammessage").data("parammessage");if(_.isNil(c)||_.eq(c,"")||_.eq(c,"参数已存在"))return RF_SP2SwalMixin({title:"参数提示",text:"未填写参数或参数已存在",type:"warning",timer:1900}),!1;var d,u,p=n.data("ivalue"),S=r,f=markerBackMathCalc(t),h=_.isNil(o)?"添加":"修改";l.isExist&&l.unique?(_.eq(s,"0")?(d=l.coordinateId[0],u=void 0):_.eq(s,"1")&&(d=void 0,u=l.coordinateId[0]),$.ajax({type:"GET",url:"Calculator",data:{customParameter:i,coordinateId:d,calculationId:p,waferId:a.waferid,userformula:S,formula:f,subdieId:u,subdieFlag:s,oldParameter:o,sParameter:RF_SP2Store.stateObj.TCFsParameter,typeIdStr:_.reduce(a.selected,function(t,e){return t.push(e.curvetypeid),t},[]).join()},dataType:"json"}).then(function(t){var e=t.result,a=t.message;5==_.keys(t).length?_.isNil(e)?RF_SP2SwalMixin({title:h+"提示",text:h+"失败",type:"warning",timer:1900,showConfirmButton:!1}):_.eq(e,"")?RF_SP2SwalMixin({title:h+"提示",text:h+"失败，公式错误，请检查公式或先提交Marker",type:"warning",timer:2500,showConfirmButton:!1}):_.eq(a,"自定义参数已存在")||_.eq(a,"自定义参数为空")?RF_SP2SwalMixin({title:h+"提示",text:h+"失败，"+a,type:"warning",timer:2e3,showConfirmButton:!1}):(RF_SP2SwalMixin({title:h+"提示",text:h+"成功",type:"success",timer:1900,showConfirmButton:!1}),_.isNaN(e)?n.children().eq(1).text("9E+37"):n.children().eq(1).text(e),n.children().eq(0).text(i),n.children().eq(2).text(r),n.data({oldparameter:t.customParameter,olduserformula:S,ivalue:t.calculationId}),_.isNil(o)&&$(".g_bodyin_bodyin_bottom_lsub_bottom tbody").append('<tr class="canCalc"><td></td><td></td><td></td></tr>'),$(".subAddParam_footin>.btn-warning").trigger("click")):RF_SP2SwalMixin({title:h+"提示",text:h+"失败",type:"warning",timer:1900,showConfirmButton:!1})})):RF_SP2SwalMixin({title:h+"提示",text:"未选中曲线或所选曲线不在同一die",type:"warning",timer:2e3,showConfirmButton:!1})}),$("#calc_text").on("blur",function(){var t=RF_SP2Store.util.curTCFSelectWafer(),e=RF_SP2Store.util.judgeCoordinateId().subdieFlag;if(_.isNil(t))return RF_SP2SwalMixin({title:"参数提示",text:"未选择曲线或选择出错",type:"warning",timer:1900}),!1;var a=_.toString($(this).data("oldparameter")),i=$(this).val().trim();_.eq(a,i)?$("div.parammessage").text("参数可用").data("parammessage","参数可用"):$.ajax({type:"GET",url:"CustomParameter",data:{waferId:t.waferid,customParameter:i,subdieFlag:e},dataType:"json"}).then(function(t){_.isEqual(t,"")?$("div.parammessage").text("参数可用").data("parammessage","参数可用"):$("div.parammessage").text("参数已存在").data("parammessage","参数已存在")})}),$(".calcin>div>.row>div>div").on({mousedown:function(){$(this).addClass("active")},mouseup:function(){$(this).removeClass("active");var t=$("#clac_textarea").val(),e=$(this).data("ivalue"),a=eouluGlobal.S_getCaretPosition($("#clac_textarea")[0]);if("Number"!=e&&"退格"!=e){var i=t.substring(0,a)+e+t.substring(a,t.length);$("#clac_textarea").val(i);var r=Number($(this).data("ipos"));eouluGlobal.S_setCaretPosition($("#clac_textarea")[0],a+e.toString().length+r),$("#clac_textarea").trigger("input")}else if("Number"==e)$(".row.toggleRow").slideToggle(150),eouluGlobal.S_setCaretPosition($("#clac_textarea")[0],a);else if("退格"==e){var n=$("#clac_textarea").val().substring(0,a-1)+$("#clac_textarea").val().substring(a,$("#clac_textarea").val().length);$("#clac_textarea").val(n),eouluGlobal.S_setCaretPosition($("#clac_textarea")[0],a-1)}}}),$("#clac_textarea").on("keydown",function(t){var e=t.keyCode||t.which||t.charCode;if(-1==_.indexOf(RF_SP2Store.allowKeyCode,e))return!1}).on("input propertychange change",function(){var old=$(this).val();if(old=old.replace(/[\u4e00-\u9fa5]+/g,""),$("#clac_textarea").val(old),eouluGlobal.S_setCaretPosition($("#clac_textarea")[0],eouluGlobal.S_getCaretPosition($("#clac_textarea")[0])),""==old||""==old.trim())$("#preview").attr("title","未填公式").text("未填公式").data({frontformula:"未填公式",frontformulahasmarker:"未填公式"});else{console.log(old);var oldHasMarker=markerMathCalc(old);oldHasMarker=oldHasMarker.replace(/MarkMath\.E/g,"Marke"),console.log(old);var oldReplaceMarker=markerJoinCalc(old);console.log(old),console.log(oldReplaceMarker),oldReplaceMarker=markerMathCalc(oldReplaceMarker),console.log(old),console.log(oldReplaceMarker);try{var iVal=eval(oldReplaceMarker);_.isNaN(iVal)?$("#preview").attr("title","9E+37").text("9E+37"):$("#preview").attr("title",iVal).text(iVal.toFixed(2)),$("#preview").data({frontformula:oldReplaceMarker,frontformulahasmarker:oldHasMarker})}catch(t){$("#preview").attr("title","公式有误").text("公式有误").data({frontformula:"公式有误",frontformulahasmarker:"公式有误"})}}}),$(".g_bodyin_bodyin_bottom_rsubin_tit>button").on({click:function(){var t=$(this).next();if("enter"==t.data("imouseenter"))return!1;t.toggleClass("clicked"),t.hasClass("clicked")?(t.slideDown(400),$(this).html('<span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span> 关闭Marker设置')):(t.slideUp(400),$(this).html('<span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span> 打开Marker设置'))},mouseenter:function(){var t=$(this).next();if(t.hasClass("clicked"))return!1;t.data("imouseenter","enter"),t.addClass("clicked").slideDown(400,function(){t.data("imouseenter","leave")}),$(this).html('<span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span> 关闭Marker设置')}}),$("#comfirm_key").click(function(){var e=$(this).parent().prev().children("select").val(),t=RF_SP2Store.util.curTCFSelectWafer();if(_.isNil(e)||_.isEqual(e,"请选择")||_.isNil(t))return!1;$.ajax({type:"POST",url:"MarkerOperate",data:{classify:"remove",sParameter:RF_SP2Store.stateObj.TCFsParameter,curveTypeId:_.reduce(t.selected,function(t,e){return _.isEmpty(t)?e.curvetypeid:t+","+e.curvetypeid},"")},dataType:"json"}).then(function(t){!0===t?(RF_SP2Store.stateObj.comfirm_key=e,RF_SP2SwalMixin({title:"Marker确认Key提示",text:"成功，现在可以选点了，请记得保存",type:"success",timer:1100,showConfirmButton:!1}).then(function(t){t.dismiss!=swal.DismissReason.backdrop&&t.dismiss!=swal.DismissReason.esc&&t.dismiss!=swal.DismissReason.timer||(RF_SP2Store.stateObj.key_y=!1,RF_SP2Store.stateObj.changeKey=!0,$(".reRenderBtnDiv").trigger("click"))})):RF_SP2SwalMixin(!1===t?{title:"Marker切换key提示",text:"切换失败，检查是否提交",type:"warning",timer:1600,showConfirmButton:!1}:{title:"Marker切换key提示",text:t,type:"info",timer:1900,showConfirmButton:!1})})}),$(document).on({"input propertychange change":function(){var t=$(this).text(),e=/[\n\r\s]+/g;e.test(t)&&$(this).text(t.replace(e,""))},keydown:function(t){if(13==(t.keyCode||t.which||t.charCode))return!1},blur:function(){var e=$(this),a=e.data("iorigin"),i=e.text(),r=e.parent().data("markerid"),n=!0;if(/^Marker\d+.+/.test(i)){if(!_.isNil(r))if(_.forEach(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter],function(t,e){if(t.markerName!=a&&t.markerName==i)return n=!1}),!n||_.isEqual(i,a))e.text(a);else{e.parent().data("curvetypeid");$.ajax({type:"POST",url:"MarkerOperate",data:{classify:"modify",newMarker:[r,i]},dataType:"json",beforeSend:function(){RF_SP2SwalMixin({title:"Marker修改提示",text:"正在请求...",type:"info",showConfirmButton:!1})}}).then(function(t){!0===t?(RF_SP2Store.stateObj.changeMarkerName=!0,RF_SP2SwalMixin({title:"Marker修改提示",text:"修改成功",type:"success",showConfirmButton:!1}),e.data("iorigin",i).parent().data("imarkername",i),_.find(RF_SP2Store.stateObj.splineSelectedArr[RF_SP2Store.stateObj.TCFsParameter],function(t,e){return _.isEqual(_.toString(t.markerid),_.toString(r))}).markerName=i,RF_SP2Store.util.echoMarker({classify:"awesomplete"})):!1===t?(RF_SP2Store.stateObj.changeMarkerName=!1,e.text(a),RF_SP2SwalMixin({title:"Marker修改提示",text:"修改失败",type:"warning",showConfirmButton:!1})):(RF_SP2Store.stateObj.changeMarkerName=!1,e.text(a),RF_SP2SwalMixin({title:"Marker修改提示",text:t,type:"info",showConfirmButton:!1}))}).always(function(){setTimeout(function(){swal.close()},1e3)})}}else e.text(a)}},".buildMarker_body>.container-fluid tbody td:nth-child(1)"),$(".buildMarker_footin>.btn-primary").click(function(){if(0==$(".buildMarker_body>.container-fluid tbody>tr").length)return!1;var t=RF_SP2Store.stateObj.TCFsParameter;_.forEach(RF_SP2Store.stateObj.splineSelectedArr[t],function(t,e){var a=$(".buildMarker_body>.container-fluid tbody>tr[data-iflag='"+(t.name+t.x)+"'][data-imarkername='"+t.markerName+"']").children("td").eq(0).text();t.markerName=a,t.id=a.match(/Marker(\S+)/)[1]});var e=RF_SP2Store.util.curTCFSelectWafer();if(!_.isNil(e)){var a={};a.waferId=e.waferid,a.classify="add",a.sParameter=t,_.forEach(RF_SP2Store.stateObj.splineSelectedArr[t],function(t,e){a[t.markerName]=[],a[t.markerName].push(t.curvetypeid),a[t.markerName].push(t.markerName),a[t.markerName].push(t.x),a[t.markerName].push(t.y),a[t.markerName].push(t.key)}),$.ajax({type:"POST",url:"MarkerOperate",data:a,dataType:"json"}).then(function(t){!0===t?(RF_SP2SwalMixin({title:"Marker提交提示",text:"保存成功",type:"success",timer:1200,showConfirmButton:!1}).then(function(t){t.dismiss==swal.DismissReason.backdrop||t.dismiss==swal.DismissReason.esc||(t.dismiss,swal.DismissReason.timer)}),RF_SP2Store.ajax.GetMarker({curveTypeId:_.reduce(e.selected,function(t,e){return _.isEmpty(t)?e.curvetypeid:t+","+e.curvetypeid},""),done:function(t){RF_SP2Store.util.addMarkerId({data:t}),RF_SP2Store.util.echoMarker({classify:"awesomplete"})}})):RF_SP2SwalMixin(!1===t?{title:"Marker提交提示",text:"保存失败",type:"warning",timer:1600,showConfirmButton:!1}:{title:"Marker提交提示",text:t,type:"info",timer:1900,showConfirmButton:!1})})}}),$(".buildMarker_footin>.btn-success").click(function(){if(0==$(".buildMarker_body>.container-fluid tbody>tr").length||"请选择"==RF_SP2Store.stateObj.comfirm_key)return!1;var t=RF_SP2Store.util.curTCFSelectWafer();if(!_.isNil(t)){var e,a,i=RF_SP2Store.util.judgeCoordinateId(),r=i.subdieFlag;if(i.isExist&&i.unique)_.eq(r,"0")?(e=i.coordinateId[0],a=void 0):_.eq(r,"1")&&(e=void 0,a=i.coordinateId[0]),$.ajax({type:"POST",url:"MarkerSave",data:{coordinateId:e,markerKey:RF_SP2Store.stateObj.comfirm_key,sParameter:t.sParameter,waferId:t.waferid,subdieId:a,subdieFlag:r,curveTypeStr:_.reduce(t.selected,function(t,e){return t.push(e.curvetypeid),t},[])},dataType:"json"}).then(function(t){var e,a;a=!0===t?(e="应用成功","success"):!1===t?(e="应用失败","warning"):(e=t,"info"),RF_SP2SwalMixin({title:"marker应用到其他die提示",text:e,type:a,timer:1900,showConfirmButton:!1})});else RF_SP2SwalMixin({title:"marker应用到其他die提示",text:"未选中曲线或所选曲线不在同一die",type:"warning",timer:2e3,showConfirmButton:!1})}}),$(document).on("dblclick",".chartWarp",function(){$(".allLegends").hide();var t=$(this).data("itargetchart"),e=t.replace("_chart_S","");RF_SP2Store.stateObj.dblclickFlag=e,$(".fourChart_div").fadeOut(200,function(){$(".signalChart_div").fadeIn(200),$("#"+t).siblings().fadeOut(100),$("#"+t).delay(100).fadeIn(150,function(){"S12"==e||"S21"==e?getDataBuildBigS12S21({iclassify:e,itargetchart:t,callback:function(){$(".signalChart_div_tit>button:not(.backover)").prop("disabled",!1),setTimeout(function(){$(".indicatrix_footin>.btn-success").trigger("click")},50)}}):(getDataBuildBigS11S22({iclassify:e,itargetchart:t}),$(".signalChart_div_tit>button:not(.backover)").prop("disabled",!0))}).data("iflag","initial")})}),$(".signalChart_div_tit>button.backover").click(function(){$(".signalChart_div").fadeOut(200,function(){$(".fourChart_div").fadeIn(100,function(){$(window).trigger("resize"),setTimeout(function(){_.forEach(RF_SP2Store.stateObj.S2PSmallChartSmithArr,function(t,e,a){a[e].onresize()})},50)}),RF_SP2Store.stateObj.dblclickFlag=!1})}),$(".signalChart_div_tit>.open_del_indicatrix").click(function(){$(".RF_SP2_cover, .indicatrix_div").slideDown(200);var t=$("[id$='_chart_S']:visible").attr("id");if(_.isNil(t))return!1;var e=t.replace("_chart_S",""),a="",i="";_.forEach(RF_SP2Store.stateObj[e].indicatrix_up,function(t,e){a+='<tr><td><input type="text" class="form-control AwesompleteX input_X1" value="'+t[0]+'"></td><td><input type="text" class="form-control AwesompleteX input_X2" value="'+t[1]+'"></td><td><input type="text" class="form-control input_Y0" value="'+t[2]+'"></td><td><span class="glyphicon glyphicon-ok" aria-hidden="true"></span><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></td></tr>'}),_.forEach(RF_SP2Store.stateObj[e].indicatrix_low,function(t,e){i+='<tr><td><input type="text" class="form-control AwesompleteX input_X1" value="'+t[0]+'"></td><td><input type="text" class="form-control AwesompleteX input_X2" value="'+t[1]+'"></td><td><input type="text" class="form-control input_Y0" value="'+t[2]+'"></td><td><span class="glyphicon glyphicon-ok" aria-hidden="true"></span><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></td></tr>'}),RF_SP2Store.stateObj[e].indicatrix_up.length=0,RF_SP2Store.stateObj[e].indicatrix_low.length=0,$(".indicatrix_body #upflag_table tbody").empty().append(a),$(".indicatrix_body #lowflag_table tbody").empty().append(i),$(".indicatrix_body #upflag_table tbody").find(".glyphicon-ok").trigger("click"),$(".indicatrix_body #lowflag_table tbody").find(".glyphicon-ok").trigger("click"),_.isEmpty(_.concat(RF_SP2Store.stateObj[e].indicatrix_low,RF_SP2Store.stateObj[e].indicatrix_up))&&$(".indicatrix_footin>.btn-success").prop("disabled",!0),$(".indicatrix_body tbody").find("input[type='text']").each(function(t,e){new Awesomplete(e,{list:RF_SP2Store.stateObj.smithSXCategories,minChars:1,maxItems:15,autoFirst:!1})})}),$(".indicatrix_tit>span.glyphicon, .indicatrix_footin>.btn-warning").click(function(){if(0<$("div.indicatrix_body td>.glyphicon-ok:visible").length)return RF_SP2SwalMixin({title:"指标线面板关闭提示",text:"请先保存或删除所填",type:"warning",timer:1900,showConfirmButton:!1}),!1;$(".RF_SP2_cover, .indicatrix_div").slideUp(200)}),$(document).on("click","#upflag_table>tbody .glyphicon-remove, #lowflag_table>tbody .glyphicon-remove",function(){var e=$("[id$='_chart_S']:visible").attr("id");if(_.isNil(e))return!1;var a=e.replace("_chart_S","");if($(this).parent().parent().hasClass("hasOk")){var t,i=[];$(this).parent().siblings("td").each(function(t){t<3&&(i[t]=parseFloat($(this).find("input[type='text']").val()))}),t=$(this).parents("#lowflag_table").length?RF_SP2Store.stateObj[a].indicatrix_low:RF_SP2Store.stateObj[a].indicatrix_up,_.pullAt(t,_.findIndex(t,function(t){return _.isEqual(t,i)}))}$(this).parent().parent().remove(),RF_SP2Store.util.judgeIndicatrixApply({noeqCallback:null,eqCallback:null,eqZeroCallback:function(){var t=$("[id$=_chart_S]:visible").data("iflag");"initial"==t?getDataBuildBigS12S21({iclassify:a,itargetchart:e}):"XYOfPhase"==t?RF_SP2Store.util.graphStyleHandler({iclassify:a,itargetchart:e,contextFlag:!0,graphStyle:t}):"XYOfMagnitude"==t?RF_SP2Store.util.graphStyleHandler({iclassify:a,itargetchart:e,contextFlag:!0,graphStyle:t}):"XYdBOfMagnitude"==t&&getDataBuildBigS12S21({iclassify:a,itargetchart:e,contextFlag:!0,graphStyle:t})}});var r=$("#upflag_table").prev().children("span"),n=$("#lowflag_table").prev().children("span"),o=$("#upflag_table tbody tr.hasOk").length,l=$("#lowflag_table tbody tr.hasOk").length,s=$("#upflag_table tbody tr").length,c=$("#lowflag_table tbody tr").length;0===s||s===o?r.fadeIn(100):r.fadeOut(100),0===c||c===l?n.fadeIn(100):n.fadeOut(100)}),$(".indicatrix_footin>.btn-success").click(function(){var e=$("[id$='_chart_S']:visible").attr("id");if(_.isNil(e))return!1;var t=e.replace("_chart_S","");if(_.isEmpty(_.concat(RF_SP2Store.stateObj[t].indicatrix_low,RF_SP2Store.stateObj[t].indicatrix_up)))return!1;if(!_.isNil(e)){RF_SP2Store.stateObj.indicatrix_state_arr=[];var f=_.find(Highcharts.charts,function(t){if(!_.isNil(t))return $(t.renderTo).is("div#"+e)}),h=f.series,a=0,i=[];_.forEach(h,function(t,e){_.includes(t.name,"低于指标#")&&i.push(e),h[e].update({color:"#00FF00"})}),_.forEach(h,function(t,e){_.includes(t.name,"高于指标#")&&i.push(e)}),_.forEach(i,function(t,e){h[t-a].remove(),a++});var m=f.xAxis[0].categories,g=.02*(RF_SP2Store.stateObj.indicatrix_min_max[1]-RF_SP2Store.stateObj.indicatrix_min_max[0]);_.forEach(RF_SP2Store.stateObj[t].indicatrix_low,function(r,t){var e=[],n=_.indexOf(m,r[0]),o=_.indexOf(m,r[1]),a=!1,i=!1;if(-1==n){var l=_.findIndex(m,function(t,e){return t>r[0]});if(-1==l||0==l)a=!0;else{var s=Math.abs(r[0]-m[l-1]),c=Math.abs(r[0]-m[l]);n=s<c?l-1:l}}if(-1==o){var d=_.findLastIndex(m,function(t,e){return t<r[1]});if(-1==d||d==m.length-1)i=!0;else{var u=Math.abs(r[1]-m[d-1]),p=Math.abs(r[1]-m[d]);o=u<=p?d-1:d}}if(a||i)return RF_SP2SwalMixin({title:"自动标记指标线提示",text:"第"+(t+1)+"条指标线的X1或X2值找不到对应点",type:"warning",timer:1900,showConfirmButton:!1}),!0;e.push([n,r[2]+g]),e.push([n,r[2]]),e.push([o,r[2]]),e.push([o,r[2]+g]),f.addSeries({name:"低于指标#"+t,data:e,showInLegend:!1,enableMouseTracking:!0,dataLabels:{enabled:!0,formatter:function(){return this.x}},color:"#000",tooltip:{headerFormat:!1,pointFormat:!1,footerFormat:!1},events:{mouseOver:function(){var t=_.find(RF_SP2Store.stateObj.indicatrix_state_arr,function(t,e){return this.name==t.name}.bind(this));_.forEach(t.seriesName,function(a,t){var e=_.find(h,function(t,e){return t.name==a});e.update({lineWidth:4}),e.select(!0)})},mouseOut:function(){var t=_.find(RF_SP2Store.stateObj.indicatrix_state_arr,function(t,e){return this.name==t.name}.bind(this));_.forEach(t.seriesName,function(a,t){var e=_.find(h,function(t,e){return t.name==a});e.update({lineWidth:2}),e.select(!1)})}},point:{events:{mouseOver:void 0}}});var S=[];_.forEach(h,function(t,e){if(_.includes(t.name,"低于指标#"))return!0;if(_.includes(t.name,"高于指标#"))return!0;var a=t.yData,i=!1;_.forEach(a,function(t,e){if(n<=e&&e<=o&&t>r[2])return!(i=!0)}),i&&(S.push(h[e].name),"#FF0000"!=h[e].color&&"#ff0000"!=h[e].color&&h[e].update({color:"#FF0000"}))}),RF_SP2Store.stateObj.indicatrix_state_arr.push({name:"低于指标#"+t,seriesName:S})}),_.forEach(RF_SP2Store.stateObj[t].indicatrix_up,function(r,t){var e=[],n=_.indexOf(m,r[0]),o=_.indexOf(m,r[1]),a=!1,i=!1;if(-1==n){var l=_.findIndex(m,function(t,e){return t>r[0]});if(-1==l||0==l)a=!0;else{var s=Math.abs(r[0]-m[l-1]),c=Math.abs(r[0]-m[l]);n=s<c?l-1:l}}if(-1==o){var d=_.findLastIndex(m,function(t,e){return t<r[1]});if(-1==d||d==m.length-1)i=!0;else{var u=Math.abs(r[1]-m[d-1]),p=Math.abs(r[1]-m[d]);o=u<=p?d-1:d}}if(a||i)return RF_SP2SwalMixin({title:"自动标记指标线提示",text:"第"+(t+1)+"条指标线的X1或X2值找不到对应点",type:"warning",timer:1900,showConfirmButton:!1}),!0;e.push([n,r[2]-g]),e.push([n,r[2]]),e.push([o,r[2]]),e.push([o,r[2]-g]),f.addSeries({name:"高于指标#"+t,data:e,showInLegend:!1,enableMouseTracking:!0,dataLabels:{enabled:!0,formatter:function(){return this.x}},color:"#000",tooltip:{headerFormat:!1,pointFormat:!1,footerFormat:!1},events:{mouseOver:function(){var t=_.find(RF_SP2Store.stateObj.indicatrix_state_arr,function(t,e){return this.name==t.name}.bind(this));_.forEach(t.seriesName,function(a,t){var e=_.find(h,function(t,e){return t.name==a});e.update({lineWidth:4}),e.select(!0)})},mouseOut:function(){var t=_.find(RF_SP2Store.stateObj.indicatrix_state_arr,function(t,e){return this.name==t.name}.bind(this));_.forEach(t.seriesName,function(a,t){var e=_.find(h,function(t,e){return t.name==a});e.update({lineWidth:2}),e.select(!1)})}},point:{events:{mouseOver:void 0}}});var S=[];_.forEach(h,function(t,e){if(_.includes(t.name,"低于指标#"))return!0;if(_.includes(t.name,"高于指标#"))return!0;var a=t.yData,i=!1;_.forEach(a,function(t,e){if(n<=e&&e<=o&&t<r[2])return!(i=!0)}),i&&(S.push(h[e].name),"#FF0000"!=h[e].color&&"#ff0000"!=h[e].color&&h[e].update({color:"#FF0000"}))}),RF_SP2Store.stateObj.indicatrix_state_arr.push({name:"高于指标#"+t,seriesName:S})}),_.forEach(RF_SP2Store.stateObj.indicatrix_state_arr,function(e,t){if(_.isEmpty(e.seriesName))return!0;_.find(h,function(t){return t.name==e.name}).update({color:"#FF1493"})})}$(".indicatrix_footin>.btn-warning").trigger("click")}),$(".indicatrix_body legend>span").click(function(){$('<tr><td><input type="text" class="form-control AwesompleteX input_X1"></td><td><input type="text" class="form-control AwesompleteX input_X2"></td><td><input type="text" class="form-control input_Y0"></td><td><span class="glyphicon glyphicon-ok" aria-hidden="true"></span><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></td></tr>').appendTo($(this).parent().next().children("tbody")).find("input.AwesompleteX").each(function(t,e){new Awesomplete(e,{list:RF_SP2Store.stateObj.smithSXCategories,minChars:1,maxItems:15,autoFirst:!1})}),$(this).fadeOut(100),$(".indicatrix_footin>.btn-success").prop("disabled",!0)}),$(document).on("click",".indicatrix_body tbody span.glyphicon-ok",function(){var t=$("[id$='_chart_S']:visible").attr("id");if(_.isNil(t))return!1;var e,a=t.replace("_chart_S",""),i=$(this).parent().parent(),r=i.find(".input_X1").val().trim(),n=i.find(".input_X2").val().trim(),o=i.find(".input_Y0").val().trim();if(_.isEmpty(r)||_.isEmpty(n)||_.isEmpty(o))return!1;$(this).parents().is("#upflag_table")?e=RF_SP2Store.stateObj[a].indicatrix_up:$(this).parents().is("#lowflag_table")&&(e=RF_SP2Store.stateObj[a].indicatrix_low);var l=Math.min(Number(r),Number(n)),s=Math.max(Number(r),Number(n)),c=Number(o);judgeLineSegmentIntersect(l,s,_.concat(RF_SP2Store.stateObj[a].indicatrix_up,RF_SP2Store.stateObj[a].indicatrix_low))?RF_SP2SwalMixin({title:"选择区间提示",text:"区间与已有区间重合，请重选",type:"info",showConfirmButton:!1,timer:1500}):(e.push([l,s,c]),i.find(".input_Y0").val(c),$(this).fadeOut(100).parent().parent().parent().parent().prev().children("span").fadeIn(100),i.addClass("hasOk").find("input[type='text']").prop("disabled",!0),RF_SP2Store.util.judgeIndicatrixApply())}).on("input propertychange change",".input_Y0",function(){_.isNil($(this).val().match(/(\-|\+)?\d*\.?\d*/g))?$(this).val(""):$(this).val(_.head($(this).val().match(/(\-|\+)?\d*\.?\d*/g)))}),$(".indicatrix_footin>.btn-danger").click(function(){var t=$("[id$='_chart_S']:visible").attr("id");if(_.isNil(t))return!1;var e=t.replace("_chart_S","");if(_.isEmpty(_.concat(RF_SP2Store.stateObj[e].indicatrix_up,RF_SP2Store.stateObj[e].indicatrix_low)))return!1;$(".indicatrix_footin>.btn-warning").trigger("click"),$("#upflag_table>tbody, #lowflag_table>tbody").empty(),RF_SP2Store.stateObj[e].indicatrix_up.length=0,RF_SP2Store.stateObj[e].indicatrix_low.length=0,$(".indicatrix_footin>.btn-success").prop("disabled",!0),$(".indicatrix_body legend>span").fadeIn(100),getDataBuildBigS12S21({iclassify:e,itargetchart:t})}),$(document).on("mouseenter",".indicatrix_div div.awesomplete ul[role='listbox']>li",function(t){t.stopPropagation();var e=$("input.AwesompleteX:focus"),a=$(this).text();$(this).parent().is("[hidden]")||RF_SP2Store.stateObj.indicatrix_awesomplete?RF_SP2Store.stateObj.indicatrix_awesomplete&&(RF_SP2Store.stateObj.indicatrix_awesomplete=!1):e.val(a)}).on("keydown","input.AwesompleteX:focus",function(t){8==(t.keyCode||t.which||t.charCode)&&(RF_SP2Store.stateObj.indicatrix_awesomplete=!0)}),$.contextMenu({selector:"#S11_chart_S, #S22_chart_S, #S12_chart_S, #S21_chart_S",callback:function(t,e){if(e.$trigger instanceof jQuery){var a=e.$trigger;_.isNil(a.data("highcharts-chart"))?a.empty():a.highcharts().destroy();var i=a.parent(),r=a.data("iclassify");a.remove(),i.append('<div id="'+r+'_chart_S" data-iflag="'+t+'" data-iclassify="'+r+'" style="display: block;"></div>')}RF_SP2Store.util.graphStyleDispatch({graphStyle:t})},items:{Smith:{name:"Smith",icon:""},Polar:{name:"Polar",icon:""},XYOfPhase:{name:"XYOfPhase",icon:""},XYOfMagnitude:{name:"XYOfMagnitude",icon:""},XYdBOfMagnitude:{name:"XYdBOfMagnitude",icon:""}}}),$("#RFSP2SmallLegend").click(function(t){t=t||window.event,$(".allLegends").css({left:t.pageX+"px",top:t.pageY+"px"}).fadeIn(200);var a="";_.forEach(RF_SP2Store.stateObj.S2PSmallChartSmithData.S11,function(t,e){a+='<div class="row"><div class="col-sm-2 col-md-2 col-lg-2"><p class="legend_color" style="background-color: '+t.color+'"></p></div><div class="col-sm-10 col-md-10 col-lg-10"><p class="legend_text">'+t.name+"</p></div></div>"}),$(".allLegends_body>.container-fluid").empty().append(a)}),$(".allLegends_tit>span").click(function(){$(".allLegends").fadeOut(200)});