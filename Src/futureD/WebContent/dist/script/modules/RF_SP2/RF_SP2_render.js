function getDataBuildS12S21(e){var a=e.allData,t={xCategories:[]};_.forEach(a[0].data,function(e,a){t.xCategories.push(Math.floor(e[0]/1e7)/100)}),t.series=[],e.renderData&&_.forEach(a,function(e,a){var t={};t.name=e.name,t.data=[],_.forEach(e.data,function(e,a){t.data.push(parseFloat(e[1]))})}),t.container=e.container,t.zoomType=e.zoomType,t.resetZoomButton={position:{align:"left",x:0,y:0},relativeTo:"chart"},t.showCheckbox=e.showCheckbox,drawRealS12S21(t)}function getDataBuildS11S22(e){var a=smithChart(e.wrapDOM,e.title,e.legendName,e.data,e.classify,e.msgDOM,e.lineColorArray,e.msgFun,e.msgInitFun);_.isFunction(e.callback)&&e.callback(a)}function drawRealS12S21(a){var e=a.container,t=a.xCategories,i=a.series,r=a.legend_enabled||!0,n=a.zoomType||"None",s=a.resetZoomButton,o=a.text||null,l=a.showCheckbox||!1,d=Highcharts.chart(e,{chart:{type:"line",zoomType:n,resetZoomButton:s},title:{text:o},lang:{loading:"Loading..."},legend:{enabled:r},xAxis:{title:{text:"GHz"},categories:t},yAxis:{title:{text:"dB"},gridLineColor:"#eee",gridLineWidth:1},series:i,credits:{enabled:!1},tooltip:{formatter:function(e){return"<b>"+this.series.name+"</b><br>"+this.x+" GHz, "+this.y+" dB"},useHTML:!0},plotOptions:{series:{point:{events:{mouseOver:function(e){_.isFunction(a.pointMouseOverCallback)&&a.pointMouseOverCallback(this,d,e)}}},showCheckbox:l}}});return _.isFunction(a.callback)&&a.callback(d),d}function getEventPosition(e){var a,t;return e.layerX||0==e.layerX?(a=e.layerX,t=e.layerY):(e.offsetX||0==e.offsetX)&&(a=e.offsetX,t=e.offsetY),{x:a,y:t}}function renderSpline(a){var C=Highcharts.chart(a.container,{chart:{type:"spline",zoomType:"x",resetZoomButton:{position:{align:"left",x:90,y:10},relativeTo:"chart"}},title:{text:a.title},lang:{loading:"Loading..."},legend:{enabled:!0},xAxis:{title:{text:"Mhz"},categories:a.data.xData[0],gridLineColor:"#197F07",gridLineWidth:0,crosshair:{dashStyle:"LongDashDotDot",width:2,color:"#bbbbbb",snap:!0}},yAxis:{title:{text:"dB"},gridLineColor:"#eee",gridLineWidth:1,crosshair:{dashStyle:"LongDashDotDot",width:2,color:"#bbbbbb",snap:!0}},series:[{name:a.name[0],data:a.data.yData[0]},{name:a.name[1],data:a.data.yData[1]}],credits:{enabled:!1},tooltip:{formatter:function(e){return"y"==RF_SP2State.stateObj.comfirm_key?"<b>"+this.series.name+"</b><br>"+this.x+' Mhz, <b class="underline_b">'+this.y+" dB</b>":"x"==RF_SP2State.stateObj.comfirm_key?"<b>"+this.series.name+'</b><br><b class="underline_b">'+this.x+" Mhz</b>, "+this.y+" dB":"<b>"+this.series.name+"</b><br>"+this.x+" Mhz, "+this.y+" dB"},useHTML:!0},plotOptions:{series:{allowPointSelect:!1,connectNulls:!0,marker:{enabled:!0,radius:1,symbol:"diamond",states:{hover:{fillColor:"white",lineColor:"black",lineWidth:3},select:{fillColor:"white",lineColor:"red",lineWidth:3,radius:4}}},cursor:"pointer",point:{events:{mouseOver:function(e){0==this.colorIndex?($(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(0).children().text(this.series.name+" "+this.category+"Mhz, "+this.y+"dB"),$(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(1).children().text(a.name[1]+" "+this.category+"Mhz, "+a.data.yData[1][this.x]+"dB")):($(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(1).children().text(this.series.name+" "+this.category+"Mhz, "+this.y+"dB"),$(".g_bodyin_bodyin_bottom_rsubin_foot>.container-fluid>.row").eq(0).children().text(a.name[0]+" "+this.category+"Mhz, "+a.data.yData[0][this.x]+"dB"))},click:function(e){if(_.isNil(RF_SP2State.stateObj.comfirm_key))return RF_SP2SwalMixin({title:"Key值设置提醒",text:"请先设置Key值并保存",type:"info",showConfirmButton:!1,timer:2e3}),!1;var a=!this.colorIndex,t=this.series.name,i=C.series[Number(a)].name,r=this.category,s=this.y,n=this.x;if("x"==RF_SP2State.stateObj.comfirm_key){var o=C.series[Number(a)].yData[n];if(this.selected)this.select(!1,!0),C.series[Number(a)].data[n].select(!1,!0),_.pull(RF_SP2State.stateObj.splineSelectedArr,_.find(RF_SP2State.stateObj.splineSelectedArr,function(e){var a=!1;return e.name==t&&e.x==r&&(a=!0),a})),_.pull(RF_SP2State.stateObj.splineSelectedArr,_.find(RF_SP2State.stateObj.splineSelectedArr,function(e){var a=!1;return e.name==i&&e.x==r&&(a=!0),a})),$(".buildMarker_body>.container-fluid tbody>tr[data-iflag='"+(t+r)+"']").remove(),$(".buildMarker_body>.container-fluid tbody>tr[data-iflag='"+(i+r)+"']").remove();else{var l=0;if(_.forEach(RF_SP2State.stateObj.splineSelectedArr,function(e){e.name==t&&l++}),1<l)return RF_SP2SwalMixin({title:"Marker打点提示",text:"以x为Key时一条曲线最多打2个点",type:"error",timer:2500}),!1;this.select(!0,!0),C.series[Number(a)].data[n].select(!0,!0),saveMarkerANDaddTr(t,r,s,!1,n),saveMarkerANDaddTr(i,r,o,!1,n)}}else if("y"==RF_SP2State.stateObj.comfirm_key)if(this.selected)_.forEach(RF_SP2State.stateObj.splineSelectedArr,function(e,a){if(!_.isNil(e.isNew)){var t=_.indexOf(RF_SP2State.waferTCFSelected,e.name);C.series[t].data[_.indexOf(C.xAxis[0].categories,e.x)].select(!1,!0)}}),RF_SP2State.stateObj.splineSelectedArr=[],$(".buildMarker_body>.container-fluid tbody").empty(),RF_SP2State.stateObj.key_y=!1;else{if(RF_SP2State.stateObj.key_y)return!1;var d=C.series[Number(!a)].yData,c=_.lastIndexOf(d,s),f=_.indexOf(d,s);if(n==c&&n==f){var x=judgeIntersect(d,n,1,s),u=_.reverse(_.cloneDeep(d)),b=u.length-n-1,y=judgeIntersect(u,b,1,s);if(x||y){if(x&&!y)console.warn("第一步，自己曲线找","以y为Key时，当前曲线另一点存在但是还未找到，位置大于当前点"),renderPointToChart({iindex:n,yData1:d,y:s,chart:C,ii:a,name:t,x:r,flag:"last"});else if(!x&&y)console.warn("第一步，自己曲线找","以y为Key时，当前曲线另一点存在但是还未找到，位置小于当前点"),renderPointToChart({iindex:b,yData1:u,y:s,chart:C,ii:a,name:t,x:r,flag:"first"});else if(x&&y){console.warn("第一步，自己曲线找","以y为Key时，当前曲线存在两极");var h=findPointCombinatorial({fromIndex:0,Arr:d,baseVal:s,flag:"last"}),m=[],D=C.xAxis[0].categories;_.forEach([_.head(h),_.last(h)],function(e,a){var t=D[e.index],i=D[e.index+1],r=e.arr[0],n=e.arr[1];m.push(getPointXY({one:[t,r],two:[i,n],baseVal:s,index:e.index}))});var S=buildNewxyData({pointArr:m,xData:_.cloneDeep(D),yData:_.cloneDeep(d),yData2:_.cloneDeep(C.series[Number(a)].yData)});C.xAxis[0].setCategories(S.xData),C.series[Number(!a)].setData(S.yData),C.series[Number(a)].setData(S.yData2),saveMarkerANDaddTr(t,m[0].x,s,!0,m[0].index+1),saveMarkerANDaddTr(t,m[1].x,s,!0,m[1].index+2)}}else RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为Key时，当前曲线另一点不存在",type:"error",timer:2e3}),saveMarkerANDaddTr(t,r,s,!1,n),saveMarkerANDaddTr(t,NaN,s,null,-1)}else n==c&&n!=f?(console.warn("第一步，自己曲线找","当前曲线两点都存在，另一点位置在"+f),saveMarkerANDaddTr(t,r,s,!1,n),saveMarkerANDaddTr(t,C.xAxis[0].categories[f],s,!1,f)):n!=c&&n==f?(console.warn("第一步，自己曲线找","当前曲线两点都存在，另一点位置在"+c),saveMarkerANDaddTr(t,r,s,!1,n),saveMarkerANDaddTr(t,C.xAxis[0].categories[c],s,!1,c)):n!=c&&n!=f&&(console.warn("第一步，自己曲线找","当前曲线两点都存在，两点位置在"+f+","+c),saveMarkerANDaddTr(t,C.xAxis[0].categories[f],s,!1,f),saveMarkerANDaddTr(t,C.xAxis[0].categories[c],s,!1,c));var g=C.xAxis[0].categories,p=C.series[Number(a)].yData,v=[];if(_.forEach(p,function(e,a){e==s&&v.push(a)}),0==v.length)if(judgeIntersect(p,0,0,s)){var w,N=findPointCombinatorial({fromIndex:0,Arr:p,baseVal:s,flag:"last"}),A=[];1==N.length?(_.forEach([_.head(N)],function(e,a){var t=g[e.index],i=g[e.index+1],r=e.arr[0],n=e.arr[1];A.push(getPointXY({one:[t,r],two:[i,n],baseVal:s,index:e.index}))}),w=buildNewxyData({pointArr:A,xData:_.cloneDeep(g),yData:_.cloneDeep(p),yData2:_.cloneDeep(C.series[Number(!a)].yData)}),C.xAxis[0].setCategories(w.xData),C.series[Number(a)].setData(w.yData),C.series[Number(!a)].setData(w.yData2),saveMarkerANDaddTr(i,NaN,s,null,-1),saveMarkerANDaddTr(i,A[0].x,s,!0,A[0].index+1)):(_.forEach([_.head(N),_.last(N)],function(e,a){var t=g[e.index],i=g[e.index+1],r=e.arr[0],n=e.arr[1];A.push(getPointXY({one:[t,r],two:[i,n],baseVal:s,index:e.index}))}),w=buildNewxyData({pointArr:A,xData:_.cloneDeep(g),yData:_.cloneDeep(p),yData2:_.cloneDeep(C.series[Number(!a)].yData)}),C.xAxis[0].setCategories(w.xData),C.series[Number(a)].setData(w.yData),C.series[Number(!a)].setData(w.yData2),saveMarkerANDaddTr(i,A[0].x,s,!0,A[0].index+1),saveMarkerANDaddTr(i,A[1].x,s,!0,A[1].index+2))}else RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为Key时，另一条曲线两点都不存在",type:"error",timer:2e3}),saveMarkerANDaddTr(i,NaN,s,null,-1),saveMarkerANDaddTr(i,NaN,s,null,-1);else if(1==v.length){console.warn("第二步，另一条曲线找","另一条曲线有相同的y，有一个");var P=_.reverse(_.cloneDeep(p)),k=P.length-_.head(v)-1,M=judgeIntersect(p,_.head(v),1,s),F=judgeIntersect(P,k,1,s);if(M||F){if(M&&!F)console.warn("第二步，另一条曲线找","向后找有，向前找没"),renderPointToChart({iindex:_.head(v),yData1:p,y:s,chart:C,ii:!a,name:i,x:g[_.head(v)],flag:"last"});else if(!M&&F)console.warn("第二步，另一条曲线找","向前找有，向后找没"),renderPointToChart({iindex:k,yData1:P,y:s,chart:C,ii:!a,name:i,x:g[_.head(v)],flag:"first"});else if(M&&F){console.warn("第二步，另一条曲线找","另一条曲存在两极点");var R,T=findPointCombinatorial({fromIndex:0,Arr:p,baseVal:s,flag:"last"}),O=[];_.forEach([_.head(T),_.last(T)],function(e,a){var t=g[e.index],i=g[e.index+1],r=e.arr[0],n=e.arr[1];O.push(getPointXY({one:[t,r],two:[i,n],baseVal:s,index:e.index}))}),R=buildNewxyData({pointArr:O,xData:_.cloneDeep(g),yData:_.cloneDeep(p),yData2:_.cloneDeep(C.series[Number(!a)].yData)}),C.xAxis[0].setCategories(R.xData),C.series[Number(a)].setData(R.yData),C.series[Number(!a)].setData(R.yData2),saveMarkerANDaddTr(i,O[0].x,s,!0,O[0].index+1),saveMarkerANDaddTr(i,O[1].x,s,!0,O[1].index+2)}}else RF_SP2SwalMixin({title:"Marker打点提示",text:"以y为Key时，另一条曲线只存在一个点",type:"info",timer:2e3}),saveMarkerANDaddTr(i,g[_.head(v)],s,!1,_.head(v)),saveMarkerANDaddTr(i,NaN,s,null,-1)}else console.warn("第二步，另一条曲线找","另一条曲线有相同的y，大于一个"),saveMarkerANDaddTr(i,g[_.head(v)],s,!1,_.head(v)),saveMarkerANDaddTr(i,g[_.last(v)],s,!1,_.last(v));_.forEach(RF_SP2State.stateObj.splineSelectedArr,function(e,a){if(!_.isNil(e.isNew)){var t=_.indexOf(RF_SP2State.waferTCFSelected,e.name);C.series[t].data[_.indexOf(C.xAxis[0].categories,e.x)].select(!0,!0)}}),RF_SP2State.stateObj.key_y=!0}}}}}}});a.callback&&a.callback(C)}function judgeIntersect(t,i,r,n){var s=!1;return _.forEach(t,function(e,a){if(i<a)if(t[i+r]>n){if(e<n)return!(s=!0)}else{if(!(t[i+r]<n))return!(s=!0);if(n<e)return!(s=!0)}}),s}function saveMarkerANDaddTr(e,a,t,i,r){var n,s="Marker"+(n=_.isNil(RF_SP2State.stateObj.splineSelectedArr)||_.isEmpty(RF_SP2State.stateObj.splineSelectedArr)?1:Number(_.last(_.sortBy(RF_SP2State.stateObj.splineSelectedArr,function(e){return e.id})).id)+1);RF_SP2State.stateObj.splineSelectedArr.push({name:e,x:a,y:t,markerName:s,key:RF_SP2State.stateObj.comfirm_key,id:n,isNew:i,newIndex:r}),$(".buildMarker_body>.container-fluid tbody").append('<tr data-iflag="'+(e+a)+'"><td contenteditable="true" title="点击修改" data-iorigin="'+s+'">'+s+"</td><td>"+a+"</td><td>"+t+"</td><td>"+RF_SP2State.stateObj.comfirm_key+"</td></tr>")}function findPointCombinatorial(s){s.fromIndex;var o=[];return _.reduce(s.Arr,function(e,a,t,i){if(t>s.fromIndex){var r,n;if(_.sortBy([e,a])[0]<s.baseVal&&s.baseVal<_.sortBy([e,a])[1])"last"==s.flag?(r=t-1,n=[e,a]):"first"==s.flag&&(r=i.length-t-1,n=[a,e]),o.push({index:r,arr:n});return a}},s.Arr[s.fromIndex+1]),o}function getPointXY(e){var a=(e.two[1]-e.one[1])/e.two[0]-e.one[0],t=e.two[0]-(e.two[1]-e.baseVal)/a;return{x:t=Math.floor(100*t)/100,y:e.baseVal,index:e.index}}function buildNewxyData(t){return _.forEach(t.pointArr,function(e,a){t.xData.splice(e.index+a+1,0,e.x),t.yData.splice(e.index+a+1,0,e.y),t.yData2.splice(e.index+a+1,0,t.yData2[e.index+a])}),{xData:_.cloneDeep(t.xData),yData:_.cloneDeep(t.yData),yData2:_.cloneDeep(t.yData2)}}function renderPointToChart(e){var a=e.iindex,t=e.yData1,s=e.y,i=e.chart,o=i.xAxis[0].categories,r=e.ii,n=e.name,l=e.x,d=e.flag,c=findPointCombinatorial({fromIndex:a,Arr:t,baseVal:s,flag:d}),f=[],x=[];"last"==d||"first"==d?x[0]=_.last(c):"twoSlide"==d&&(x[0]=_.last(c)),_.forEach(x,function(e,a){var t=o[e.index],i=o[e.index+1],r=e.arr[0],n=e.arr[1];f.push(getPointXY({one:[t,r],two:[i,n],baseVal:s,index:e.index}))});var u=buildNewxyData({pointArr:f,xData:_.cloneDeep(o),yData:_.cloneDeep(i.series[Number(!r)].yData),yData2:_.cloneDeep(i.series[Number(r)].yData)});i.xAxis[0].setCategories(u.xData),i.series[Number(!r)].setData(u.yData),i.series[Number(r)].setData(u.yData2),saveMarkerANDaddTr(n,l,s,!1,a),saveMarkerANDaddTr(n,_.last(f).x,_.last(f).y,!0,_.last(f).index+1)}$(document).on("contextmenu","#S12_chart_S, #S21_chart_S, div.swal2-container",function(e){return!1}),$("#S12_chart_S, #S21_chart_S").mousedown(function(e){if(3==e.which){var a=$(this);RF_SP2SwalMixin({title:"选择切换的数据格式",html:'<div class="container-fluid"><div class="row"><div class="col-sm-12 col-md-12 col-lg-12"><label><input type="radio" name="swal_radio_RFSP2" data-iiradio="Smith">Smith</label></div></div><div class="row"><div class="col-sm-12 col-md-12 col-lg-12"><label><input type="radio" name="swal_radio_RFSP2" data-iiradio="Polar">Polar</label></div></div><div class="row"><div class="col-sm-12 col-md-12 col-lg-12"><label><input type="radio" name="swal_radio_RFSP2" data-iiradio="XY of Phase">XY of Phase</label></div></div><div class="row"><div class="col-sm-12 col-md-12 col-lg-12"><label><input type="radio" name="swal_radio_RFSP2" data-iiradio="XY of Phase(unwrapped)">XY of Phase(unwrapped)</label></div></div><div class="row"><div class="col-sm-12 col-md-12 col-lg-12"><label><input type="radio" name="swal_radio_RFSP2" data-iiradio="XY of Magnitude">XY of Magnitude</label></div></div><div class="row"><div class="col-sm-12 col-md-12 col-lg-12"><label><input type="radio" name="swal_radio_RFSP2" data-iiradio="XY db Magnitude">XY db Magnitude</label></div></div></div>',onBeforeOpen:function(){},onOpen:function(){$(document).on("change","input[name='swal_radio_RFSP2']",function(){var e=$("input[name='swal_radio_RFSP2']:checked").data("iiradio");a.data("iflag",e),RF_SP2State.contextObj.classify=a.data("iclassify"),RF_SP2State.contextObj.flag=a.data("iflag"),getDataBuildBigS12S21({iclassify:RF_SP2State.contextObj.classify,itargetchart:a.attr("id"),contextFlag:!0,iflag:RF_SP2State.contextObj.flag,callback:function(){RF_SP2SwalMixin({title:"切换成功！",text:"新数据已被绘制到图表",type:"success",showConfirmButton:!1,timer:1e3})}})})},showCancelButton:!1,showConfirmButton:!1,confirmButtonText:"确定，切换！",cancelButtonText:"不，取消！",reverseButtons:!1}).then(function(e){})}});