function IsInnerRect(e,i){return i.x>e.x&&i.x<=e.x+e.width&&i.y>e.y&&i.y<=e.y+e.height}function IsInSubRec(e,i){for(var t=!1,r=0;r<e.length;r++){var o=e[r];if(i.x>o.X&&i.x<=o.X+o.Width&&i.y>o.Y&&i.y<=o.Y+o.Height){t=e[r];break}}return t}function getEventPosition(e){var i,t;return e.layerX||0==e.layerX?(i=e.layerX,t=e.layerY):(e.offsetX||0==e.offsetX)&&(i=e.offsetX,t=e.offsetY),{x:i,y:t}}function mapAddHighLight(e,i,t,r,o){e.strokeStyle="#000000",e.lineWidth=.1*r,e.beginPath();var a=.037*r;e.moveTo(i+r/5,t),e.lineTo(i,t),e.lineTo(i,t+o/5),e.moveTo(i,t+o/5*4),e.lineTo(i,t+o-a),e.lineTo(i+r/5,t+o-a),e.moveTo(i+r/5*4,t+o-a),e.lineTo(i+r-a,t+o-a),e.lineTo(i+r-a,t+o/5*4),e.moveTo(i+r/5*4,t),e.lineTo(i+r-a,t),e.lineTo(i+r-a,t+o/5),e.stroke(),e.closePath()}function HashTable(){var t=0,r=new Object;this.add=function(e,i){this.containsKey(e)||t++,r[e]=i},this.getValue=function(e){return this.containsKey(e)?r[e]:null},this.remove=function(e){this.containsKey(e)&&delete r[e]&&t--},this.containsKey=function(e){return e in r},this.containsValue=function(e){for(var i in r)if(r[i]==e)return!0;return!1},this.getValues=function(){var e=new Array;for(var i in r)e.push(r[i]);return e},this.getKeys=function(){var e=new Array;for(var i in r)e.push(i);return e},this.getSize=function(){return t},this.clear=function(){t=0,r=new Object}}function changeHash(e){var i=new HashTable;if(e instanceof Array)for(var t=0;t<e.length;t++)for(var r in e[t])i.add(r,e[t][r]);else for(var r in e)i.add(r,e[r].bin);return i}function getCoordinateId(e,i){var t={};for(var r in e){var o=e[r].coordinateId,a=[];for(var l in i)if(i[l].coordinateId==o){var n={};n.subcoord=l,n.bin=i[l].subdieBin,n.subNo=i[l].subdieNO,n.percent=i[l].percent,a.push(n)}t[r]=a}return t}var subdieList=[{sX:3e3,sY:3e3,sW:1e4,sH:1e4,bin:100,Coord_X:"0",Coord_Y:"-1"}];function WaferMapPlotObj(e){console.log("option",e),this.colorMap=e.colorMap,this.bgFillColor=e.bgFillColor,this.ctx=e.ctx,this.r0=e.r0,this.r=e.r,this.centerX=e.centerX,this.centerY=e.centerY,this.dieX=e.dieX,this.dieY=e.dieY,this.minRow=e.minRow,this.maxRow=e.maxRow,this.minCol=e.minCol,this.maxCol=e.maxCol,this.coordsArray=e.coordsArray,this.positionFlag=e.positionFlag,this.FlatLength=e.FlatLength,this.colorOrder=e.colorOrder,this.filterArr=e.filterArr,this.currentDieCoord=e.currentDieCoord,this.isFirst=e.isFirst,this.isSaveDieCoord=e.isSaveDieCoord,this.saveDieCoord=e.saveDieCoord,this.coordsArra=e.coordsArra,this.vectorMap=e.vectorMap,this.container=e.container,this.waferData=e.waferData,this.param=e.param,this.subcoordsArray=e.subcoordsArray}function renderWaferMapByGetData(obj){var can=document.getElementById(obj.container),ctx=can.getContext("2d");if(can.width=obj.width,can.height=obj.height,_.isEmpty(obj.m_DieDataListNew))var coordsA=changeHash(obj.waferData.waferDie.currentDieList);else var coordsA=changeHash(obj.m_DieDataListNew);var subcoordsArray="";obj.waferData.containSubdie&&obj.colorOrder&&(subcoordsArray=obj.subcoordsArray);var newWaferMap=new WaferMapPlotObj({colorMap:obj.colorMap,bgFillColor:obj.bgFillColor,ctx:ctx,r0:parseFloat(obj.waferData.Diameter||obj.waferData.diameter),r:obj.width/2-obj.spacePercent.x*obj.width,centerX:obj.width/2,centerY:obj.width/2-obj.spacePercent.x*obj.width+obj.spacePercent.y*obj.height,dieX:parseFloat(obj.waferData.DieSizeX||obj.waferData.dieSizeX),dieY:parseFloat(obj.waferData.DieSizeY||obj.waferData.dieSizeY),minRow:parseFloat(obj.waferData.minY),maxRow:parseFloat(obj.waferData.maxY),minCol:parseFloat(obj.waferData.minX),maxCol:parseFloat(obj.waferData.maxX),coordsArray:coordsA,positionFlag:(obj.waferData.DirectionX||obj.waferData.directionX)+(obj.waferData.DirectionY||obj.waferData.directionY),FlatLength:parseFloat(obj.waferData.FlatLength||obj.waferData.flagLength),colorOrder:obj.colorOrder,filterArr:obj.filterArr,currentDieCoord:obj.currentDieCoord,isFirst:obj.isFirst,isSaveDieCoord:obj.isSaveDieCoord,saveDieCoord:obj.saveDieCoord,coordsArra:obj.coordsArra,vectorMap:obj.vectorMap,container:obj.container,waferData:obj.waferData,param:obj.param,subcoordsArray:subcoordsArray});if(newWaferMap.plot(),obj.addEvent&&($(can).off("mousemove click"),$(can).on({mousemove:function(e){e.stopPropagation(),obj.curSelectedDie=null;for(var i=eouluGlobal.S_getEventPosition(e),t="",r=obj.waferData.maxY;r>=obj.waferData.minY;r--){for(var o=obj.waferData.maxX;o>=obj.waferData.minX;o--){var a=o+":"+r;if(obj.coordsArra.containsKey(a)){var l=obj.coordsArra.getValue(a);if(IsInnerRect(l.rect,i)){var n=l.subDie;if(n&&IsInSubRec(n,i)){n=IsInSubRec(n,i),obj.curSelectedDie=n,obj.curSelectedDie.x=n.x,obj.curSelectedDie.y=n.y,t="SubDie信息";break}obj.curSelectedDie=_.cloneDeep(l),obj.curSelectedDie.x=o,obj.curSelectedDie.y=r,t="Die信息";break}}}if(null!=obj.curSelectedDie)break}null!==obj.curSelectedDie?($("html, body").css("cursor","pointer"),$("#in").fadeIn(50),$("#in").html('<ul style="list-style:none;"><li>'+t+"</li><li>Coord: ("+obj.curSelectedDie.x+":"+obj.curSelectedDie.y+")</li><li>Bin:"+obj.curSelectedDie.Bin+"</li>"),$("#in").css({left:i.x+10+"px",top:i.y+10+"px",color:"#000",background:"#fff",padding:"5px"})):($("#in").fadeOut(50),$("html,body").css("cursor","default"))},click:function(e){e.stopPropagation(),obj.curSelectedDie=null;for(var i=eouluGlobal.S_getEventPosition(e),t=obj.waferData.maxY;t>=obj.waferData.minY;t--){for(var r=obj.waferData.minX;r<=obj.waferData.maxX;r++){var o=r+":"+t;if(obj.coordsArra.containsKey(o)){var a=obj.coordsArra.getValue(o);if(IsInnerRect(a.rect,i)){if(!obj.waferData.containSubdie){obj.curSelectedDie=_.cloneDeep(a),obj.curSelectedDie.x=r,obj.curSelectedDie.y=t,dieorsubNameStr="Die信息";break}var l=a.subDie;if(IsInSubRec(l,i)){l=IsInSubRec(l,i),obj.curSelectedDie=l,obj.curSelectedDie.x=l.x,obj.curSelectedDie.y=l.y,dieorsubNameStr="SubDie信息";break}}}}if(null!=obj.curSelectedDie)break}if(null!=obj.curSelectedDie&&"disabled"!=obj.curSelectedDie.filterFlag&&-1!=obj.curSelectedDie.Bin&&5001!=obj.curSelectedDie.Bin&&"-1"!=obj.curSelectedDie.Dieno){var n=obj.curSelectedDie.x+":"+obj.curSelectedDie.y;newWaferMap.setPlotParam({currentDieCoord:n}).plot(),obj.clickCallback&&obj.clickCallback(n)}}}),$(document).off("keydown"),$(document).on("keydown",function(e){e.stopPropagation();for(var code=e.keyCode||e.which||e.charCode,currentDie_x="",currentDie_y="",i=parseFloat(obj.waferData.maxY);i>=parseFloat(obj.waferData.minY);i--)for(var j=parseFloat(obj.waferData.minX);j<=parseFloat(obj.waferData.maxX);j++){var key=j+":"+i;if(obj.coordsArra.containsKey(key)){var die=obj.coordsArra.getValue(key);if(die.moveFlag){currentDie_x=j,currentDie_y=i;break}}}var positionFlag=obj.waferData.DirectionX+obj.waferData.DirectionY,Die_x=currentDie_x,Die_y=currentDie_y,len=obj.coordsArra.getKeys().length,codeMap={37:{vari:"x",Left:"-",Right:"+"},38:{vari:"y",Top:"-",Down:"+"},39:{vari:"x",Left:"+",Right:"-"},40:{vari:"y",Top:"+",Down:"-"}},codeItem=_.find(codeMap,function(e,i){return i==code});if(_.isNil(codeItem))return!1;for(var i=1;i<len;i++){var a="Die_"+codeItem.vari,b="currentDie_"+codeItem.vari,c=codeItem[eval("obj.waferData.Direction"+codeItem.vari.toUpperCase())]||codeItem[eval("obj.waferData.direction"+codeItem.vari.toUpperCase())];console.log(a),console.log(b),console.log(c);var ee=a+" = "+b+c+"i";eval(ee);var newkey=Die_x+":"+Die_y;if(obj.coordsArra.containsKey(newkey)){if(-1==obj.coordsArra.getValue(newkey).Bin||5001==obj.coordsArra.getValue(newkey).Bin||"disabled"==obj.coordsArra.getValue(newkey).filterFlag)continue;break}}if(-1<_.indexOf([37,38,39,40],code)){var newkey2=Die_x+":"+Die_y;obj.coordsArra.containsKey(newkey2)&&(newWaferMap.setPlotParam({currentDieCoord:newkey2}).plot(),obj.keydownCallback&&obj.keydownCallback(newkey2))}})),obj.returnFlag)return newWaferMap}function getGradientColor(e,i,t,r){var o=/#((?:[0-9]|[a-fA-F]){2})((?:[0-9]|[a-fA-F]){2})((?:[0-9]|[a-fA-F]){2})/,a=e.match(o),l=i.match(o),n="";if(t=t||1,r=r||0,null===a&&(n="start"),null===l&&(n="end"),0<n.length)throw new Error("Invalid "+n+" color format, required hex color");var s=parseInt(a[1],16),c=parseInt(a[2],16),d=parseInt(a[3],16),f=parseInt(l[1],16),h=parseInt(l[2],16),b=parseInt(l[3],16),u=r/t,g=Math.round(s+(f-s)*u).toString(16),D=Math.round(c+(h-c)*u).toString(16),m=Math.round(d+(b-d)*u).toString(16);return"#"+(g=eouluGlobal.S_getLastStr("0"+g,2))+(D=eouluGlobal.S_getLastStr("0"+D,2))+(m=eouluGlobal.S_getLastStr("0"+m,2))}function buildColorGradation(i){var t=new HashTable,e=i.colorOrder;if(!0===e){var r=i.theMin,o=i.lowwer,a=i.midder,l=i.upper,n=i.theMax,s=i.colorGradation.twoDiff,c=i.colorGradation.threeDiff,d=i.colorGradation.fourDiff,f=i.colorGradation.fiveDiff;_.times(s,function(e){t.add("2:"+(r+e),getGradientColor(i.colorGradation.lowwerColor,i.colorGradation.theMinColor,i.colorGradation.twoDiff,i.colorGradation.twoDiff-e))}),_.times(c,function(e){t.add("3:"+(o+e),getGradientColor(i.colorGradation.midderColor,i.colorGradation.lowwerColor,i.colorGradation.threeDiff,i.colorGradation.threeDiff-e))}),_.times(d,function(e){t.add("4:"+(a+e),getGradientColor(i.colorGradation.upperColor,i.colorGradation.midderColor,i.colorGradation.fourDiff,i.colorGradation.fourDiff-e))}),_.times(f,function(e){t.add("5:"+(l+e),getGradientColor(i.colorGradation.theMaxColor,i.colorGradation.upperColor,i.colorGradation.fiveDiff,i.colorGradation.fiveDiff-e))}),t.add("1:"+r,i.colorGradation.theMinColor),t.add("6:"+n,i.colorGradation.theMaxColor),_.forOwn(i.otherColor,function(e,i){t.add(i,e)})}else t.add(-123456,i.colorGradation.limitColor),t.add(123456,i.colorGradation.limitColor),_.times(256,function(e){0<e&&t.add(e,getGradientColor(i.colorGradation.limitColor,i.colorGradation.floorColor,i.colorGradation.nums,i.colorGradation.nums-e))}),t.add(-1,"#314067"),t.add(5001,"#FFFFFF"),t.add(5e3,"#FDFDFD");var h=i.width,b=i.height;i.custom&&(!0===i.custom.WH&&(h=50*(i.waferData.maxX-i.waferData.minX+1),b=50*(i.waferData.maxY-i.waferData.minY+1)),(h>i.maxWidth||b>i.maxHeight)&&(h=b=_.sortBy([i.maxHeight,i.maxWidth])[0]));var u=renderWaferMapByGetData({width:h,height:b,container:i.container,bgFillColor:i.bgFillColor,colorMap:t,waferData:i.waferData,spacePercent:i.spacePercent,m_DieDataListNew:i.m_DieDataListNew,colorOrder:e,filterArr:i.filterArr,currentDieCoord:i.currentDieCoord,isFirst:i.isFirst,isSaveDieCoord:i.isSaveDieCoord,saveDieCoord:i.saveDieCoord,coordsArra:i.coordsArra,returnFlag:i.returnFlag,addEvent:i.addEvent,curSelectedDie:i.curSelectedDie,vectorMap:i.vectorMap,clickCallback:i.clickCallback,keydownCallback:i.keydownCallback,param:i.param,subcoordsArray:i.subcoordsArray}),g=(i.waferData.DirectionX||i.waferData.directionX)+(i.waferData.DirectionY||i.waferData.directionY);if(i.callback&&i.callback(g,u),i.resizeCallback&&i.resizeCallback(h,b,u),i.returnFlag)return u}null==WaferMapPlotObj.prototype.type&&(WaferMapPlotObj.prototype.setPlotParam=function(e){return _.isEmpty(e)||_.forOwn(e,function(e,i){this[i]=e}.bind(this)),this},WaferMapPlotObj.prototype.plot=function(){for(var e=this.colorMap,i=this.ctx,t=this.bgFillColor,r=.001*this.r*this.dieX/this.r0,o=.001*this.r*this.dieY/this.r0,a=this.r,l=-999999,n=999999,s=-999999,c=999999,d=this.colorOrder,f=this.filterArr,h=this.isFirst,b=this.isSaveDieCoord,u=this.coordsArra,g=this.vectorMap,D=this.maxRow;D>=this.minRow;D--)for(var m=this.maxCol;m>=this.minCol;m--){var y=m+":"+D;this.coordsArray.containsKey(y)&&(l<m&&(l=m),m<n&&(n=m),s<D&&(s=D),D<c&&(c=D),c==s&&(c-=1),l==n&&(n-=1))}var w=(l+n)/2,p=(s+c)/2;o=r*(l-n)/(s-c);var v=0,j=0;for(D=this.maxRow;D>=this.minRow;D--)for(m=this.maxCol;m>=this.minCol;m--){y=m+":"+D;this.coordsArray.containsKey(y)&&v<(j=Math.sqrt(Math.pow((Math.abs(m-w)+.5)*r,2)+Math.pow((Math.abs(D-p)+.5)*o,2)))&&(v=j)}r=.995*r*a/v,o=.995*o*a/v;var F=Math.floor(180*Math.asin(this.FlatLength/(2*this.r0))/Math.PI),C=(90+F)*Math.PI/180,S=(90-F)*Math.PI/180;i.fillStyle=t,i.beginPath(),C==S?i.arc(this.centerX,this.centerY,this.r,0,2*Math.PI):i.arc(this.centerX,this.centerY,this.r,C,S),i.closePath(),i.fill();this.r,this.r;var x=0;if(subdieFlag=this.waferData.containSubdie,"nullnull"==this.positionFlag)for(D=this.maxRow;D>=this.minRow;D--){var A=this.centerY+D*o-o;for(m=this.maxCol;m>=this.minCol;m--){y=m+":"+D;var k=this.centerX-m*r;if(this.coordsArray.containsKey(y)){x++;var M=this.coordsArray.getValue(y),O=new Object,R=new Object;if(!0===d?(i.fillStyle=e.getValue(M.color),g&&(_.isEmpty(f)?O.filterFlag="undisabled":-1<_.indexOf(f,y)&&-1!=M.bin?O.filterFlag="undisabled":(i.fillStyle="#ccc",O.filterFlag="disabled"))):(i.fillStyle=e.getValue(M),g&&(_.isEmpty(f)?O.filterFlag="undisabled":-1<_.indexOf(f,y)&&-1!=M?O.filterFlag="undisabled":(i.fillStyle="#ccc",O.filterFlag="disabled"))),i.fillRect(k,A,r,o),i.lineWidth=1,i.strokeStyle="black",i.strokeRect(k,A,r,o),g){var X=M;!0===d&&(X=M.bin),_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==O.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,k,A,r,o),h=!1,(O.moveFlag=!0)===b&&(this.saveDieCoord[0]=y)):this.currentDieCoord==y?(mapAddHighLight(i,k,A,r,o),O.moveFlag=!0):O.moveFlag=!1,R.x=k,R.y=A,R.width=r,R.height=o,O.Dieno=x,O.Bin=X,O.rect=R,u.add(y,O)}}else i.fillStyle="#20242b"}}else if("RightDown"==this.positionFlag)for(D=this.maxRow;D>=this.minRow;D--)for(A=this.centerY-D*o+p*o-.5*o,m=this.maxCol;m>=this.minCol;m--){y=m+":"+D,k=this.centerX-m*r+w*r-.5*r;if(this.coordsArray.containsKey(y)){x++;M=this.coordsArray.getValue(y),O=new Object,R=new Object;if(!0===d?(i.fillStyle=e.getValue(M.color),g&&(_.isEmpty(f)?O.filterFlag="undisabled":-1<_.indexOf(f,y)&&-1!=M.bin?O.filterFlag="undisabled":(i.fillStyle="#ccc",O.filterFlag="disabled"))):(i.fillStyle=e.getValue(M),g&&(_.isEmpty(f)?O.filterFlag="undisabled":-1<_.indexOf(f,y)&&-1!=M?O.filterFlag="undisabled":(i.fillStyle="#ccc",O.filterFlag="disabled"))),i.fillRect(k,A,r,o),i.lineWidth=1,i.strokeStyle="black",i.strokeRect(k,A,r,o),g){X=M;!0===d&&(X=M.bin),_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==O.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,k,A,r,o),h=!1,(O.moveFlag=!0)===b&&(this.saveDieCoord[0]=y)):this.currentDieCoord==y?(mapAddHighLight(i,k,A,r,o),O.moveFlag=!0):O.moveFlag=!1,R.x=k,R.y=A,R.width=r,R.height=o,O.Dieno=x,O.Bin=X,O.rect=R,u.add(y,O)}}else i.fillStyle="#20242b"}else if("RightTop"==this.positionFlag)for(D=this.minRow;D<=this.maxRow;D++)for(A=this.centerY+D*o-p*o-.5*o,m=this.maxCol;m>=this.minCol;m--){y=m+":"+D,k=this.centerX-m*r+w*r-.5*r;if(this.coordsArray.containsKey(y)){x++;M=this.coordsArray.getValue(y),O=new Object,R=new Object;if(!0===d?(i.fillStyle=e.getValue(M.color),g&&(_.isEmpty(f)?O.filterFlag="undisabled":-1<_.indexOf(f,y)&&-1!=M.bin?O.filterFlag="undisabled":(i.fillStyle="#ccc",O.filterFlag="disabled"))):(i.fillStyle=e.getValue(M),g&&(_.isEmpty(f)?O.filterFlag="undisabled":-1<_.indexOf(f,y)&&-1!=M?O.filterFlag="undisabled":(i.fillStyle="#ccc",O.filterFlag="disabled"))),i.fillRect(k,A,r,o),i.lineWidth=1,i.strokeStyle="black",i.strokeRect(k,A,r,o),g){X=M;!0===d&&(X=M.bin),_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==O.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,k,A,r,o),h=!1,(O.moveFlag=!0)===b&&(this.saveDieCoord[0]=y)):this.currentDieCoord==y?(mapAddHighLight(i,k,A,r,o),O.moveFlag=!0):O.moveFlag=!1,R.x=k,R.y=A,R.width=r,R.height=o,O.Dieno=x,O.Bin=X,O.rect=R,u.add(y,O)}}else i.fillStyle="#20242b"}else if("LeftTop"==this.positionFlag)for(D=this.minRow;D<=this.maxRow;D++)for(A=this.centerY+D*o-p*o-.5*o,m=this.minCol;m<=this.maxCol;m++){y=m+":"+D,k=this.centerX+m*r-w*r-.5*r;if(this.coordsArray.containsKey(y)){x++;M=this.coordsArray.getValue(y),O=new Object,R=new Object;if(!0===d?(i.fillStyle=e.getValue(M.color),g&&(_.isEmpty(f)?O.filterFlag="undisabled":-1<_.indexOf(f,y)&&-1!=M.bin?O.filterFlag="undisabled":(i.fillStyle="#ccc",O.filterFlag="disabled"))):(i.fillStyle=e.getValue(M),g&&(_.isEmpty(f)?O.filterFlag="undisabled":-1<_.indexOf(f,y)&&-1!=M?O.filterFlag="undisabled":(i.fillStyle="#ccc",O.filterFlag="disabled"))),i.fillRect(k,A,r,o),i.lineWidth=1,i.strokeStyle="black",i.strokeRect(k,A,r,o),g){X=M;!0===d&&(X=M.bin),_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==O.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,k,A,r,o),h=!1,(O.moveFlag=!0)===b&&(this.saveDieCoord[0]=y)):this.currentDieCoord==y?(mapAddHighLight(i,k,A,r,o),O.moveFlag=!0):O.moveFlag=!1,R.x=k,R.y=A,R.width=r,R.height=o,O.Dieno=x,O.Bin=X,O.rect=R,u.add(y,O)}}else i.fillStyle="#20242b"}else if("LeftDown"==this.positionFlag)for(D=this.minRow;D<=this.maxRow;D++)for(A=this.centerY-D*o+p*o-.5*o,m=this.minCol;m<=this.maxCol;m++){y=m+":"+D,k=this.centerX+m*r-w*r-.5*r;if(this.coordsArray.containsKey(y)){x++;M=this.coordsArray.getValue(y),O=new Object,R=new Object;var G=new Object;!0===d?(i.fillStyle=e.getValue(M.color),g&&(_.isEmpty(f)?O.filterFlag="undisabled":-1<_.indexOf(f,y)&&-1!=M.bin?O.filterFlag="undisabled":(i.fillStyle="#ccc",O.filterFlag="disabled"))):(i.fillStyle=e.getValue(M),g&&(_.isEmpty(f)?O.filterFlag="undisabled":-1<_.indexOf(f,y)&&-1!=M?O.filterFlag="undisabled":(i.fillStyle="#ccc",O.filterFlag="disabled"))),i.fillRect(k,A,r,o),i.lineWidth=1,i.strokeStyle="black",i.strokeRect(k,A,r,o);X=M;if(!0===d&&(X=M.bin),subdieFlag){if(this.param)var I=_.find(this.waferData.waferList,{parameter:this.param}).currentSubdieList;else I=this.waferData.waferList.currentSubdieList;var Y,L,P=getCoordinateId(this.waferData.waferDie.currentDieList,I),V=r/this.dieX,E=[];for(var H in this.waferData.subdieConfig){var W=new Object;if(-1==M)Y=-1,L=P[y][T].subcoord;else for(var T=0;T<P[y].length;T++)if(P[y][T].subNo==H){L=P[y][T].subcoord,Y=d?_.find(this.subcoordsArray,function(e){return-1<_.keys(e).indexOf(L)})[L]:P[y][T];break}G=this.waferData.subdieConfig[H];var B=Math.abs(G[0]),K=Math.abs(G[1]),N=Math.abs(G[2]),$=Math.abs(G[3]);i.beginPath(),i.fillStyle=d?e.getValue(Y.color):e.getValue(Y.bin),i.fillStyle=e.getValue(Y),i.fillRect(V*B+k,V*K+A,V*N,V*$),i.closePath(),i.beginPath(),i.lineWidth=1,i.strokeStyle="#7171b8",i.strokeRect(V*B+k,V*K+A,V*N,V*$),i.closePath();new Object;g&&(_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==O.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,V*B+k,V*K+A,V*N,V*$),!(h=!1)===b&&(this.saveDieCoord[0]=L)):this.currentDieCoord==L&&mapAddHighLight(i,V*B+k,V*K+A,V*N,V*$),W.Height=V*$,W.Width=V*N,W.X=V*B+k,W.Y=V*K+A,W.x=L.split(":")[0],W.y=L.split(":")[1],W.Bin=Y.bin,E.push(W))}g&&(R.x=k,R.y=A,R.width=r,R.height=o,O.Dieno=x,O.Bin=X,O.rect=R,O.subDie=E,u.add(y,O))}g&&!subdieFlag&&(_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==O.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,k,A,r,o),h=!1,(O.moveFlag=!0)===b&&(this.saveDieCoord[0]=y)):this.currentDieCoord==y?(mapAddHighLight(i,k,A,r,o),O.moveFlag=!0):O.moveFlag=!1,R.x=k,R.y=A,R.width=r,R.height=o,O.Dieno=x,O.Bin=X,O.rect=R,u.add(y,O))}else i.fillStyle="#20242b"}});