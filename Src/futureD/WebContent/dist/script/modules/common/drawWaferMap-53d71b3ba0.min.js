function IsInnerRect(e,i){return i.x>e.x&&i.x<=e.x+e.width&&i.y>e.y&&i.y<=e.y+e.height}function IsInSubRec(e,i){for(var t=!1,a=0;a<e.length;a++){var r=e[a];if(i.x>r.X&&i.x<=r.X+r.Width&&i.y>r.Y&&i.y<=r.Y+r.Height){t=e[a];break}}return t}function getEventPosition(e){var i,t;return e.layerX||0==e.layerX?(i=e.layerX,t=e.layerY):(e.offsetX||0==e.offsetX)&&(i=e.offsetX,t=e.offsetY),{x:i,y:t}}function mapAddHighLight(e,i,t,a,r){e.strokeStyle="#000000",e.lineWidth=.1*a,e.beginPath();var o=.037*a;e.moveTo(i+a/5,t),e.lineTo(i,t),e.lineTo(i,t+r/5),e.moveTo(i,t+r/5*4),e.lineTo(i,t+r-o),e.lineTo(i+a/5,t+r-o),e.moveTo(i+a/5*4,t+r-o),e.lineTo(i+a-o,t+r-o),e.lineTo(i+a-o,t+r/5*4),e.moveTo(i+a/5*4,t),e.lineTo(i+a-o,t),e.lineTo(i+a-o,t+r/5),e.stroke(),e.closePath()}function HashTable(){var t=0,a=new Object;this.add=function(e,i){this.containsKey(e)||t++,a[e]=i},this.getValue=function(e){return this.containsKey(e)?a[e]:null},this.remove=function(e){this.containsKey(e)&&delete a[e]&&t--},this.containsKey=function(e){return e in a},this.containsValue=function(e){for(var i in a)if(a[i]==e)return!0;return!1},this.getValues=function(){var e=new Array;for(var i in a)e.push(a[i]);return e},this.getKeys=function(){var e=new Array;for(var i in a)e.push(i);return e},this.getSize=function(){return t},this.clear=function(){t=0,a=new Object}}function changeHash(e){var i=new HashTable;if(e instanceof Array)for(var t=0;t<e.length;t++)for(var a in e[t])i.add(a,e[t][a]);else for(var a in e)i.add(a,e[a].bin);return i}function getCoordinateId(e,i){var t={};for(var a in e){var r=e[a].coordinateId,o=[];for(var l in i)if(i[l].coordinateId==r){var s={};s.subcoord=l,s.bin=i[l].subdieBin,s.subNo=i[l].subdieNO,s.percent=i[l].percent,o.push(s)}t[a]=o}return t}var subdieList=[{sX:3e3,sY:3e3,sW:1e4,sH:1e4,bin:100,Coord_X:"0",Coord_Y:"-1"}];function WaferMapPlotObj(e){console.log("option",e),this.colorMap=e.colorMap,this.bgFillColor=e.bgFillColor,this.ctx=e.ctx,this.r0=e.r0,this.r=e.r,this.centerX=e.centerX,this.centerY=e.centerY,this.dieX=e.dieX,this.dieY=e.dieY,this.minRow=e.minRow,this.maxRow=e.maxRow,this.minCol=e.minCol,this.maxCol=e.maxCol,this.coordsArray=e.coordsArray,this.positionFlag=e.positionFlag,this.FlatLength=e.FlatLength,this.colorOrder=e.colorOrder,this.filterArr=e.filterArr,this.currentDieCoord=e.currentDieCoord,this.isFirst=e.isFirst,this.isSaveDieCoord=e.isSaveDieCoord,this.saveDieCoord=e.saveDieCoord,this.coordsArra=e.coordsArra,this.vectorMap=e.vectorMap,this.container=e.container,this.waferData=e.waferData,this.param=e.param,this.subcoordsArray=e.subcoordsArray}function renderWaferMapByGetData(obj){var can=document.getElementById(obj.container),ctx=can.getContext("2d");if(can.width=obj.width,can.height=obj.height,_.isEmpty(obj.m_DieDataListNew))var coordsA=changeHash(obj.waferData.waferDie.currentDieList);else var coordsA=changeHash(obj.m_DieDataListNew);var subcoordsArray="";obj.waferData.containSubdie&&obj.colorOrder&&(subcoordsArray=obj.subcoordsArray);var newWaferMap=new WaferMapPlotObj({colorMap:obj.colorMap,bgFillColor:obj.bgFillColor,ctx:ctx,r0:parseFloat(obj.waferData.Diameter||obj.waferData.diameter),r:obj.width/2-obj.spacePercent.x*obj.width,centerX:obj.width/2,centerY:obj.width/2-obj.spacePercent.x*obj.width+obj.spacePercent.y*obj.height,dieX:parseFloat(obj.waferData.DieSizeX||obj.waferData.dieSizeX),dieY:parseFloat(obj.waferData.DieSizeY||obj.waferData.dieSizeY),minRow:parseFloat(obj.waferData.minY),maxRow:parseFloat(obj.waferData.maxY),minCol:parseFloat(obj.waferData.minX),maxCol:parseFloat(obj.waferData.maxX),coordsArray:coordsA,positionFlag:(obj.waferData.DirectionX||obj.waferData.directionX)+(obj.waferData.DirectionY||obj.waferData.directionY),FlatLength:parseFloat(obj.waferData.FlatLength||obj.waferData.flagLength),colorOrder:obj.colorOrder,filterArr:obj.filterArr,currentDieCoord:obj.currentDieCoord,isFirst:obj.isFirst,isSaveDieCoord:obj.isSaveDieCoord,saveDieCoord:obj.saveDieCoord,coordsArra:obj.coordsArra,vectorMap:obj.vectorMap,container:obj.container,waferData:obj.waferData,param:obj.param,subcoordsArray:subcoordsArray});if(newWaferMap.plot(),obj.addEvent&&($(can).off("mousemove click"),$(can).on({mousemove:function(e){e.stopPropagation(),obj.curSelectedDie=null;for(var i=eouluGlobal.S_getEventPosition(e),t="",a=obj.waferData.maxY;a>=obj.waferData.minY;a--){for(var r=obj.waferData.maxX;r>=obj.waferData.minX;r--){var o=r+":"+a;if(obj.coordsArra.containsKey(o)){var l=obj.coordsArra.getValue(o);if(IsInnerRect(l.rect,i)){var s=l.subDie;if(s&&IsInSubRec(s,i)){s=IsInSubRec(s,i),obj.curSelectedDie=s,obj.curSelectedDie.x=s.x,obj.curSelectedDie.y=s.y,t="SubDie信息";break}obj.curSelectedDie=_.cloneDeep(l),obj.curSelectedDie.x=r,obj.curSelectedDie.y=a,t="Die信息";break}}}if(null!=obj.curSelectedDie)break}null!==obj.curSelectedDie?($("html, body").css("cursor","pointer"),$("#in").fadeIn(50),$("#in").html('<ul style="list-style:none;"><li>'+t+"</li><li>Coord: ("+obj.curSelectedDie.x+":"+obj.curSelectedDie.y+")</li><li>Bin:"+obj.curSelectedDie.Bin+"</li>"),$("#in").css({left:i.x+10+"px",top:i.y+10+"px",color:"#000",background:"#fff",padding:"5px"})):($("#in").fadeOut(50),$("html,body").css("cursor","default"))},click:function(e){e.stopPropagation(),obj.curSelectedDie=null;for(var i=eouluGlobal.S_getEventPosition(e),t=obj.waferData.maxY;t>=obj.waferData.minY;t--){for(var a=obj.waferData.minX;a<=obj.waferData.maxX;a++){var r=a+":"+t;if(obj.coordsArra.containsKey(r)){var o=obj.coordsArra.getValue(r);if(IsInnerRect(o.rect,i)){if(!obj.waferData.containSubdie){obj.curSelectedDie=_.cloneDeep(o),obj.curSelectedDie.x=a,obj.curSelectedDie.y=t,dieorsubNameStr="Die信息";break}var l=o.subDie;if(IsInSubRec(l,i)){l=IsInSubRec(l,i),obj.curSelectedDie=l,obj.curSelectedDie.x=l.x,obj.curSelectedDie.y=l.y,dieorsubNameStr="SubDie信息";break}}}}if(null!=obj.curSelectedDie)break}if(null!=obj.curSelectedDie&&"disabled"!=obj.curSelectedDie.filterFlag&&-1!=obj.curSelectedDie.Bin&&5001!=obj.curSelectedDie.Bin&&"-1"!=obj.curSelectedDie.Dieno){var s=obj.curSelectedDie.x+":"+obj.curSelectedDie.y;newWaferMap.setPlotParam({currentDieCoord:s}).plot(),obj.clickCallback&&obj.clickCallback(s)}}}),$(document).off("keydown"),$(document).on("keydown",function(e){e.stopPropagation();for(var code=e.keyCode||e.which||e.charCode,currentDie_x="",currentDie_y="",i=parseFloat(obj.waferData.maxY);i>=parseFloat(obj.waferData.minY);i--)for(var j=parseFloat(obj.waferData.minX);j<=parseFloat(obj.waferData.maxX);j++){var key=j+":"+i;if(obj.coordsArra.containsKey(key)){var die=obj.coordsArra.getValue(key);if(die.moveFlag){currentDie_x=j,currentDie_y=i;break}}}var positionFlag=obj.waferData.DirectionX+obj.waferData.DirectionY,Die_x=currentDie_x,Die_y=currentDie_y,len=obj.coordsArra.getKeys().length,codeMap={37:{vari:"x",Left:"-",Right:"+"},38:{vari:"y",Top:"-",Down:"+"},39:{vari:"x",Left:"+",Right:"-"},40:{vari:"y",Top:"+",Down:"-"}},codeItem=_.find(codeMap,function(e,i){return i==code});if(_.isNil(codeItem))return!1;for(var i=1;i<len;i++){var a="Die_"+codeItem.vari,b="currentDie_"+codeItem.vari,c=codeItem[eval("obj.waferData.Direction"+codeItem.vari.toUpperCase())]||codeItem[eval("obj.waferData.direction"+codeItem.vari.toUpperCase())];console.log(a),console.log(b),console.log(c);var ee=a+" = "+b+c+"i";eval(ee);var newkey=Die_x+":"+Die_y;if(obj.coordsArra.containsKey(newkey)){if(-1==obj.coordsArra.getValue(newkey).Bin||5001==obj.coordsArra.getValue(newkey).Bin||"disabled"==obj.coordsArra.getValue(newkey).filterFlag)continue;break}}if(-1<_.indexOf([37,38,39,40],code)){var newkey2=Die_x+":"+Die_y;obj.coordsArra.containsKey(newkey2)&&(newWaferMap.setPlotParam({currentDieCoord:newkey2}).plot(),obj.keydownCallback&&obj.keydownCallback(newkey2))}})),obj.returnFlag)return newWaferMap}function getGradientColor(e,i,t,a){var r=/#((?:[0-9]|[a-fA-F]){2})((?:[0-9]|[a-fA-F]){2})((?:[0-9]|[a-fA-F]){2})/,o=e.match(r),l=i.match(r),s="";if(t=t||1,a=a||0,null===o&&(s="start"),null===l&&(s="end"),0<s.length)throw new Error("Invalid "+s+" color format, required hex color");var n=parseInt(o[1],16),d=parseInt(o[2],16),c=parseInt(o[3],16),f=parseInt(l[1],16),h=parseInt(l[2],16),b=parseInt(l[3],16),u=a/t,g=Math.round(n+(f-n)*u).toString(16),D=Math.round(d+(h-d)*u).toString(16),y=Math.round(c+(b-c)*u).toString(16);return"#"+(g=eouluGlobal.S_getLastStr("0"+g,2))+(D=eouluGlobal.S_getLastStr("0"+D,2))+(y=eouluGlobal.S_getLastStr("0"+y,2))}function buildColorGradation(i){var t=new HashTable,e=i.colorOrder;if(!0===e){var a=i.theMin,r=i.lowwer,o=i.midder,l=i.upper,s=i.theMax,n=i.colorGradation.twoDiff,d=i.colorGradation.threeDiff,c=i.colorGradation.fourDiff,f=i.colorGradation.fiveDiff;_.times(n,function(e){t.add("2:"+(a+e),getGradientColor(i.colorGradation.lowwerColor,i.colorGradation.theMinColor,i.colorGradation.twoDiff,i.colorGradation.twoDiff-e))}),_.times(d,function(e){t.add("3:"+(r+e),getGradientColor(i.colorGradation.midderColor,i.colorGradation.lowwerColor,i.colorGradation.threeDiff,i.colorGradation.threeDiff-e))}),_.times(c,function(e){t.add("4:"+(o+e),getGradientColor(i.colorGradation.upperColor,i.colorGradation.midderColor,i.colorGradation.fourDiff,i.colorGradation.fourDiff-e))}),_.times(f,function(e){t.add("5:"+(l+e),getGradientColor(i.colorGradation.theMaxColor,i.colorGradation.upperColor,i.colorGradation.fiveDiff,i.colorGradation.fiveDiff-e))}),t.add("1:"+a,i.colorGradation.theMinColor),t.add("6:"+s,i.colorGradation.theMaxColor),_.forOwn(i.otherColor,function(e,i){t.add(i,e)})}else t.add(-123456,i.colorGradation.limitColor),t.add(123456,i.colorGradation.limitColor),_.times(256,function(e){0<e&&t.add(e,getGradientColor(i.colorGradation.limitColor,i.colorGradation.floorColor,i.colorGradation.nums,i.colorGradation.nums-e))}),t.add(-1,"#314067"),t.add(5001,"#FFFFFF"),t.add(5e3,"#FDFDFD");var h=i.width,b=i.height;i.custom&&(!0===i.custom.WH&&(h=50*(i.waferData.maxX-i.waferData.minX+1),b=50*(i.waferData.maxY-i.waferData.minY+1)),(h>i.maxWidth||b>i.maxHeight)&&(h=b=_.sortBy([i.maxHeight,i.maxWidth])[0]));var u=renderWaferMapByGetData({width:h,height:b,container:i.container,bgFillColor:i.bgFillColor,colorMap:t,waferData:i.waferData,spacePercent:i.spacePercent,m_DieDataListNew:i.m_DieDataListNew,colorOrder:e,filterArr:i.filterArr,currentDieCoord:i.currentDieCoord,isFirst:i.isFirst,isSaveDieCoord:i.isSaveDieCoord,saveDieCoord:i.saveDieCoord,coordsArra:i.coordsArra,returnFlag:i.returnFlag,addEvent:i.addEvent,curSelectedDie:i.curSelectedDie,vectorMap:i.vectorMap,clickCallback:i.clickCallback,keydownCallback:i.keydownCallback,param:i.param,subcoordsArray:i.subcoordsArray}),g=(i.waferData.DirectionX||i.waferData.directionX)+(i.waferData.DirectionY||i.waferData.directionY);if(i.callback&&i.callback(g,u),i.resizeCallback&&i.resizeCallback(h,b,u),i.returnFlag)return u}null==WaferMapPlotObj.prototype.type&&(WaferMapPlotObj.prototype.setPlotParam=function(e){return _.isEmpty(e)||_.forOwn(e,function(e,i){this[i]=e}.bind(this)),this},WaferMapPlotObj.prototype.plot=function(){for(var e=this.colorMap,i=this.ctx,t=this.bgFillColor,a=.001*this.r*this.dieX/this.r0,r=.001*this.r*this.dieY/this.r0,o=this.r,l=-999999,s=999999,n=-999999,d=999999,c=this.colorOrder,f=this.filterArr,h=this.isFirst,b=this.isSaveDieCoord,u=this.coordsArra,g=this.vectorMap,D=this.maxRow;D>=this.minRow;D--)for(var y=this.maxCol;y>=this.minCol;y--){var w=y+":"+D;this.coordsArray.containsKey(w)&&(l<y&&(l=y),y<s&&(s=y),n<D&&(n=D),D<d&&(d=D),d==n&&(d-=1),l==s&&(s-=1))}var m=(l+s)/2,p=(n+d)/2;r=a*(l-s)/(n-d);var F=0,j=0;for(D=this.maxRow;D>=this.minRow;D--)for(y=this.maxCol;y>=this.minCol;y--){w=y+":"+D;this.coordsArray.containsKey(w)&&F<(j=Math.sqrt(Math.pow((Math.abs(y-m)+.5)*a,2)+Math.pow((Math.abs(D-p)+.5)*r,2)))&&(F=j)}a=.995*a*o/F,r=.995*r*o/F;var v=Math.floor(180*Math.asin(this.FlatLength/(2*this.r0))/Math.PI),C=(90+v)*Math.PI/180,S=(90-v)*Math.PI/180;i.fillStyle=t,i.beginPath(),C==S?i.arc(this.centerX,this.centerY,this.r,0,2*Math.PI):i.arc(this.centerX,this.centerY,this.r,C,S),i.closePath(),i.fill();this.r,this.r;var x=0;if(subdieFlag=this.waferData.containSubdie,"nullnull"==this.positionFlag)for(D=this.maxRow;D>=this.minRow;D--){var A=this.centerY+D*r-r;for(y=this.maxCol;y>=this.minCol;y--){w=y+":"+D;var k=this.centerX-y*a;if(this.coordsArray.containsKey(w)){x++;var M=this.coordsArray.getValue(w),L=new Object,O=new Object,R=new Object;!0===c?(i.fillStyle=e.getValue(M.color),g&&!subdieFlag&&(_.isEmpty(f)?L.filterFlag="undisabled":-1<_.indexOf(f,w)&&-1!=M.bin?L.filterFlag="undisabled":(i.fillStyle="#ccc",L.filterFlag="disabled"))):(i.fillStyle=e.getValue(M),g&&!subdieFlag&&(_.isEmpty(f)?L.filterFlag="undisabled":-1<_.indexOf(f,w)&&-1!=M?L.filterFlag="undisabled":(i.fillStyle="#ccc",L.filterFlag="disabled"))),i.fillRect(k,A,a,r),i.lineWidth=1,i.strokeStyle="black",i.strokeRect(k,A,a,r);var X=M;if(!0===c&&(X=M.bin),subdieFlag){if(this.param)var P=_.assign(_.find(this.waferData.waferList,{parameter:this.param}).currentSubdieList,this.waferData.otherSubdieType);else P=_.assign(this.waferData.waferList.currentSubdieList,this.waferData.otherSubdieType);var I=getCoordinateId(this.waferData.waferDie.currentDieList,P),G=a/this.dieX,Y=[];for(var H in console.log("this.subcoordsArray",this.subcoordsArray),this.waferData.subdieConfig){for(var E=new Object,V=0;V<I[w].length;V++)if(I[w][V].subNo==H){$=I[w][V].subcoord,N=-1==M?-1:c?_.find(this.subcoordsArray,function(e){return-1<_.keys(e).indexOf($)})[$]:I[w][V];break}R=this.waferData.subdieConfig[H];var W=Math.abs(R[0]),T=Math.abs(R[1]),B=Math.abs(R[2]),K=Math.abs(R[3]);i.beginPath(),i.fillStyle=c?e.getValue(N.color):e.getValue(N.bin),_.isEmpty(f)||-1==M?R.filterFlag="undisabled":-1<_.indexOf(f,$)?R.filterFlag="undisabled":(i.fillStyle="#ccc",R.filterFlag="disabled"),i.fillRect(G*W+k,G*T+A,G*B,G*K),i.closePath(),i.beginPath(),i.lineWidth=1,i.strokeStyle="#7171b8",i.strokeRect(G*W+k,G*T+A,G*B,G*K),i.closePath();new Object;g&&(_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==R.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,G*W+k,G*T+A,G*B,G*K),!(h=!1)===b&&(this.saveDieCoord[0]=$)):this.currentDieCoord==$&&mapAddHighLight(i,G*W+k,G*T+A,G*B,G*K),E.Height=G*K,E.Width=G*B,E.X=G*W+k,E.Y=G*T+A,E.x=$.split(":")[0],E.y=$.split(":")[1],E.Bin=-1==N?-1:N.bin,E.filterFlag=R.filterFlag,Y.push(E))}g&&(O.x=k,O.y=A,O.width=a,O.height=r,L.Dieno=x,L.Bin=X,L.rect=O,L.subDie=Y,u.add(w,L))}g&&!subdieFlag&&(_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==L.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,k,A,a,r),h=!1,(L.moveFlag=!0)===b&&(this.saveDieCoord[0]=w)):this.currentDieCoord==w?(mapAddHighLight(i,k,A,a,r),L.moveFlag=!0):L.moveFlag=!1,O.x=k,O.y=A,O.width=a,O.height=r,L.Dieno=x,L.Bin=X,L.rect=O,u.add(w,L))}else i.fillStyle="#20242b"}}else if("RightDown"==this.positionFlag)for(D=this.maxRow;D>=this.minRow;D--)for(A=this.centerY-D*r+p*r-.5*r,y=this.maxCol;y>=this.minCol;y--){w=y+":"+D,k=this.centerX-y*a+m*a-.5*a;if(this.coordsArray.containsKey(w)){x++;M=this.coordsArray.getValue(w),L=new Object,O=new Object,R=new Object;!0===c?(i.fillStyle=e.getValue(M.color),g&&!subdieFlag&&(_.isEmpty(f)?L.filterFlag="undisabled":-1<_.indexOf(f,w)&&-1!=M.bin?L.filterFlag="undisabled":(i.fillStyle="#ccc",L.filterFlag="disabled"))):(i.fillStyle=e.getValue(M),g&&!subdieFlag&&(_.isEmpty(f)?L.filterFlag="undisabled":-1<_.indexOf(f,w)&&-1!=M?L.filterFlag="undisabled":(i.fillStyle="#ccc",L.filterFlag="disabled"))),i.fillRect(k,A,a,r),i.lineWidth=1,i.strokeStyle="black",i.strokeRect(k,A,a,r);X=M;if(!0===c&&(X=M.bin),subdieFlag){if(this.param)P=_.assign(_.find(this.waferData.waferList,{parameter:this.param}).currentSubdieList,this.waferData.otherSubdieType);else P=_.assign(this.waferData.waferList.currentSubdieList,this.waferData.otherSubdieType);I=getCoordinateId(this.waferData.waferDie.currentDieList,P),G=a/this.dieX,Y=[];for(var H in console.log("this.subcoordsArray",this.subcoordsArray),this.waferData.subdieConfig){for(E=new Object,V=0;V<I[w].length;V++)if(I[w][V].subNo==H){$=I[w][V].subcoord,N=-1==M?-1:c?_.find(this.subcoordsArray,function(e){return-1<_.keys(e).indexOf($)})[$]:I[w][V];break}R=this.waferData.subdieConfig[H],W=Math.abs(R[0]),T=Math.abs(R[1]),B=Math.abs(R[2]),K=Math.abs(R[3]);i.beginPath(),i.fillStyle=c?e.getValue(N.color):e.getValue(N.bin),_.isEmpty(f)||-1==M?R.filterFlag="undisabled":-1<_.indexOf(f,$)?R.filterFlag="undisabled":(i.fillStyle="#ccc",R.filterFlag="disabled"),i.fillRect(G*W+k,G*T+A,G*B,G*K),i.closePath(),i.beginPath(),i.lineWidth=1,i.strokeStyle="#7171b8",i.strokeRect(G*W+k,G*T+A,G*B,G*K),i.closePath();new Object;g&&(_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==R.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,G*W+k,G*T+A,G*B,G*K),!(h=!1)===b&&(this.saveDieCoord[0]=$)):this.currentDieCoord==$&&mapAddHighLight(i,G*W+k,G*T+A,G*B,G*K),E.Height=G*K,E.Width=G*B,E.X=G*W+k,E.Y=G*T+A,E.x=$.split(":")[0],E.y=$.split(":")[1],E.Bin=-1==N?-1:N.bin,E.filterFlag=R.filterFlag,Y.push(E))}g&&(O.x=k,O.y=A,O.width=a,O.height=r,L.Dieno=x,L.Bin=X,L.rect=O,L.subDie=Y,u.add(w,L))}g&&!subdieFlag&&(_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==L.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,k,A,a,r),h=!1,(L.moveFlag=!0)===b&&(this.saveDieCoord[0]=w)):this.currentDieCoord==w?(mapAddHighLight(i,k,A,a,r),L.moveFlag=!0):L.moveFlag=!1,O.x=k,O.y=A,O.width=a,O.height=r,L.Dieno=x,L.Bin=X,L.rect=O,u.add(w,L))}else i.fillStyle="#20242b"}else if("RightTop"==this.positionFlag)for(D=this.minRow;D<=this.maxRow;D++)for(A=this.centerY+D*r-p*r-.5*r,y=this.maxCol;y>=this.minCol;y--){w=y+":"+D,k=this.centerX-y*a+m*a-.5*a;if(this.coordsArray.containsKey(w)){x++;M=this.coordsArray.getValue(w),L=new Object,O=new Object,R=new Object;!0===c?(i.fillStyle=e.getValue(M.color),g&&!subdieFlag&&(_.isEmpty(f)?L.filterFlag="undisabled":-1<_.indexOf(f,w)&&-1!=M.bin?L.filterFlag="undisabled":(i.fillStyle="#ccc",L.filterFlag="disabled"))):(i.fillStyle=e.getValue(M),g&&!subdieFlag&&(_.isEmpty(f)?L.filterFlag="undisabled":-1<_.indexOf(f,w)&&-1!=M?L.filterFlag="undisabled":(i.fillStyle="#ccc",L.filterFlag="disabled"))),i.fillRect(k,A,a,r),i.lineWidth=1,i.strokeStyle="black",i.strokeRect(k,A,a,r);X=M;if(!0===c&&(X=M.bin),subdieFlag){if(this.param)P=_.assign(_.find(this.waferData.waferList,{parameter:this.param}).currentSubdieList,this.waferData.otherSubdieType);else P=_.assign(this.waferData.waferList.currentSubdieList,this.waferData.otherSubdieType);I=getCoordinateId(this.waferData.waferDie.currentDieList,P),G=a/this.dieX,Y=[];for(var H in console.log("this.subcoordsArray",this.subcoordsArray),this.waferData.subdieConfig){for(E=new Object,V=0;V<I[w].length;V++)if(I[w][V].subNo==H){$=I[w][V].subcoord,N=-1==M?-1:c?_.find(this.subcoordsArray,function(e){return-1<_.keys(e).indexOf($)})[$]:I[w][V];break}R=this.waferData.subdieConfig[H],W=Math.abs(R[0]),T=Math.abs(R[1]),B=Math.abs(R[2]),K=Math.abs(R[3]);i.beginPath(),i.fillStyle=c?e.getValue(N.color):e.getValue(N.bin),_.isEmpty(f)||-1==M?R.filterFlag="undisabled":-1<_.indexOf(f,$)?R.filterFlag="undisabled":(i.fillStyle="#ccc",R.filterFlag="disabled"),i.fillRect(G*W+k,G*T+A,G*B,G*K),i.closePath(),i.beginPath(),i.lineWidth=1,i.strokeStyle="#7171b8",i.strokeRect(G*W+k,G*T+A,G*B,G*K),i.closePath();new Object;g&&(_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==R.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,G*W+k,G*T+A,G*B,G*K),!(h=!1)===b&&(this.saveDieCoord[0]=$)):this.currentDieCoord==$&&mapAddHighLight(i,G*W+k,G*T+A,G*B,G*K),E.Height=G*K,E.Width=G*B,E.X=G*W+k,E.Y=G*T+A,E.x=$.split(":")[0],E.y=$.split(":")[1],E.Bin=-1==N?-1:N.bin,E.filterFlag=R.filterFlag,Y.push(E))}g&&(O.x=k,O.y=A,O.width=a,O.height=r,L.Dieno=x,L.Bin=X,L.rect=O,L.subDie=Y,u.add(w,L))}g&&!subdieFlag&&(_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==L.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,k,A,a,r),h=!1,(L.moveFlag=!0)===b&&(this.saveDieCoord[0]=w)):this.currentDieCoord==w?(mapAddHighLight(i,k,A,a,r),L.moveFlag=!0):L.moveFlag=!1,O.x=k,O.y=A,O.width=a,O.height=r,L.Dieno=x,L.Bin=X,L.rect=O,u.add(w,L))}else i.fillStyle="#20242b"}else if("LeftTop"==this.positionFlag)for(D=this.minRow;D<=this.maxRow;D++)for(A=this.centerY+D*r-p*r-.5*r,y=this.minCol;y<=this.maxCol;y++){w=y+":"+D,k=this.centerX+y*a-m*a-.5*a;if(this.coordsArray.containsKey(w)){x++;M=this.coordsArray.getValue(w),L=new Object,O=new Object,R=new Object;!0===c?(i.fillStyle=e.getValue(M.color),g&&!subdieFlag&&(_.isEmpty(f)?L.filterFlag="undisabled":-1<_.indexOf(f,w)&&-1!=M.bin?L.filterFlag="undisabled":(i.fillStyle="#ccc",L.filterFlag="disabled"))):(i.fillStyle=e.getValue(M),g&&!subdieFlag&&(_.isEmpty(f)?L.filterFlag="undisabled":-1<_.indexOf(f,w)&&-1!=M?L.filterFlag="undisabled":(i.fillStyle="#ccc",L.filterFlag="disabled"))),i.fillRect(k,A,a,r),i.lineWidth=1,i.strokeStyle="black",i.strokeRect(k,A,a,r);X=M;if(!0===c&&(X=M.bin),subdieFlag){if(this.param)P=_.assign(_.find(this.waferData.waferList,{parameter:this.param}).currentSubdieList,this.waferData.otherSubdieType);else P=_.assign(this.waferData.waferList.currentSubdieList,this.waferData.otherSubdieType);I=getCoordinateId(this.waferData.waferDie.currentDieList,P),G=a/this.dieX,Y=[];for(var H in this.waferData.subdieConfig){for(E=new Object,V=0;V<I[w].length;V++)if(I[w][V].subNo==H){$=I[w][V].subcoord,N=-1==M?-1:c?_.find(this.subcoordsArray,function(e){return-1<_.keys(e).indexOf($)})[$]:I[w][V];break}R=this.waferData.subdieConfig[H],W=Math.abs(R[0]),T=Math.abs(R[1]),B=Math.abs(R[2]),K=Math.abs(R[3]);i.beginPath(),i.fillStyle=c?e.getValue(N.color):e.getValue(N.bin),_.isEmpty(f)||-1==M?R.filterFlag="undisabled":-1<_.indexOf(f,$)?R.filterFlag="undisabled":(i.fillStyle="#ccc",R.filterFlag="disabled"),i.fillRect(G*W+k,G*T+A,G*B,G*K),i.closePath(),i.beginPath(),i.lineWidth=1,i.strokeStyle="#7171b8",i.strokeRect(G*W+k,G*T+A,G*B,G*K),i.closePath();new Object;g&&(_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==R.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,G*W+k,G*T+A,G*B,G*K),!(h=!1)===b&&(this.saveDieCoord[0]=$)):this.currentDieCoord==$&&mapAddHighLight(i,G*W+k,G*T+A,G*B,G*K),E.Height=G*K,E.Width=G*B,E.X=G*W+k,E.Y=G*T+A,E.x=$.split(":")[0],E.y=$.split(":")[1],E.Bin=-1==N?-1:N.bin,E.filterFlag=R.filterFlag,Y.push(E))}g&&(O.x=k,O.y=A,O.width=a,O.height=r,L.Dieno=x,L.Bin=X,L.rect=O,L.subDie=Y,u.add(w,L))}g&&!subdieFlag&&(_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==L.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,k,A,a,r),h=!1,(L.moveFlag=!0)===b&&(this.saveDieCoord[0]=w)):this.currentDieCoord==w?(mapAddHighLight(i,k,A,a,r),L.moveFlag=!0):L.moveFlag=!1,O.x=k,O.y=A,O.width=a,O.height=r,L.Dieno=x,L.Bin=X,L.rect=O,u.add(w,L))}else i.fillStyle="#20242b"}else if("LeftDown"==this.positionFlag)for(D=this.minRow;D<=this.maxRow;D++)for(A=this.centerY-D*r+p*r-.5*r,y=this.minCol;y<=this.maxCol;y++){w=y+":"+D,k=this.centerX+y*a-m*a-.5*a;if(this.coordsArray.containsKey(w)){x++;M=this.coordsArray.getValue(w),L=new Object,O=new Object,R=new Object;!0===c?(i.fillStyle=e.getValue(M.color),g&&!subdieFlag&&(_.isEmpty(f)?L.filterFlag="undisabled":-1<_.indexOf(f,w)&&-1!=M.bin?L.filterFlag="undisabled":(i.fillStyle="#ccc",L.filterFlag="disabled"))):(i.fillStyle=e.getValue(M),g&&!subdieFlag&&(_.isEmpty(f)?L.filterFlag="undisabled":-1<_.indexOf(f,w)&&-1!=M?L.filterFlag="undisabled":(i.fillStyle="#ccc",L.filterFlag="disabled"))),i.fillRect(k,A,a,r),i.lineWidth=1,i.strokeStyle="black",i.strokeRect(k,A,a,r);X=M;if(!0===c&&(X=M.bin),subdieFlag){if(this.param)P=_.assign(_.find(this.waferData.waferList,{parameter:this.param}).currentSubdieList,this.waferData.otherSubdieType);else P=_.assign(this.waferData.waferList.currentSubdieList,this.waferData.otherSubdieType);var N,$;I=getCoordinateId(this.waferData.waferDie.currentDieList,P),G=a/this.dieX,Y=[];for(var H in this.waferData.subdieConfig){for(E=new Object,V=0;V<I[w].length;V++)if(I[w][V].subNo==H){$=I[w][V].subcoord,N=-1==M?-1:c?_.find(this.subcoordsArray,function(e){return-1<_.keys(e).indexOf($)})[$]:I[w][V];break}R=this.waferData.subdieConfig[H],W=Math.abs(R[0]),T=Math.abs(R[1]),B=Math.abs(R[2]),K=Math.abs(R[3]);i.beginPath(),i.fillStyle=c?e.getValue(N.color):e.getValue(N.bin),_.isEmpty(f)||-1==M?R.filterFlag="undisabled":-1<_.indexOf(f,$)?R.filterFlag="undisabled":(i.fillStyle="#ccc",R.filterFlag="disabled"),i.fillRect(G*W+k,G*T+A,G*B,G*K),i.closePath(),i.beginPath(),i.lineWidth=1,i.strokeStyle="#7171b8",i.strokeRect(G*W+k,G*T+A,G*B,G*K),i.closePath();new Object;g&&(_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==R.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,G*W+k,G*T+A,G*B,G*K),!(h=!1)===b&&(this.saveDieCoord[0]=$)):this.currentDieCoord==$&&mapAddHighLight(i,G*W+k,G*T+A,G*B,G*K),E.Height=G*K,E.Width=G*B,E.X=G*W+k,E.Y=G*T+A,E.x=$.split(":")[0],E.y=$.split(":")[1],E.Bin=-1==N?-1:N.bin,E.filterFlag=R.filterFlag,Y.push(E))}g&&(O.x=k,O.y=A,O.width=a,O.height=r,L.Dieno=x,L.Bin=X,L.rect=O,L.subDie=Y,u.add(w,L))}g&&!subdieFlag&&(_.isEmpty(this.currentDieCoord)&&h&&"undisabled"==L.filterFlag&&-1!=X&&5001!=X?(mapAddHighLight(i,k,A,a,r),h=!1,(L.moveFlag=!0)===b&&(this.saveDieCoord[0]=w)):this.currentDieCoord==w?(mapAddHighLight(i,k,A,a,r),L.moveFlag=!0):L.moveFlag=!1,O.x=k,O.y=A,O.width=a,O.height=r,L.Dieno=x,L.Bin=X,L.rect=O,u.add(w,L))}else i.fillStyle="#20242b"}});